/*! drawerjs - 1.11.0
 */
var fabric=fabric||{version:"1.7.1"},emptyFunc=("undefined"!=typeof exports&&(exports.fabric=fabric),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.document.createWindow?fabric.window=fabric.document.createWindow():fabric.window=fabric.document.parentWindow),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id"],fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.charWidthsCache={},fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,!function(){function o(t,e){this.__eventListeners[t]&&(t=this.__eventListeners[t],e?t[t.indexOf(e)]=!1:fabric.util.array.fill(t,!1))}function t(t,e){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var i in t)this.on(i,t[i]);else this.__eventListeners[t]||(this.__eventListeners[t]=[]),this.__eventListeners[t].push(e);return this}function e(t,e){if(this.__eventListeners){if(0===arguments.length)for(t in this.__eventListeners)o.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var i in t)o.call(this,i,t[i]);else o.call(this,t,e);return this}}function i(t,e){if(this.__eventListeners){var i=this.__eventListeners[t];if(i){for(var o=0,n=i.length;o<n;o++)i[o]&&i[o].call(this,e||{});return this.__eventListeners[t]=i.filter(function(t){return!1!==t}),this}}}fabric.Observable={observe:t,stopObserving:e,fire:i,on:t,off:e,trigger:i}}(),fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var t=0,e=arguments.length;t<e;t++)this._onObjectAdded(arguments[t]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(t,e,i){var o=this.getObjects();return i?o[e]=t:o.splice(e,0,t),this._onObjectAdded&&this._onObjectAdded(t),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var t,e=this.getObjects(),i=!1,o=0,n=arguments.length;o<n;o++)-1!==(t=e.indexOf(arguments[o]))&&(i=!0,e.splice(t,1),this._onObjectRemoved)&&this._onObjectRemoved(arguments[o]);return this.renderOnAddRemove&&i&&this.renderAll(),this},forEachObject:function(t,e){for(var i=this.getObjects(),o=0,n=i.length;o<n;o++)t.call(e,i[o],o,i);return this},getObjects:function(e){return void 0===e?this._objects:this._objects.filter(function(t){return t.type===e})},item:function(t){return this.getObjects()[t]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(t){return-1<this.getObjects().indexOf(t)},complexity:function(){return this.getObjects().reduce(function(t,e){return t+=e.complexity?e.complexity():0},0)}},!function(r){var c=Math.sqrt,p=Math.atan2,s=Math.pow,o=Math.abs,a=Math.PI/180;fabric.util={removeFromArray:function(t,e){e=t.indexOf(e);return-1!==e&&t.splice(e,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*a},radiansToDegrees:function(t){return t/a},rotatePoint:function(t,e,i){t.subtractEquals(e);t=fabric.util.rotateVector(t,i);return new fabric.Point(t.x,t.y).addEquals(e)},rotateVector:function(t,e){var i=Math.sin(e),e=Math.cos(e);return{x:t.x*e-t.y*i,y:t.x*i+t.y*e}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),e=fabric.util.array.max(e),e=Math.abs(i-e),t=[t[0].y,t[1].y,t[2].y,t[3].y],o=fabric.util.array.min(t),t=fabric.util.array.max(t);return{left:i,top:o,width:e,height:Math.abs(o-t)}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),e=[e*t[3],-e*t[1],-e*t[2],e*t[0]],t=fabric.util.transformPoint({x:t[4],y:t[5]},e,!0);return e[4]=-t.x,e[5]=-t.y,e},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),o=parseFloat(t);switch(e=e||fabric.Text.DEFAULT_SVG_FONT_SIZE,i[0]){case"mm":return o*fabric.DPI/25.4;case"cm":return o*fabric.DPI/2.54;case"in":return o*fabric.DPI;case"pt":return o*fabric.DPI/72;case"pc":return o*fabric.DPI/72*12;case"em":return o*e;default:return o}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},resolveNamespace:function(t){if(!t)return fabric;for(var e=t.split("."),i=e.length,o=r||fabric.window,n=0;n<i;++n)o=o[e[n]];return o},loadImage:function(t,e,i,o){var n;t?((n=fabric.util.createImage()).onload=function(){e&&e.call(i,n),n=n.onload=n.onerror=null},n.onerror=function(){fabric.log("Error loading "+n.src),e&&e.call(i,null,!0),n=n.onload=n.onerror=null},0!==t.indexOf("data")&&o&&(n.crossOrigin=o),n.src=t):e&&e.call(i,t)},enlivenObjects:function(t,e,n,r){function s(){++i===o&&e&&e(a)}var a=[],i=0,o=(t=t||[]).length;o?t.forEach(function(i,o){var t;i&&i.type?(t=fabric.util.getKlass(i.type,n)).async?t.fromObject(i,function(t,e){e||(a[o]=t,r&&r(i,a[o])),s()}):(a[o]=t.fromObject(i),r&&r(i,a[o]),s()):s()}):e&&e(a)},groupSVGElements:function(t,e,i){t=new fabric.PathGroup(t,e);return void 0!==i&&t.setSourcePath(i),t},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var o=0,n=i.length;o<n;o++)i[o]in t&&(e[i[o]]=t[i[o]])},drawDashedLine:function(t,e,i,o,n,r){var o=o-e,n=n-i,s=c(o*o+n*n),n=p(n,o),a=r.length,h=0,l=!0;for(t.save(),t.translate(e,i),t.moveTo(0,0),t.rotate(n),e=0;e<s;)s<(e+=r[h++%a])&&(e=s),t[l?"lineTo":"moveTo"](e,0),l=!l;t.restore()},createCanvasElement:function(t){return(t=t||fabric.document.createElement("canvas")).getContext||"undefined"==typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(t),t},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(t){for(var e,i,o,n=t.prototype,r=n.stateProperties.length;r--;)i="set"+(o=(e=n.stateProperties[r]).charAt(0).toUpperCase()+e.slice(1)),n[o="get"+o]||(n[o]=new Function('return this.get("'+e+'")')),n[i]||(n[i]=new Function("value",'return this.set("'+e+'", value)'))},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var e=p(t[1],t[0]),i=s(t[0],2)+s(t[1],2),o=c(i),n=(t[0]*t[3]-t[2]*t[1])/o,i=p(t[0]*t[2]+t[1]*t[3],i);return{angle:e/a,scaleX:o,scaleY:n,skewX:i/a,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){i=[1,0,o(Math.tan(i*a)),1],t=[o(t),0,0,o(e)];return fabric.util.multiplyTransformMatrices(t,i,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.setAngle(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,o){0<o&&(o<e?e-=o:e=0,o<i?i-=o:i=0);for(var n=!0,r=t.getImageData(e,i,2*o||1,2*o||1),s=r.data.length,a=3;a<s&&!1!=(n=r.data[a]<=0);a+=4);return r=null,n},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",t=t.split(" ");return t&&t.length&&("meet"!==(i=t.pop())&&"slice"!==i?(e=i,i="meet"):t.length&&(e=t.pop())),{meetOrSlice:i,alignX:"none"!==e?e.slice(1,4):"none",alignY:"none"!==e?e.slice(5,8):"none"}},clearFabricFontCache:function(t){t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}}}}("undefined"!=typeof exports?exports:this),!function(){var P={},k={},S={},M=Array.prototype.join;function v(t,e,i,o,n,r,s){var a=M.call(arguments);if(P[a])return P[a];for(var h=Math.PI,l=s*h/180,c=Math.sin(l),p=Math.cos(l),u=0,d=0,l=-p*t*.5-c*e*.5,f=-p*e*.5+c*t*.5,g=(i=Math.abs(i))*i,v=(o=Math.abs(o))*o,b=f*f,m=l*l,y=g*v-g*b-v*m,_=0,C=(y<0?(i*=C=Math.sqrt(1-y/(g*v)),o*=C):_=(n===r?-1:1)*Math.sqrt(y/(g*b+v*m)),_*i*f/o),y=-_*o*l/i,w=p*C-c*y+.5*t,T=c*C+p*y+.5*e,O=B(1,0,(l-C)/i,(f-y)/o),g=B((l-C)/i,(f-y)/o,(-l-C)/i,(-f-y)/o),S=(0===r&&0<g?g-=2*h:1===r&&g<0&&(g+=2*h),Math.ceil(Math.abs(g/h*2))),E=[],x=g/S,I=8/3*Math.sin(x/4)*Math.sin(x/4)/Math.sin(x/2),D=O+x,A=0;A<S;A++)E[A]=function(t,e,i,o,n,r,s,a,h,l,c){var p,u,d,f,g,v,b,m=M.call(arguments);return k[m]||(u=Math.cos(t),g=Math.sin(t),p=Math.cos(e),b=Math.sin(e),f=l+h*(-i*n*g-o*r*u),g=c+h*(-o*n*g+i*r*u),v=(u=i*n*p-o*r*b+s)+h*(i*n*b+o*r*p),b=(d=o*n*p+i*r*b+a)+h*(o*n*b-i*r*p),k[m]=[f,g,v,b,u,d]),k[m]}(O,D,p,c,i,o,w,T,I,u,d),u=E[A][4],d=E[A][5],O=D,D+=x;return P[a]=E}function B(t,e,i,o){e=Math.atan2(e,t),t=Math.atan2(o,i);return e<=t?t-e:2*Math.PI-(e-t)}function b(t,e,i,o,n,r,s,a){var h=M.call(arguments);if(S[h])return S[h];for(var l,c,p,u=Math.sqrt,d=Math.min,f=Math.max,g=Math.abs,v=[],b=[[],[]],m=6*t-12*i+6*n,y=-3*t+9*i-9*n+3*s,_=3*i-3*t,C=0;C<2;++C)0<C&&(m=6*e-12*o+6*r,y=-3*e+9*o-9*r+3*a,_=3*o-3*e),g(y)<1e-12?g(m)<1e-12||0<(l=-_/m)&&l<1&&v.push(l):(p=m*m-4*_*y)<0||(0<(c=(-m+(p=u(p)))/(2*y))&&c<1&&v.push(c),0<(c=(-m-p)/(2*y))&&c<1&&v.push(c));for(var w,T=v.length,O=T;T--;)b[0][T]=(w=1-(l=v[T]))*w*w*t+3*w*w*l*i+3*w*l*l*n+l*l*l*s,b[1][T]=w*w*w*e+3*w*w*l*o+3*w*l*l*r+l*l*l*a;b[0][O]=t,b[1][O]=e,b[0][O+1]=s,b[1][O+1]=a;O=[{x:d.apply(null,b[0]),y:d.apply(null,b[1])},{x:f.apply(null,b[0]),y:f.apply(null,b[1])}];return S[h]=O}fabric.util.drawArc=function(t,e,i,o){for(var n=o[0],r=o[1],s=o[2],a=o[3],h=o[4],l=[[],[],[],[]],c=v(o[5]-e,o[6]-i,n,r,a,h,s),p=0,u=c.length;p<u;p++)l[p][0]=c[p][0]+e,l[p][1]=c[p][1]+i,l[p][2]=c[p][2]+e,l[p][3]=c[p][3]+i,l[p][4]=c[p][4]+e,l[p][5]=c[p][5]+i,t.bezierCurveTo.apply(t,l[p])},fabric.util.getBoundsOfArc=function(t,e,i,o,n,r,s,a,h){for(var l,c=0,p=0,u=[],d=v(a-t,h-e,i,o,r,s,n),f=0,g=d.length;f<g;f++)l=b(c,p,d[f][0],d[f][1],d[f][2],d[f][3],d[f][4],d[f][5]),u.push({x:l[0].x+t,y:l[0].y+e}),u.push({x:l[1].x+t,y:l[1].y+e}),c=d[f][4],p=d[f][5];return u},fabric.util.getBoundsOfCurve=b}(),!function(){var s=Array.prototype.slice;function i(t,e,i){if(t&&0!==t.length){var o=t.length-1,n=e?t[o][e]:t[o];if(e)for(;o--;)i(t[o][e],n)&&(n=t[o][e]);else for(;o--;)i(t[o],n)&&(n=t[o]);return n}}Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(null==this)throw new TypeError;var e=Object(this),i=e.length>>>0;if(0!=i){var o=0;if(0<arguments.length&&((o=Number(arguments[1]))!=o?o=0:0!==o&&o!==Number.POSITIVE_INFINITY&&o!==Number.NEGATIVE_INFINITY&&(o=(0<o||-1)*Math.floor(Math.abs(o)))),!(i<=o))for(var n=0<=o?o:Math.max(i-Math.abs(o),0);n<i;n++)if(n in e&&e[n]===t)return n}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){for(var i=0,o=this.length>>>0;i<o;i++)i in this&&t.call(e,this[i],i,this)}),Array.prototype.map||(Array.prototype.map=function(t,e){for(var i=[],o=0,n=this.length>>>0;o<n;o++)o in this&&(i[o]=t.call(e,this[o],o,this));return i}),Array.prototype.every||(Array.prototype.every=function(t,e){for(var i=0,o=this.length>>>0;i<o;i++)if(i in this&&!t.call(e,this[i],i,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t,e){for(var i=0,o=this.length>>>0;i<o;i++)if(i in this&&t.call(e,this[i],i,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(t,e){for(var i,o=[],n=0,r=this.length>>>0;n<r;n++)n in this&&(i=this[n],t.call(e,i,n,this))&&o.push(i);return o}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var e,i=this.length>>>0,o=0;if(1<arguments.length)e=arguments[1];else for(;;){if(o in this){e=this[o++];break}if(++o>=i)throw new TypeError}for(;o<i;o++)o in this&&(e=t.call(null,e,this[o],o,this));return e}),fabric.util.array={fill:function(t,e){for(var i=t.length;i--;)t[i]=e;return t},invoke:function(t,e){for(var i=s.call(arguments,2),o=[],n=0,r=t.length;n<r;n++)o[n]=i.length?t[n][e].apply(t[n],i):t[n][e].call(t[n]);return o},min:function(t,e){return i(t,e,function(t,e){return t<e})},max:function(t,e){return i(t,e,function(t,e){return e<=t})}}}(),!function(){function s(t,e,i){if(i)if(!fabric.isLikelyNode&&e instanceof Element)t=e;else if(e instanceof Array){t=[];for(var o=0,n=e.length;o<n;o++)t[o]=s({},e[o],i)}else if(e&&"object"==typeof e)for(var r in e)e.hasOwnProperty(r)&&(t[r]=s({},e[r],i));else t=e;else for(var r in e)t[r]=e[r];return t}fabric.util.object={extend:s,clone:function(t,e){return s({},t,e)}}}(),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:function(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})},capitalize:function(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:function(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},!function(){function n(){}var r=Array.prototype.slice,s=Function.prototype.apply;Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,i=r.call(arguments,1),o=i.length?function(){return s.call(e,this instanceof n?this:t,i.concat(r.call(arguments)))}:function(){return s.call(e,this instanceof n?this:t,arguments)};return n.prototype=this.prototype,o.prototype=new n,o})}(),!function(){function r(){}var s=Array.prototype.slice,a=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}();function h(){}function l(t){var e=this.constructor.superclass.prototype[t];return 1<arguments.length?e.apply(this,s.call(arguments,1)):e.call(this)}fabric.util.createClass=function(){var t=null,e=s.call(arguments,0);function i(){this.initialize.apply(this,arguments)}"function"==typeof e[0]&&(t=e.shift()),i.superclass=t,i.subclasses=[],t&&(h.prototype=t.prototype,i.prototype=new h,t.subclasses.push(i));for(var o=0,n=e.length;o<n;o++)!function(t,o,n){for(var e in o)e in t.prototype&&"function"==typeof t.prototype[e]&&-1<(o[e]+"").indexOf("callSuper")?t.prototype[e]=function(i){return function(){var t=this.constructor.superclass,e=(this.constructor.superclass=n,o[i].apply(this,arguments));if(this.constructor.superclass=t,"initialize"!==i)return e}}(e):t.prototype[e]=o[e],a&&(o.toString!==Object.prototype.toString&&(t.prototype.toString=o.toString),o.valueOf!==Object.prototype.valueOf)&&(t.prototype.valueOf=o.valueOf)}(i,e[o],t);return i.prototype.initialize||(i.prototype.initialize=r),(i.prototype.constructor=i).prototype.callSuper=l,i}}(),!function(){var i="unknown";function t(t){for(var e,i=Array.prototype.slice.call(arguments,1),o=i.length,n=0;n<o;n++)if(e=typeof t[i[n]],!/^(?:function|object|unknown)$/.test(e))return!1;return!0}e=0;var n,r,e,o,a=function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+e++)};function s(t,e){return{handler:e,wrappedHandler:(i=t,o=e,function(t){o.call(n(i),t||fabric.window.event)})};var i,o}o={},n=function(t){return o[t]},r=function(t,e){o[t]=e};var h,l=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),c=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),p={},u={};l=l?(h=function(t,e,i){t.addEventListener(e,i,!1)},function(t,e,i){t.removeEventListener(e,i,!1)}):c?(h=function(t,e,i){var o=a(t),i=(r(o,t),p[o]||(p[o]={}),p[o][e]||(p[o][e]=[]),s(o,i));p[o][e].push(i),t.attachEvent("on"+e,i.wrappedHandler)},function(t,e,i){var o,n=a(t);if(p[n]&&p[n][e])for(var r=0,s=p[n][e].length;r<s;r++)(o=p[n][e][r])&&o.handler===i&&(t.detachEvent("on"+e,o.wrappedHandler),p[n][e][r]=null)}):(h=function(t,e,i){var o,n,r,s=a(t);u[s]||(u[s]={}),u[s][e]||(u[s][e]=[],(o=t["on"+e])&&u[s][e].push(o),t["on"+e]=(n=s,r=e,function(t){if(u[n]&&u[n][r])for(var e=u[n][r],i=0,o=e.length;i<o;i++)e[i].call(this,t||fabric.window.event)})),u[s][e].push(i)},function(t,e,i){t=a(t);if(u[t]&&u[t][e])for(var o=u[t][e],n=0,r=o.length;n<r;n++)o[n]===i&&o.splice(n,1)}),fabric.util.addListener=h,fabric.util.removeListener=l;var d=function(t){return typeof t.clientX!=i?t.clientX:0},f=function(t){return typeof t.clientY!=i?t.clientY:0};function g(t,e,i){var o="touchend"===t.type?"changedTouches":"touches";return t[o]&&t[o][0]&&t[o][0][e]-(t[o][0][e]-t[o][0][i])||t[i]}fabric.isTouchSupported&&(d=function(t){return g(t,"pageX","clientX")},f=function(t){return g(t,"pageY","clientY")}),fabric.util.getPointer=function(t){var e=(t=t||fabric.window.event).target||(typeof t.srcElement!=i?t.srcElement:null),e=fabric.util.getScrollLeftTop(e);return{x:d(t)+e.left,y:f(t)+e.top}},fabric.util.object.extend(fabric.util,fabric.Observable)}(),!function(){var t=fabric.document.createElement("div"),e="string"==typeof t.style.opacity,t="string"==typeof t.style.filter,o=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(t){return t};e?n=function(t,e){return t.style.opacity=e,t}:t&&(n=function(t,e){var i=t.style;return t.currentStyle&&!t.currentStyle.hasLayout&&(i.zoom=1),o.test(i.filter)?i.filter=i.filter.replace(o,e=.9999<=e?"":"alpha(opacity="+100*e+")"):i.filter+=" alpha(opacity="+100*e+")",t}),fabric.util.setStyle=function(t,e){var i=t.style;if(i){if("string"==typeof e)return t.style.cssText+=";"+e,-1<e.indexOf("opacity")?n(t,e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var o in e)"opacity"===o?n(t,e[o]):i["float"===o||"cssFloat"===o?void 0===i.styleFloat?"cssFloat":"styleFloat":o]=e[o]}return t}}(),!function(){var e=Array.prototype.slice;var a,t,i,o=function(t){return e.call(t,0)};try{t=o(fabric.document.childNodes)instanceof Array}catch(t){}function n(t,e){var i,o=fabric.document.createElement(t);for(i in e)"class"===i?o.className=e[i]:"for"===i?o.htmlFor=e[i]:o.setAttribute(i,e[i]);return o}function h(t){for(var e=0,i=0,o=fabric.document.documentElement,n=fabric.document.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===fabric.document?(e=n.scrollLeft||o.scrollLeft||0,i=n.scrollTop||o.scrollTop||0):(e+=t.scrollLeft||0,i+=t.scrollTop||0),1!==t.nodeType||"fixed"!==fabric.util.getElementStyle(t,"position")););return{left:e,top:i}}t||(o=function(t){for(var e=new Array(t.length),i=t.length;i--;)e[i]=t[i];return e}),a=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(t,e){t=fabric.document.defaultView.getComputedStyle(t,null);return t?t[e]:void 0}:function(t,e){var i=t.style[e];return i=!i&&t.currentStyle?t.currentStyle[e]:i},t=fabric.document.documentElement.style,i="userSelect"in t?"userSelect":"MozUserSelect"in t?"MozUserSelect":"WebkitUserSelect"in t?"WebkitUserSelect":"KhtmlUserSelect"in t?"KhtmlUserSelect":"",fabric.util.makeElementUnselectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=fabric.util.falseFunction),i?t.style[i]="none":"string"==typeof t.unselectable&&(t.unselectable="on"),t},fabric.util.makeElementSelectable=function(t){return void 0!==t.onselectstart&&(t.onselectstart=null),i?t.style[i]="":"string"==typeof t.unselectable&&(t.unselectable=""),t},fabric.util.getScript=function(t,e){var i=fabric.document.getElementsByTagName("head")[0],o=fabric.document.createElement("script"),n=!0;o.onload=o.onreadystatechange=function(t){!n||"string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(n=!1,e(t||fabric.window.event),o=o.onload=o.onreadystatechange=null)},o.src=t,i.appendChild(o)},fabric.util.getById=function(t){return"string"==typeof t?fabric.document.getElementById(t):t},fabric.util.toArray=o,fabric.util.makeElement=n,fabric.util.addClass=function(t,e){t&&-1===(" "+t.className+" ").indexOf(" "+e+" ")&&(t.className+=(t.className?" ":"")+e)},fabric.util.wrapElement=function(t,e,i){return"string"==typeof e&&(e=n(e,i)),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},fabric.util.getScrollLeftTop=h,fabric.util.getElementOffset=function(t){var e,i,o=t&&t.ownerDocument,n={left:0,top:0},r={left:0,top:0},s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!o)return r;for(i in s)r[s[i]]+=parseInt(a(t,i),10)||0;return o=o.documentElement,void 0!==t.getBoundingClientRect&&(n=t.getBoundingClientRect()),e=h(t),{left:n.left+e.left-(o.clientLeft||0)+r.left,top:n.top+e.top-(o.clientTop||0)+r.top}},fabric.util.getElementStyle=a}(),!function(){var a=function(){for(var t=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],e=t.length;e--;)try{if(t[e]())return t[e]}catch(t){}}();function h(){}fabric.util.request=function(t,e){var i,o=(e=e||{}).method?e.method.toUpperCase():"GET",n=e.onComplete||function(){},r=a(),s=e.body||e.parameters;return r.onreadystatechange=function(){4===r.readyState&&(n(r),r.onreadystatechange=h)},"GET"===o&&(s=null,"string"==typeof e.parameters)&&(i=t,e=e.parameters,t=i+(/\?/.test(i)?"&":"?")+e),r.open(o,t,!0),"POST"!==o&&"PUT"!==o||r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(s),r}}(),fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(t){void 0!==console[t]&&"function"==typeof console[t].apply&&(fabric[t]=function(){return console[t].apply(console,arguments)})}),!function(){var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(t){fabric.window.setTimeout(t,1e3/60)};function u(){return t.apply(fabric.window,arguments)}fabric.util.animate=function(p){u(function(t){p=p||{};var i,o=t||+new Date,n=p.duration||500,r=o+n,s=p.onChange||function(){},a=p.abort||function(){return!1},h=p.easing||function(t,e,i,o){return-i*Math.cos(t/o*(Math.PI/2))+i+e},l="startValue"in p?p.startValue:0,t="endValue"in p?p.endValue:100,c=p.byValue||t-l;p.onStart&&p.onStart(),function t(e){i=e||+new Date;e=r<i?n:i-o;a()||(s(h(e,l,c,n)),r<i)?p.onComplete&&p.onComplete():u(t)}(o)})},fabric.util.requestAnimFrame=u}(),!function(){function r(t,e,i,o){return o=t<Math.abs(e)?(t=e,i/4):0===e&&0===t?i/(2*Math.PI)*Math.asin(1):i/(2*Math.PI)*Math.asin(e/t),{a:t,c:e,p:i,s:o}}function s(t,e,i){return t.a*Math.pow(2,10*--e)*Math.sin((e*i-t.s)*(2*Math.PI)/t.p)}function n(t,e,i,o){return i-a(o-t,0,i,o)+e}function a(t,e,i,o){return(t/=o)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e}fabric.util.ease={easeInQuad:function(t,e,i,o){return i*(t/=o)*t+e},easeOutQuad:function(t,e,i,o){return-i*(t/=o)*(t-2)+e},easeInOutQuad:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,i,o){return i*(t/=o)*t*t+e},easeOutCubic:function(t,e,i,o){return i*((t=t/o-1)*t*t+1)+e},easeInOutCubic:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,i,o){return i*(t/=o)*t*t*t+e},easeOutQuart:function(t,e,i,o){return-i*((t=t/o-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,i,o){return i*(t/=o)*t*t*t*t+e},easeOutQuint:function(t,e,i,o){return i*((t=t/o-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,i,o){return(t/=o/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,i,o){return-i*Math.cos(t/o*(Math.PI/2))+i+e},easeOutSine:function(t,e,i,o){return i*Math.sin(t/o*(Math.PI/2))+e},easeInOutSine:function(t,e,i,o){return-i/2*(Math.cos(Math.PI*t/o)-1)+e},easeInExpo:function(t,e,i,o){return 0===t?e:i*Math.pow(2,10*(t/o-1))+e},easeOutExpo:function(t,e,i,o){return t===o?e+i:i*(1-Math.pow(2,-10*t/o))+e},easeInOutExpo:function(t,e,i,o){return 0===t?e:t===o?e+i:(t/=o/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,i,o){return-i*(Math.sqrt(1-(t/=o)*t)-1)+e},easeOutCirc:function(t,e,i,o){return i*Math.sqrt(1-(t=t/o-1)*t)+e},easeInOutCirc:function(t,e,i,o){return(t/=o/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,i,o){var n=0;return 0===t?e:1===(t/=o)?e+i:-s(r(i,i,n=n||.3*o,1.70158),t,o)+e},easeOutElastic:function(t,e,i,o){var n=0;return 0===t?e:1===(t/=o)?e+i:(i=r(i,i,n=n||.3*o,1.70158)).a*Math.pow(2,-10*t)*Math.sin((t*o-i.s)*(2*Math.PI)/i.p)+i.c+e},easeInOutElastic:function(t,e,i,o){var n=0;return 0===t?e:2===(t/=o/2)?e+i:(i=r(i,i,n=n||o*(.3*1.5),1.70158),t<1?-.5*s(i,t,o)+e:i.a*Math.pow(2,-10*--t)*Math.sin((t*o-i.s)*(2*Math.PI)/i.p)*.5+i.c+e)},easeInBack:function(t,e,i,o,n){return i*(t/=o)*t*(((n=void 0===n?1.70158:n)+1)*t-n)+e},easeOutBack:function(t,e,i,o,n){return i*((t=t/o-1)*t*(((n=void 0===n?1.70158:n)+1)*t+n)+1)+e},easeInOutBack:function(t,e,i,o,n){return void 0===n&&(n=1.70158),(t/=o/2)<1?i/2*(t*t*((1+(n*=1.525))*t-n))+e:i/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},easeInBounce:n,easeOutBounce:a,easeInOutBounce:function(t,e,i,o){return t<o/2?.5*n(2*t,0,i,o)+e:.5*a(2*t-o,0,i,o)+.5*i+e}}}(),!function(t){"use strict";var c,e,p,i,o,v=t.fabric||(t.fabric={}),l=v.util.object.extend,r=v.util.string.capitalize,u=v.util.object.clone,d=v.util.toFixed,b=v.util.parseUnit,s=v.util.multiplyTransformMatrices,f=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/i,m=/^(symbol|image|marker|pattern|view|svg)$/i,g=/^(?:pattern|defs|symbol|metadata)$/i,y=/^(symbol|g|a|svg)$/i,n={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},_={stroke:"strokeOpacity",fill:"fillOpacity"};function C(t){return t in n?n[t]:t}function w(t,e,i,o){var n,r="[object Array]"===Object.prototype.toString.call(e);return"fill"!==t&&"stroke"!==t||"none"!==e?"strokeDashArray"===t?e="none"===e?null:e.replace(/,/g," ").split(/\s+/).map(function(t){return parseFloat(t)}):"transformMatrix"===t?e=i&&i.transformMatrix?s(i.transformMatrix,v.parseTransformAttribute(e)):v.parseTransformAttribute(e):"visible"===t?(e="none"!==e&&"hidden"!==e,i&&!1===i.visible&&(e=!1)):"originX"===t?e="start"===e?"left":"end"===e?"right":"center":n=r?e.map(b):b(e,o):e="",!r&&isNaN(n)?e:n}function T(t,e){for(var i,o=[],n=0;n<e.length;n++)i=e[n],i=t.getElementsByTagName(i),o=o.concat(Array.prototype.slice.call(i));return o}function O(t,e){var i,o={};for(i in v.cssRules[e])if(function(t,e){var i,o=!0;(i=a(t,e.pop()))&&e.length&&(o=function(t,e){var i,o=!0;for(;t.parentNode&&1===t.parentNode.nodeType&&e.length;)o&&(i=e.pop()),t=t.parentNode,o=a(t,i);return 0===e.length}(t,e));return i&&o&&0===e.length}(t,i.split(" ")))for(var n in v.cssRules[e][i])o[n]=v.cssRules[e][i][n];return o}function a(t,e){var i=t.nodeName,o=t.getAttribute("class"),t=t.getAttribute("id"),n=new RegExp("^"+i,"i");if(e=e.replace(n,""),t&&e.length&&(n=new RegExp("#"+t+"(?![a-zA-Z\\-]+)","i"),e=e.replace(n,"")),o&&e.length)for(var r=(o=o.split(" ")).length;r--;)n=new RegExp("\\."+o[r]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(n,"");return 0===e.length}function S(t){for(var e=T(t,["use","svg:use"]),i=0;e.length&&i<e.length;){var o,n=e[i],r=n.getAttribute("xlink:href").substr(1),s=n.getAttribute("x")||0,a=n.getAttribute("y")||0,h=function(t,e){var i;if(i=t.getElementById?t.getElementById(e):i)return i;for(var o,n=t.getElementsByTagName("*"),r=0;r<n.length;r++)if(e===(o=n[r]).getAttribute("id"))return o}(t,r).cloneNode(!0),l=(h.getAttribute("transform")||"")+" translate("+s+", "+a+")",r=e.length;if(x(h),/^svg$/i.test(h.nodeName)){for(var c,p=h.ownerDocument.createElement("g"),u=0,d=(c=h.attributes).length;u<d;u++)o=c.item(u),p.setAttribute(o.nodeName,o.nodeValue);for(;h.firstChild;)p.appendChild(h.firstChild);h=p}for(u=0,d=(c=n.attributes).length;u<d;u++)"x"!==(o=c.item(u)).nodeName&&"y"!==o.nodeName&&"xlink:href"!==o.nodeName&&("transform"===o.nodeName?l=o.nodeValue+" "+l:h.setAttribute(o.nodeName,o.nodeValue));h.setAttribute("transform",l),h.setAttribute("instantiated_by_use","1"),h.removeAttribute("id"),n.parentNode.replaceChild(h,n),e.length===r&&i++}}v.cssRules={},v.gradientDefs={},v.parseTransformAttribute=(c=[1,0,0,1,0,0],t=v.reNum,p="(?:"+("(?:(matrix)\\s*\\(\\s*("+t+")"+(e="(?:\\s+,?\\s*|,\\s*)")+"("+t+")"+e+"("+t+")"+e+"("+t+")"+e+"("+t+")"+e+"("+t+")\\s*\\))")+"|"+("(?:(translate)\\s*\\(\\s*("+t+")(?:"+e+"("+t+"))?\\s*\\))")+"|"+("(?:(scale)\\s*\\(\\s*("+t+")(?:"+e+"("+t+"))?\\s*\\))")+"|"+("(?:(rotate)\\s*\\(\\s*("+t+")(?:"+e+"("+t+")"+e+"("+t+"))?\\s*\\))")+"|"+("(?:(skewX)\\s*\\(\\s*("+t+")\\s*\\))")+"|"+("(?:(skewY)\\s*\\(\\s*("+t+")\\s*\\))")+")",i=new RegExp("^\\s*(?:"+("(?:"+p+"(?:"+e+"*"+p+")*)")+"?)\\s*$"),o=new RegExp(p,"g"),function(t){var h=c.concat(),l=[];if(!t||!i.test(t))return h;t.replace(o,function(t){var e,i,o,n,r,t=new RegExp(p).exec(t).filter(function(t){return!!t}),s=t[1],a=t.slice(2).map(parseFloat);switch(s){case"translate":r=a,(n=h)[4]=r[0],2===r.length&&(n[5]=r[1]);break;case"rotate":a[0]=v.util.degreesToRadians(a[0]),n=h,i=(r=a)[0],o=3===r.length?r[1]:0,r=3===r.length?r[2]:0,n[0]=Math.cos(i),n[1]=Math.sin(i),n[2]=-Math.sin(i),n[3]=Math.cos(i),n[4]=o-(n[0]*o+n[2]*r),n[5]=r-(n[1]*o+n[3]*r);break;case"scale":i=h,e=(o=a)[0],o=2===o.length?o[1]:o[0],i[0]=e,i[3]=o;break;case"skewX":h[2]=Math.tan(v.util.degreesToRadians(a[0]));break;case"skewY":h[1]=Math.tan(v.util.degreesToRadians(a[0]));break;case"matrix":h=a}l.push(h.concat()),h=c.concat()});for(var e=l[0];1<l.length;)l.shift(),e=v.util.multiplyTransformMatrices(e,l[0]);return e});var E=new RegExp("^\\s*("+v.reNum+"+)\\s*,?\\s*("+v.reNum+"+)\\s*,?\\s*("+v.reNum+"+)\\s*,?\\s*("+v.reNum+"+)\\s*$");function x(t){var e,i,o=t.getAttribute("viewBox"),n=1,r=1,s=t.getAttribute("width"),a=t.getAttribute("height"),h=t.getAttribute("x")||0,l=t.getAttribute("y")||0,c=t.getAttribute("preserveAspectRatio")||"",p=!o||!m.test(t.nodeName)||!(o=o.match(E)),u=!s||!a||"100%"===s||"100%"===a,d=p&&u,f={},g="";if(f.width=0,f.height=0,!(f.toBeParsed=d))if(p)f.width=b(s),f.height=b(a);else if(d=-parseFloat(o[1]),p=-parseFloat(o[2]),e=parseFloat(o[3]),o=parseFloat(o[4]),u?(f.width=e,f.height=o):(f.width=b(s),f.height=b(a),n=f.width/e,r=f.height/o),"none"!==v.util.parsePreserveAspectRatioAttribute(c).alignX&&(r=n=r<n?r:n),1!==n||1!==r||0!=d||0!=p||0!==h||0!==l){if(u=(g=h||l?" translate("+b(h)+" "+b(l)+") ":g)+" matrix("+n+" 0 0 "+r+" "+d*n+" "+p*r+") ","svg"===t.nodeName){for(i=t.ownerDocument.createElement("g");t.firstChild;)i.appendChild(t.firstChild);t.appendChild(i)}else u=(i=t).getAttribute("transform")+u;i.setAttribute("transform",u)}return f}v.parseSVGDocument=function(t,e,i){if(t){S(t);var o=new Date,n=v.Object.__uid++,r=x(t),s=v.util.toArray(t.getElementsByTagName("*"));if(r.svgUid=n,0===s.length&&v.isLikelyNode){for(var a=[],h=0,l=(s=t.selectNodes('//*[name(.)!="svg"]')).length;h<l;h++)a[h]=s[h];s=a}var c=s.filter(function(t){return x(t),f.test(t.nodeName.replace("svg:",""))&&!function(t,e){for(;t=t&&t.parentNode;)if(t.nodeName&&e.test(t.nodeName.replace("svg:",""))&&!t.getAttribute("instantiated_by_use"))return 1}(t,g)});c&&c.length?(v.gradientDefs[n]=v.getGradientDefs(t),v.cssRules[n]=v.getCSSRules(t),v.parseElements(c,function(t){v.documentParsingTime=new Date-o,e&&e(t,r)},u(r),i)):e&&e([],{})}};var h=function(t,e){e(!1)},I=function(){},D=function(){};function A(t,e,i){e[i]&&e[i].toSVG&&t.push('\t<pattern x="0" y="0" id="',i,'Pattern" ','width="',e[i].source.width,'" height="',e[i].source.height,'" patternUnits="userSpaceOnUse">\n','\t\t<image x="0" y="0" ','width="',e[i].source.width,'" height="',e[i].source.height,'" xlink:href="',e[i].source.src,'"></image>\n\t</pattern>\n')}var P=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+v.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+v.reNum+"))?\\s+(.*)");l(v,{parseFontDeclaration:function(t,e){var i,o,n,r,t=t.match(P);t&&(i=t[1],o=t[3],n=t[4],r=t[5],t=t[6],i&&(e.fontStyle=i),o&&(e.fontWeight=isNaN(parseFloat(o))?o:parseFloat(o)),n&&(e.fontSize=b(n)),t&&(e.fontFamily=t),r)&&(e.lineHeight="normal"===r?1:r)},getGradientDefs:function(t){for(var e,i,o=T(t,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),n=0,r={},s={},n=o.length;n--;)i=(h=o[n]).getAttribute("xlink:href"),e=h.getAttribute("id"),i&&(s[e]=i.substr(1)),r[e]=h;for(e in s)for(var a=r[s[e]].cloneNode(!0),h=r[e];a.firstChild;)h.appendChild(a.firstChild);return r},parseAttributes:function(i,t,e){if(i){var o,n,r,s,a={},t=(void 0===e&&(e=i.getAttribute("svgUid")),i.parentNode&&y.test(i.parentNode.nodeName)&&(a=v.parseAttributes(i.parentNode,t,e)),n=a&&a.fontSize||i.getAttribute("font-size")||v.Text.DEFAULT_SVG_FONT_SIZE,t.reduce(function(t,e){return(o=i.getAttribute(e))&&(e=C(e),o=w(e,o,a,n),t[e]=o),t},{})),h=((t=l(t,l(O(i,e),v.parseStyleAttribute(i)))).font&&v.parseFontDeclaration(t.font,t),l(a,t));for(s in _)if(void 0!==h[_[s]]&&""!==h[s]){if(void 0===h[s]){if(!v.Object.prototype[s])continue;h[s]=v.Object.prototype[s]}0!==h[s].indexOf("url(")&&(r=new v.Color(h[s]),h[s]=r.setAlpha(d(r.getAlpha()*h[_[s]],2)).toRgba())}return h}},parseElements:function(t,e,i,o){new v.ElementsParser(t,e,i,o).parse()},parseStyleAttribute:function(t){var e,i,o,n={},t=t.getAttribute("style");if(t)if("string"==typeof t)e=n,t.replace(/;\s*$/,"").split(";").forEach(function(t){t=t.split(":");i=C(t[0].trim().toLowerCase()),o=w(i,t[1].trim()),e[i]=o});else{var r,s,a,h=t,l=n;for(a in h)void 0!==h[a]&&(s=w(r=C(a.toLowerCase()),h[a]),l[r]=s)}return n},parsePointsAttribute:function(t){if(!t)return null;for(var e=[],i=0,o=(t=(t=t.replace(/,/g," ").trim()).split(/\s+/)).length;i<o;i+=2)e.push({x:parseFloat(t[i]),y:parseFloat(t[i+1])});return e},getCSSRules:function(t){for(var e=t.getElementsByTagName("style"),h={},i=0,o=e.length;i<o;i++){var n=e[i].textContent||e[i].text;""!==(n=n.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&n.match(/[^{]*\{[\s\S]*?\}/g).map(function(t){return t.trim()}).forEach(function(t){for(var e=t.match(/([\s\S]*?)\s*\{([^}]*)\}/),i={},o=e[2].trim().replace(/;$/,"").split(/\s*;\s*/),n=0,r=o.length;n<r;n++){var s=o[n].split(/\s*:\s*/),a=C(s[0]),s=w(a,s[1],s[0]);i[a]=s}(t=e[1]).split(",").forEach(function(t){""!==(t=t.replace(/^svg/i,"").trim())&&(h[t]?v.util.object.extend(h[t],i):h[t]=v.util.object.clone(i))})})}return h},loadSVGFromURL:function(i,o,n){function e(t){var e=t.responseXML;e&&!e.documentElement&&v.window.ActiveXObject&&t.responseText&&((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),e&&e.documentElement||o&&o(null),v.parseSVGDocument(e.documentElement,function(t,e){D(i,{objects:v.util.array.invoke(t,"toObject"),options:e}),o&&o(t,e)},n)}i=i.replace(/^\n\s*/,"").trim(),h(i,function(t){t?I(i,function(t){i=(e=t).objects,e=t.options;var e,i,t={objects:i=i.map(function(t){return v[r(t.type)].fromObject(t)}),options:e};o(t.objects,t.options)}):new v.util.request(i,{method:"get",onComplete:e})})},loadSVGFromString:function(t,i,e){var o,n;t=t.trim(),"undefined"!=typeof DOMParser?(n=new DOMParser)&&n.parseFromString&&(o=n.parseFromString(t,"text/xml")):v.window.ActiveXObject&&((o=new ActiveXObject("Microsoft.XMLDOM")).async="false",o.loadXML(t.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),v.parseSVGDocument(o.documentElement,function(t,e){i(t,e)},e)},createSVGFontFacesMarkup:function(t){for(var e,i,o,n,r,s,a,h="",l={},c=v.fontPaths,p=0,u=t.length;p<u;p++)if(i=(e=t[p]).fontFamily,-1!==e.type.indexOf("text")&&!l[i]&&c[i]&&(l[i]=!0,e.styles))for(r in o=e.styles)for(s in n=o[r])!l[i=n[s].fontFamily]&&c[i]&&(l[i]=!0);for(a in l)h+=["\t\t@font-face {\n","\t\t\tfont-family: '",a,"';\n","\t\t\tsrc: url('",c[a],"');\n","\t\t}\n"].join("");return h=h&&['\t<style type="text/css">',"<![CDATA[\n",h,"]]>","</style>\n"].join("")},createSVGRefElementsMarkup:function(t){var e=[];return A(e,t,"backgroundColor"),A(e,t,"overlayColor"),e.join("")}})}("undefined"!=typeof exports?exports:this),fabric.ElementsParser=function(t,e,i,o){this.elements=t,this.callback=e,this.options=i,this.reviver=o,this.svgUid=i&&i.svgUid||0},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var t=0,e=this.elements.length;t<e;t++)this.elements[t].setAttribute("svgUid",this.svgUid),!function(t,e){setTimeout(function(){t.createObject(t.elements[e],e)},0)}(this,t)},fabric.ElementsParser.prototype.createObject=function(t,e){var i=fabric[fabric.util.string.capitalize(t.tagName.replace("svg:",""))];if(i&&i.fromElement)try{this._createObject(i,t,e)}catch(t){fabric.log(t)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(t,e,i){t.async?t.fromElement(e,this.createCallback(i,e),this.options):(t=t.fromElement(e,this.options),this.resolveGradient(t,"fill"),this.resolveGradient(t,"stroke"),this.reviver&&this.reviver(e,t),this.instances[i]=t,this.checkIfDone())},fabric.ElementsParser.prototype.createCallback=function(e,i){var o=this;return function(t){o.resolveGradient(t,"fill"),o.resolveGradient(t,"stroke"),o.reviver&&o.reviver(i,t),o.instances[e]=t,o.checkIfDone()}},fabric.ElementsParser.prototype.resolveGradient=function(t,e){var i=t.get(e);/^url\(/.test(i)&&(i=i.slice(5,i.length-1),fabric.gradientDefs[this.svgUid][i])&&t.set(e,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][i],t))},fabric.ElementsParser.prototype.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(t){return null!=t}),this.callback(this.instances))},!function(t){"use strict";t=t.fabric||(t.fabric={});function i(t,e){this.x=t,this.y=e}t.Point?t.warn("fabric.Point is already defined"):(t.Point=i).prototype={type:"point",constructor:i,add:function(t){return new i(this.x+t.x,this.y+t.y)},addEquals:function(t){return this.x+=t.x,this.y+=t.y,this},scalarAdd:function(t){return new i(this.x+t,this.y+t)},scalarAddEquals:function(t){return this.x+=t,this.y+=t,this},subtract:function(t){return new i(this.x-t.x,this.y-t.y)},subtractEquals:function(t){return this.x-=t.x,this.y-=t.y,this},scalarSubtract:function(t){return new i(this.x-t,this.y-t)},scalarSubtractEquals:function(t){return this.x-=t,this.y-=t,this},multiply:function(t){return new i(this.x*t,this.y*t)},multiplyEquals:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return new i(this.x/t,this.y/t)},divideEquals:function(t){return this.x/=t,this.y/=t,this},eq:function(t){return this.x===t.x&&this.y===t.y},lt:function(t){return this.x<t.x&&this.y<t.y},lte:function(t){return this.x<=t.x&&this.y<=t.y},gt:function(t){return this.x>t.x&&this.y>t.y},gte:function(t){return this.x>=t.x&&this.y>=t.y},lerp:function(t,e){return void 0===e&&(e=.5),e=Math.max(Math.min(1,e),0),new i(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)},distanceFrom:function(t){var e=this.x-t.x,t=this.y-t.y;return Math.sqrt(e*e+t*t)},midPointFrom:function(t){return this.lerp(t)},min:function(t){return new i(Math.min(this.x,t.x),Math.min(this.y,t.y))},max:function(t){return new i(Math.max(this.x,t.x),Math.max(this.y,t.y))},toString:function(){return this.x+","+this.y},setXY:function(t,e){return this.x=t,this.y=e,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setFromPoint:function(t){return this.x=t.x,this.y=t.y,this},swap:function(t){var e=this.x,i=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=i},clone:function(){return new i(this.x,this.y)}}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var a=t.fabric||(t.fabric={});function h(t){this.status=t,this.points=[]}a.Intersection?a.warn("fabric.Intersection is already defined"):(a.Intersection=h,a.Intersection.prototype={constructor:h,appendPoint:function(t){return this.points.push(t),this},appendPoints:function(t){return this.points=this.points.concat(t),this}},a.Intersection.intersectLineLine=function(t,e,i,o){var n,r=(o.x-i.x)*(t.y-i.y)-(o.y-i.y)*(t.x-i.x),s=(e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x),o=(o.y-i.y)*(e.x-t.x)-(o.x-i.x)*(e.y-t.y);return 0!=o?(i=s/o,0<=(o=r/o)&&o<=1&&0<=i&&i<=1?(n=new h("Intersection")).appendPoint(new a.Point(t.x+o*(e.x-t.x),t.y+o*(e.y-t.y))):n=new h):n=new h(0==r||0==s?"Coincident":"Parallel"),n},a.Intersection.intersectLinePolygon=function(t,e,i){for(var o,n,r=new h,s=i.length,a=0;a<s;a++)n=i[a],o=i[(a+1)%s],n=h.intersectLineLine(t,e,n,o),r.appendPoints(n.points);return 0<r.points.length&&(r.status="Intersection"),r},a.Intersection.intersectPolygonPolygon=function(t,e){for(var i=new h,o=t.length,n=0;n<o;n++){var r=t[n],s=t[(n+1)%o],r=h.intersectLinePolygon(r,s,e);i.appendPoints(r.points)}return 0<i.points.length&&(i.status="Intersection"),i},a.Intersection.intersectPolygonRectangle=function(t,e,i){var o=e.min(i),e=e.max(i),i=new a.Point(e.x,o.y),n=new a.Point(o.x,e.y),r=h.intersectLinePolygon(o,i,t),i=h.intersectLinePolygon(i,e,t),e=h.intersectLinePolygon(e,n,t),n=h.intersectLinePolygon(n,o,t),o=new h;return o.appendPoints(r.points),o.appendPoints(i.points),o.appendPoints(e.points),o.appendPoints(n.points),0<o.points.length&&(o.status="Intersection"),o})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var l=t.fabric||(t.fabric={});function a(t){t?this._tryParsingColor(t):this.setSource([0,0,0,1])}function h(t,e,i){return i<0&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}l.Color?l.warn("fabric.Color is already defined."):(l.Color=a,l.Color.prototype={_tryParsingColor:function(t){var e;(e=(e=(e=(e=(e="transparent"===(t=t in a.colorNameMap?a.colorNameMap[t]:t)?[255,255,255,0]:e)||a.sourceFromHex(t))||a.sourceFromRgb(t))||a.sourceFromHsl(t))||[0,0,0,1])&&this.setSource(e)},_rgbToHsl:function(t,e,i){var o,n=l.util.array.max([t/=255,e/=255,i/=255]),r=l.util.array.min([t,e,i]),s=(n+r)/2;if(n===r)o=h=0;else{var a=n-r,h=.5<s?a/(2-n-r):a/(n+r);switch(n){case t:o=(e-i)/a+(e<i?6:0);break;case e:o=(i-t)/a+2;break;case i:o=(t-e)/a+4}o/=6}return[Math.round(360*o),Math.round(100*h),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(t){this._source=t},toRgb:function(){var t=this.getSource();return"rgb("+t[0]+","+t[1]+","+t[2]+")"},toRgba:function(){var t=this.getSource();return"rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")"},toHsl:function(){var t=this.getSource(),t=this._rgbToHsl(t[0],t[1],t[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var t=this.getSource(),e=this._rgbToHsl(t[0],t[1],t[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+t[3]+")"},toHex:function(){var t,e=this.getSource(),i=e[0].toString(16);return i=1===i.length?"0"+i:i,t=1===(t=e[1].toString(16)).length?"0"+t:t,e=1===(e=e[2].toString(16)).length?"0"+e:e,i.toUpperCase()+t.toUpperCase()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(t){var e=this.getSource();return e[3]=t,this.setSource(e),this},toGrayscale:function(){var t=this.getSource(),e=parseInt((.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),10),t=t[3];return this.setSource([e,e,e,t]),this},toBlackWhite:function(t){var e=this.getSource(),i=(.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),e=e[3];return t=t||127,i=Number(i)<Number(t)?0:255,this.setSource([i,i,i,e]),this},overlayWith:function(t){t instanceof a||(t=new a(t));for(var e=[],i=this.getAlpha(),o=this.getSource(),n=t.getSource(),r=0;r<3;r++)e.push(Math.round(.5*o[r]+.5*n[r]));return e[3]=i,this.setSource(e),this}},l.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,l.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,l.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,l.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",grey:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},l.Color.fromRgb=function(t){return a.fromSource(a.sourceFromRgb(t))},l.Color.sourceFromRgb=function(t){var e,i,o,t=t.match(a.reRGBa);if(t)return e=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),i=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),o=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1),[parseInt(e,10),parseInt(i,10),parseInt(o,10),t[4]?parseFloat(t[4]):1]},l.Color.fromRgba=a.fromRgb,l.Color.fromHsl=function(t){return a.fromSource(a.sourceFromHsl(t))},l.Color.sourceFromHsl=function(t){var e,i,o,n,r,s,t=t.match(a.reHSLa);if(t)return e=(parseFloat(t[1])%360+360)%360/360,o=parseFloat(t[2])/(/%$/.test(t[2])?100:1),i=parseFloat(t[3])/(/%$/.test(t[3])?100:1),0==o?n=r=s=i:(n=h(o=2*i-(i=i<=.5?i*(1+o):i+o-i*o),i,e+1/3),r=h(o,i,e),s=h(o,i,e-1/3)),[Math.round(255*n),Math.round(255*r),Math.round(255*s),t[4]?parseFloat(t[4]):1]},l.Color.fromHsla=a.fromHsl,l.Color.fromHex=function(t){return a.fromSource(a.sourceFromHex(t))},l.Color.sourceFromHex=function(t){var e,i,o,n,r;if(t.match(a.reHex))return e=3===(t=t.slice(t.indexOf("#")+1)).length||4===t.length,r=8===t.length||4===t.length,i=e?t.charAt(0)+t.charAt(0):t.substring(0,2),o=e?t.charAt(1)+t.charAt(1):t.substring(2,4),n=e?t.charAt(2)+t.charAt(2):t.substring(4,6),r=r?e?t.charAt(3)+t.charAt(3):t.substring(6,8):"FF",[parseInt(i,16),parseInt(o,16),parseInt(n,16),parseFloat((parseInt(r,16)/255).toFixed(2))]},l.Color.fromSource=function(t){var e=new a;return e.setSource(t),e})}("undefined"!=typeof exports?exports:this),!function(){function l(t,e,i){var o,n,r,s=0,a=1,h="";for(n in e)"Infinity"===e[n]?e[n]=1:"-Infinity"===e[n]&&(e[n]=0),o=parseFloat(e[n],10),a="string"==typeof e[n]&&/^\d+%$/.test(e[n])?.01:1,"x1"===n||"x2"===n||"r2"===n?(a*="objectBoundingBox"===i?t.width:1,s="objectBoundingBox"===i&&t.left||0):"y1"!==n&&"y2"!==n||(a*="objectBoundingBox"===i?t.height:1,s="objectBoundingBox"===i&&t.top||0),e[n]=o*a+s;return"ellipse"===t.type&&null!==e.r2&&"objectBoundingBox"===i&&t.rx!==t.ry&&(h=" scale(1, "+(r=t.ry/t.rx)+")",e.y1&&(e.y1/=r),e.y2)&&(e.y2/=r),h}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(t){t=t||{};var e={};this.id=fabric.Object.__uid++,this.type=t.type||"linear",e={x1:t.coords.x1||0,y1:t.coords.y1||0,x2:t.coords.x2||0,y2:t.coords.y2||0},"radial"===this.type&&(e.r1=t.coords.r1||0,e.r2=t.coords.r2||0),this.coords=e,this.colorStops=t.colorStops.slice(),t.gradientTransform&&(this.gradientTransform=t.gradientTransform),this.offsetX=t.offsetX||this.offsetX,this.offsetY=t.offsetY||this.offsetY},addColorStop:function(t){for(var e in t){var i=new fabric.Color(t[e]);this.colorStops.push({offset:e,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(t){var e={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientTransform:this.gradientTransform&&this.gradientTransform.concat()};return fabric.util.populateWithProperties(this,e,t),e},toSVG:function(t){var e,i,o=fabric.util.object.clone(this.coords);if(this.colorStops.sort(function(t,e){return t.offset-e.offset}),!t.group||"path-group"!==t.group.type)for(var n in o)"x1"===n||"x2"===n||"r2"===n?o[n]+=this.offsetX-t.width/2:"y1"!==n&&"y2"!==n||(o[n]+=this.offsetY-t.height/2);i='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(i+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),"linear"===this.type?e=["<linearGradient ",i,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,'">\n']:"radial"===this.type&&(e=["<radialGradient ",i,' cx="',o.x2,'" cy="',o.y2,'" r="',o.r2,'" fx="',o.x1,'" fy="',o.y1,'">\n']);for(var r=0;r<this.colorStops.length;r++)e.push("<stop ",'offset="',100*this.colorStops[r].offset+"%",'" style="stop-color:',this.colorStops[r].color,null!==this.colorStops[r].opacity?";stop-opacity: "+this.colorStops[r].opacity:";",'"/>\n');return e.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),e.join("")},toLive:function(t,e){var i,o,n=fabric.util.object.clone(this.coords);if(this.type){if(e.group&&"path-group"===e.group.type)for(o in n)"x1"===o||"x2"===o?n[o]+=-this.offsetX+e.width/2:"y1"!==o&&"y2"!==o||(n[o]+=-this.offsetY+e.height/2);"linear"===this.type?i=t.createLinearGradient(n.x1,n.y1,n.x2,n.y2):"radial"===this.type&&(i=t.createRadialGradient(n.x1,n.y1,n.r1,n.x2,n.y2,n.r2));for(var r=0,s=this.colorStops.length;r<s;r++){var a=this.colorStops[r].color,h=this.colorStops[r].opacity,l=this.colorStops[r].offset;void 0!==h&&(a=new fabric.Color(a).setAlpha(h).toRgba()),i.addColorStop(parseFloat(l),a)}return i}}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(t,e){var i,o=t.getElementsByTagName("stop"),n=t.getAttribute("gradientUnits")||"objectBoundingBox",r=t.getAttribute("gradientTransform"),s=[],a="linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial";"linear"===a?i={x1:(i=t).getAttribute("x1")||0,y1:i.getAttribute("y1")||0,x2:i.getAttribute("x2")||"100%",y2:i.getAttribute("y2")||0}:"radial"===a&&(i={x1:(t=t).getAttribute("fx")||t.getAttribute("cx")||"50%",y1:t.getAttribute("fy")||t.getAttribute("cy")||"50%",r1:0,x2:t.getAttribute("cx")||"50%",y2:t.getAttribute("cy")||"50%",r2:t.getAttribute("r")||"50%"});for(var h=o.length;h--;)s.push(function(t){var e,i,o=t.getAttribute("style"),n=t.getAttribute("offset")||0;if(n=(n=parseFloat(n)/(/%$/.test(n)?100:1))<0?0:1<n?1:n,o){var r=o.split(/\s*;\s*/);""===r[r.length-1]&&r.pop();for(var s=r.length;s--;){var a=r[s].split(/\s*:\s*/),h=a[0].trim(),a=a[1].trim();"stop-color"===h?e=a:"stop-opacity"===h&&(i=a)}}return e=e||t.getAttribute("stop-color")||"rgb(0,0,0)",i=i||t.getAttribute("stop-opacity"),o=(e=new fabric.Color(e)).getAlpha(),i=isNaN(parseFloat(i))?1:parseFloat(i),i*=o,{offset:n,color:e.toRgb(),opacity:i}}(o[h]));t=l(e,i,n),n=new fabric.Gradient({type:a,coords:i,colorStops:s,offsetX:-e.left,offsetY:-e.top});return!r&&""===t||(n.gradientTransform=fabric.parseTransformAttribute((r||"")+t)),n},forObject:function(t,e){return l(t,(e=e||{}).coords,"userSpaceOnUse"),new fabric.Gradient(e)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(t){var e;t=t||{},this.id=fabric.Object.__uid++,t.source&&("string"==typeof t.source?void 0!==fabric.util.getFunctionBody(t.source)?this.source=new Function(fabric.util.getFunctionBody(t.source)):((e=this).source=fabric.util.createImage(),fabric.util.loadImage(t.source,function(t){e.source=t})):this.source=t.source),t.repeat&&(this.repeat=t.repeat),t.offsetX&&(this.offsetX=t.offsetX),t.offsetY&&(this.offsetY=t.offsetY)},toObject:function(t){var e;return"function"==typeof this.source?e=String(this.source):"string"==typeof this.source.src?e=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(e=this.source.toDataURL()),e={source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY},fabric.util.populateWithProperties(this,e,t),e},toSVG:function(t){var e="function"==typeof this.source?this.source():this.source,i=e.width/t.getWidth(),o=e.height/t.getHeight(),n=this.offsetX/t.getWidth(),t=this.offsetY/t.getHeight(),r="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(o=1),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(i=1),e.src?r=e.src:e.toDataURL&&(r=e.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+n+'" y="'+t+'" width="'+i+'" height="'+o+'">\n<image x="0" y="0" width="'+e.width+'" height="'+e.height+'" xlink:href="'+r+'"></image>\n</pattern>\n'},toLive:function(t){var e="function"==typeof this.source?this.source():this.source;if(!e)return"";if(void 0!==e.src){if(!e.complete)return"";if(0===e.naturalWidth||0===e.naturalHeight)return""}return t.createPattern(e,this.repeat)}}),!function(t){"use strict";var r=t.fabric||(t.fabric={}),s=r.util.toFixed;r.Shadow?r.warn("fabric.Shadow is already defined."):(r.Shadow=r.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(t){for(var e in t="string"==typeof t?this._parseShadow(t):t)this[e]=t[e];this.id=r.Object.__uid++},_parseShadow:function(t){var t=t.trim(),e=r.Shadow.reOffsetsAndBlur.exec(t)||[];return{color:(t.replace(r.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseInt(e[1],10)||0,offsetY:parseInt(e[2],10)||0,blur:parseInt(e[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(t){var e=40,i=40,o=r.Object.NUM_FRACTION_DIGITS,n=r.util.rotateVector({x:this.offsetX,y:this.offsetY},r.util.degreesToRadians(-t.angle));return t.width&&t.height&&(e=100*s((Math.abs(n.x)+this.blur)/t.width,o)+20,i=100*s((Math.abs(n.y)+this.blur)/t.height,o)+20),t.flipX&&(n.x*=-1),t.flipY&&(n.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+i+'%" height="'+(100+2*i)+'%" x="-'+e+'%" width="'+(100+2*e)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+s(this.blur?this.blur/2:0,o)+'"></feGaussianBlur>\n\t<feOffset dx="'+s(n.x,o)+'" dy="'+s(n.y,o)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+this.color+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){var e,i;return this.includeDefaultValues?{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke}:(e={},i=r.Shadow.prototype,["color","blur","offsetX","offsetY","affectStroke"].forEach(function(t){this[t]!==i[t]&&(e[t]=this[t])},this),e)}}),r.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/)}("undefined"!=typeof exports?exports:this),!function(){"use strict";var o,t,h,s,e;fabric.StaticCanvas?fabric.warn("fabric.StaticCanvas is already defined."):(o=fabric.util.object.extend,t=fabric.util.getElementOffset,h=fabric.util.removeFromArray,s=fabric.util.toFixed,e=new Error("Could not initialize `canvas` element"),fabric.StaticCanvas=fabric.util.createClass({initialize:function(t,e){this._initStatic(t,e=e||{})},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,_initStatic:function(t,e){var i=fabric.StaticCanvas.prototype.renderAll.bind(this);this._objects=[],this._createLowerCanvas(t),this._initOptions(e),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),e.overlayImage&&this.setOverlayImage(e.overlayImage,i),e.backgroundImage&&this.setBackgroundImage(e.backgroundImage,i),e.backgroundColor&&this.setBackgroundColor(e.backgroundColor,i),e.overlayColor&&this.setOverlayColor(e.overlayColor,i),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(t,e,i){return this.__setBgOverlayImage("overlayImage",t,e,i)},setBackgroundImage:function(t,e,i){return this.__setBgOverlayImage("backgroundImage",t,e,i)},setOverlayColor:function(t,e){return this.__setBgOverlayColor("overlayColor",t,e)},setBackgroundColor:function(t,e){return this.__setBgOverlayColor("backgroundColor",t,e)},_setImageSmoothing:function(){var t=this.getContext();t.imageSmoothingEnabled=t.imageSmoothingEnabled||t.webkitImageSmoothingEnabled||t.mozImageSmoothingEnabled||t.msImageSmoothingEnabled||t.oImageSmoothingEnabled,t.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,i,o){return"string"==typeof t?fabric.util.loadImage(t,function(t){t&&(this[e]=new fabric.Image(t,o)),i&&i(t)},this,o&&o.crossOrigin):(o&&t.setOptions(o),this[e]=t,i&&i(t)),this},__setBgOverlayColor:function(e,i,o){var n;return i&&i.source?(n=this,fabric.util.loadImage(i.source,function(t){n[e]=new fabric.Pattern({source:t,repeat:i.repeat,offsetX:i.offsetX,offsetY:i.offsetY}),o&&o()})):(this[e]=i,o&&o()),this},_createCanvasElement:function(t){t=fabric.util.createCanvasElement(t);if(t.style||(t.style={}),!t)throw e;if(void 0===t.getContext)throw e;return t},_initOptions:function(t){for(var e in t)this[e]=t[e];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(t){this.lowerCanvasEl=fabric.util.getById(t)||this._createCanvasElement(t),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(t,e){return this.setDimensions({width:t},e)},setHeight:function(t,e){return this.setDimensions({height:t},e)},setDimensions:function(t,e){var i,o;for(o in e=e||{},t)i=t[o],e.cssOnly||(this._setBackstoreDimension(o,t[o]),i+="px"),e.backstoreOnly||this._setCssDimension(o,i);return this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),e.cssOnly||this.renderAll(),this},_setBackstoreDimension:function(t,e){return this.lowerCanvasEl[t]=e,this.upperCanvasEl&&(this.upperCanvasEl[t]=e),this.cacheCanvasEl&&(this.cacheCanvasEl[t]=e),this[t]=e,this},_setCssDimension:function(t,e){return this.lowerCanvasEl.style[t]=e,this.upperCanvasEl&&(this.upperCanvasEl.style[t]=e),this.wrapperEl&&(this.wrapperEl.style[t]=e),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(t){var e,i=this._activeGroup;this.viewportTransform=t;for(var o=0,n=this._objects.length;o<n;o++)(e=this._objects[o]).group||e.setCoords();return i&&i.setCoords(),this.renderAll(),this},zoomToPoint:function(t,e){var i=t,o=this.viewportTransform.slice(0),e=(t=fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform)),o[0]=e,o[3]=e,fabric.util.transformPoint(t,o));return o[4]+=i.x-e.x,o[5]+=i.y-e.y,this.setViewportTransform(o)},setZoom:function(t){return this.zoomToPoint(new fabric.Point(0,0),t),this},absolutePan:function(t){var e=this.viewportTransform.slice(0);return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)},relativePan:function(t){return this.absolutePan(new fabric.Point(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(t){this.stateful&&t.setupState(),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added")},_onObjectRemoved:function(t){this.fire("object:removed",{target:t}),t.fire("removed"),delete t.canvas},clearContext:function(t){return t.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("selection:cleared",this._canvasITextSelectionClearedHanlder),this.off("object:selected",this._canvasITextSelectionClearedHanlder),this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(){var t=this.contextContainer;return this.renderCanvas(t,this._objects),this},renderCanvas:function(t,e){this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),t.save(),t.transform.apply(t,this.viewportTransform),this._renderObjects(t,e),t.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render")},_renderObjects:function(t,e){for(var i=0,o=e.length;i<o;++i)e[i]&&e[i].render(t)},_renderBackgroundOrOverlay:function(t,e){var i=this[e+"Color"];i&&(t.fillStyle=i.toLive?i.toLive(t):i,t.fillRect(i.offsetX||0,i.offsetY||0,this.width,this.height)),(i=this[e+"Image"])&&(this[e+"Vpt"]&&(t.save(),t.transform.apply(t,this.viewportTransform)),i.render(t),this[e+"Vpt"])&&t.restore()},_renderBackground:function(t){this._renderBackgroundOrOverlay(t,"background")},_renderOverlay:function(t){this._renderBackgroundOrOverlay(t,"overlay")},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(t){return this._centerObject(t,new fabric.Point(this.getCenter().left,t.getCenterPoint().y))},centerObjectV:function(t){return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,this.getCenter().top))},centerObject:function(t){var e=this.getCenter();return this._centerObject(t,new fabric.Point(e.left,e.top))},viewportCenterObject:function(t){var e=this.getVpCenter();return this._centerObject(t,e)},viewportCenterObjectH:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(e.x,t.getCenterPoint().y)),this},viewportCenterObjectV:function(t){var e=this.getVpCenter();return this._centerObject(t,new fabric.Point(t.getCenterPoint().x,e.y))},getVpCenter:function(){var t=this.getCenter(),e=fabric.util.invertTransform(this.viewportTransform);return fabric.util.transformPoint({x:t.left,y:t.top},e)},_centerObject:function(t,e){return t.setPositionByOrigin(e,"center","center"),this.renderAll(),this},toDatalessJSON:function(t){return this.toDatalessObject(t)},toObject:function(t){return this._toObjectMethod("toObject",t)},toDatalessObject:function(t){return this._toObjectMethod("toDatalessObject",t)},_toObjectMethod:function(t,e){var i={objects:this._toObjects(t,e)};return o(i,this.__serializeBgOverlay(t,e)),fabric.util.populateWithProperties(this,i,e),i},_toObjects:function(e,i){return this.getObjects().filter(function(t){return!t.excludeFromExport}).map(function(t){return this._toObject(t,e,i)},this)},_toObject:function(t,e,i){this.includeDefaultValues||(o=t.includeDefaultValues,t.includeDefaultValues=!1);var o,e=t[e](i);return this.includeDefaultValues||(t.includeDefaultValues=o),e},__serializeBgOverlay:function(t,e){var i={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject(e):this.backgroundColor};return this.overlayColor&&(i.overlay=this.overlayColor.toObject?this.overlayColor.toObject(e):this.overlayColor),this.backgroundImage&&(i.backgroundImage=this._toObject(this.backgroundImage,t,e)),this.overlayImage&&(i.overlayImage=this._toObject(this.overlayImage,t,e)),i},svgViewportTransformation:!0,toSVG:function(t,e){var i=[];return this._setSVGPreamble(i,t=t||{}),this._setSVGHeader(i,t),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage",e),this._setSVGObjects(i,e),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage",e),i.push("</svg>"),i.join("")},_setSVGPreamble:function(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(t,e){var i=e.width||this.width,o=e.height||this.height,n='viewBox="0 0 '+this.width+" "+this.height+'" ',r=fabric.Object.NUM_FRACTION_DIGITS;e.viewBox?n='viewBox="'+e.viewBox.x+" "+e.viewBox.y+" "+e.viewBox.width+" "+e.viewBox.height+'" ':this.svgViewportTransformation&&(e=this.viewportTransform,n='viewBox="'+s(-e[4]/e[0],r)+" "+s(-e[5]/e[3],r)+" "+s(this.width/e[0],r)+" "+s(this.height/e[3],r)+'" '),t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',o,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,n,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",fabric.version,"</desc>\n","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>\n")},_setSVGObjects:function(t,e){for(var i,o=0,n=this.getObjects(),r=n.length;o<r;o++)(i=n[o]).excludeFromExport||this._setSVGObject(t,i,e)},_setSVGObject:function(t,e,i){t.push(e.toSVG(i))},_setSVGBgOverlayImage:function(t,e,i){this[e]&&this[e].toSVG&&t.push(this[e].toSVG(i))},_setSVGBgOverlayColor:function(t,e){this[e]&&this[e].source?t.push('<rect x="',this[e].offsetX,'" y="',this[e].offsetY,'" ','width="',("repeat-y"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source:this).width,'" height="',("repeat-x"===this[e].repeat||"no-repeat"===this[e].repeat?this[e].source:this).height,'" fill="url(#'+e+'Pattern)"',"></rect>\n"):this[e]&&"overlayColor"===e&&t.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[e],'"',"></rect>\n")},sendToBack:function(t){if(!t)return this;var e,i,o,n=this._activeGroup;if(t===n)for(e=(o=n._objects).length;e--;)i=o[e],h(this._objects,i),this._objects.unshift(i);else h(this._objects,t),this._objects.unshift(t);return this.renderAll&&this.renderAll()},bringToFront:function(t){if(!t)return this;var e,i,o,n=this._activeGroup;if(t===n)for(o=n._objects,e=0;e<o.length;e++)i=o[e],h(this._objects,i),this._objects.push(i);else h(this._objects,t),this._objects.push(t);return this.renderAll&&this.renderAll()},sendBackwards:function(t,e){if(t){var i,o,n,r,s,a=this._activeGroup;if(t===a)for(s=a._objects,i=0;i<s.length;i++)o=s[i],0!==(n=this._objects.indexOf(o))&&(r=n-1,h(this._objects,o),this._objects.splice(r,0,o));else 0!==(n=this._objects.indexOf(t))&&(r=this._findNewLowerIndex(t,n,e),h(this._objects,t),this._objects.splice(r,0,t));this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(t,e,i){if(i){for(var o=e,n=e-1;0<=n;--n)if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){o=n;break}}else o=e-1;return o},bringForward:function(t,e){if(t){var i,o,n,r,s,a=this._activeGroup;if(t===a)for(i=(s=a._objects).length;i--;)o=s[i],(n=this._objects.indexOf(o))!==this._objects.length-1&&(r=n+1,h(this._objects,o),this._objects.splice(r,0,o));else(n=this._objects.indexOf(t))!==this._objects.length-1&&(r=this._findNewUpperIndex(t,n,e),h(this._objects,t),this._objects.splice(r,0,t));this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(t,e,i){if(i){for(var o=e,n=e+1;n<this._objects.length;++n)if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){o=n;break}}else o=e+1;return o},moveTo:function(t,e){return h(this._objects,t),this._objects.splice(e,0,t),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),o(fabric.StaticCanvas.prototype,fabric.Observable),o(fabric.StaticCanvas.prototype,fabric.Collection),o(fabric.StaticCanvas.prototype,fabric.DataURLExporter),o(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(t){var e=fabric.util.createCanvasElement();if(!e||!e.getContext)return null;var i=e.getContext("2d");if(!i)return null;switch(t){case"getImageData":return void 0!==i.getImageData;case"setLineDash":return void 0!==i.setLineDash;case"toDataURL":return void 0!==e.toDataURL;case"toDataURLWithQuality":try{return e.toDataURL("image/jpeg",0),!0}catch(t){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject)}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(t){return this.shadow=new fabric.Shadow(t),this},_setBrushStyles:function(){var t=this.canvas.contextTop;t.strokeStyle=this.color,t.lineWidth=this.width,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&t.setLineDash(this.strokeDashArray)},_setShadow:function(){var t,e;this.shadow&&(t=this.canvas.contextTop,e=this.canvas.getZoom(),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*e,t.shadowOffsetX=this.shadow.offsetX*e,t.shadowOffsetY=this.shadow.offsetY*e)},_resetShadow:function(){var t=this.canvas.contextTop;t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0}}),fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(t){t=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(t){this._points.push(t)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(t){t=new fabric.Point(t.x,t.y);this._addPoint(t)},_render:function(){var t=this.canvas.contextTop,e=this.canvas.viewportTransform,i=this._points[0],o=this._points[1];t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t.beginPath(),2===this._points.length&&i.x===o.x&&i.y===o.y&&(i.x-=.5,o.x+=.5),t.moveTo(i.x,i.y);for(var n=1,r=this._points.length;n<r;n++){var s=i.midPointFrom(o);t.quadraticCurveTo(i.x,i.y,s.x,s.y),i=this._points[n],o=this._points[n+1]}t.lineTo(i.x,i.y),t.stroke(),t.restore()},convertPointsToSVGPath:function(t){var e=[],i=new fabric.Point(t[0].x,t[0].y),o=new fabric.Point(t[1].x,t[1].y);e.push("M ",t[0].x," ",t[0].y," ");for(var n=1,r=t.length;n<r;n++){var s=i.midPointFrom(o);e.push("Q ",i.x," ",i.y," ",s.x," ",s.y," "),i=new fabric.Point(t[n].x,t[n].y),n+1<t.length&&(o=new fabric.Point(t[n+1].x,t[n+1].y))}return e.push("L ",i.x," ",i.y," "),e},createPath:function(t){t=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var t=this.convertPointsToSVGPath(this._points).join("");"M 0 0 Q 0 0 0 0 L 0 0"===t?this.canvas.renderAll():(t=this.createPath(t),this.canvas.add(t),t.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:t}))}}),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var t=this.addPoint(t),e=this.canvas.contextTop,i=this.canvas.viewportTransform;e.save(),e.transform(i[0],i[1],i[2],i[3],i[4],i[5]),e.fillStyle=t.fill,e.beginPath(),e.arc(t.x,t.y,t.radius,0,2*Math.PI,!1),e.closePath(),e.fill(),e.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){for(var t=this.canvas.renderOnAddRemove,e=(this.canvas.renderOnAddRemove=!1,[]),i=0,o=this.points.length;i<o;i++){var n=this.points[i],n=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill});this.shadow&&n.setShadow(this.shadow),e.push(n)}var r=new fabric.Group(e,{originX:"center",originY:"center"});r.canvas=this.canvas,this.canvas.add(r),this.canvas.fire("path:created",{path:r}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},addPoint:function(t){var t=new fabric.Point(t.x,t.y),e=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,i=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=e,t.fill=i,this.points.push(t),t}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render()},onMouseMove:function(t){this.addSprayChunk(t),this.render()},onMouseUp:function(){for(var t=this.canvas.renderOnAddRemove,e=(this.canvas.renderOnAddRemove=!1,[]),i=0,o=this.sprayChunks.length;i<o;i++)for(var n=this.sprayChunks[i],r=0,s=n.length;r<s;r++){var a=new fabric.Rect({width:n[r].width,height:n[r].width,left:n[r].x+1,top:n[r].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&a.setShadow(this.shadow),e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var h=new fabric.Group(e,{originX:"center",originY:"center"});h.canvas=this.canvas,this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.renderAll()},_getOptimizedRects:function(t){for(var e,i={},o=0,n=t.length;o<n;o++)i[e=t[o].left+""+t[o].top]||(i[e]=t[o]);var r=[];for(e in i)r.push(i[e]);return r},render:function(){var t=this.canvas.contextTop,e=(t.fillStyle=this.color,this.canvas.viewportTransform);t.save(),t.transform(e[0],e[1],e[2],e[3],e[4],e[5]);for(var i=0,o=this.sprayChunkPoints.length;i<o;i++){var n=this.sprayChunkPoints[i];void 0!==n.opacity&&(t.globalAlpha=n.opacity),t.fillRect(n.x,n.y,n.width,n.width)}t.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];for(var e=this.width/2,i=0;i<this.density;i++){var o=fabric.util.getRandomInt(t.x-e,t.x+e),n=fabric.util.getRandomInt(t.y-e,t.y+e),r=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,o=new fabric.Point(o,n);o.width=r,this.randomOpacity&&(o.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=fabric.document.createElement("canvas"),e=t.getContext("2d");return t.width=t.height=25,e.fillStyle=this.color,e.beginPath(),e.arc(10,10,10,0,2*Math.PI,!1),e.closePath(),e.fill(),t},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(t){var t=this.callSuper("createPath",t),e=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-e.x,offsetY:-e.y}),t}}),!function(){var t,s=fabric.util.getPointer,a=fabric.util.degreesToRadians,h=fabric.util.radiansToDegrees,l=Math.atan2,c=Math.abs,p=fabric.StaticCanvas.supports("setLineDash");for(t in fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(t,e){this._initStatic(t,e=e||{}),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var t,e=this.getActiveGroup(),i=this.getActiveObject(),o=[],n=[];if(!e&&!i||this.preserveObjectStacking)o=this._objects;else{for(var r=0,s=this._objects.length;r<s;r++)t=this._objects[r],(e&&e.contains(t)||t===i?n:o).push(t);e&&(e._set("_objects",n),o.push(e)),i&&o.push(i)}return o},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1);var t=this.contextContainer;return this.renderCanvas(t,this._chooseObjectsToRender()),this},renderTop:function(){var t=this.contextTop;return this.clearContext(t),this.selection&&this._groupSelector&&this._drawSelection(t),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,skewX:t.original.skewX,skewY:t.original.skewY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(t.target)?"rotate"===t.action?this._setOriginToCenter(t.target):("center"!==t.originX&&("right"===t.originX?t.mouseXSign=-1:t.mouseXSign=1),"center"!==t.originY&&("bottom"===t.originY?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(t,e,i){i=i||this.getPointer(t,!0),t=e.group&&e.group===this.getActiveGroup()?this._normalizePointer(e.group,i):{x:i.x,y:i.y};return e.containsPoint(t)||e._findTargetCorner(i)},_normalizePointer:function(t,e){t=t.calcTransformMatrix(),t=fabric.util.invertTransform(t),e=this.restorePointerVpt(e);return fabric.util.transformPoint(e,t)},isTargetTransparent:function(t,e,i){var o=t.hasBorders,n=t.transparentCorners,r=this.contextCache,s=t.selectionBackgroundColor,o=(t.hasBorders=t.transparentCorners=!1,t.selectionBackgroundColor="",r.save(),r.transform.apply(r,this.viewportTransform),t.render(r),r.restore(),t.active&&t._renderControls(r),t.hasBorders=o,t.transparentCorners=n,t.selectionBackgroundColor=s,fabric.util.isTransparent(r,e,i,this.targetFindTolerance));return this.clearContext(r),o},_shouldClearSelection:function(t,e){var i=this.getActiveGroup(),o=this.getActiveObject();return!e||i&&!i.contains(e)&&i!==e&&!t[this.selectionKey]||e&&!e.evented||e&&!e.selectable&&o&&o!==e},_shouldCenterTransform:function(t){var e,i;if(t)return"scale"===(e=this._currentTransform).action||"scaleX"===e.action||"scaleY"===e.action?i=this.centeredScaling||t.centeredScaling:"rotate"===e.action&&(i=this.centeredRotation||t.centeredRotation),i?!e.altKey:e.altKey},_getOriginFromCorner:function(t,e){t={x:t.originX,y:t.originY};return"ml"===e||"tl"===e||"bl"===e?t.x="right":"mr"!==e&&"tr"!==e&&"br"!==e||(t.x="left"),"tl"===e||"mt"===e||"tr"===e?t.y="bottom":"bl"!==e&&"mb"!==e&&"br"!==e||(t.y="top"),t},_getActionFromCorner:function(t,e,i){if(!e)return"drag";switch(e){case"mtr":return"rotate";case"ml":case"mr":return i[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return i[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(t,e){var i,o,n,r;e&&(i=this.getPointer(t),o=e._findTargetCorner(this.getPointer(t,!0)),n=this._getActionFromCorner(e,o,t),r=this._getOriginFromCorner(e,o),this._currentTransform={target:e,action:n,corner:o,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:r.x,originY:r.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,left:e.left,top:e.top,theta:a(e.angle),width:e.width*e.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:t.shiftKey,altKey:t[this.centeredKey]},this._currentTransform.original={left:e.left,top:e.top,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,originX:r.x,originY:r.y},this._resetCurrentTransform())},_translateObject:function(t,e){var i=this._currentTransform,o=i.target,t=t-i.offsetX,e=e-i.offsetY,i=!o.get("lockMovementX")&&o.left!==t,n=!o.get("lockMovementY")&&o.top!==e;return i&&o.set("left",t),n&&o.set("top",e),i||n},_changeSkewTransformOrigin:function(t,e,i){var o="originX",n={0:"center"},r=e.target.skewX,s="left",a="right",h="mt"===e.corner||"ml"===e.corner?1:-1,l=1;t=0<t?1:-1,"y"===i&&(r=e.target.skewY,s="top",a="bottom",o="originY"),n[-1]=s,n[1]=a,e.target.flipX&&(l*=-1),e.target.flipY&&(l*=-1),0===r?(e.skewSign=-h*t*l,e[o]=n[-t]):(e.skewSign=r=0<r?1:-1,e[o]=n[r*h*l])},_skewObject:function(t,e,i){var o,n,r=this._currentTransform,s=r.target,a=s.get("lockSkewingX"),h=s.get("lockSkewingY");return!(a&&"x"===i||h&&"y"===i)&&(a=s.getCenterPoint(),h=s.toLocalPoint(new fabric.Point(t,e),"center","center")[i],o=s.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[i],n=s._getTransformedDimensions(),this._changeSkewTransformOrigin(h-o,r,i),h=s.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY)[i],o=s.translateToOriginPoint(a,r.originX,r.originY),a=this._setObjectSkew(h,r,i,n),r.lastX=t,r.lastY=e,s.setPositionByOrigin(o,r.originX,r.originY),a)},_setObjectSkew:function(t,e,i,o){var n,r,s,a=e.target,e=e.skewSign,h="x"===i?(n="y",r="Y",s="X",l=0,a.skewY):(n="x",r="X",s="Y",l=a.skewX,0),l=a._getTransformedDimensions(l,h),h=2*Math.abs(t)-l[i],c=h<=2?0:(c=e*Math.atan(h/a["scale"+s]/(l[n]/a["scale"+r])),fabric.util.radiansToDegrees(c)),t=a["skew"+s]!==c;return a.set("skew"+s,c),0!==a["skew"+r]&&(i=a._getTransformedDimensions(),c=o[n]/i[n]*a["scale"+r],a.set("scale"+r,c)),t},_scaleObject:function(t,e,i){var o,n,r=this._currentTransform,s=r.target,a=s.get("lockScalingX"),h=s.get("lockScalingY"),l=s.get("lockScalingFlip");return(!a||!h)&&(o=s.translateToOriginPoint(s.getCenterPoint(),r.originX,r.originY),t=s.toLocalPoint(new fabric.Point(t,e),r.originX,r.originY),e=s._getTransformedDimensions(),n=!1,this._setLocalMouse(t,r),n=this._setObjectScale(t,r,a,h,i,l,e),s.setPositionByOrigin(o,r.originX,r.originY),n)},_setObjectScale:function(t,e,i,o,n,r,s){var a=e.target,h=!1,l=!1,c=!1,p=t.x*a.scaleX/s.x,u=t.y*a.scaleY/s.y,d=a.scaleX!==p,f=a.scaleY!==u;return r&&p<=0&&p<a.scaleX&&(h=!0),r&&u<=0&&u<a.scaleY&&(l=!0),"equally"!==n||i||o?n?"x"!==n||a.get("lockUniScaling")?"y"!==n||a.get("lockUniScaling")||l||o||a.set("scaleY",u)&&(c=c||f):h||i||a.set("scaleX",p)&&(c=c||d):(h||i||a.set("scaleX",p)&&(c=c||d),l||o||a.set("scaleY",u)&&(c=c||f)):h||l||(c=this._scaleObjectEqually(t,a,e,s)),e.newScaleX=p,e.newScaleY=u,h||l||this._flipObject(e,n),c},_scaleObjectEqually:function(t,e,i,o){var t=t.y+t.x,o=o.y*i.original.scaleY/e.scaleY+o.x*i.original.scaleX/e.scaleX;return i.newScaleX=i.original.scaleX*t/o,i.newScaleY=i.original.scaleY*t/o,t=i.newScaleX!==e.scaleX||i.newScaleY!==e.scaleY,e.set("scaleX",i.newScaleX),e.set("scaleY",i.newScaleY),t},_flipObject:function(t,e){t.newScaleX<0&&"y"!==e&&("left"===t.originX?t.originX="right":"right"===t.originX&&(t.originX="left")),t.newScaleY<0&&"x"!==e&&("top"===t.originY?t.originY="bottom":"bottom"===t.originY&&(t.originY="top"))},_setLocalMouse:function(t,e){var i=e.target;"right"===e.originX?t.x*=-1:"center"===e.originX&&(t.x*=2*e.mouseXSign,t.x<0)&&(e.mouseXSign=-e.mouseXSign),"bottom"===e.originY?t.y*=-1:"center"===e.originY&&(t.y*=2*e.mouseYSign,t.y<0)&&(e.mouseYSign=-e.mouseYSign),c(t.x)>i.padding?t.x<0?t.x+=i.padding:t.x-=i.padding:t.x=0,c(t.y)>i.padding?t.y<0?t.y+=i.padding:t.y-=i.padding:t.y=0},_rotateObject:function(t,e){var i,o,n,r=this._currentTransform;return!r.target.get("lockRotation")&&(n=l(r.ey-r.top,r.ex-r.left),e=l(e-r.top,t-r.left),t=!0,(e=h(e-n+r.theta))<0&&(e=360+e),e%=360,0<r.target.snapAngle&&(n=r.target.snapAngle,i=r.target.snapThreshold||n,o=Math.ceil(e/n)*n,n=Math.floor(e/n)*n,Math.abs(e-n)<i?e=n:Math.abs(e-o)<i&&(e=o),r.target.angle===e)&&(t=!1),r.target.angle=e,t)},setCursor:function(t){this.upperCanvasEl.style.cursor=t},_resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.setAngle(0)},_drawSelection:function(t){var e,i,o=this._groupSelector,n=o.left,r=o.top,s=c(n),a=c(r);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(o.ex-(0<n?0:-n),o.ey-(0<r?0:-r),s,a)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,1<this.selectionDashArray.length&&!p?(e=o.ex+.5-(0<n?0:s),i=o.ey+.5-(0<r?0:a),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+s,i,this.selectionDashArray),fabric.util.drawDashedLine(t,e,i+a-1,e+s,i+a-1,this.selectionDashArray),fabric.util.drawDashedLine(t,e,i,e,i+a,this.selectionDashArray),fabric.util.drawDashedLine(t,e+s-1,i,e+s-1,i+a,this.selectionDashArray),t.closePath(),t.stroke()):(fabric.Object.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(o.ex+.5-(0<n?0:s),o.ey+.5-(0<r?0:a),s,a)))},findTarget:function(t,e){if(!this.skipTargetFind){var i,o=this.getPointer(t,!0),n=this.getActiveGroup(),r=this.getActiveObject();if(n&&!e&&this._checkTarget(o,n))return this._fireOverOutEvents(n,t),n;if(r&&r._findTargetCorner(o))return this._fireOverOutEvents(r,t),r;if(r&&this._checkTarget(o,r)){if(!this.preserveObjectStacking)return this._fireOverOutEvents(r,t),r;i=r}this.targets=[];e=this._searchPossibleTargets(this._objects,o);return t[this.altSelectionKey]&&e&&i&&e!==i&&(e=i),this._fireOverOutEvents(e,t),e}},_fireOverOutEvents:function(t,e){t?this._hoveredTarget!==t&&(this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout")),this.fire("mouse:over",{target:t,e:e}),t.fire("mouseover"),this._hoveredTarget=t):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget,e:e}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(t,e){if(e&&e.visible&&e.evented&&this.containsPoint(null,e,t))return!((this.perPixelTargetFind||e.perPixelTargetFind)&&!e.isEditing&&this.isTargetTransparent(e,t.x,t.y))||void 0},_searchPossibleTargets:function(t,e){for(var i,o,n=t.length;n--;)if(this._checkTarget(e,t[n])){"group"===(i=t[n]).type&&i.subTargetCheck&&(o=this._normalizePointer(i,e),o=this._searchPossibleTargets(i._objects,o))&&this.targets.push(o);break}return i},restorePointerVpt:function(t){return fabric.util.transformPoint(t,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(t,e,i){i=i||this.upperCanvasEl;var t=s(t),o=i.getBoundingClientRect(),n=o.width||0,r=o.height||0;return n&&r||("top"in o&&"bottom"in o&&(r=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(n=Math.abs(o.right-o.left))),this.calcOffset(),t.x=t.x-this._offset.left,t.y=t.y-this._offset.top,e||(t=this.restorePointerVpt(t)),o=0===n||0===r?{width:1,height:1}:{width:i.width/n,height:i.height/r},{x:t.x*o.width,y:t.y*o.height}},_createUpperCanvas:function(){var t=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+t),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(t){var e=this.getWidth()||t.width,i=this.getHeight()||t.height;fabric.util.setStyle(t,{position:"absolute",width:e+"px",height:i+"px",left:0,top:0}),t.width=e,t.height=i,fabric.util.makeElementUnselectable(t)},_copyCanvasStyle:function(t,e){e.style.cssText=t.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(t){this._activeObject&&this._activeObject.set("active",!1),(this._activeObject=t).set("active",!0)},setActiveObject:function(t,e){return this._setActiveObject(t),this.renderAll(),this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e}),this},getActiveObject:function(){return this._activeObject},_onObjectRemoved:function(t){this.getActiveObject()===t&&(this.fire("before:selection:cleared",{target:t}),this._discardActiveObject(),this.fire("selection:cleared",{target:t}),t.fire("deselected")),this.callSuper("_onObjectRemoved",t)},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(t){var e=this._activeObject;return this.fire("before:selection:cleared",{target:e,e:t}),this._discardActiveObject(),this.fire("selection:cleared",{e:t}),e&&e.fire("deselected",{e:t}),this},_setActiveGroup:function(t){(this._activeGroup=t)&&t.set("active",!0)},setActiveGroup:function(t,e){return this._setActiveGroup(t),t&&(this.fire("object:selected",{target:t,e:e}),t.fire("selected",{e:e})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var t=this.getActiveGroup();t&&t.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(t){var e=this.getActiveGroup();return this.fire("before:selection:cleared",{e:t,target:e}),this._discardActiveGroup(),this.fire("selection:cleared",{e:t}),this},deactivateAll:function(){for(var t,e=this.getObjects(),i=0,o=e.length;i<o;i++)(t=e[i])&&t.set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(t){var e=this.getActiveGroup(),i=this.getActiveObject();return(i||e)&&this.fire("before:selection:cleared",{target:i||e,e:t}),this.deactivateAll(),(i||e)&&(this.fire("selection:cleared",{e:t,target:i}),i)&&i.fire("deselected"),this},dispose:function(){this.callSuper("dispose");var t=this.wrapperEl;return this.removeListeners(),t.removeChild(this.upperCanvasEl),t.removeChild(this.lowerCanvasEl),delete this.upperCanvasEl,t.parentNode&&t.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,this},clear:function(){return this.discardActiveGroup(),this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(t){var e=this.getActiveGroup();e?e._renderControls(t):this._drawObjectsControls(t)},_drawObjectsControls:function(t){for(var e=0,i=this._objects.length;e<i;++e)this._objects[e]&&this._objects[e].active&&this._objects[e]._renderControls(t)},_toObject:function(t,e,i){var o=this._realizeGroupTransformOnObject(t),e=this.callSuper("_toObject",t,e,i);return this._unwindGroupTransformOnObject(t,o),e},_realizeGroupTransformOnObject:function(e){var i;return e.group&&e.group===this.getActiveGroup()?(i={},["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"].forEach(function(t){i[t]=e[t]}),this.getActiveGroup().realizeTransform(e),i):null},_unwindGroupTransformOnObject:function(t,e){e&&t.set(e)},_setSVGObject:function(t,e,i){var o=this._realizeGroupTransformOnObject(e);this.callSuper("_setSVGObject",t,e,i),this._unwindGroupTransformOnObject(e,o)}}),fabric.StaticCanvas)"prototype"!==t&&(fabric.Canvas[t]=fabric.StaticCanvas[t]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),!function(){var o={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},i=fabric.util.addListener,n=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),i(fabric.window,"resize",this._onResize),i(this.upperCanvasEl,"mousedown",this._onMouseDown),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"mouseout",this._onMouseOut),i(this.upperCanvasEl,"mouseenter",this._onMouseEnter),i(this.upperCanvasEl,"wheel",this._onMouseWheel),i(this.upperCanvasEl,"contextmenu",this._onContextMenu),i(this.upperCanvasEl,"touchstart",this._onMouseDown),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this)},removeListeners:function(){n(fabric.window,"resize",this._onResize),n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"mouseout",this._onMouseOut),n(this.upperCanvasEl,"mouseenter",this._onMouseEnter),n(this.upperCanvasEl,"wheel",this._onMouseWheel),n(this.upperCanvasEl,"contextmenu",this._onContextMenu),n(this.upperCanvasEl,"touchstart",this._onMouseDown),n(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!=typeof eventjs&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(t,e){this.__onTransformGesture&&this.__onTransformGesture(t,e)},_onDrag:function(t,e){this.__onDrag&&this.__onDrag(t,e)},_onMouseWheel:function(t){this.__onMouseWheel(t)},_onMouseOut:function(t){var e=this._hoveredTarget;this.fire("mouse:out",{target:e,e:t}),this._hoveredTarget=null,e&&e.fire("mouseout",{e:t})},_onMouseEnter:function(t){this.findTarget(t)||(this.fire("mouse:over",{target:null,e:t}),this._hoveredTarget=null)},_onOrientationChange:function(t,e){this.__onOrientationChange&&this.__onOrientationChange(t,e)},_onShake:function(t,e){this.__onShake&&this.__onShake(t,e)},_onLongPress:function(t,e){this.__onLongPress&&this.__onLongPress(t,e)},_onContextMenu:function(t){return this.stopContextMenu&&(t.stopPropagation(),t.preventDefault()),!1},_onMouseDown:function(t){this.__onMouseDown(t),i(fabric.document,"touchend",this._onMouseUp),i(fabric.document,"touchmove",this._onMouseMove),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchstart"===t.type?n(this.upperCanvasEl,"mousedown",this._onMouseDown):(i(fabric.document,"mouseup",this._onMouseUp),i(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(t){var e;this.__onMouseUp(t),n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"touchend",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove),n(fabric.document,"touchmove",this._onMouseMove),i(this.upperCanvasEl,"mousemove",this._onMouseMove),i(this.upperCanvasEl,"touchmove",this._onMouseMove),"touchend"===t.type&&(e=this,setTimeout(function(){i(e.upperCanvasEl,"mousedown",e._onMouseDown)},400))},_onMouseMove:function(t){!this.allowTouchScrolling&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)},_onResize:function(){this.calcOffset()},_shouldRender:function(t,e){var i=this.getActiveGroup()||this.getActiveObject();return!!(t&&(t.isMoving||t!==i)||!t&&i||!t&&!i&&!this._groupSelector||e&&this._previousPointer&&this.selection&&(e.x!==this._previousPointer.x||e.y!==this._previousPointer.y))},__onMouseUp:function(t){var e=!0,i=this._currentTransform,o=this._groupSelector,o=!o||0===o.left&&0===o.top;this.isDrawingMode&&this._isCurrentlyDrawing?this._onMouseUpInDrawingMode(t):(i&&(this._finalizeCurrentTransform(),e=!i.actionPerformed),e=e?this.findTarget(t,!0):i.target,i=this._shouldRender(e,this.getPointer(t)),e||!o?this._maybeGroupObjects(t):(this._groupSelector=null,this._currentTransform=null),e&&(e.isMoving=!1),this._handleCursorAndEvent(t,e,"up"),e&&(e.__corner=0),i&&this.renderAll())},_handleCursorAndEvent:function(t,e,i){this._setCursorFromEvent(t,e),this._handleEvent(t,i,e||null)},_handleEvent:function(t,e,i){var o=this.targets||[],n={e:t,target:i,subTargets:o};this.fire("mouse:"+e,n),i&&i.fire("mouse"+e,n);for(var r=0;r<o.length;r++)o[r].fire("mouse"+e,n)},_finalizeCurrentTransform:function(){var t=this._currentTransform,e=t.target;e._scaling&&(e._scaling=!1),e.setCoords(),this._restoreOriginXY(e),(t.actionPerformed||this.stateful&&e.hasStateChanged())&&(this.fire("object:modified",{target:e}),e.fire("modified"))},_restoreOriginXY:function(t){var e;this._previousOriginX&&this._previousOriginY&&(e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY),t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null)},_onMouseDownInDrawingMode:function(t){this._isCurrentlyDrawing=!0,this.discardActiveObject(t).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var e=this.getPointer(t);this.freeDrawingBrush.onMouseDown(e),this._handleEvent(t,"down")},_onMouseMoveInDrawingMode:function(t){var e;this._isCurrentlyDrawing&&(e=this.getPointer(t),this.freeDrawingBrush.onMouseMove(e)),this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")},_onMouseUpInDrawingMode:function(t){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(t,"up")},__onMouseDown:function(t){var e,i,o=this.findTarget(t),n=this.getPointer(t,!0);("which"in t?3===t.which:2===t.button)?this.fireRightClick&&this._handleEvent(t,"down",o||null):this.isDrawingMode?this._onMouseDownInDrawingMode(t):this._currentTransform||(this._previousPointer=n,e=this._shouldRender(o,n),i=this._shouldGroup(t,o),this._shouldClearSelection(t,o)?this._clearSelection(t,o,n):i&&(this._handleGrouping(t,o),o=this.getActiveGroup()),o&&(!o.selectable||!o.__corner&&i||(this._beforeTransform(t,o),this._setupCurrentTransform(t,o)),o!==this.getActiveGroup())&&o!==this.getActiveObject()&&(this.deactivateAll(),o.selectable)&&this.setActiveObject(o,t),this._handleEvent(t,"down",o||null),e&&this.renderAll())},_beforeTransform:function(t,e){this.stateful&&e.saveState(),e._findTargetCorner(this.getPointer(t))&&this.onBeforeScaleRotate(e)},_clearSelection:function(t,e,i){this.deactivateAllWithDispatch(t),e&&e.selectable?this.setActiveObject(e,t):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(t){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var e=t.getCenterPoint();t.originX="center",t.originY="center",t.left=e.x,t.top=e.y,this._currentTransform.left=t.left,this._currentTransform.top=t.top},_setCenterToOrigin:function(t){var e=t.translateToOriginPoint(t.getCenterPoint(),this._previousOriginX,this._previousOriginY);t.originX=this._previousOriginX,t.originY=this._previousOriginY,t.left=e.x,t.top=e.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(t){var e,i,o;this.isDrawingMode?this._onMouseMoveInDrawingMode(t):void 0!==t.touches&&1<t.touches.length||((o=this._groupSelector)?(i=this.getPointer(t,!0),o.left=i.x-o.ex,o.top=i.y-o.ey,this.renderTop()):this._currentTransform?this._transformObject(t):(e=this.findTarget(t),this._setCursorFromEvent(t,e)),this._handleEvent(t,"move",e||null))},__onMouseWheel:function(t){this.fire("mouse:wheel",{e:t})},_transformObject:function(t){var e=this.getPointer(t),i=this._currentTransform;i.reset=!1,i.target.isMoving=!0,this._beforeScaleTransform(t,i),this._performTransformAction(t,i,e),i.actionPerformed&&this.renderAll()},_performTransformAction:function(t,e,i){var o=i.x,i=i.y,n=e.target,r=e.action,s=!1;"rotate"===r?(s=this._rotateObject(o,i))&&this._fire("rotating",n,t):"scale"===r?(s=this._onScale(t,e,o,i))&&this._fire("scaling",n,t):"scaleX"===r?(s=this._scaleObject(o,i,"x"))&&this._fire("scaling",n,t):"scaleY"===r?(s=this._scaleObject(o,i,"y"))&&this._fire("scaling",n,t):"skewX"===r?(s=this._skewObject(o,i,"x"))&&this._fire("skewing",n,t):"skewY"===r?(s=this._skewObject(o,i,"y"))&&this._fire("skewing",n,t):(s=this._translateObject(o,i))&&(this._fire("moving",n,t),this.setCursor(n.moveCursor||this.moveCursor)),e.actionPerformed=s},_fire:function(t,e,i){this.fire("object:"+t,{target:e,e:i}),e.fire(t,{e:i})},_beforeScaleTransform:function(t,e){var i;"scale"!==e.action&&"scaleX"!==e.action&&"scaleY"!==e.action||(!(i=this._shouldCenterTransform(e.target))||"center"===e.originX&&"center"===e.originY)&&(i||"center"!==e.originX||"center"!==e.originY)||(this._resetCurrentTransform(),e.reset=!0)},_onScale:function(t,e,i,o){return!t[this.uniScaleKey]&&!this.uniScaleTransform||e.target.get("lockUniScaling")?(e.reset||"scale"!==e.currentAction||this._resetCurrentTransform(),e.currentAction="scaleEqually",this._scaleObject(i,o,"equally")):(e.currentAction="scale",this._scaleObject(i,o))},_setCursorFromEvent:function(t,e){var i,o;return e?(i=e.hoverCursor||this.hoverCursor,e.selectable&&(o=this.getActiveGroup(),o=e._findTargetCorner&&(!o||!o.contains(e))&&e._findTargetCorner(this.getPointer(t,!0)))?this._setCornerCursor(o,e,t):this.setCursor(i),!0):(this.setCursor(this.defaultCursor),!1)},_setCornerCursor:function(t,e,i){if(t in o)this.setCursor(this._getRotatedCornerCursor(t,e,i));else{if("mtr"!==t||!e.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(t,e,i){e=Math.round(e.getAngle()%360/45);return e<0&&(e+=8),e+=o[t],i[this.altActionKey]&&o[t]%2==0&&(e+=2),this.cursorMap[e%=8]}})}(),!function(){var c=Math.min,p=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(t,e){var i=this.getActiveObject();return t[this.selectionKey]&&e&&e.selectable&&(this.getActiveGroup()||i&&i!==e)&&this.selection},_handleGrouping:function(t,e){var i=this.getActiveGroup();(e!==i||(e=this.findTarget(t,!0)))&&(i?this._updateActiveGroup(e,t):this._createActiveGroup(e,t),this._activeGroup)&&this._activeGroup.saveCoords()},_updateActiveGroup:function(t,e){var i=this.getActiveGroup();if(i.contains(t)){if(i.removeWithUpdate(t),t.set("active",!1),1===i.size())return this.discardActiveGroup(e),void this.setActiveObject(i.item(0))}else i.addWithUpdate(t);this.fire("selection:created",{target:i,e:e}),i.set("active",!0)},_createActiveGroup:function(t,e){var i;this._activeObject&&t!==this._activeObject&&((i=this._createGroup(t)).addWithUpdate(),this.setActiveGroup(i),this._activeObject=null,this.fire("selection:created",{target:i,e:e})),t.set("active",!0)},_createGroup:function(t){var e=this.getObjects(),e=e.indexOf(this._activeObject)<e.indexOf(t)?[this._activeObject,t]:[t,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.Group(e,{canvas:this})},_groupSelectedObjects:function(t){var e=this._collectObjects();1===e.length?this.setActiveObject(e[0],t):1<e.length&&((e=new fabric.Group(e.reverse(),{canvas:this})).addWithUpdate(),this.setActiveGroup(e,t),e.saveCoords(),this.fire("selection:created",{target:e}),this.renderAll())},_collectObjects:function(){for(var t,e=[],i=this._groupSelector.ex,o=this._groupSelector.ey,n=i+this._groupSelector.left,r=o+this._groupSelector.top,s=new fabric.Point(c(i,n),c(o,r)),a=new fabric.Point(p(i,n),p(o,r)),h=i===n&&o===r,l=this._objects.length;l--&&!((t=this._objects[l])&&t.selectable&&t.visible&&(t.intersectsWithRect(s,a)||t.isContainedWithinRect(s,a)||t.containsPoint(s)||t.containsPoint(a))&&(t.set("active",!0),e.push(t),h)););return e},_maybeGroupObjects:function(t){this.selection&&this._groupSelector&&this._groupSelectedObjects(t);t=this.getActiveGroup();t&&(t.setObjectsCoords().setCoords(),t.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),!function(){var o=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(t){var e=(t=t||{}).format||"png",i=t.quality||1,o=t.multiplier||1,t={left:t.left||0,top:t.top||0,width:t.width||0,height:t.height||0};return this.__toDataURLWithMultiplier(e,i,t,o)},__toDataURLWithMultiplier:function(t,e,i,o){var n=this.getWidth(),r=this.getHeight(),s=(i.width||this.getWidth())*o,a=(i.height||this.getHeight())*o,h=this.getZoom()*o,l=this.viewportTransform,c=(l[4]-i.left)*o,o=(l[5]-i.top)*o,p=this.interactive,h=(this.viewportTransform=[h,0,0,h,c,o],this.interactive&&(this.interactive=!1),n!==s||r!==a?this.setDimensions({width:s,height:a}):this.renderAll(),this.__toDataURL(t,e,i));return p&&(this.interactive=p),this.viewportTransform=l,this.setDimensions({width:n,height:r}),h},__toDataURL:function(t,e){var i=this.contextContainer.canvas;return"jpg"===t&&(t="jpeg"),o?i.toDataURL("image/"+t,e):i.toDataURL("image/"+t)},toDataURLWithMultiplier:function(t,e,i){return this.toDataURL({format:t,multiplier:e,quality:i})}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(t,e,i){return this.loadFromJSON(t,e,i)},loadFromJSON:function(t,e,i){var o,n;if(t)return o="string"==typeof t?JSON.parse(t):fabric.util.object.clone(t),this.clear(),(n=this)._enlivenObjects(o.objects,function(){n._setBgOverlay(o,function(){for(var t in delete o.objects,delete o.backgroundImage,delete o.overlayImage,delete o.background,delete o.overlay,o)n[t]=o[t];e&&e()})},i),this},_setBgOverlay:function(t,e){var i,o=this,n={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};t.backgroundImage||t.overlayImage||t.background||t.overlay?(this.__setBgOverlay("backgroundImage",t.backgroundImage,n,i=function(){n.backgroundImage&&n.overlayImage&&n.backgroundColor&&n.overlayColor&&(o.renderAll(),e)&&e()}),this.__setBgOverlay("overlayImage",t.overlayImage,n,i),this.__setBgOverlay("backgroundColor",t.background,n,i),this.__setBgOverlay("overlayColor",t.overlay,n,i),i()):e&&e()},__setBgOverlay:function(e,t,i,o){var n=this;t?"backgroundImage"===e||"overlayImage"===e?fabric.Image.fromObject(t,function(t){n[e]=t,i[e]=!0,o&&o()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){i[e]=!0,o&&o()}):i[e]=!0},_enlivenObjects:function(t,e,i){var o,n=this;t&&0!==t.length?(o=this.renderOnAddRemove,this.renderOnAddRemove=!1,fabric.util.enlivenObjects(t,function(t){t.forEach(function(t,e){n.insertAt(t,e)}),n.renderOnAddRemove=o,e&&e()},null,i)):e&&e()},_toDataURL:function(e,i){this.clone(function(t){i(t.toDataURL(e))})},_toDataURLWithMultiplier:function(e,i,o){this.clone(function(t){o(t.toDataURLWithMultiplier(e,i))})},clone:function(e,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){e&&e(t)})})},cloneWithoutData:function(t){var e=fabric.document.createElement("canvas"),i=(e.width=this.getWidth(),e.height=this.getHeight(),new fabric.Canvas(e));i.clipTo=this.clipTo,this.backgroundImage?(i.setBackgroundImage(this.backgroundImage.src,function(){i.renderAll(),t&&t(i)}),i.backgroundImageOpacity=this.backgroundImageOpacity,i.backgroundImageStretch=this.backgroundImageStretch):t&&t(i)}}),!function(t){"use strict";var r=t.fabric||(t.fabric={}),t=r.util.object.extend,i=r.util.toFixed,e=r.util.string.capitalize,o=r.util.degreesToRadians,n=r.StaticCanvas.supports("setLineDash"),s=!r.isLikelyNode;r.Object||(r.Object=r.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:s,statefullCache:!1,noScaleCache:!0,dirty:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit fillRule backgroundColor".split(" "),initialize:function(t){(t=t||{})&&this.setOptions(t),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"}))},_createCacheCanvas:function(){this._cacheCanvas=r.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas()},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform&&"scale"===this.canvas._currentTransform.action.slice(0,5))return!1;var t=this.getViewportTransform()[0],e=this.getObjectScaling(),i=this._getNonTransformedDimensions(),o=this.canvas&&this.canvas._isRetinaScaling()?r.devicePixelRatio:1,n=e.scaleX*t*o,e=e.scaleY*t*o,t=i.x*n,o=i.y*e;return(t!==this.cacheWidth||o!==this.cacheHeight)&&(this._cacheCanvas.width=t,this._cacheCanvas.height=o,this._cacheContext.translate(t/2,o/2),this._cacheContext.scale(n,e),this.cacheWidth=t,this.cacheHeight=o,this.zoomX=n,this.zoomY=e,!0)},_initGradient:function(t){!t.fill||!t.fill.colorStops||t.fill instanceof r.Gradient||this.set("fill",new r.Gradient(t.fill)),!t.stroke||!t.stroke.colorStops||t.stroke instanceof r.Gradient||this.set("stroke",new r.Gradient(t.stroke))},_initPattern:function(t){!t.fill||!t.fill.source||t.fill instanceof r.Pattern||this.set("fill",new r.Pattern(t.fill)),!t.stroke||!t.stroke.source||t.stroke instanceof r.Pattern||this.set("stroke",new r.Pattern(t.stroke))},_initClipping:function(t){t.clipTo&&"string"==typeof t.clipTo&&void 0!==(t=r.util.getFunctionBody(t.clipTo))&&(this.clipTo=new Function("ctx",t))},setOptions:function(t){for(var e in t)this.set(e,t[e]);this._initGradient(t),this._initPattern(t),this._initClipping(t)},transform:function(t,e){this.group&&!this.group._transformDone&&this.group===this.canvas._activeGroup&&this.group.transform(t);e=e?this._getLeftTopCoords():this.getCenterPoint();t.translate(e.x,e.y),t.rotate(o(this.angle)),t.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1)),t.transform(1,0,Math.tan(o(this.skewX)),1,0,0),t.transform(1,Math.tan(o(this.skewY)),0,1,0,0)},toObject:function(t){var e=r.Object.NUM_FRACTION_DIGITS,e={type:this.type,originX:this.originX,originY:this.originY,left:i(this.left,e),top:i(this.top,e),width:i(this.width,e),height:i(this.height,e),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,e),strokeDashArray:this.strokeDashArray&&this.strokeDashArray.concat(),strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,e),scaleX:i(this.scaleX,e),scaleY:i(this.scaleY,e),angle:i(this.getAngle(),e),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix&&this.transformMatrix.concat(),skewX:i(this.skewX,e),skewY:i(this.skewY,e)};return r.util.populateWithProperties(this,e,t),e=this.includeDefaultValues?e:this._removeDefaultValues(e)},toDatalessObject:function(t){return this.toObject(t)},_removeDefaultValues:function(e){var i=r.util.getKlass(e.type).prototype;return i.stateProperties.forEach(function(t){e[t]===i[t]&&delete e[t],"[object Array]"===Object.prototype.toString.call(e[t])&&"[object Array]"===Object.prototype.toString.call(i[t])&&0===e[t].length&&0===i[t].length&&delete e[t]}),e},toString:function(){return"#<fabric."+e(this.type)+">"},get:function(t){return this[t]},getObjectScaling:function(){var t,e=this.scaleX,i=this.scaleY;return this.group&&(e*=(t=this.group.getObjectScaling()).scaleX,i*=t.scaleY),{scaleX:e,scaleY:i}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,e){return("scaleX"===t||"scaleY"===t)&&(e=this._constrainScale(e)),"scaleX"===t&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof r.Shadow||(e=new r.Shadow(e)),this[t]=e,-1<this.cacheProperties.indexOf(t)&&(this.dirty=!0),"width"!==t&&"height"!==t||(this.minScaleLimit=Math.min(.1,1/Math.max(this.width,this.height))),this},setOnGroup:function(){},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},setSourcePath:function(t){return this.sourcePath=t,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(t,e){0===this.width&&0===this.height||!this.visible||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),e||this.transform(t),this._setOpacity(t),this._setShadow(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this.clipTo&&r.util.clipContext(this,t),this.objectCaching&&!this.group?(this.isCacheDirty(e)&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,e),this.dirty=!1),this.drawCacheOnCanvas(t)):(this.drawObject(t,e),e&&this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&t.restore(),t.restore())},drawObject:function(t,e){this._renderBackground(t),this._setStrokeStyles(t),this._setFillStyles(t),this._render(t,e)},drawCacheOnCanvas:function(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheWidth/2,-this.cacheHeight/2)},isCacheDirty:function(t){return!(t||!this._updateCacheCanvas())||!!(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties"))&&(t||(t=this._getNonTransformedDimensions(),this._cacheContext.clearRect(-t.x/2,-t.y/2,t.x,t.y)),!0)},_renderBackground:function(t){var e;this.backgroundColor&&(e=this._getNonTransformedDimensions(),t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t))},_setOpacity:function(t){t.globalAlpha*=this.opacity},_setStrokeStyles:function(t){this.stroke&&(t.lineWidth=this.strokeWidth,t.lineCap=this.strokeLineCap,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,t.strokeStyle=this.stroke.toLive?this.stroke.toLive(t,this):this.stroke)},_setFillStyles:function(t){this.fill&&(t.fillStyle=this.fill.toLive?this.fill.toLive(t,this):this.fill)},_setLineDash:function(t,e,i){e&&(1&e.length&&e.push.apply(e,e),n?t.setLineDash(e):i&&i(t))},_renderControls:function(t,e){var i;!this.active||e||this.group&&this.group!==this.canvas.getActiveGroup()||(e=this.getViewportTransform(),i=this.calcTransformMatrix(),i=r.util.multiplyTransformMatrices(e,i),e=r.util.qrDecompose(i),t.save(),t.translate(e.translateX,e.translateY),t.lineWidth=+this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.group&&this.group===this.canvas.getActiveGroup()?(t.rotate(o(e.angle)),this.drawBordersInGroup(t,e)):(t.rotate(o(this.angle)),this.drawBorders(t)),this.drawControls(t),t.restore())},_setShadow:function(t){var e,i,o;this.shadow&&(e=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1,o=this.getObjectScaling(),this.canvas&&this.canvas._isRetinaScaling()&&(e*=r.devicePixelRatio,i*=r.devicePixelRatio),t.shadowColor=this.shadow.color,t.shadowBlur=this.shadow.blur*(e+i)*(o.scaleX+o.scaleY)/4,t.shadowOffsetX=this.shadow.offsetX*e*o.scaleX,t.shadowOffsetY=this.shadow.offsetY*i*o.scaleY)},_removeShadow:function(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)},_renderFill:function(t){var e;this.fill&&(t.save(),this.fill.gradientTransform&&(e=this.fill.gradientTransform,t.transform.apply(t,e)),this.fill.toLive&&t.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())},_renderStroke:function(t){var e;this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray,this._renderDashedStroke),this.stroke.gradientTransform&&(e=this.stroke.gradientTransform,t.transform.apply(t,e)),this.stroke.toLive&&t.translate(-this.width/2+this.stroke.offsetX||0,-this.height/2+this.stroke.offsetY||0),t.stroke(),t.restore())},clone:function(t,e){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(e),t):new r.Object(this.toObject(e))},cloneAsImage:function(e,t){t=this.toDataURL(t);return r.util.loadImage(t,function(t){e&&e(new r.Image(t))}),this},toDataURL:function(t){t=t||{};var e=r.util.createCanvasElement(),i=this.getBoundingRect(),i=(e.width=i.width,e.height=i.height,r.util.wrapElement(e,"div"),new r.StaticCanvas(e,{enableRetinaScaling:t.enableRetinaScaling})),e=("jpg"===t.format&&(t.format="jpeg"),"jpeg"===t.format&&(i.backgroundColor="#fff"),{active:this.get("active"),left:this.getLeft(),top:this.getTop()}),o=(this.set("active",!1),this.setPositionByOrigin(new r.Point(i.getWidth()/2,i.getHeight()/2),"center","center"),this.canvas),t=(i.add(this),i.toDataURL(t));return this.set(e).setCoords(),this.canvas=o,i.dispose(),i=null,t},isType:function(t){return this.type===t},complexity:function(){return 0},toJSON:function(t){return this.toObject(t)},setGradient:function(t,e){var i,o={colorStops:[]};for(i in o.type=(e=e||{}).type||(e.r1||e.r2?"radial":"linear"),o.coords={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},(e.r1||e.r2)&&(o.coords.r1=e.r1,o.coords.r2=e.r2),e.gradientTransform&&(o.gradientTransform=e.gradientTransform),e.colorStops){var n=new r.Color(e.colorStops[i]);o.colorStops.push({offset:i,color:n.toRgb(),opacity:n.getAlpha()})}return this.set(t,r.Gradient.forObject(this,o))},setPatternFill:function(t){return this.set("fill",new r.Pattern(t))},setShadow:function(t){return this.set("shadow",t?new r.Shadow(t):null)},setColor:function(t){return this.set("fill",t),this},setAngle:function(t){var e=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},remove:function(){return this.canvas&&this.canvas.remove(this),this},getLocalPointer:function(t,e){e=e||this.canvas.getPointer(t);t=new r.Point(e.x,e.y),e=this._getLeftTopCoords();return{x:(t=this.angle?r.util.rotatePoint(t,e,r.util.degreesToRadians(-this.angle)):t).x-e.x,y:t.y-e.y}},_setupCompositeOperation:function(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}}),r.util.createAccessors(r.Object),r.Object.prototype.rotate=r.Object.prototype.setAngle,t(r.Object.prototype,r.Observable),r.Object.NUM_FRACTION_DIGITS=2,r.Object.__uid=0)}("undefined"!=typeof exports?exports:this),!function(){var r=fabric.util.degreesToRadians,a={left:-.5,center:0,right:.5},h={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(t,e,i,o,n){var r=t.x,s=t.y;return"string"==typeof e?e=a[e]:e-=.5,"string"==typeof o?o=a[o]:o-=.5,"string"==typeof i?i=h[i]:i-=.5,"string"==typeof n?n=h[n]:n-=.5,n=n-i,((i=o-e)||n)&&(o=this._getTransformedDimensions(),r=t.x+i*o.x,s=t.y+n*o.y),new fabric.Point(r,s)},translateToCenterPoint:function(t,e,i){e=this.translateToGivenOrigin(t,e,i,"center","center");return this.angle?fabric.util.rotatePoint(e,t,r(this.angle)):e},translateToOriginPoint:function(t,e,i){e=this.translateToGivenOrigin(t,"center","center",e,i);return this.angle?fabric.util.rotatePoint(e,t,r(this.angle)):e},getCenterPoint:function(){var t=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(t,this.originX,this.originY)},getPointByOrigin:function(t,e){var i=this.getCenterPoint();return this.translateToOriginPoint(i,t,e)},toLocalPoint:function(t,e,i){var o=this.getCenterPoint(),e=void 0!==e&&void 0!==i?this.translateToGivenOrigin(o,"center","center",e,i):new fabric.Point(this.left,this.top),i=new fabric.Point(t.x,t.y);return(i=this.angle?fabric.util.rotatePoint(i,o,-r(this.angle)):i).subtractEquals(e)},setPositionByOrigin:function(t,e,i){t=this.translateToCenterPoint(t,e,i),e=this.translateToOriginPoint(t,this.originX,this.originY);this.set("left",e.x),this.set("top",e.y)},adjustPosition:function(t){var e=r(this.angle),i=this.getWidth(),o=Math.cos(e)*i,e=Math.sin(e)*i,i="string"==typeof this.originX?a[this.originX]:this.originX-.5,n="string"==typeof t?a[t]:t-.5;this.left+=o*(n-i),this.top+=e*(n-i),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getCenterPoint();this.originX="center",this.originY="center",this.left=t.x,this.top=t.y},_resetOrigin:function(){var t=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=t.x,this.top=t.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),!function(){function o(t){return[new fabric.Point(t.tl.x,t.tl.y),new fabric.Point(t.tr.x,t.tr.y),new fabric.Point(t.br.x,t.br.y),new fabric.Point(t.bl.x,t.bl.y)]}var c=fabric.util.degreesToRadians,n=fabric.util.multiplyTransformMatrices;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(t,e){var i=o(this.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonRectangle(i,t,e).status},intersectsWithObject:function(t){return"Intersection"===fabric.Intersection.intersectPolygonPolygon(o(this.oCoords),o(t.oCoords)).status||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)},isContainedWithinObject:function(t){for(var e=o(this.oCoords),i=0;i<4;i++)if(!t.containsPoint(e[i]))return!1;return!0},isContainedWithinRect:function(t,e){var i=this.getBoundingRect();return i.left>=t.x&&i.left+i.width<=e.x&&i.top>=t.y&&i.top+i.height<=e.y},containsPoint:function(t){this.oCoords||this.setCoords();var e=this._getImageLines(this.oCoords),t=this._findCrossPoints(t,e);return 0!==t&&t%2==1},_getImageLines:function(t){return{topline:{o:t.tl,d:t.tr},rightline:{o:t.tr,d:t.br},bottomline:{o:t.br,d:t.bl},leftline:{o:t.bl,d:t.tl}}},_findCrossPoints:function(t,e){var i,o,n,r=0;for(n in e)if(!((o=e[n]).o.y<t.y&&o.d.y<t.y||o.o.y>=t.y&&o.d.y>=t.y||((o.o.x===o.d.x&&o.o.x>=t.x?o.o.x:(i=(o.d.y-o.o.y)/(o.d.x-o.o.x),-(t.y-0*t.x-(o.o.y-i*o.o.x))/(0-i)))>=t.x&&(r+=1),2!==r)))break;return r},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(t){t=this.calcCoords(t);return fabric.util.makeBoundingBoxFromPoints([t.tl,t.tr,t.br,t.bl])},getWidth:function(){return this._getTransformedDimensions().x},getHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t},scale:function(t){return(t=this._constrainScale(t))<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,t*=-1),this.scaleX=t,this.scaleY=t,this.setCoords()},scaleToWidth:function(t){var e=this.getBoundingRect().width/this.getWidth();return this.scale(t/this.width/e)},scaleToHeight:function(t){var e=this.getBoundingRect().height/this.getHeight();return this.scale(t/this.height/e)},calcCoords:function(t){var e=c(this.angle),i=this.getViewportTransform(),o=t?this._getTransformedDimensions():this._calculateCurrentDimensions(),n=o.x,o=o.y,r=Math.sin(e),s=Math.cos(e),a=0<n?Math.atan(o/n):0,h=n/Math.cos(a)/2,l=Math.cos(a+e)*h,a=Math.sin(a+e)*h,e=this.getCenterPoint(),h=t?e:fabric.util.transformPoint(e,i),t=new fabric.Point(h.x-l,h.y-a),e=new fabric.Point(t.x+n*s,t.y+n*r),i=new fabric.Point(t.x-o*r,t.y+o*s),n=new fabric.Point(h.x+l,h.y+a),o=new fabric.Point((t.x+i.x)/2,(t.y+i.y)/2),l=new fabric.Point((e.x+t.x)/2,(e.y+t.y)/2);return{tl:t,tr:e,br:n,bl:i,ml:o,mt:l,mr:new fabric.Point((n.x+e.x)/2,(n.y+e.y)/2),mb:new fabric.Point((n.x+i.x)/2,(n.y+i.y)/2),mtr:new fabric.Point(l.x+r*this.rotatingPointOffset,l.y-s*this.rotatingPointOffset)}},setCoords:function(t){return this.oCoords=this.calcCoords(t),t||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){var t,e;return this.angle?(e=c(this.angle),[t=Math.cos(e),e=Math.sin(e),-e,t,0,0]):[1,0,0,1,0,0]},calcTransformMatrix:function(){var t=this.getCenterPoint(),t=[1,0,0,1,t.x,t.y],e=this._calcRotateMatrix(),i=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0),o=this.group?this.group.calcTransformMatrix():[1,0,0,1,0,0],o=n(o,t);return o=n(o,e),n(o,i)},_calcDimensionsTransformMatrix:function(t,e,i){var t=[1,0,Math.tan(c(t)),1],e=[1,Math.tan(c(e)),0,1],o=this.scaleX*(i&&this.flipX?-1:1),i=this.scaleY*(i&&this.flipY?-1:1),o=n([o,0,0,i],t,!0);return n(o,e,!0)}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(t){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,t):this.canvas.sendBackwards(this,t),this},bringForward:function(t){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,t):this.canvas.bringForward(this,t),this},moveTo:function(t){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,t):this.canvas.moveTo(this,t),this}}),!function(){function c(t,e){var i;return e?e.toLive?t+": url(#SVGID_"+e.id+"); ":(i=t+": "+(e=new fabric.Color(e)).toRgb()+"; ",1!==(e=e.getAlpha())&&(i+=t+"-opacity: "+e.toString()+"; "),i):t+": none; "}fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(t){var e=this.fillRule,i=this.strokeWidth||"0",o=this.strokeDashArray?this.strokeDashArray.join(" "):"none",n=this.strokeLineCap||"butt",r=this.strokeLineJoin||"miter",s=this.strokeMiterLimit||"4",a=void 0!==this.opacity?this.opacity:"1",h=this.visible?"":" visibility: hidden;",t=t?"":this.getSvgFilter(),l=c("fill",this.fill);return[c("stroke",this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",o,"; ","stroke-linecap: ",n,"; ","stroke-linejoin: ",r,"; ","stroke-miterlimit: ",s,"; ",l,"fill-rule: ",e,"; ","opacity: ",a,";",t,h].join("")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgId:function(){return this.id?'id="'+this.id+'" ':""},getSvgTransform:function(){var t,e,i,o,n,r,s;return this.group&&"path-group"===this.group.type?"":(n=fabric.util.toFixed,e=this.getAngle(),o=this.getSkewX()%360,s=this.getSkewY()%360,t=this.getCenterPoint(),r=fabric.Object.NUM_FRACTION_DIGITS,t="path-group"===this.type?"":"translate("+n(t.x,r)+" "+n(t.y,r)+")",e=0!==e?" rotate("+n(e,r)+")":"",i=1===this.scaleX&&1===this.scaleY?"":" scale("+n(this.scaleX,r)+" "+n(this.scaleY,r)+")",o=0!=o?" skewX("+n(o,r)+")":"",n=0!=s?" skewY("+n(s,r)+")":"",s="path-group"===this.type?this.width:0,r=this.flipX?" matrix(-1 0 0 1 "+s+" 0) ":"",s="path-group"===this.type?this.height:0,[t,e,i,r,this.flipY?" matrix(1 0 0 -1 0 "+s+")":"",o,n].join(""))},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var t=[];return this.fill&&this.fill.toLive&&t.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&t.push(this.stroke.toSVG(this,!1)),this.shadow&&t.push(this.shadow.toSVG(this)),t}})}(),!function(){var n=fabric.util.object.extend,o="stateProperties";function r(e,t,i){var o={};i.forEach(function(t){o[t]=e[t]}),n(e[t],o,!0)}fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(t){return!function t(e,i,o){if(!fabric.isLikelyNode&&e instanceof Element)return e===i;if(e instanceof Array){if(e.length===i.length){for(var n=0,r=e.length;n<r;n++)if(e[n]!==i[n])return;return 1}}else{if(!e||"object"!=typeof e)return e===i;if(o||Object.keys(e).length===Object.keys(i).length){for(var s in e)if(!t(e[s],i[s]))return;return 1}}}(this[t="_"+(t=t||o)],this,!0)},saveState:function(t){var e=t&&t.propertySet||o,i="_"+e;return r(this,i,this[e]),t&&t.stateProperties&&r(this,i,t.stateProperties),this},setupState:function(t){var e=(t=t||{}).propertySet||o;return this["_"+(t.propertySet=e)]={},this.saveState(t),this}})}(),!function(){var h=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(this.hasControls&&this.active){var e,i,o=t.x,n=t.y;for(i in this.__corner=0,this.oCoords)if(this.isControlVisible(i)&&("mtr"!==i||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==i&&"mr"!==i&&"mb"!==i&&"ml"!==i)&&(e=this._getImageLines(this.oCoords[i].corner),0!==(e=this._findCrossPoints({x:o,y:n},e)))&&e%2==1)return this.__corner=i}return!1},_setCornerCoords:function(){var t,e,i,o=this.oCoords,n=h(45-this.angle),r=.707106*this.cornerSize,s=r*Math.cos(n),a=r*Math.sin(n);for(i in o)t=o[i].x,e=o[i].y,o[i].corner={tl:{x:t-a,y:e-s},tr:{x:t+s,y:e-a},bl:{x:t-s,y:e+a},br:{x:t+a,y:e+s}}},_getNonTransformedDimensions:function(){var t=this.strokeWidth;return{x:this.width+t,y:this.height+t}},_getTransformedDimensions:function(t,e){void 0===t&&(t=this.skewX),void 0===e&&(e=this.skewY);for(var i=this._getNonTransformedDimensions(),o=i.x/2,i=i.y/2,n=[{x:-o,y:-i},{x:o,y:-i},{x:-o,y:i},{x:o,y:i}],r=this._calcDimensionsTransformMatrix(t,e,!1),s=0;s<n.length;s++)n[s]=fabric.util.transformPoint(n[s],r);return{x:(o=fabric.util.makeBoundingBoxFromPoints(n)).width,y:o.height}},_calculateCurrentDimensions:function(){var t=this.getViewportTransform(),e=this._getTransformedDimensions();return fabric.util.transformPoint(e,t,!0).scalarAdd(2*this.padding)},drawSelectionBackground:function(t){var e,i,o;return this.selectionBackgroundColor&&!this.group&&this.active&&(t.save(),e=this.getCenterPoint(),i=this._calculateCurrentDimensions(),o=this.canvas.viewportTransform,t.translate(e.x,e.y),t.scale(1/o[0],1/o[3]),t.rotate(h(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-i.x/2,-i.y/2,i.x,i.y),t.restore()),this},drawBorders:function(t){var e,i,o;return this.hasBorders&&(i=this._calculateCurrentDimensions(),o=1/this.borderScaleFactor,e=i.x+o,i=i.y+o,t.save(),t.strokeStyle=this.borderColor,this._setLineDash(t,this.borderDashArray,null),t.strokeRect(-e/2,-i/2,e,i),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(o=-i/2,t.beginPath(),t.moveTo(0,o),t.lineTo(0,o-this.rotatingPointOffset),t.closePath(),t.stroke()),t.restore()),this},drawBordersInGroup:function(t,e){var i,o;return this.hasBorders&&(o=this._getNonTransformedDimensions(),e=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),o=fabric.util.transformPoint(o,e),e=1/this.borderScaleFactor,i=o.x+e,o=o.y+e,t.save(),this._setLineDash(t,this.borderDashArray,null),t.strokeStyle=this.borderColor,t.strokeRect(-i/2,-o/2,i,o),t.restore()),this},drawControls:function(t){var e,i,o,n,r;return this.hasControls&&(e=(i=this._calculateCurrentDimensions()).x,i=i.y,o=-(e+(n=this.cornerSize))/2,n=-(i+n)/2,r=this.transparentCorners?"stroke":"fill",t.save(),t.strokeStyle=t.fillStyle=this.cornerColor,this.transparentCorners||(t.strokeStyle=this.cornerStrokeColor),this._setLineDash(t,this.cornerDashArray,null),this._drawControl("tl",t,r,o,n),this._drawControl("tr",t,r,o+e,n),this._drawControl("bl",t,r,o,n+i),this._drawControl("br",t,r,o+e,n+i),this.get("lockUniScaling")||(this._drawControl("mt",t,r,o+e/2,n),this._drawControl("mb",t,r,o+e/2,n+i),this._drawControl("mr",t,r,o+e,n+i/2),this._drawControl("ml",t,r,o,n+i/2)),this.hasRotatingPoint&&this._drawControl("mtr",t,r,o+e/2,n-this.rotatingPointOffset),t.restore()),this},_drawControl:function(t,e,i,o,n){var r;this.isControlVisible(t)&&(t=this.cornerSize,r=!this.transparentCorners&&this.cornerStrokeColor,"circle"===this.cornerStyle?(e.beginPath(),e.arc(o+t/2,n+t/2,t/2,0,2*Math.PI,!1),e[i](),r&&e.stroke()):("undefined"!=typeof G_vmlCanvasManager||this.transparentCorners||e.clearRect(o,n,t,t),e[i+"Rect"](o,n,t,t),r&&e.strokeRect(o,n,t,t)))},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){for(var e in t=t||{})this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){function i(){}var o=(t=t||{}).onComplete||i,n=t.onChange||i,r=this;return fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),r.renderAll(),n()},onComplete:function(){e.setCoords(),o()}}),this},fxCenterObjectV:function(e,t){function i(){}var o=(t=t||{}).onComplete||i,n=t.onChange||i,r=this;return fabric.util.animate({startValue:e.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),r.renderAll(),n()},onComplete:function(){e.setCoords(),o()}}),this},fxRemove:function(e,t){function i(){}var o=(t=t||{}).onComplete||i,n=t.onChange||i,r=this;return fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(t){e.set("opacity",t),r.renderAll(),n()},onComplete:function(){r.remove(e),o()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var t,e,i=[];for(t in arguments[0])i.push(t);for(var o=0,n=i.length;o<n;o++)e=o!==n-1,this._animate(t=i[o],arguments[0][t],arguments[1],e)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,i,o){var n,r=this,s=(t=t.toString(),i=i?fabric.util.object.clone(i):{},(n=~e.indexOf(".")?e.split("."):n)?this.get(n[0])[n[1]]:this.get(e));"from"in i||(i.from=s),t=~t.indexOf("=")?s+parseFloat(t.replace("=","")):parseFloat(t),fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(r)},onChange:function(t){n?r[n[0]][n[1]]=t:r.set(e,t),o||i.onChange&&i.onChange()},onComplete:function(){o||(r.setCoords(),i.onComplete&&i.onComplete())}})}}),!function(t){"use strict";var o=t.fabric||(t.fabric={}),n=o.util.object.extend,i={x1:1,x2:1,y1:1,y2:1},r=o.StaticCanvas.supports("setLineDash");function e(t,e){var i=t.origin,o=t.axis1,n=t.axis2,r=t.dimension,s=e.nearest,a=e.center,h=e.farthest;return function(){switch(this.get(i)){case s:return Math.min(this.get(o),this.get(n));case a:return Math.min(this.get(o),this.get(n))+.5*this.get(r);case h:return Math.max(this.get(o),this.get(n))}}}o.Line?o.warn("fabric.Line is already defined"):(o.Line=o.util.createClass(o.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(t,e){t=t||[0,0,0,0],this.callSuper("initialize",e),this.set("x1",t[0]),this.set("y1",t[1]),this.set("x2",t[2]),this.set("y2",t[3]),this._setWidthHeight(e)},_setWidthHeight:function(t){t=t||{},this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in t?t.left:this._getLeftToOriginX(),this.top="top"in t?t.top:this._getTopToOriginY()},_set:function(t,e){return this.callSuper("_set",t,e),void 0!==i[t]&&this._setWidthHeight(),this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(t,e){t.beginPath(),e&&(e=this.getCenterPoint(),t.translate(e.x-this.strokeWidth/2,e.y-this.strokeWidth/2)),(!this.strokeDashArray||this.strokeDashArray&&r)&&(e=this.calcLinePoints(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)),t.lineWidth=this.strokeWidth;e=t.strokeStyle;t.strokeStyle=this.stroke||t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=e},_renderDashedStroke:function(t){var e=this.calcLinePoints();t.beginPath(),o.util.drawDashedLine(t,e.x1,e.y1,e.x2,e.y2,this.strokeDashArray),t.closePath()},toObject:function(t){return n(this.callSuper("toObject",t),this.calcLinePoints())},_getNonTransformedDimensions:function(){var t=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===t.x&&(t.y-=this.strokeWidth),0===t.y)&&(t.x-=this.strokeWidth),t},calcLinePoints:function(){var t=this.x1<=this.x2?-1:1,e=this.y1<=this.y2?-1:1,i=t*this.width*.5,o=e*this.height*.5;return{x1:i,x2:t*this.width*-.5,y1:o,y2:e*this.height*-.5}},toSVG:function(t){var e=this._createBaseSVGMarkup(),i={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&"path-group"===this.group.type||(i=this.calcLinePoints()),e.push("<line ",this.getSvgId(),'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),o.Line.ATTRIBUTE_NAMES=o.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),o.Line.fromElement=function(t,e){var t=o.parseAttributes(t,o.Line.ATTRIBUTE_NAMES),i=[t.x1||0,t.y1||0,t.x2||0,t.y2||0];return new o.Line(i,n(t,e))},o.Line.fromObject=function(t,e){var i=[t.x1,t.y1,t.x2,t.y2],i=new o.Line(i,t);return e&&e(i),i})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var o=t.fabric||(t.fabric={}),a=Math.PI,n=o.util.object.extend;o.Circle?o.warn("fabric.Circle is already defined."):(o.Circle=o.util.createClass(o.Object,{type:"circle",radius:0,startAngle:0,endAngle:2*a,initialize:function(t){this.callSuper("initialize",t),this.set("radius",t&&t.radius||0)},_set:function(t,e){return this.callSuper("_set",t,e),"radius"===t&&this.setRadius(e),this},toObject:function(t){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(t))},toSVG:function(t){var e,i,o=this._createBaseSVGMarkup(),n=0,r=0,s=(this.endAngle-this.startAngle)%(2*a);return 0==s?(this.group&&"path-group"===this.group.type&&(n=this.left+this.radius,r=this.top+this.radius),o.push("<circle ",this.getSvgId(),'cx="'+n+'" cy="'+r+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')):(n=Math.cos(this.startAngle)*this.radius,r=Math.sin(this.startAngle)*this.radius,e=Math.cos(this.endAngle)*this.radius,i=Math.sin(this.endAngle)*this.radius,o.push('<path d="M '+n+" "+r," A "+this.radius+" "+this.radius," 0 ",+(a<s?"1":"0")+" 1"," "+e+" "+i,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')),t?t(o.join("")):o.join("")},_render:function(t,e){t.beginPath(),t.arc(e?this.left+this.radius:0,e?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1),this._renderFill(t),this._renderStroke(t)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(t){return this.radius=t,this.set("width",2*t).set("height",2*t)},complexity:function(){return 1}}),o.Circle.ATTRIBUTE_NAMES=o.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),o.Circle.fromElement=function(t,e){e=e||{};t=o.parseAttributes(t,o.Circle.ATTRIBUTE_NAMES);if(!("radius"in(i=t)&&0<=i.radius))throw new Error("value of `r` attribute is required and can not be negative");t.left=t.left||0,t.top=t.top||0;var i=new o.Circle(n(t,e));return i.left-=i.radius,i.top-=i.radius,i},o.Circle.fromObject=function(t,e){t=new o.Circle(t);return e&&e(t),t})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var o=t.fabric||(t.fabric={});o.Triangle?o.warn("fabric.Triangle is already defined"):(o.Triangle=o.util.createClass(o.Object,{type:"triangle",initialize:function(t){this.callSuper("initialize",t),this.set("width",t&&t.width||100).set("height",t&&t.height||100)},_render:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,i),t.lineTo(0,-i),t.lineTo(e,i),t.closePath(),this._renderFill(t),this._renderStroke(t)},_renderDashedStroke:function(t){var e=this.width/2,i=this.height/2;t.beginPath(),o.util.drawDashedLine(t,-e,i,0,-i,this.strokeDashArray),o.util.drawDashedLine(t,0,-i,e,i,this.strokeDashArray),o.util.drawDashedLine(t,e,i,-e,i,this.strokeDashArray),t.closePath()},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.width/2,o=this.height/2,i=[-i+" "+o,"0 "+-o,i+" "+o].join(",");return e.push("<polygon ",this.getSvgId(),'points="',i,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),o.Triangle.fromObject=function(t,e){t=new o.Triangle(t);return e&&e(t),t})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var i=t.fabric||(t.fabric={}),o=2*Math.PI,n=i.util.object.extend;i.Ellipse?i.warn("fabric.Ellipse is already defined."):(i.Ellipse=i.util.createClass(i.Object,{type:"ellipse",rx:0,ry:0,initialize:function(t){this.callSuper("initialize",t),this.set("rx",t&&t.rx||0),this.set("ry",t&&t.ry||0)},_set:function(t,e){switch(this.callSuper("_set",t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=0,o=0;return this.group&&"path-group"===this.group.type&&(i=this.left+this.rx,o=this.top+this.ry),e.push("<ellipse ",this.getSvgId(),'cx="',i,'" cy="',o,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},_render:function(t,e){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(e?this.left+this.rx:0,e?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,o,!1),t.restore(),this._renderFill(t),this._renderStroke(t)},complexity:function(){return 1}}),i.Ellipse.ATTRIBUTE_NAMES=i.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),i.Ellipse.fromElement=function(t,e){e=e||{};t=i.parseAttributes(t,i.Ellipse.ATTRIBUTE_NAMES),t.left=t.left||0,t.top=t.top||0,t=new i.Ellipse(n(t,e));return t.top-=t.ry,t.left-=t.rx,t},i.Ellipse.fromObject=function(t,e){t=new i.Ellipse(t);return e&&e(t),t})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var r=t.fabric||(t.fabric={}),i=r.util.object.extend;r.Rect?r.warn("fabric.Rect is already defined"):((t=r.Object.prototype.stateProperties.concat()).push("rx","ry","x","y"),r.Rect=r.util.createClass(r.Object,{stateProperties:t,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(t){this.callSuper("initialize",t),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(t,e){var i,o,n,r,s,a,h;1===this.width&&1===this.height?t.fillRect(-.5,-.5,1,1):(i=this.rx?Math.min(this.rx,this.width/2):0,o=this.ry?Math.min(this.ry,this.height/2):0,n=this.width,r=this.height,s=e?this.left:-this.width/2,e=e?this.top:-this.height/2,a=0!==i||0!==o,h=.4477152502,t.beginPath(),t.moveTo(s+i,e),t.lineTo(s+n-i,e),a&&t.bezierCurveTo(s+n-h*i,e,s+n,e+h*o,s+n,e+o),t.lineTo(s+n,e+r-o),a&&t.bezierCurveTo(s+n,e+r-h*o,s+n-h*i,e+r,s+n-i,e+r),t.lineTo(s+i,e+r),a&&t.bezierCurveTo(s+h*i,e+r,s,e+r-h*o,s,e+r-o),t.lineTo(s,e+o),a&&t.bezierCurveTo(s,e+h*o,s+h*i,e,s+i,e),t.closePath(),this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,o=this.width,n=this.height;t.beginPath(),r.util.drawDashedLine(t,e,i,e+o,i,this.strokeDashArray),r.util.drawDashedLine(t,e+o,i,e+o,i+n,this.strokeDashArray),r.util.drawDashedLine(t,e+o,i+n,e,i+n,this.strokeDashArray),r.util.drawDashedLine(t,e,i+n,e,i,this.strokeDashArray),t.closePath()},toObject:function(t){return this.callSuper("toObject",["rx","ry"].concat(t))},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=this.left,o=this.top;return this.group&&"path-group"===this.group.type||(i=-this.width/2,o=-this.height/2),e.push("<rect ",this.getSvgId(),'x="',i,'" y="',o,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),t?t(e.join("")):e.join("")},complexity:function(){return 1}}),r.Rect.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),r.Rect.fromElement=function(t,e){if(!t)return null;e=e||{};t=r.parseAttributes(t,r.Rect.ATTRIBUTE_NAMES),t.left=t.left||0,t.top=t.top||0,e=new r.Rect(i(e?r.util.object.clone(e):{},t));return e.visible=e.visible&&0<e.width&&0<e.height,e},r.Rect.fromObject=function(t,e){t=new r.Rect(t);return e&&e(t),t})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var r=t.fabric||(t.fabric={});r.Polyline?r.warn("fabric.Polyline is already defined"):(r.Polyline=r.util.createClass(r.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(t,e){return r.Polygon.prototype.initialize.call(this,t,e)},_calcDimensions:function(){return r.Polygon.prototype._calcDimensions.call(this)},toObject:function(t){return r.Polygon.prototype.toObject.call(this,t)},toSVG:function(t){return r.Polygon.prototype.toSVG.call(this,t)},_render:function(t,e){r.Polygon.prototype.commonRender.call(this,t,e)&&(this._renderFill(t),this._renderStroke(t))},_renderDashedStroke:function(t){var e,i;t.beginPath();for(var o=0,n=this.points.length;o<n;o++)e=this.points[o],i=this.points[o+1]||e,r.util.drawDashedLine(t,e.x,e.y,i.x,i.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),r.Polyline.ATTRIBUTE_NAMES=r.SHARED_ATTRIBUTES.concat(),r.Polyline.fromElement=function(t,e){if(!t)return null;e=e||{};var i=r.parsePointsAttribute(t.getAttribute("points")),t=r.parseAttributes(t,r.Polyline.ATTRIBUTE_NAMES);return new r.Polyline(i,r.util.object.extend(t,e))},r.Polyline.fromObject=function(t,e){t=new r.Polyline(t.points,t);return e&&e(t),t})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var o=t.fabric||(t.fabric={}),n=o.util.object.extend,r=o.util.array.min,s=o.util.array.max,a=o.util.toFixed;o.Polygon?o.warn("fabric.Polygon is already defined"):(o.Polygon=o.util.createClass(o.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t||[],this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX),this.pathOffset={x:this.minX+this.width/2,y:this.minY+this.height/2}},_calcDimensions:function(){var t=this.points,e=r(t,"x"),i=r(t,"y"),o=s(t,"x"),t=s(t,"y");this.width=o-e||0,this.height=t-i||0,this.minX=e||0,this.minY=i||0},toObject:function(t){return n(this.callSuper("toObject",t),{points:this.points.concat()})},toSVG:function(t){for(var e,i=[],o=this._createBaseSVGMarkup(),n=0,r=this.points.length;n<r;n++)i.push(a(this.points[n].x,2),",",a(this.points[n].y,2)," ");return this.group&&"path-group"===this.group.type||(e=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),o.push("<",this.type," ",this.getSvgId(),'points="',i.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),e," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(o.join("")):o.join("")},_render:function(t,e){this.commonRender(t,e)&&(this._renderFill(t),this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t))},commonRender:function(t,e){var i,o=this.points.length;if(!o||isNaN(this.points[o-1].y))return!1;e||t.translate(-this.pathOffset.x,-this.pathOffset.y),t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var n=0;n<o;n++)i=this.points[n],t.lineTo(i.x,i.y);return!0},_renderDashedStroke:function(t){o.Polyline.prototype._renderDashedStroke.call(this,t),t.closePath()},complexity:function(){return this.points.length}}),o.Polygon.ATTRIBUTE_NAMES=o.SHARED_ATTRIBUTES.concat(),o.Polygon.fromElement=function(t,e){if(!t)return null;e=e||{};var i=o.parsePointsAttribute(t.getAttribute("points")),t=o.parseAttributes(t,o.Polygon.ATTRIBUTE_NAMES);return new o.Polygon(i,n(t,e))},o.Polygon.fromObject=function(t,e){t=new o.Polygon(t.points,t);return e&&e(t),t})}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var b=t.fabric||(t.fabric={}),m=b.util.array.min,y=b.util.array.max,o=b.util.object.extend,n=Object.prototype.toString,g=b.util.drawArc,_={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},C={m:"l",M:"L"};b.Path?b.warn("fabric.Path is already defined"):(b.Path=b.util.createClass(b.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(t,e){(e=e||{})&&this.setOptions(e);var i="[object Array]"===n.call(t=t||[]);this.path=i?t:t.match&&t.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path&&(i||(this.path=this._parsePath()),this._setPositionDimensions(e),e.sourcePath&&this.setSourcePath(e.sourcePath),this.objectCaching)&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"}))},_setPositionDimensions:function(t){var e=this._parseDimensions();this.minX=e.left,this.minY=e.top,this.width=e.width,this.height=e.height,void 0===t.left&&(this.left=e.left+("center"===this.originX?this.width/2:"right"===this.originX?this.width:0)),void 0===t.top&&(this.top=e.top+("center"===this.originY?this.height/2:"bottom"===this.originY?this.height:0)),this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_renderPathCommands:function(t){var e,i,o,n=null,r=0,s=0,a=0,h=0,l=0,c=0,p=-this.pathOffset.x,u=-this.pathOffset.y;this.group&&"path-group"===this.group.type&&(u=p=0),t.beginPath();for(var d=0,f=this.path.length;d<f;++d){switch((e=this.path[d])[0]){case"l":a+=e[1],h+=e[2],t.lineTo(a+p,h+u);break;case"L":a=e[1],h=e[2],t.lineTo(a+p,h+u);break;case"h":a+=e[1],t.lineTo(a+p,h+u);break;case"H":a=e[1],t.lineTo(a+p,h+u);break;case"v":h+=e[1],t.lineTo(a+p,h+u);break;case"V":h=e[1],t.lineTo(a+p,h+u);break;case"m":r=a+=e[1],s=h+=e[2],t.moveTo(a+p,h+u);break;case"M":r=a=e[1],s=h=e[2],t.moveTo(a+p,h+u);break;case"c":i=a+e[5],o=h+e[6],l=a+e[3],c=h+e[4],t.bezierCurveTo(a+e[1]+p,h+e[2]+u,l+p,c+u,i+p,o+u),a=i,h=o;break;case"C":a=e[5],h=e[6],l=e[3],c=e[4],t.bezierCurveTo(e[1]+p,e[2]+u,l+p,c+u,a+p,h+u);break;case"s":i=a+e[3],o=h+e[4],c=null===n[0].match(/[CcSs]/)?(l=a,h):(l=2*a-l,2*h-c),t.bezierCurveTo(l+p,c+u,a+e[1]+p,h+e[2]+u,i+p,o+u),l=a+e[1],c=h+e[2],a=i,h=o;break;case"S":i=e[3],o=e[4],c=null===n[0].match(/[CcSs]/)?(l=a,h):(l=2*a-l,2*h-c),t.bezierCurveTo(l+p,c+u,e[1]+p,e[2]+u,i+p,o+u),a=i,h=o,l=e[1],c=e[2];break;case"q":i=a+e[3],o=h+e[4],l=a+e[1],c=h+e[2],t.quadraticCurveTo(l+p,c+u,i+p,o+u),a=i,h=o;break;case"Q":i=e[3],o=e[4],t.quadraticCurveTo(e[1]+p,e[2]+u,i+p,o+u),a=i,h=o,l=e[1],c=e[2];break;case"t":i=a+e[1],o=h+e[2],c=null===n[0].match(/[QqTt]/)?(l=a,h):(l=2*a-l,2*h-c),t.quadraticCurveTo(l+p,c+u,i+p,o+u),a=i,h=o;break;case"T":i=e[1],o=e[2],c=null===n[0].match(/[QqTt]/)?(l=a,h):(l=2*a-l,2*h-c),t.quadraticCurveTo(l+p,c+u,i+p,o+u),a=i,h=o;break;case"a":g(t,a+p,h+u,[e[1],e[2],e[3],e[4],e[5],e[6]+a+p,e[7]+h+u]),a+=e[6],h+=e[7];break;case"A":g(t,a+p,h+u,[e[1],e[2],e[3],e[4],e[5],e[6]+p,e[7]+u]),a=e[6],h=e[7];break;case"z":case"Z":a=r,h=s,t.closePath()}n=e}},_render:function(t){this._renderPathCommands(t),this._renderFill(t),this._renderStroke(t)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){return o(this.callSuper("toObject",["sourcePath","pathOffset"].concat(t)),{path:this.path.map(function(t){return t.slice()})})},toDatalessObject:function(t){t=this.toObject(t);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),o="",n=0,r=this.path.length;n<r;n++)e.push(this.path[n].join(" "));var s=e.join(" ");return this.group&&"path-group"===this.group.type||(o=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),i.push("<path ",this.getSvgId(),'d="',s,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),o,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),t?t(i.join("")):i.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var t,e,i,o,n=[],r=[],s=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,a=0,h=this.path.length;a<h;a++){for(o=(t=this.path[a]).slice(1).trim(),r.length=0;i=s.exec(o);)r.push(i[0]);for(var l=[t.charAt(0)],c=0,p=r.length;c<p;c++)e=parseFloat(r[c]),isNaN(e)||l.push(e);var u=l[0],d=_[u.toLowerCase()],f=C[u]||u;if(d<l.length-1)for(var g=1,v=l.length;g<v;g+=d)n.push([u].concat(l.slice(g,g+d))),u=f;else n.push(l)}return n},_parseDimensions:function(){for(var t,e,i,o,n=[],r=[],s=null,a=0,h=0,l=0,c=0,p=0,u=0,d=0,f=this.path.length;d<f;++d){switch((t=this.path[d])[0]){case"l":l+=t[1],c+=t[2],o=[];break;case"L":l=t[1],c=t[2],o=[];break;case"h":l+=t[1],o=[];break;case"H":l=t[1],o=[];break;case"v":c+=t[1],o=[];break;case"V":c=t[1],o=[];break;case"m":a=l+=t[1],h=c+=t[2],o=[];break;case"M":a=l=t[1],h=c=t[2],o=[];break;case"c":e=l+t[5],i=c+t[6],p=l+t[3],u=c+t[4],o=b.util.getBoundsOfCurve(l,c,l+t[1],c+t[2],p,u,e,i),l=e,c=i;break;case"C":l=t[5],c=t[6],p=t[3],u=t[4],o=b.util.getBoundsOfCurve(l,c,t[1],t[2],p,u,l,c);break;case"s":e=l+t[3],i=c+t[4],u=null===s[0].match(/[CcSs]/)?(p=l,c):(p=2*l-p,2*c-u),o=b.util.getBoundsOfCurve(l,c,p,u,l+t[1],c+t[2],e,i),p=l+t[1],u=c+t[2],l=e,c=i;break;case"S":e=t[3],i=t[4],u=null===s[0].match(/[CcSs]/)?(p=l,c):(p=2*l-p,2*c-u),o=b.util.getBoundsOfCurve(l,c,p,u,t[1],t[2],e,i),l=e,c=i,p=t[1],u=t[2];break;case"q":e=l+t[3],i=c+t[4],p=l+t[1],u=c+t[2],o=b.util.getBoundsOfCurve(l,c,p,u,p,u,e,i),l=e,c=i;break;case"Q":p=t[1],u=t[2],o=b.util.getBoundsOfCurve(l,c,p,u,p,u,t[3],t[4]),l=t[3],c=t[4];break;case"t":e=l+t[1],i=c+t[2],u=null===s[0].match(/[QqTt]/)?(p=l,c):(p=2*l-p,2*c-u),o=b.util.getBoundsOfCurve(l,c,p,u,p,u,e,i),l=e,c=i;break;case"T":e=t[1],i=t[2],u=null===s[0].match(/[QqTt]/)?(p=l,c):(p=2*l-p,2*c-u),o=b.util.getBoundsOfCurve(l,c,p,u,p,u,e,i),l=e,c=i;break;case"a":o=b.util.getBoundsOfArc(l,c,t[1],t[2],t[3],t[4],t[5],t[6]+l,t[7]+c),l+=t[6],c+=t[7];break;case"A":o=b.util.getBoundsOfArc(l,c,t[1],t[2],t[3],t[4],t[5],t[6],t[7]),l=t[6],c=t[7];break;case"z":case"Z":l=a,c=h}s=t,o.forEach(function(t){n.push(t.x),r.push(t.y)}),n.push(l),r.push(c)}var g=m(n)||0,v=m(r)||0;return{left:g,top:v,width:(y(n)||0)-g,height:(y(r)||0)-v}}}),b.Path.fromObject=function(i,o){var n;if("string"!=typeof i.path)return n=new b.Path(i.path,i),o&&o(n),n;b.loadSVGFromURL(i.path,function(t){var e=i.path;n=t[0],delete i.path,b.util.object.extend(n,i),n.setSourcePath(e),o&&o(n)})},b.Path.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["d"]),b.Path.fromElement=function(t,e,i){t=b.parseAttributes(t,b.Path.ATTRIBUTE_NAMES);e&&e(new b.Path(t.d,o(t,i)))},b.Path.async=!0)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var p=t.fabric||(t.fabric={}),e=p.util.object.extend,i=p.util.array.invoke,o=p.Object.prototype.toObject;p.PathGroup?p.warn("fabric.PathGroup is already defined"):(p.PathGroup=p.util.createClass(p.Object,{type:"path-group",fill:"",initialize:function(t,e){e=e||{},this.paths=t||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;e.toBeParsed&&(this.parseDimensionsFromPaths(e),delete e.toBeParsed),this.setOptions(e),this.setCoords(),e.sourcePath&&this.setSourcePath(e.sourcePath),this.objectCaching&&(this._createCacheCanvas(),this.setupState({propertySet:"cacheProperties"}))},parseDimensionsFromPaths:function(t){for(var e,i=[],o=[],n=this.paths.length;n--;)for(var r,s=(r=this.paths[n]).height+r.strokeWidth,a=r.width+r.strokeWidth,h=[{x:r.left,y:r.top},{x:r.left+a,y:r.top},{x:r.left,y:r.top+s},{x:r.left+a,y:r.top+s}],l=this.paths[n].transformMatrix,c=0;c<h.length;c++)e=h[c],l&&(e=p.util.transformPoint(e,l,!1)),i.push(e.x),o.push(e.y);t.width=Math.max.apply(null,i),t.height=Math.max.apply(null,o)},drawObject:function(t){t.save(),t.translate(-this.width/2,-this.height/2);for(var e=0,i=this.paths.length;e<i;++e)this.paths[e].render(t,!0);t.restore()},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(this.statefullCache)for(var t,e=0,i=this.paths.length;e<i;e++)if(this.paths[e].isCacheDirty(!0))return t=this._getNonTransformedDimensions(),this._cacheContext.clearRect(-t.x/2,-t.y/2,t.x,t.y),!0;return!1},_set:function(t,e){if("fill"===t&&e&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(t,e);return this.callSuper("_set",t,e)},toObject:function(t){return e(o.call(this,["sourcePath"].concat(t)),{paths:i(this.getObjects(),"toObject",t)})},toDatalessObject:function(t){t=this.toObject(t);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(t){var e=this.getObjects(),i=this.getPointByOrigin("left","top"),i="translate("+i.x+" "+i.y+")",o=this._createBaseSVGMarkup();o.push("<g ",this.getSvgId(),'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),i,this.getSvgTransform(),'" ',">\n");for(var n=0,r=e.length;n<r;n++)o.push("\t",e[n].toSVG(t));return o.push("</g>\n"),t?t(o.join("")):o.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var e=this.getObjects()[0].get("fill")||"";return"string"==typeof e&&(e=e.toLowerCase(),this.getObjects().every(function(t){t=t.get("fill")||"";return"string"==typeof t&&t.toLowerCase()===e}))},complexity:function(){return this.paths.reduce(function(t,e){return t+(e&&e.complexity?e.complexity():0)},0)},getObjects:function(){return this.paths}}),p.PathGroup.fromObject=function(i,o){"string"==typeof i.paths?p.loadSVGFromURL(i.paths,function(t){var e=i.paths,t=(delete i.paths,p.util.groupSVGElements(t,i,e));o(t)}):p.util.enlivenObjects(i.paths,function(t){delete i.paths,o(new p.PathGroup(t,i))})},p.PathGroup.async=!0)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var o,n=t.fabric||(t.fabric={}),e=n.util.object.extend,r=n.util.array.min,s=n.util.array.max,i=n.util.array.invoke;n.Group||(n.Group=n.util.createClass(n.Object,n.Collection,{type:"group",strokeWidth:0,subTargetCheck:!(o={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0}),initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;this.originalState={},e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),i?this._updateObjectsCoords(!0):(this._calcBounds(),this._updateObjectsCoords(),this.callSuper("initialize",e)),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(t){for(var e=this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],e,t)},_updateObjectCoords:function(t,e,i){var o;t.__origHasControls=t.hasControls,t.hasControls=!1,i||(i=t.getLeft(),o=t.getTop(),t.set({originalLeft:i,originalTop:o,left:i-e.x,top:o-e.y}),t.setCoords(!0))},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),n.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,this},_setObjectActive:function(t){t.set("active",!0),t.group=this},removeWithUpdate:function(t){return this._restoreObjectsState(),n.util.resetObjectTransform(this),this.forEachObject(this._setObjectActive,this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group,t.set("active",!1)},delegatedProperties:{fill:!0,stroke:!0,strokeWidth:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(t,e){var i=this._objects.length;if(this.delegatedProperties[t]||"canvas"===t)for(;i--;)this._objects[i].set(t,e);else for(;i--;)this._objects[i].setOnGroup(t,e);this.callSuper("_set",t,e)},toObject:function(t){return e(this.callSuper("toObject",t),{objects:i(this._objects,"toObject",t)})},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},drawObject:function(t){for(var e=0,i=this._objects.length;e<i;e++)this._renderObject(this._objects[e],t)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(this.statefullCache)for(var t,e=0,i=this._objects.length;e<i;e++)if(this._objects[e].isCacheDirty(!0))return t=this._getNonTransformedDimensions(),this._cacheContext.clearRect(-t.x/2,-t.y/2,t.x,t.y),!0;return!1},_renderControls:function(t,e){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e);for(var i=0,o=this._objects.length;i<o;i++)this._objects[i]._renderControls(t);t.restore()},_renderObject:function(t,e){var i;t.visible&&(i=t.hasRotatingPoint,t.hasRotatingPoint=!1,t.render(e),t.hasRotatingPoint=i)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var e=t.calcTransformMatrix(),e=n.util.qrDecompose(e),i=new n.Point(e.translateX,e.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",e.scaleX),t.set("scaleY",e.scaleY),t.skewX=e.skewX,t.skewY=e.skewY,t.angle=e.angle,t.setPositionByOrigin(i,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),t.hasControls=t.__origHasControls,delete t.__origHasControls,t.set("active",!1),delete t.group,this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(t){t.setCoords(!0)}),this},_calcBounds:function(t){for(var e,i,o,n=[],r=[],s=["tr","br","bl","tl"],a=0,h=this._objects.length,l=s.length;a<h;++a)for((e=this._objects[a]).setCoords(!0),o=0;o<l;o++)n.push(e.oCoords[i=s[o]].x),r.push(e.oCoords[i].y);this.set(this._getBounds(n,r,t))},_getBounds:function(t,e,i){var o=new n.Point(r(t),r(e)),t=new n.Point(s(t),s(e)),e={width:t.x-o.x||0,height:t.y-o.y||0};return i||(e.left=o.x||0,e.top=o.y||0,"center"===this.originX&&(e.left+=e.width/2),"right"===this.originX&&(e.left+=e.width),"center"===this.originY&&(e.top+=e.height/2),"bottom"===this.originY&&(e.top+=e.height)),e},toSVG:function(t){var e=this._createBaseSVGMarkup();e.push("<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'" style="',this.getSvgFilter(),'">\n');for(var i=0,o=this._objects.length;i<o;i++)e.push("\t",this._objects[i].toSVG(t));return e.push("</g>\n"),t?t(e.join("")):e.join("")},get:function(t){if(t in o){if(this[t])return this[t];for(var e=0,i=this._objects.length;e<i;e++)if(this._objects[e][t])return!0;return!1}return t in this.delegatedProperties?this._objects[0]&&this._objects[0].get(t):this[t]}}),n.Group.fromObject=function(e,i){n.util.enlivenObjects(e.objects,function(t){delete e.objects,i&&i(new n.Group(t,e,!0))})},n.Group.async=!0)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var r=fabric.util.object.extend;t.fabric||(t.fabric={}),t.fabric.Image?fabric.warn("fabric.Image is already defined."):((t=fabric.Object.prototype.stateProperties.concat()).push("alignX","alignY","meetOrSlice"),fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",strokeWidth:0,_lastScaleX:1,_lastScaleY:1,minimumScaleTrigger:.5,stateProperties:t,objectCaching:!1,initialize:function(t,e,i){e=e||{},this.filters=[],this.resizeFilters=[],this.callSuper("initialize",e),this._initElement(t,e,i)},getElement:function(){return this._element},setElement:function(t,e,i){var o;return this._element=t,this._originalElement=t,this._initConfig(i),t=0===this.resizeFilters.length?e:(o=this,function(){o.applyFilters(e,o.resizeFilters,o._filteredEl||o._originalElement,!0)}),0!==this.filters.length?this.applyFilters(t):t&&t(this),this},setCrossOrigin:function(t){return this.crossOrigin=t,this._element.crossOrigin=t,this},getOriginalSize:function(){var t=this.getElement();return{width:t.width,height:t.height}},_stroke:function(t){var e,i;this.stroke&&0!==this.strokeWidth&&(e=this.width/2,i=this.height/2,t.beginPath(),t.moveTo(-e,-i),t.lineTo(e,-i),t.lineTo(e,i),t.lineTo(-e,i),t.lineTo(-e,-i),t.closePath())},_renderDashedStroke:function(t){var e=-this.width/2,i=-this.height/2,o=this.width,n=this.height;t.save(),this._setStrokeStyles(t),t.beginPath(),fabric.util.drawDashedLine(t,e,i,e+o,i,this.strokeDashArray),fabric.util.drawDashedLine(t,e+o,i,e+o,i+n,this.strokeDashArray),fabric.util.drawDashedLine(t,e+o,i+n,e,i+n,this.strokeDashArray),fabric.util.drawDashedLine(t,e,i+n,e,i,this.strokeDashArray),t.closePath(),t.restore()},toObject:function(t){var e=[],i=[],o=1,n=1,t=(this.filters.forEach(function(t){t&&("Resize"===t.type&&(o*=t.scaleX,n*=t.scaleY),e.push(t.toObject()))}),this.resizeFilters.forEach(function(t){t&&i.push(t.toObject())}),r(this.callSuper("toObject",["crossOrigin","alignX","alignY","meetOrSlice"].concat(t)),{src:this.getSrc(),filters:e,resizeFilters:i}));return t.width/=o,t.height/=n,t},toSVG:function(t){var e=this._createBaseSVGMarkup(),i=-this.width/2,o=-this.height/2,n="none";return this.group&&"path-group"===this.group.type&&(i=this.left,o=this.top),"none"!==this.alignX&&"none"!==this.alignY&&(n="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),e.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',"<image ",this.getSvgId(),'xlink:href="',this.getSvgSrc(!0),'" x="',i,'" y="',o,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',n,'"',"></image>\n"),(this.stroke||this.strokeDashArray)&&(n=this.fill,this.fill=null,e.push("<rect ",'x="',i,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=n),e.push("</g>\n"),t?t(e.join("")):e.join("")},getSrc:function(t){t=t?this._element:this._originalElement;return t?fabric.isLikelyNode?t._src:t.src:this.src||""},setSrc:function(t,e,i){fabric.util.loadImage(t,function(t){return this.setElement(t,e,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyFilters:function(t,e,i,o){var n,r,s,a,h,l,c;if(e=e||this.filters,i=i||this._originalElement)return n=fabric.util.createImage(),r=this.canvas?this.canvas.getRetinaScaling():fabric.devicePixelRatio,s=this.minimumScaleTrigger/r,a=this,0===e.length?(this._element=i,t&&t(this),i):((c=fabric.util.createCanvasElement()).width=i.width,c.height=i.height,c.getContext("2d").drawImage(i,0,0,i.width,i.height),e.forEach(function(t){t&&(o?(h=a.scaleX<s?a.scaleX:1,l=a.scaleY<s?a.scaleY:1,h*r<1&&(h*=r),l*r<1&&(l*=r)):(h=t.scaleX,l=t.scaleY),t.applyTo(c,h,l),o||"Resize"!==t.type||(a.width*=t.scaleX,a.height*=t.scaleY))}),n.width=c.width,n.height=c.height,fabric.isLikelyNode?(n.src=c.toBuffer(void 0,fabric.Image.pngCompression),a._element=n,o||(a._filteredEl=n),t&&t(a)):(n.onload=function(){a._element=n,o||(a._filteredEl=n),t&&t(a),n.onload=c=null},n.src=c.toDataURL("image/png")),c)},_render:function(t,e){var i,o=this._findMargins(),n=e?this.left:-this.width/2,e=e?this.top:-this.height/2;"slice"===this.meetOrSlice&&(t.beginPath(),t.rect(n,e,this.width,this.height),t.clip()),(i=!1===this.isMoving&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):this._element)&&t.drawImage(i,n+o.marginX,e+o.marginY,o.width,o.height),this._stroke(t),this._renderStroke(t)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var t,e=this.width,i=this.height,o=0,n=0;return"none"===this.alignX&&"none"===this.alignY||(t=[this.width/this._element.width,this.height/this._element.height],t=("meet"===this.meetOrSlice?Math.min:Math.max).apply(null,t),e=this._element.width*t,i=this._element.height*t,"Mid"===this.alignX&&(o=(this.width-e)/2),"Max"===this.alignX&&(o=this.width-e),"Mid"===this.alignY&&(n=(this.height-i)/2),"Max"===this.alignY&&(n=this.height-i)),{width:e,height:i,marginX:o,marginY:n}},_resetWidthHeight:function(){var t=this.getElement();this.set("width",t.width),this.set("height",t.height)},_initElement:function(t,e,i){this.setElement(fabric.util.getById(t),i,e),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(t){this.setOptions(t=t||{}),this._setWidthHeight(t),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(t,e){t&&t.length?fabric.util.enlivenObjects(t,function(t){e&&e(t)},"fabric.Image.filters"):e&&e()},_setWidthHeight:function(t){this.width="width"in t?t.width:this.getElement()&&this.getElement().width||0,this.height="height"in t?t.height:this.getElement()&&this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(i,o){fabric.util.loadImage(i.src,function(e){fabric.Image.prototype._initFilters.call(i,i.filters,function(t){i.filters=t||[],fabric.Image.prototype._initFilters.call(i,i.resizeFilters,function(t){return i.resizeFilters=t||[],new fabric.Image(e,i,o)})})},null,i.crossOrigin)},fabric.Image.fromURL=function(t,e,i){fabric.util.loadImage(t,function(t){e&&e(new fabric.Image(t,i))},null,i&&i.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" ")),fabric.Image.fromElement=function(t,e,i){var o,t=fabric.parseAttributes(t,fabric.Image.ATTRIBUTE_NAMES);t.preserveAspectRatio&&(o=fabric.util.parsePreserveAspectRatioAttribute(t.preserveAspectRatio),r(t,o)),fabric.Image.fromURL(t["xlink:href"],e,r(i?fabric.util.object.clone(i):{},t))},fabric.Image.async=!0,fabric.Image.pngCompression=1)}("undefined"!=typeof exports?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var t=this.getAngle()%360;return 0<t?90*Math.round((t-1)/90):90*Math.round(t/90)},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(t){function e(){}var i=(t=t||{}).onComplete||e,o=t.onChange||e,n=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(t){n.setAngle(t),o()},onComplete:function(){n.setCoords(),i()},onStart:function(){n.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(t){return t.straighten(),this.renderAll(),this},fxStraightenObject:function(t){return t.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(t){t&&this.setOptions(t)},setOptions:function(t){for(var e in t)this[e]=t[e]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.Brightness=o(t.BaseFilter,{type:"Brightness",initialize:function(t){this.brightness=(t=t||{}).brightness||0},applyTo:function(t){for(var e=t.getContext("2d"),t=e.getImageData(0,0,t.width,t.height),i=t.data,o=this.brightness,n=0,r=i.length;n<r;n+=4)i[n]+=o,i[n+1]+=o,i[n+2]+=o;e.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}}),e.Image.filters.Brightness.fromObject=function(t){return new e.Image.filters.Brightness(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.Convolute=o(t.BaseFilter,{type:"Convolute",initialize:function(t){this.opaque=(t=t||{}).opaque,this.matrix=t.matrix||[0,0,0,0,1,0,0,0,0]},applyTo:function(t){for(var e,i,o,n=this.matrix,r=t.getContext("2d"),t=r.getImageData(0,0,t.width,t.height),s=Math.round(Math.sqrt(n.length)),a=Math.floor(s/2),h=t.data,l=t.width,c=t.height,t=r.createImageData(l,c),p=t.data,u=this.opaque?1:0,d=0;d<c;d++)for(var f=0;f<l;f++){for(var g=4*(d*l+f),v=0,b=0,m=0,y=0,_=0;_<s;_++)for(var C=0;C<s;C++)e=f+C-a,(i=d+_-a)<0||c<i||e<0||l<e||(o=n[_*s+C],v+=h[i=4*(i*l+e)]*o,b+=h[1+i]*o,m+=h[2+i]*o,y+=h[3+i]*o);p[g]=v,p[1+g]=b,p[2+g]=m,p[3+g]=y+u*(255-y)}r.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),e.Image.filters.Convolute.fromObject=function(t){return new e.Image.filters.Convolute(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.GradientTransparency=o(t.BaseFilter,{type:"GradientTransparency",initialize:function(t){this.threshold=(t=t||{}).threshold||100},applyTo:function(t){for(var e=t.getContext("2d"),t=e.getImageData(0,0,t.width,t.height),i=t.data,o=this.threshold,n=i.length,r=0,s=i.length;r<s;r+=4)i[r+3]=o+255*(n-r)/n;e.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}}),e.Image.filters.GradientTransparency.fromObject=function(t){return new e.Image.filters.GradientTransparency(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),t=e.Image.filters,i=e.util.createClass;t.Grayscale=i(t.BaseFilter,{type:"Grayscale",applyTo:function(t){for(var e,i=t.getContext("2d"),t=i.getImageData(0,0,t.width,t.height),o=t.data,n=t.width*t.height*4,r=0;r<n;)e=(o[r]+o[r+1]+o[r+2])/3,o[r]=e,o[r+1]=e,o[r+2]=e,r+=4;i.putImageData(t,0,0)}}),e.Image.filters.Grayscale.fromObject=function(){return new e.Image.filters.Grayscale}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),t=e.Image.filters,i=e.util.createClass;t.Invert=i(t.BaseFilter,{type:"Invert",applyTo:function(t){for(var e=t.getContext("2d"),t=e.getImageData(0,0,t.width,t.height),i=t.data,o=i.length,n=0;n<o;n+=4)i[n]=255-i[n],i[n+1]=255-i[n+1],i[n+2]=255-i[n+2];e.putImageData(t,0,0)}}),e.Image.filters.Invert.fromObject=function(){return new e.Image.filters.Invert}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var c=t.fabric||(t.fabric={}),e=c.util.object.extend,t=c.Image.filters,i=c.util.createClass;t.Mask=i(t.BaseFilter,{type:"Mask",initialize:function(t){this.mask=(t=t||{}).mask,this.channel=-1<[0,1,2,3].indexOf(t.channel)?t.channel:0},applyTo:function(t){if(this.mask){var e=t.getContext("2d"),i=e.getImageData(0,0,t.width,t.height),o=i.data,n=this.mask.getElement(),r=c.util.createCanvasElement(),s=this.channel,a=i.width*i.height*4;r.width=t.width,r.height=t.height,r.getContext("2d").drawImage(n,0,0,t.width,t.height);for(var h=r.getContext("2d").getImageData(0,0,t.width,t.height).data,l=0;l<a;l+=4)o[l+3]=h[l+s];e.putImageData(i,0,0)}},toObject:function(){return e(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),c.Image.filters.Mask.fromObject=function(e,i){c.util.loadImage(e.mask.src,function(t){e.mask=new c.Image(t,e.mask),i&&i(new c.Image.filters.Mask(e))})},c.Image.filters.Mask.async=!0}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.Noise=o(t.BaseFilter,{type:"Noise",initialize:function(t){this.noise=(t=t||{}).noise||0},applyTo:function(t){for(var e,i=t.getContext("2d"),t=i.getImageData(0,0,t.width,t.height),o=t.data,n=this.noise,r=0,s=o.length;r<s;r+=4)e=(.5-Math.random())*n,o[r]+=e,o[r+1]+=e,o[r+2]+=e;i.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}}),e.Image.filters.Noise.fromObject=function(t){return new e.Image.filters.Noise(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.Pixelate=o(t.BaseFilter,{type:"Pixelate",initialize:function(t){this.blocksize=(t=t||{}).blocksize||4},applyTo:function(t){for(var e,i=t.getContext("2d"),t=i.getImageData(0,0,t.width,t.height),o=t.data,n=t.height,r=t.width,s=0;s<n;s+=this.blocksize)for(e=0;e<r;e+=this.blocksize)for(var a,h=o[a=4*s*r+4*e],l=o[1+a],c=o[2+a],p=o[3+a],u=s,d=s+this.blocksize;u<d;u++)for(var f=e,g=e+this.blocksize;f<g;f++)o[a=4*u*r+4*f]=h,o[1+a]=l,o[2+a]=c,o[3+a]=p;i.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}}),e.Image.filters.Pixelate.fromObject=function(t){return new e.Image.filters.Pixelate(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.RemoveWhite=o(t.BaseFilter,{type:"RemoveWhite",initialize:function(t){this.threshold=(t=t||{}).threshold||30,this.distance=t.distance||20},applyTo:function(t){for(var e,i,o,n=t.getContext("2d"),t=n.getImageData(0,0,t.width,t.height),r=t.data,s=this.threshold,a=this.distance,h=255-s,l=Math.abs,c=0,p=r.length;c<p;c+=4)e=r[c],i=r[c+1],o=r[c+2],h<e&&h<i&&h<o&&l(e-i)<a&&l(e-o)<a&&l(i-o)<a&&(r[c+3]=0);n.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),e.Image.filters.RemoveWhite.fromObject=function(t){return new e.Image.filters.RemoveWhite(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),t=e.Image.filters,i=e.util.createClass;t.Sepia=i(t.BaseFilter,{type:"Sepia",applyTo:function(t){for(var e,i=t.getContext("2d"),t=i.getImageData(0,0,t.width,t.height),o=t.data,n=o.length,r=0;r<n;r+=4)e=.3*o[r]+.59*o[r+1]+.11*o[r+2],o[r]=100+e,o[r+1]=50+e,o[r+2]=255+e;i.putImageData(t,0,0)}}),e.Image.filters.Sepia.fromObject=function(){return new e.Image.filters.Sepia}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),t=e.Image.filters,i=e.util.createClass;t.Sepia2=i(t.BaseFilter,{type:"Sepia2",applyTo:function(t){for(var e,i,o,n=t.getContext("2d"),t=n.getImageData(0,0,t.width,t.height),r=t.data,s=r.length,a=0;a<s;a+=4)e=r[a],i=r[a+1],o=r[a+2],r[a]=(.393*e+.769*i+.189*o)/1.351,r[a+1]=(.349*e+.686*i+.168*o)/1.203,r[a+2]=(.272*e+.534*i+.131*o)/2.14;n.putImageData(t,0,0)}}),e.Image.filters.Sepia2.fromObject=function(){return new e.Image.filters.Sepia2}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var d=t.fabric||(t.fabric={}),e=d.util.object.extend,t=d.Image.filters,i=d.util.createClass;t.Tint=i(t.BaseFilter,{type:"Tint",initialize:function(t){this.color=(t=t||{}).color||"#000000",this.opacity=void 0!==t.opacity?t.opacity:new d.Color(this.color).getAlpha()},applyTo:function(t){for(var e,i,o,n=t.getContext("2d"),t=n.getImageData(0,0,t.width,t.height),r=t.data,s=r.length,a=new d.Color(this.color).getSource(),h=a[0]*this.opacity,l=a[1]*this.opacity,c=a[2]*this.opacity,p=1-this.opacity,u=0;u<s;u+=4)e=r[u],i=r[u+1],o=r[u+2],r[u]=h+e*p,r[u+1]=l+i*p,r[u+2]=c+o*p;n.putImageData(t,0,0)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),d.Image.filters.Tint.fromObject=function(t){return new d.Image.filters.Tint(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var s=t.fabric||(t.fabric={}),e=s.util.object.extend,t=s.Image.filters,i=s.util.createClass;t.Multiply=i(t.BaseFilter,{type:"Multiply",initialize:function(t){this.color=(t=t||{}).color||"#000000"},applyTo:function(t){for(var e=t.getContext("2d"),t=e.getImageData(0,0,t.width,t.height),i=t.data,o=i.length,n=new s.Color(this.color).getSource(),r=0;r<o;r+=4)i[r]*=n[0]/255,i[r+1]*=n[1]/255,i[r+2]*=n[2]/255;e.putImageData(t,0,0)},toObject:function(){return e(this.callSuper("toObject"),{color:this.color})}}),s.Image.filters.Multiply.fromObject=function(t){return new s.Image.filters.Multiply(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var b=t.fabric,t=b.Image.filters,e=b.util.createClass;t.Blend=e(t.BaseFilter,{type:"Blend",initialize:function(t){this.color=(t=t||{}).color||"#000",this.image=t.image||!1,this.mode=t.mode||"multiply",this.alpha=t.alpha||1},applyTo:function(t){var e,i,o,n,r,s,a,h,l,c,p,u=t.getContext("2d"),t=u.getImageData(0,0,t.width,t.height),d=t.data,f=!1;this.image?(f=!0,(c=b.util.createCanvasElement()).width=this.image.width,c.height=this.image.height,(c=new b.StaticCanvas(c)).add(this.image),p=c.getContext("2d").getImageData(0,0,c.width,c.height).data):(e=(p=new b.Color(this.color).getSource())[0]*this.alpha,i=p[1]*this.alpha,o=p[2]*this.alpha);for(var g=0,v=d.length;g<v;g+=4)switch(n=d[g],r=d[g+1],s=d[g+2],f&&(e=p[g]*this.alpha,i=p[g+1]*this.alpha,o=p[g+2]*this.alpha),this.mode){case"multiply":d[g]=n*e/255,d[g+1]=r*i/255,d[g+2]=s*o/255;break;case"screen":d[g]=1-(1-n)*(1-e),d[g+1]=1-(1-r)*(1-i),d[g+2]=1-(1-s)*(1-o);break;case"add":d[g]=Math.min(255,n+e),d[g+1]=Math.min(255,r+i),d[g+2]=Math.min(255,s+o);break;case"diff":case"difference":d[g]=Math.abs(n-e),d[g+1]=Math.abs(r-i),d[g+2]=Math.abs(s-o);break;case"subtract":h=r-i,l=s-o,d[g]=(a=n-e)<0?0:a,d[g+1]=h<0?0:h,d[g+2]=l<0?0:l;break;case"darken":d[g]=Math.min(n,e),d[g+1]=Math.min(r,i),d[g+2]=Math.min(s,o);break;case"lighten":d[g]=Math.max(n,e),d[g+1]=Math.max(r,i),d[g+2]=Math.max(s,o)}u.putImageData(t,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}}),b.Image.filters.Blend.fromObject=function(t){return new b.Image.filters.Blend(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var b=t.fabric||(t.fabric={}),A=Math.pow,P=Math.floor,k=Math.sqrt,M=Math.abs,m=Math.max,s=Math.round,o=Math.sin,B=Math.ceil,t=b.Image.filters,e=b.util.createClass;t.Resize=e(t.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(t,e,i){var o,n,r;1===e&&1===i||(this.rcpScaleX=1/e,this.rcpScaleY=1/i,o=t.width,n=t.height,e=s(o*e),i=s(n*i),"sliceHack"===this.resizeType&&(r=this.sliceByTwo(t,o,n,e,i)),"hermite"===this.resizeType&&(r=this.hermiteFastResize(t,o,n,e,i)),"bilinear"===this.resizeType&&(r=this.bilinearFiltering(t,o,n,e,i)),"lanczos"===this.resizeType&&(r=this.lanczosResize(t,o,n,e,i)),t.width=e,t.height=i,t.getContext("2d").putImageData(r,0,0))},sliceByTwo:function(t,e,i,o,n){var r,s=t.getContext("2d"),a=.5,h=.5,l=1,c=1,p=!1,u=!1,d=e,f=i,g=b.util.createCanvasElement(),v=g.getContext("2d");for(o=P(o),n=P(n),g.width=m(o,e),g.height=m(n,i),e<o&&(a=2,l=-1),i<n&&(h=2,c=-1),r=s.getImageData(0,0,e,i),t.width=m(o,e),t.height=m(n,i),s.putImageData(r,0,0);!p||!u;)i=f,o*l<P((e=d)*a*l)?d=P(d*a):(d=o,p=!0),n*c<P(f*h*c)?f=P(f*h):(f=n,u=!0),r=s.getImageData(0,0,e,i),v.putImageData(r,0,0),s.clearRect(0,0,d,f),s.drawImage(g,0,0,e,i,0,0,d,f);return s.getImageData(0,0,o,n)},lanczosResize:function(t,d,f,g,v){var i,t=t.getContext("2d"),e=t.getImageData(0,0,d,f),b=t.getImageData(0,0,g,v),m=e.data,y=b.data,_=(i=this.lanczosLobes,function(t){var e;return i<t?0:(t*=Math.PI,M(t)<1e-16?1:(e=t/i,o(t)*o(e)/t/e))}),C=this.rcpScaleX,w=this.rcpScaleY,T=2/this.rcpScaleX,O=2/this.rcpScaleY,S=B(C*this.lanczosLobes/2),E=B(w*this.lanczosLobes/2),x={},I={},D={};return function t(e){var i,o,n,r,s,a,h,l,c,p;for(I.x=(e+.5)*C,D.x=P(I.x),i=0;i<v;i++){for(I.y=(i+.5)*w,D.y=P(I.y),l=h=a=s=r=0,o=D.x-S;o<=D.x+S;o++)if(!(o<0||d<=o)){c=P(1e3*M(o-I.x)),x[c]||(x[c]={});for(var u=D.y-E;u<=D.y+E;u++)u<0||f<=u||(p=P(1e3*M(u-I.y)),x[c][p]||(x[c][p]=_(k(A(c*T,2)+A(p*O,2))/1e3)),0<(p=x[c][p])&&(r+=p,s+=p*m[n=4*(u*d+o)],a+=p*m[n+1],h+=p*m[n+2],l+=p*m[n+3]))}y[n=4*(i*g+e)]=s/r,y[n+1]=a/r,y[n+2]=h/r,y[n+3]=l/r}return++e<g?t(e):b}(0)},bilinearFiltering:function(t,e,i,o,n){for(var r,s,a,h,l,c,p,u,d,f,g,v=0,b=this.rcpScaleX,m=this.rcpScaleY,t=t.getContext("2d"),y=4*(e-1),_=t.getImageData(0,0,e,i).data,i=t.getImageData(0,0,o,n),C=i.data,w=0;w<n;w++)for(p=0;p<o;p++)for(u=b*p-(l=P(b*p)),d=m*w-(c=P(m*w)),g=4*(c*e+l),f=0;f<4;f++)r=_[g+f],s=_[4+g+f],a=_[g+y+f],h=_[g+y+4+f],C[v++]=r*(1-u)*(1-d)+s*u*(1-d)+a*d*(1-u)+h*u*d;return i},hermiteFastResize:function(t,e,i,o,n){for(var r=this.rcpScaleX,s=this.rcpScaleY,a=B(r/2),h=B(s/2),t=t.getContext("2d"),l=t.getImageData(0,0,e,i).data,i=t.getImageData(0,0,o,n),c=i.data,p=0;p<n;p++)for(var u=0;u<o;u++){for(var d=4*(u+p*o),f=0,g=0,v=0,b=0,m=0,y=0,_=0,C=(p+.5)*s,w=P(p*s);w<(p+1)*s;w++)for(var T=M(C-(w+.5))/h,O=(u+.5)*r,S=T*T,E=P(u*r);E<(u+1)*r;E++){var x=M(O-(E+.5))/a,I=k(S+x*x);1<I&&I<-1||0<(f=2*I*I*I-3*I*I+1)&&(_+=f*l[3+(x=4*(E+w*e))],v+=f,b+=(f=l[3+x]<255?f*l[3+x]/250:f)*l[x],m+=f*l[1+x],y+=f*l[2+x],g+=f)}c[d]=b/g,c[1+d]=m/g,c[2+d]=y/g,c[3+d]=_/v}return i},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),b.Image.filters.Resize.fromObject=function(t){return new b.Image.filters.Resize(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.ColorMatrix=o(t.BaseFilter,{type:"ColorMatrix",initialize:function(t){this.matrix=(t=t||{}).matrix||[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},applyTo:function(t){for(var e,i,o,n,r=t.getContext("2d"),t=r.getImageData(0,0,t.width,t.height),s=t.data,a=s.length,h=this.matrix,l=0;l<a;l+=4)e=s[l],i=s[l+1],o=s[l+2],n=s[l+3],s[l]=e*h[0]+i*h[1]+o*h[2]+n*h[3]+h[4],s[l+1]=e*h[5]+i*h[6]+o*h[7]+n*h[8]+h[9],s[l+2]=e*h[10]+i*h[11]+o*h[12]+n*h[13]+h[14],s[l+3]=e*h[15]+i*h[16]+o*h[17]+n*h[18]+h[19];r.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{type:this.type,matrix:this.matrix})}}),e.Image.filters.ColorMatrix.fromObject=function(t){return new e.Image.filters.ColorMatrix(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.Contrast=o(t.BaseFilter,{type:"Contrast",initialize:function(t){this.contrast=(t=t||{}).contrast||0},applyTo:function(t){for(var e=t.getContext("2d"),t=e.getImageData(0,0,t.width,t.height),i=t.data,o=259*(this.contrast+255)/(255*(259-this.contrast)),n=0,r=i.length;n<r;n+=4)i[n]=o*(i[n]-128)+128,i[n+1]=o*(i[n+1]-128)+128,i[n+2]=o*(i[n+2]-128)+128;e.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{contrast:this.contrast})}}),e.Image.filters.Contrast.fromObject=function(t){return new e.Image.filters.Contrast(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,t=e.Image.filters,o=e.util.createClass;t.Saturate=o(t.BaseFilter,{type:"Saturate",initialize:function(t){this.saturate=(t=t||{}).saturate||0},applyTo:function(t){for(var e,i=t.getContext("2d"),t=i.getImageData(0,0,t.width,t.height),o=t.data,n=.01*-this.saturate,r=0,s=o.length;r<s;r+=4)e=Math.max(o[r],o[r+1],o[r+2]),o[r]+=e!==o[r]?(e-o[r])*n:0,o[r+1]+=e!==o[r+1]?(e-o[r+1])*n:0,o[r+2]+=e!==o[r+2]?(e-o[r+2])*n:0;i.putImageData(t,0,0)},toObject:function(){return i(this.callSuper("toObject"),{saturate:this.saturate})}}),e.Image.filters.Saturate.fromObject=function(t){return new e.Image.filters.Saturate(t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e,u=t.fabric||(t.fabric={}),i=u.util.object.clone,d=u.util.toFixed,f=u.Object.NUM_FRACTION_DIGITS;u.Text?u.warn("fabric.Text is already defined"):((t=u.Object.prototype.stateProperties.concat()).push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing"),(e=u.Object.prototype.cacheProperties.concat()).push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","charSpacing","styles"),u.Text=u.util.createClass(u.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:t,cacheProperties:e,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,charSpacing:0,initialize:function(t,e){e=e||{},this.text=t,this.__skipDimension=!0,this.callSuper("initialize",e),this.__skipDimension=!1,this._initDimensions(),this.setupState({propertySet:"_dimensionAffectingProps"})},_initDimensions:function(t){this.__skipDimension||(t||(t=u.util.createCanvasElement().getContext("2d"),this._setTextStyles(t)),this._textLines=this._splitTextIntoLines(),this._clearCache(),this.width=this._getTextWidth(t)||this.cursorWidth||2,this.height=this._getTextHeight(t))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(t){this._setTextStyles(t),this.group&&"path-group"===this.group.type&&t.translate(this.left,this.top),this._renderTextLinesBackground(t),this._renderText(t),this._renderTextDecoration(t)},_renderText:function(t){this._renderTextFill(t),this._renderTextStroke(t)},_setTextStyles:function(t){t.textBaseline="alphabetic",t.font=this._getFontDeclaration()},_getTextHeight:function(){return this._getHeightOfSingleLine()+(this._textLines.length-1)*this._getHeightOfLine()},_getTextWidth:function(t){for(var e=this._getLineWidth(t,0),i=1,o=this._textLines.length;i<o;i++){var n=this._getLineWidth(t,i);e<n&&(e=n)}return e},_renderChars:function(t,e,i,o,n){var r,s,a,h,l=t.slice(0,-4);if(this[l].toLive&&(a=-this.width/2+this[l].offsetX||0,h=-this.height/2+this[l].offsetY||0,e.save(),e.translate(a,h),o-=a,n-=h),0!==this.charSpacing)for(var c=this._getWidthOfCharSpacing(),p=0,u=(i=i.split("")).length;p<u;p++)r=i[p],s=e.measureText(r).width+c,e[t](r,o,n),o+=0<s?s:0;else e[t](i,o,n);this[l].toLive&&e.restore()},_renderTextLine:function(t,e,i,o,n,r){n-=this.fontSize*this._fontSizeFraction;var s=this._getLineWidth(e,r);if("justify"!==this.textAlign||this.width<s)this._renderChars(t,e,i,o,n,r);else for(var a,h=i.split(/\s+/),l=0,s=this._getWidthOfWords(e,h.join(" "),r,0),s=this.width-s,c=h.length-1,p=0<c?s/c:0,u=0,d=0,f=h.length;d<f;d++){for(;" "===i[l]&&l<i.length;)l++;a=h[d],this._renderChars(t,e,a,o+u,n,r,l),u+=this._getWidthOfWords(e,a,r,l)+p,l+=a.length}},_getWidthOfWords:function(t,e){t=t.measureText(e).width;return 0!==this.charSpacing&&(t+=e.split("").length*this._getWidthOfCharSpacing()),0<t?t:0},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},isEmptyStyles:function(){return!0},_renderTextCommon:function(t,e){for(var i=0,o=this._getLeftOffset(),n=this._getTopOffset(),r=0,s=this._textLines.length;r<s;r++){var a=this._getHeightOfLine(t,r),h=a/this.lineHeight,l=this._getLineWidth(t,r),l=this._getLineLeftOffset(l);this._renderTextLine(e,t,this._textLines[r],o+l,n+i+h,r),i+=a}},_renderTextFill:function(t){!this.fill&&this.isEmptyStyles()||this._renderTextCommon(t,"fillText")},_renderTextStroke:function(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())},_getHeightOfLine:function(){return this._getHeightOfSingleLine()*this.lineHeight},_getHeightOfSingleLine:function(){return this.fontSize*this._fontSizeMult},_renderTextLinesBackground:function(t){if(this.textBackgroundColor){var e,i,o,n=0,r=t.fillStyle;t.fillStyle=this.textBackgroundColor;for(var s=0,a=this._textLines.length;s<a;s++)e=this._getHeightOfLine(t,s),0<(i=this._getLineWidth(t,s))&&(o=this._getLineLeftOffset(i),t.fillRect(this._getLeftOffset()+o,this._getTopOffset()+n,i,e/this.lineHeight)),n+=e;t.fillStyle=r,this._removeShadow(t)}},_getLineLeftOffset:function(t){return"center"===this.textAlign?(this.width-t)/2:"right"===this.textAlign?this.width-t:0},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[]},_shouldClearDimensionCache:function(){var t;return this._forceClearCache?(this._forceClearCache=!1,this.dirty=!0):((t=this.hasStateChanged("_dimensionAffectingProps"))&&(this.saveState({propertySet:"_dimensionAffectingProps"}),this.dirty=!0),t)},_getLineWidth:function(t,e){var i;return this.__lineWidths[e]?-1===this.__lineWidths[e]?this.width:this.__lineWidths[e]:(t=""===(i=this._textLines[e])?0:this._measureLine(t,e),(this.__lineWidths[e]=t)&&"justify"===this.textAlign&&1<i.split(/\s+/).length&&(this.__lineWidths[e]=-1),t)},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},_measureLine:function(t,e){var e=this._textLines[e],i=0;return 0<(t=t.measureText(e).width+(i=0!==this.charSpacing?(e.split("").length-1)*this._getWidthOfCharSpacing():i))?t:0},_renderTextDecoration:function(t){if(this.textDecoration){var e=this.height/2,i=this,o=[];if(-1<this.textDecoration.indexOf("underline")&&o.push(.85),-1<this.textDecoration.indexOf("line-through")&&o.push(.43),-1<this.textDecoration.indexOf("overline")&&o.push(-.12),0<o.length)for(var n,r,s,a,h,l=o,c=0,p=0,u=i._textLines.length;p<u;p++){for(s=i._getLineWidth(t,p),a=i._getLineLeftOffset(s),h=i._getHeightOfLine(t,p),n=0,r=l.length;n<r;n++)t.fillRect(i._getLeftOffset()+a,c+(i._fontSizeMult-1+l[n])*i.fontSize-e,s,i.fontSize/15);c+=h}}},_getFontDeclaration:function(){return[u.isLikelyNode?this.fontWeight:this.fontStyle,u.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",u.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(t,e){this.visible&&(this._shouldClearDimensionCache()&&(this._setTextStyles(t),this._initDimensions(t)),this.callSuper("render",t,e))},_splitTextIntoLines:function(){return this.text.split(this._reNewline)},toObject:function(t){t=["text","fontSize","fontWeight","fontFamily","fontStyle","lineHeight","textDecoration","textAlign","textBackgroundColor","charSpacing"].concat(t);return this.callSuper("toObject",t)},toSVG:function(t){this.ctx||(this.ctx=u.util.createCanvasElement().getContext("2d"));var e=this._createBaseSVGMarkup(),i=this._getSVGLeftTopOffsets(this.ctx),i=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(e,i),t?t(e.join("")):e.join("")},_getSVGLeftTopOffsets:function(t){t=this._getHeightOfLine(t,0);return{textLeft:-this.width/2+(this.group&&"path-group"===this.group.type?this.left:0),textTop:0+(this.group&&"path-group"===this.group.type?-this.top:0),lineTop:t}},_wrapSVGTextAndBg:function(t,e){var i=this.getSvgFilter(),i=""===i?"":' style="'+i+'"';t.push("\t<g ",this.getSvgId(),'transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"',i,">\n",e.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(!0),'" >\n',e.textSpans.join(""),"\t\t</text>\n","\t</g>\n")},_getSVGTextAndBg:function(t,e){var i=[],o=[],n=0;this._setSVGBg(o);for(var r=0,s=this._textLines.length;r<s;r++)this.textBackgroundColor&&this._setSVGTextLineBg(o,r,e,t,n),this._setSVGTextLineText(r,i,n,e,t,o),n+=this._getHeightOfLine(this.ctx,r);return{textSpans:i,textBgRects:o}},_setSVGTextLineText:function(t,e,i,o,n){n=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-n+i-this.height/2;"justify"===this.textAlign?this._setSVGTextLineJustifed(t,e,n,o):e.push('\t\t\t<tspan x="',d(o+this._getLineLeftOffset(this._getLineWidth(this.ctx,t)),f),'" ','y="',d(n,f),'" ',this._getFillAttributes(this.fill),">",u.util.string.escapeXml(this._textLines[t]),"</tspan>\n")},_setSVGTextLineJustifed:function(t,e,i,o){var n=u.util.createCanvasElement().getContext("2d");this._setTextStyles(n);var r,s,a=this._textLines[t].split(/\s+/),h=this._getWidthOfWords(n,a.join("")),h=this.width-h,l=a.length-1,c=0<l?h/l:0,p=this._getFillAttributes(this.fill);for(o+=this._getLineLeftOffset(this._getLineWidth(n,t)),t=0,s=a.length;t<s;t++)r=a[t],e.push('\t\t\t<tspan x="',d(o,f),'" ','y="',d(i,f),'" ',p,">",u.util.string.escapeXml(r),"</tspan>\n"),o+=this._getWidthOfWords(n,r)+c},_setSVGTextLineBg:function(t,e,i,o,n){t.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',d(i+this._getLineLeftOffset(this._getLineWidth(this.ctx,e)),f),'" y="',d(n-this.height/2,f),'" width="',d(this._getLineWidth(this.ctx,e),f),'" height="',d(this._getHeightOfLine(this.ctx,e)/this.lineHeight,f),'"></rect>\n')},_setSVGBg:function(t){this.backgroundColor&&t.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',d(-this.width/2,f),'" y="',d(-this.height/2,f),'" width="',d(this.width,f),'" height="',d(this.height,f),'"></rect>\n')},_getFillAttributes:function(t){var e=t&&"string"==typeof t?new u.Color(t):"";return e&&e.getSource()&&1!==e.getAlpha()?'opacity="'+e.getAlpha()+'" fill="'+e.setAlpha(1).toRgb()+'"':'fill="'+t+'"'},_set:function(t,e){this.callSuper("_set",t,e),-1<this._dimensionAffectingProps.indexOf(t)&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),u.Text.ATTRIBUTE_NAMES=u.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),u.Text.DEFAULT_SVG_FONT_SIZE=16,u.Text.fromElement=function(t,e){var i;return t?(i=u.parseAttributes(t,u.Text.ATTRIBUTE_NAMES),(e=u.util.object.extend(e?u.util.object.clone(e):{},i)).top=e.top||0,e.left=e.left||0,"dx"in i&&(e.left+=i.dx),"dy"in i&&(e.top+=i.dy),"fontSize"in e||(e.fontSize=u.Text.DEFAULT_SVG_FONT_SIZE),e.originX||(e.originX="left"),i="","textContent"in t?i=t.textContent:"firstChild"in t&&null!==t.firstChild&&"data"in t.firstChild&&null!==t.firstChild.data&&(i=t.firstChild.data),i=i.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),i=(t=new u.Text(i,e)).getHeight()/t.height,e=((t.height+t.strokeWidth)*t.lineHeight-t.height)*i,i=t.getHeight()+e,e=0,"left"===t.originX&&(e=t.getWidth()/2),"right"===t.originX&&(e=-t.getWidth()/2),t.set({left:t.getLeft()+e,top:t.getTop()-i/2+t.fontSize*(.18+t._fontSizeFraction)/t.lineHeight}),t):null},u.Text.fromObject=function(t,e){t=new u.Text(t.text,i(t));return e&&e(t),t},u.util.createAccessors(u.Text))}("undefined"!=typeof exports?exports:this),!function(){var s=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],initialize:function(t,e){this.styles=e&&e.styles||{},this.callSuper("initialize",t,e),this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache"),this.__widthOfSpace=[]},isEmptyStyles:function(){if(this.styles){var t,e=this.styles;for(t in e)for(var i in e[t])for(var o in e[t][i])return!1}return!0},setSelectionStart:function(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)},setSelectionEnd:function(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)},_updateAndFire:function(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectionStyles:function(t,e){if(2===arguments.length){for(var i=[],o=t;o<e;o++)i.push(this.getSelectionStyles(o));return i}var n=this.get2DCursorLocation(t);return this._getStyleDeclaration(n.lineIndex,n.charIndex)||{}},setSelectionStyles:function(t){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,t);else for(var e=this.selectionStart;e<this.selectionEnd;e++)this._extendStyles(e,t);return this._forceClearCache=!0,this},_extendStyles:function(t,e){t=this.get2DCursorLocation(t);this._getLineStyle(t.lineIndex)||this._setLineStyle(t.lineIndex,{}),this._getStyleDeclaration(t.lineIndex,t.charIndex)||this._setStyleDeclaration(t.lineIndex,t.charIndex,{}),fabric.util.object.extend(this._getStyleDeclaration(t.lineIndex,t.charIndex),e)},_initDimensions:function(t){t||this.clearContextTop(),this.callSuper("_initDimensions",t)},render:function(t,e){this.clearContextTop(),this.callSuper("render",t,e)},_render:function(t){this.callSuper("_render",t),this.ctx=t,this.cursorOffsetCache={},this.renderCursorOrSelection()},clearContextTop:function(){var t;this.active&&this.isEditing&&this.canvas&&this.canvas.contextTop&&((t=this.canvas.contextTop).save(),t.transform.apply(t,this.canvas.viewportTransform),this.transform(t),this.transformMatrix&&t.transform.apply(t,this.transformMatrix),this._clearTextArea(t),t.restore())},renderCursorOrSelection:function(){var t,e,i;this.active&&this.isEditing&&(t=this.text.split(""),this.canvas&&this.canvas.contextTop?((i=this.canvas.contextTop).save(),i.transform.apply(i,this.canvas.viewportTransform),this.transform(i),this.transformMatrix&&i.transform.apply(i,this.transformMatrix),this._clearTextArea(i)):(i=this.ctx).save(),this.selectionStart===this.selectionEnd?(e=this._getCursorBoundaries(t,"cursor"),this.renderCursor(e,i)):(e=this._getCursorBoundaries(t,"selection"),this.renderSelection(t,e,i)),i.restore())},_clearTextArea:function(t){var e=this.width+4,i=this.height+4;t.clearRect(-e/2,-i/2,e,i)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0;i<e;i++){if(t<=this._textLines[i].length)return{lineIndex:i,charIndex:t};t-=this._textLines[i].length+1}return{lineIndex:i-1,charIndex:this._textLines[i-1].length<t?this._textLines[i-1].length:t}},getCurrentCharStyle:function(t,e){t=this._getStyleDeclaration(t,0===e?0:e-1);return{fontSize:t&&t.fontSize||this.fontSize,fill:t&&t.fill||this.fill,textBackgroundColor:t&&t.textBackgroundColor||this.textBackgroundColor,textDecoration:t&&t.textDecoration||this.textDecoration,fontFamily:t&&t.fontFamily||this.fontFamily,fontWeight:t&&t.fontWeight||this.fontWeight,fontStyle:t&&t.fontStyle||this.fontStyle,stroke:t&&t.stroke||this.stroke,strokeWidth:t&&t.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(t,e){t=this._getStyleDeclaration(t,0===e?0:e-1);return(t&&t.fontSize?t:this).fontSize},getCurrentCharColor:function(t,e){t=this._getStyleDeclaration(t,0===e?0:e-1);return t&&t.fill?t.fill:this.cursorColor},_getCursorBoundaries:function(t,e){var i=Math.round(this._getLeftOffset()),o=this._getTopOffset(),t=this._getCursorBoundariesOffsets(t,e);return{left:i,top:o,leftOffset:t.left+t.lineLeft,topOffset:t.top}},_getCursorBoundariesOffsets:function(t,e){if(!(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)){for(var i=0,o=0,n=0,r=0,s=0,a=0;a<this.selectionStart;a++)"\n"===t[a]?(s=0,r+=this._getHeightOfLine(this.ctx,o),o++,n=0):(s+=this._getWidthOfChar(this.ctx,t[a],o,n),n++),i=this._getLineLeftOffset(this._getLineWidth(this.ctx,o));"cursor"===e&&(r+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,o)/this.lineHeight-this.getCurrentCharFontSize(o,n)*(1-this._fontSizeFraction)),0!==this.charSpacing&&n===this._textLines[o].length&&(s-=this._getWidthOfCharSpacing()),this.cursorOffsetCache={top:r,left:0<s?s:0,lineLeft:i}}return this.cursorOffsetCache},renderCursor:function(t,e){var i=this.get2DCursorLocation(),o=i.lineIndex,i=i.charIndex,n=this.getCurrentCharFontSize(o,i),r=0===o&&0===i?this._getLineLeftOffset(this._getLineWidth(e,o)):t.leftOffset,s=this.scaleX*this.canvas.getZoom(),s=this.cursorWidth/s;e.fillStyle=this.getCurrentCharColor(o,i),e.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,e.fillRect(t.left+r-s/2,t.top+t.topOffset,s,n)},renderSelection:function(t,e,i){i.fillStyle=this.selectionColor;for(var o=this.get2DCursorLocation(this.selectionStart),n=this.get2DCursorLocation(this.selectionEnd),r=o.lineIndex,s=n.lineIndex,a=r;a<=s;a++){var h,l=this._getLineLeftOffset(this._getLineWidth(i,a))||0,c=this._getHeightOfLine(this.ctx,a),p=0,u=this._textLines[a];if(a===r){for(var d=0,f=u.length;d<f;d++)d>=o.charIndex&&(a!==s||d<n.charIndex)&&(p+=this._getWidthOfChar(i,u[d],a,d)),d<o.charIndex&&(l+=this._getWidthOfChar(i,u[d],a,d));d===u.length&&(p-=this._getWidthOfCharSpacing())}else if(r<a&&a<s)p+=this._getLineWidth(i,a)||5;else if(a===s){for(var g=0,v=n.charIndex;g<v;g++)p+=this._getWidthOfChar(i,u[g],a,g);n.charIndex===u.length&&(p-=this._getWidthOfCharSpacing())}h=c,(this.lineHeight<1||a===s&&1<this.lineHeight)&&(c/=this.lineHeight),i.fillRect(e.left+l,e.top+e.topOffset,0<p?p:0,c),e.topOffset+=h}},_renderChars:function(t,e,i,o,n,r,s){if(this.isEmptyStyles())return this._renderCharsFast(t,e,i,o,n);s=s||0;var a,h,l=this._getHeightOfLine(e,r),c="";e.save(),n-=l/this.lineHeight*this._fontSizeFraction;for(var p=s,u=i.length+s;p<=u;p++)a=a||this.getCurrentCharStyle(r,p),h=this.getCurrentCharStyle(r,p+1),!this._hasStyleChanged(a,h)&&p!==u||(this._renderChar(t,e,r,p-1,c,o,n,l),c="",a=h),c+=i[p-s];e.restore()},_renderCharsFast:function(t,e,i,o,n){"fillText"===t&&this.fill&&this.callSuper("_renderChars",t,e,i,o,n),"strokeText"===t&&(this.stroke&&0<this.strokeWidth||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",t,e,i,o,n)},_renderChar:function(t,e,i,o,n,r,s,a){var h,l,c,p,u=this._getStyleDeclaration(i,o);if(u?(h=this._getHeightOfChar(e,n,i,o),c=u.stroke,l=u.fill,p=u.textDecoration):h=this.fontSize,c=(c||this.stroke)&&"strokeText"===t,l=(l||this.fill)&&"fillText"===t,u&&e.save(),v=this._applyCharStylesGetWidth(e,n,i,o,u||null),p=p||this.textDecoration,u&&u.textBackgroundColor&&this._removeShadow(e),0!==this.charSpacing)for(var d,f,g=this._getWidthOfCharSpacing(),v=0,b=0,m=(d=n.split("")).length;b<m;b++)f=d[b],l&&e.fillText(f,r+v,s),c&&e.strokeText(f,r+v,s),v+=0<(f=e.measureText(f).width+g)?f:0;else l&&e.fillText(n,r,s),c&&e.strokeText(n,r,s);!p&&""===p||(t=this._fontSizeFraction*a/this.lineHeight,this._renderCharDecoration(e,p,r,s,t,v,h)),u&&e.restore(),e.translate(v,0)},_hasStyleChanged:function(t,e){return t.fill!==e.fill||t.fontSize!==e.fontSize||t.textBackgroundColor!==e.textBackgroundColor||t.textDecoration!==e.textDecoration||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth},_renderCharDecoration:function(t,e,i,o,n,r,s){if(e)for(var a,h=s/15,l={underline:o+s/10,"line-through":o-s*(this._fontSizeFraction+this._fontSizeMult-1)+h,overline:o-(this._fontSizeMult-this._fontSizeFraction)*s},c=["underline","line-through","overline"],p=0;p<c.length;p++)-1<e.indexOf(a=c[p])&&t.fillRect(i,l[a],r,h)},_renderTextLine:function(t,e,i,o,n,r){this.isEmptyStyles()||(n+=this.fontSize*(this._fontSizeFraction+.03)),this.callSuper("_renderTextLine",t,e,i,o,n,r)},_renderTextDecoration:function(t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",t)},_renderTextLinesBackground:function(t){this.callSuper("_renderTextLinesBackground",t);var e,i,o,n,r=0,s=this._getLeftOffset(),a=this._getTopOffset();t.save();for(var h=0,l=this._textLines.length;h<l;h++){if(e=this._getHeightOfLine(t,h),""!==(i=this._textLines[h])&&this.styles&&this._getLineStyle(h))for(var c=this._getLineWidth(t,h),p=this._getLineLeftOffset(c),u=0,d=i.length;u<d;u++)(n=this._getStyleDeclaration(h,u))&&n.textBackgroundColor&&(o=i[u],t.fillStyle=n.textBackgroundColor,t.fillRect(s+p+this._getWidthOfCharsAt(t,h,u),a+r,this._getWidthOfChar(t,o,h,u),e/this.lineHeight));r+=e}t.restore()},_getCacheProp:function(t,e){return t+e.fontSize+e.fontWeight+e.fontStyle},_getFontCache:function(t){return fabric.charWidthsCache[t]||(fabric.charWidthsCache[t]={}),fabric.charWidthsCache[t]},_applyCharStylesGetWidth:function(t,e,i,o,n){var r,n=n||this._getStyleDeclaration(i,o),i=s(n);if(this._applyFontStyles(i),o=this._getFontCache(i.fontFamily),r=this._getCacheProp(e,i),!n&&o[r]&&this.caching)return o[r];"string"==typeof i.shadow&&(i.shadow=new fabric.Shadow(i.shadow));n=i.fill||this.fill;return t.fillStyle=n.toLive?n.toLive(t,this):n,i.stroke&&(t.strokeStyle=i.stroke&&i.stroke.toLive?i.stroke.toLive(t,this):i.stroke),t.lineWidth=i.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(i),i.shadow&&(i.scaleX=this.scaleX,i.scaleY=this.scaleY,i.canvas=this.canvas,i.getObjectScaling=this.getObjectScaling,this._setShadow.call(i,t)),this.caching&&o[r]?o[r]:(n=t.measureText(e).width,this.caching&&(o[r]=n),n)},_applyFontStyles:function(t){t.fontFamily||(t.fontFamily=this.fontFamily),t.fontSize||(t.fontSize=this.fontSize),t.fontWeight||(t.fontWeight=this.fontWeight),t.fontStyle||(t.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,e,i){return i?this.styles[t]&&this.styles[t][e]?s(this.styles[t][e]):{}:this.styles[t]&&this.styles[t][e]?this.styles[t][e]:null},_setStyleDeclaration:function(t,e,i){this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){delete this.styles[t][e]},_getLineStyle:function(t){return this.styles[t]},_setLineStyle:function(t,e){this.styles[t]=e},_deleteLineStyle:function(t){delete this.styles[t]},_getWidthOfChar:function(t,e,i,o){if(!this._isMeasuring&&"justify"===this.textAlign&&this._reSpacesAndTabs.test(e))return this._getWidthOfSpace(t,i);t.save();e=this._applyCharStylesGetWidth(t,e,i,o);return 0!==this.charSpacing&&(e+=this._getWidthOfCharSpacing()),t.restore(),0<e?e:0},_getHeightOfChar:function(t,e,i){e=this._getStyleDeclaration(e,i);return(e&&e.fontSize?e:this).fontSize},_getWidthOfCharsAt:function(t,e,i){for(var o,n=0,r=0;r<i;r++)o=this._textLines[e][r],n+=this._getWidthOfChar(t,o,e,r);return n},_measureLine:function(t,e){this._isMeasuring=!0;t=this._getWidthOfCharsAt(t,e,this._textLines[e].length);return 0!==this.charSpacing&&(t-=this._getWidthOfCharSpacing()),this._isMeasuring=!1,0<t?t:0},_getWidthOfSpace:function(t,e){var i,o;return this.__widthOfSpace[e]||(i=this._textLines[e],o=this._getWidthOfWords(t,i,e,0),o=this.width-o,i=i.length-i.replace(this._reSpacesAndTabs,"").length,o=Math.max(o/i,t.measureText(" ").width),this.__widthOfSpace[e]=o)},_getWidthOfWords:function(t,e,i,o){for(var n=0,r=0;r<e.length;r++){var s=e[r];s.match(/\s/)||(n+=this._getWidthOfChar(t,s,i,r+o))}return n},_getHeightOfLine:function(t,e){if(!this.__lineHeights[e]){for(var i=this._textLines[e],o=this._getHeightOfChar(t,e,0),n=1,r=i.length;n<r;n++){var s=this._getHeightOfChar(t,e,n);o<s&&(o=s)}this.__lineHeights[e]=o*this.lineHeight*this._fontSizeMult}return this.__lineHeights[e]},_getTextHeight:function(t){for(var e,i=0,o=0,n=this._textLines.length;o<n;o++)e=this._getHeightOfLine(t,o),i+=o===n-1?e/this.lineHeight:e;return i},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:s(this.styles,!0)})}}),fabric.IText.fromObject=function(t,e){t=new fabric.IText(t.text,s(t));return e&&e(t),t}}(),!function(){var l=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},initSelectedHandler:function(){this.on("selected",function(){var t=this;setTimeout(function(){t.selected=!0},100)})},initAddedHandler:function(){var e=this;this.on("added",function(){var t=e.canvas;t&&(t._hasITextHandlers||(t._hasITextHandlers=!0,e._initCanvasHandlers(t)),t._iTextInstances=t._iTextInstances||[],t._iTextInstances.push(e))})},initRemovedHandler:function(){var e=this;this.on("removed",function(){var t=e.canvas;t&&(t._iTextInstances=t._iTextInstances||[],fabric.util.removeFromArray(t._iTextInstances,e),0===t._iTextInstances.length)&&(t._hasITextHandlers=!1,e._removeCanvasHandlers(t))})},_initCanvasHandlers:function(t){t._canvasITextSelectionClearedHanlder=function(){fabric.IText.prototype.exitEditingOnOthers(t)}.bind(this),t._mouseUpITextHandler=function(){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.__isMousedown=!1})}.bind(this),t.on("selection:cleared",t._canvasITextSelectionClearedHanlder),t.on("object:selected",t._canvasITextSelectionClearedHanlder),t.on("mouse:up",t._mouseUpITextHandler)},_removeCanvasHandlers:function(t){t.off("selection:cleared",t._canvasITextSelectionClearedHanlder),t.off("object:selected",t._canvasITextSelectionClearedHanlder),t.off("mouse:up",t._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(t,e,i,o){var n={isAborted:!1,abort:function(){this.isAborted=!0}};return t.animate("_currentCursorOpacity",e,{duration:i,onComplete:function(){n.isAborted||t[o]()},onChange:function(){t.canvas&&t.selectionStart===t.selectionEnd&&t.renderCursorOrSelection()},abort:function(){return n.isAborted}}),n},_onTickComplete:function(){var t=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){t._currentTickCompleteState=t._animateCursor(t,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(t){var e=this,t=t?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){e._tick()},t)},abortCursorAnimation:function(){var t=this._currentTickState||this._currentTickCompleteState;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,t&&this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this._fireSelectionChanged(),this._updateTextarea()},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(t){var e=0,i=t-1;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i--;for(;/\S/.test(this.text.charAt(i))&&-1<i;)e++,i--;return t-e},findWordBoundaryRight:function(t){var e=0,i=t;if(this._reSpace.test(this.text.charAt(i)))for(;this._reSpace.test(this.text.charAt(i));)e++,i++;for(;/\S/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},findLineBoundaryLeft:function(t){for(var e=0,i=t-1;!/\n/.test(this.text.charAt(i))&&-1<i;)e++,i--;return t-e},findLineBoundaryRight:function(t){for(var e=0,i=t;!/\n/.test(this.text.charAt(i))&&i<this.text.length;)e++,i++;return t+e},getNumNewLinesInSelectedText:function(){for(var t=this.getSelectedText(),e=0,i=0,o=t.length;i<o;i++)"\n"===t[i]&&e++;return e},searchWordBoundary:function(t,e){for(var i=this._reSpace.test(this.text.charAt(t))?t-1:t,o=this.text.charAt(i),n=/[ \n\.,;!\?\-]/;!n.test(o)&&0<i&&i<this.text.length;)o=this.text.charAt(i+=e);return n.test(o)&&"\n"!==o&&(i+=1===e?0:1),i},selectWord:function(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),t=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=t,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),t=this.findLineBoundaryRight(t);this.selectionStart=e,this.selectionEnd=t,this._fireSelectionChanged(),this._updateTextarea()},enterEditing:function(t){if(!this.isEditing&&this.editable)return this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(t),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.renderAll()),this},exitEditingOnOthers:function(t){t._iTextInstances&&t._iTextInstances.forEach(function(t){t.selected=!1,t.isEditing&&t.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(t){var e,i;this.__isMousedown&&this.isEditing&&(t=this.getSelectionStartFromPointer(t.e),e=this.selectionStart,i=this.selectionEnd,t!==this.__selectionStartOnMouseDown)&&(t>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=t):(this.selectionStart=t,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart!==e||this.selectionEnd!==i)&&(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection())},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){var t;this.hiddenTextarea&&!this.inCompositionMode&&(this.cursorOffsetCache={},this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd,this.selectionStart===this.selectionEnd)&&(t=this._calcTextareaPosition(),this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top,this.hiddenTextarea.style.fontSize=t.fontSize)},_calcTextareaPosition:function(){var t,e,i,o,n;return this.canvas?(o=this.text.split(""),o=this._getCursorBoundaries(o,"cursor"),e=(n=this.get2DCursorLocation()).lineIndex,n=n.charIndex,t=this.getCurrentCharFontSize(e,n),n=0===e&&0===n?this._getLineLeftOffset(this._getLineWidth(this.ctx,e)):o.leftOffset,e=this.calcTransformMatrix(),n={x:o.left+n,y:o.top+o.topOffset+t},i=(o=this.canvas.upperCanvasEl).width-t,o=o.height-t,n=fabric.util.transformPoint(n,e),(n=fabric.util.transformPoint(n,this.canvas.viewportTransform)).x<0&&(n.x=0),n.x>i&&(n.x=i),n.y<0&&(n.y=0),n.y>o&&(n.y=o),n.x+=this.canvas._offset.left,n.y+=this.canvas._offset.top,{left:n.x+"px",top:n.y+"px",fontSize:t}):{x:1,y:1}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas)&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor)},exitEditing:function(){var t=this._textBeforeEdit!==this.text;return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea.blur&&this.hiddenTextarea.blur(),this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),t)&&this.canvas.fire("object:modified",{target:this}),this},_removeExtraneousStyles:function(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]},_removeCharsFromTo:function(t,e){for(;e!==t;)this._removeSingleCharAndStyle(t+1),e--;this.selectionStart=t,this.selectionEnd=t},_removeSingleCharAndStyle:function(t){var e="\n"===this.text[t-1];this.removeStyleObject(e,e?t:t-1),this.text=this.text.slice(0,t-1)+this.text.slice(t),this._textLines=this._splitTextIntoLines()},insertChars:function(t,e){var i;if(1<this.selectionEnd-this.selectionStart&&this._removeCharsFromTo(this.selectionStart,this.selectionEnd),!e&&this.isEmptyStyles())this.insertChar(t,!1);else for(var o=0,n=t.length;o<n;o++)e&&(i=fabric.copiedTextStyle[o]),this.insertChar(t[o],o<n-1,i)},insertChar:function(t,e,i){var o="\n"===this.text[this.selectionStart];this.text=this.text.slice(0,this.selectionStart)+t+this.text.slice(this.selectionEnd),this._textLines=this._splitTextIntoLines(),this.insertStyleObjects(t,o,i),this.selectionStart+=t.length,this.selectionEnd=this.selectionStart,e||(this._updateTextarea(),this.setCoords(),this._fireSelectionChanged(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this}),this.canvas&&this.canvas.renderAll())},insertNewlineStyleObject:function(t,e,i){this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={});var o={},n={};if(this.styles[t]&&this.styles[t][e-1]&&(o=this.styles[t][e-1]),i)n[0]=l(o);else for(var r in this.styles[t])parseInt(r,10)>=e&&(n[parseInt(r,10)-e]=this.styles[t][r],delete this.styles[t][r]);this.styles[t+1]=n,this._forceClearCache=!0},insertCharStyleObject:function(t,e,i){var o,n=this.styles[t],r=l(n);for(o in 0!==e||i||(e=1),r){var s=parseInt(o,10);e<=s&&(n[s+1]=r[s],r[s-1]||delete n[s])}this.styles[t][e]=i||l(n[e-1]),this._forceClearCache=!0},insertStyleObjects:function(t,e,i){var o=this.get2DCursorLocation(),n=o.lineIndex,o=o.charIndex;this._getLineStyle(n)||this._setLineStyle(n,{}),"\n"===t?this.insertNewlineStyleObject(n,o,e):this.insertCharStyleObject(n,o,i)},shiftLineStyles:function(t,e){var i,o=l(this.styles);for(i in this.styles){var n=parseInt(i,10);t<n&&(this.styles[n+e]=o[n],o[n-e]||delete this.styles[n])}},removeStyleObject:function(t,e){var e=this.get2DCursorLocation(e),i=e.lineIndex,o=e.charIndex;this._removeStyleObject(t,e,i,o)},_getTextOnPreviousLine:function(t){return this._textLines[t-1]},_removeStyleObject:function(t,e,i,o){if(t){var t=this._getTextOnPreviousLine(e.lineIndex),n=t?t.length:0;for(o in this.styles[i-1]||(this.styles[i-1]={}),this.styles[i])this.styles[i-1][parseInt(o,10)+n]=this.styles[i][o];this.shiftLineStyles(e.lineIndex,-1)}else{var r,s=this.styles[i],a=(s&&delete s[o],l(s));for(r in a){var h=parseInt(r,10);o<=h&&0!==h&&(s[h-1]=a[h],delete s[h])}}},insertNewline:function(){this.insertChars("\n")},setSelectionStartEndWithShift:function(t,e,i){i<=t?(e===t?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=t),this.selectionStart=i):t<i&&i<e?"right"===this._selectionDirection?this.selectionEnd=i:this.selectionStart=i:(e===t?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=e),this.selectionEnd=i)},setSelectionInBoundaries:function(){var t=this.text.length;this.selectionStart>t?this.selectionStart=t:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>t?this.selectionEnd=t:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(t){this.__newClickTime=+new Date;var e=this.canvas.getPointer(t.e);this.isTripleClick(e)?(this.fire("tripleclick",t),this._stopEvent(t.e)):this.isDoubleClick(e)&&(this.fire("dblclick",t),this._stopEvent(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y&&this.__lastIsEditing},isTripleClick:function(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y},_stopEvent:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(t){this.selectWord(this.getSelectionStartFromPointer(t.e))}),this.on("tripleclick",function(t){this.selectLine(this.getSelectionStartFromPointer(t.e))})},initMousedownHandler:function(){this.on("mousedown",function(t){var e;this.editable&&(e=this.canvas.getPointer(t.e),this.__mousedownX=e.x,this.__mousedownY=e.y,this.__isMousedown=!0,this.selected&&this.setCursorByClick(t.e),this.isEditing)&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())})},_isObjectMoved:function(t){t=this.canvas.getPointer(t);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(t){this.__isMousedown=!1,this.editable&&!this._isObjectMoved(t.e)&&(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)})},setCursorByClick:function(t){var e=this.getSelectionStartFromPointer(t),i=this.selectionStart,o=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(i,o,e):(this.selectionStart=e,this.selectionEnd=e),this._fireSelectionChanged(),this._updateTextarea()},getSelectionStartFromPointer:function(t){for(var e,i=this.getLocalPointer(t),o=0,n=0,r=0,s=0,a=0,h=this._textLines.length;a<h;a++){e=this._textLines[a],r+=this._getHeightOfLine(this.ctx,a)*this.scaleY;for(var l=this._getLineWidth(this.ctx,a),n=this._getLineLeftOffset(l)*this.scaleX,c=0,p=e.length;c<p;c++){if(o=n,n+=this._getWidthOfChar(this.ctx,e[c],a,this.flipX?p-c:c)*this.scaleX,!(r<=i.y||n<=i.x))return this._getNewSelectionStartFromOffset(i,o,n,s+a,p);s++}if(i.y<r)return this._getNewSelectionStartFromOffset(i,o,n,s+a-1,p)}return this.text.length},_getNewSelectionStartFromOffset:function(t,e,i,o,n){o+=t.x-e<i-t.x?0:1;return o=(o=this.flipX?n-o:o)>this.text.length?this.text.length:o}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off");var t=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+t.top+"; left: "+t.left+"; opacity: 0; width: 0px; height: 0px; z-index: -999;",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),fabric.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"cut",this.cut.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),fabric.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMapUp:{67:"copy",88:"cut"},_ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(t){if(this.isEditing){if(t.keyCode in this._keysMap)this[this._keysMap[t.keyCode]](t);else{if(!(t.keyCode in this._ctrlKeysMapDown&&(t.ctrlKey||t.metaKey)))return;this[this._ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.renderAll()}},onKeyUp:function(t){!this.isEditing||this._copyDone?this._copyDone=!1:t.keyCode in this._ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this._ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas)&&this.canvas.renderAll()},onInput:function(t){var e,i,o,n,r;this.isEditing&&!this.inCompositionMode&&(e=this.selectionStart||0,i=this.selectionEnd||0,r=(o=this.text.length)<(n=this.hiddenTextarea.value.length)?(r="left"===this._selectionDirection?i:e,this.hiddenTextarea.value.slice(r,r+(n-o))):this.hiddenTextarea.value.slice(e,e+(n-o+i-e)),this.insertChars(r),t.stopPropagation())},onCompositionStart:function(){this.inCompositionMode=!0,this.prevCompositionLength=0,this.compositionStart=this.selectionStart},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(t){t=t.data;this.selectionStart=this.compositionStart,this.selectionEnd=this.selectionEnd===this.selectionStart?this.compositionStart+this.prevCompositionLength:this.selectionEnd,this.insertChars(t,!1),this.prevCompositionLength=t.length},forwardDelete:function(t){if(this.selectionStart===this.selectionEnd){if(this.selectionStart===this.text.length)return;this.moveCursorRight(t)}this.removeChars(t)},copy:function(t){var e,i;this.selectionStart!==this.selectionEnd&&(e=this.getSelectedText(),(i=this._getClipboardData(t))&&i.setData("text",e),fabric.copiedText=e,fabric.copiedTextStyle=fabric.util.object.clone(this.getSelectionStyles(this.selectionStart,this.selectionEnd)),t.stopImmediatePropagation(),t.preventDefault(),this._copyDone=!0)},paste:function(t){var e=null,i=this._getClipboardData(t),o=!0;i?(e=i.getData("text").replace(/\r/g,""),fabric.copiedTextStyle&&fabric.copiedText===e||(o=!1)):e=fabric.copiedText,e&&this.insertChars(e,o),t.stopImmediatePropagation(),t.preventDefault()},cut:function(t){this.selectionStart!==this.selectionEnd&&(this.copy(t),this.removeChars(t))},_getClipboardData:function(t){return t&&t.clipboardData||fabric.window.clipboardData},_getWidthBeforeCursor:function(t,e){for(var i,o=this._textLines[t].slice(0,e),e=this._getLineWidth(this.ctx,t),n=this._getLineLeftOffset(e),r=0,s=o.length;r<s;r++)i=o[r],n+=this._getWidthOfChar(this.ctx,i,t,r);return n},getDownCursorOffset:function(t,e){var e=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(e),o=i.lineIndex;return o===this._textLines.length-1||t.metaKey||34===t.keyCode?this.text.length-e:(t=i.charIndex,e=this._getWidthBeforeCursor(o,t),i=this._getIndexOnLine(o+1,e),this._textLines[o].slice(t).length+i+2)},_getSelectionForOffset:function(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(t,e){var e=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(e),o=i.lineIndex;return 0===o||t.metaKey||33===t.keyCode?-e:(t=i.charIndex,e=this._getWidthBeforeCursor(o,t),i=this._getIndexOnLine(o-1,e),e=this._textLines[o].slice(0,t),-this._textLines[o-1].length+i-e.length)},_getIndexOnLine:function(t,e){for(var i=this._getLineWidth(this.ctx,t),o=this._textLines[t],n=this._getLineLeftOffset(i),r=0,s=0,a=o.length;s<a;s++){var h=o[s],h=this._getWidthOfChar(this.ctx,h,t,s);if(e<(n+=h)){var l=!0,c=n,h=Math.abs(n-h-e),r=Math.abs(c-e)<h?s:s-1;break}}return r=l?r:o.length-1},moveCursorDown:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorUpOrDown("Down",t)},moveCursorUp:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)},_moveCursorUpOrDown:function(t,e){t=this["get"+t+"CursorOffset"](e,"right"===this._selectionDirection);e.shiftKey?this.moveCursorWithShift(t):this.moveCursorWithoutShift(t),0!==t&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(t){var e="left"===this._selectionDirection?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t},moveCursorWithoutShift:function(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t},moveCursorLeft:function(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)},_move:function(t,e,i){var o;if(t.altKey)o=this["findWordBoundary"+i](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===i?-1:1,!0;o=this["findLineBoundary"+i](this[e])}if(this[e]!==o)return this[e]=o,!0},_moveLeft:function(t,e){return this._move(t,e,"Left")},_moveRight:function(t,e){return this._move(t,e,"Right")},moveCursorLeftWithoutShift:function(t){var e=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e},moveCursorLeftWithShift:function(t){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(t,"selectionStart")):void 0},moveCursorRight:function(t){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||this._moveCursorLeftOrRight("Right",t)},_moveCursorLeftOrRight:function(t,e){t="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?t+="Shift":t+="outShift",this[t](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(t){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this.text.length?(this._selectionDirection="right",this._moveRight(t,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(t){var e=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e},removeChars:function(t){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(t):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.setSelectionEnd(this.selectionStart),this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(t){var e;0!==this.selectionStart&&(t.metaKey?(e=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):t.altKey?(e=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(e,this.selectionStart),this.setSelectionStart(e)):(this._removeSingleCharAndStyle(this.selectionStart),this.setSelectionStart(this.selectionStart-1)))}}),!function(){var s=fabric.util.toFixed,a=fabric.Object.NUM_FRACTION_DIGITS;fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(t,e,i,o,n,r){this._getLineStyle(t)?this._setSVGTextLineChars(t,e,i,o,r):fabric.Text.prototype._setSVGTextLineText.call(this,t,e,i,o,n)},_setSVGTextLineChars:function(t,e,i,o,n){for(var r=this._textLines[t],s=0,a=this._getLineLeftOffset(this._getLineWidth(this.ctx,t))-this.width/2,h=this._getSVGLineTopOffset(t),l=this._getHeightOfLine(this.ctx,t),c=0,p=r.length;c<p;c++){var u=this._getStyleDeclaration(t,c)||{},d=(e.push(this._createTextCharSpan(r[c],u,a,h.lineTop+h.offset,s)),this._getWidthOfChar(this.ctx,r[c],t,c));u.textBackgroundColor&&n.push(this._createTextCharBg(u,a,h.lineTop,l,d,s)),s+=d}},_getSVGLineTopOffset:function(t){for(var e,i=0,o=0;o<t;o++)i+=this._getHeightOfLine(this.ctx,o);return e=this._getHeightOfLine(this.ctx,o),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(t,e,i,o,n,r){return['\t\t<rect fill="',t.textBackgroundColor,'" x="',s(e+r,a),'" y="',s(i-this.height/2,a),'" width="',s(n,a),'" height="',s(o/this.lineHeight,a),'"></rect>\n'].join("")},_createTextCharSpan:function(t,e,i,o,n){var r=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text",getSvgFilter:fabric.Object.prototype.getSvgFilter},e));return['\t\t\t<tspan x="',s(i+n,a),'" y="',s(o-this.height/2,a),'" ',e.fontFamily?'font-family="'+e.fontFamily.replace(/"/g,"'")+'" ':"",e.fontSize?'font-size="'+e.fontSize+'" ':"",e.fontStyle?'font-style="'+e.fontStyle+'" ':"",e.fontWeight?'font-weight="'+e.fontWeight+'" ':"",e.textDecoration?'text-decoration="'+e.textDecoration+'" ':"",'style="',r,'">',fabric.util.string.escapeXml(t),"</tspan>\n"].join("")}})}(),!function(t){"use strict";var i=t.fabric||(t.fabric={}),o=i.util.object.clone;i.Textbox=i.util.createClass(i.IText,i.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingY:!0,lockScalingFlip:!0,noScaleCache:!1,initialize:function(t,e){this.callSuper("initialize",t,e),this.setControlsVisibility(i.Textbox.getTextboxControlVisibility()),this.ctx=this.objectCaching?this._cacheContext:i.util.createCanvasElement().getContext("2d"),this._dimensionAffectingProps.push("width")},_initDimensions:function(t){this.__skipDimension||(t||(t=i.util.createCanvasElement().getContext("2d"),this._setTextStyles(t),this.clearContextTop()),this.dynamicMinWidth=0,this._textLines=this._splitTextIntoLines(t),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this._clearCache(),this.height=this._getTextHeight(t))},_generateStyleMap:function(){for(var t=0,e=0,i=0,o={},n=0;n<this._textLines.length;n++)"\n"===this.text[i]&&0<n?(e=0,i++,t++):" "===this.text[i]&&0<n&&(e++,i++),o[n]={line:t,offset:e},i+=this._textLines[n].length,e+=this._textLines[n].length;return o},_getStyleDeclaration:function(t,e,i){if(this._styleMap){var o=this._styleMap[t];if(!o)return i?{}:null;t=o.line,e=o.offset+e}return this.callSuper("_getStyleDeclaration",t,e,i)},_setStyleDeclaration:function(t,e,i){var o=this._styleMap[t];t=o.line,e=o.offset+e,this.styles[t][e]=i},_deleteStyleDeclaration:function(t,e){var i=this._styleMap[t];t=i.line,e=i.offset+e,delete this.styles[t][e]},_getLineStyle:function(t){t=this._styleMap[t];return this.styles[t.line]},_setLineStyle:function(t,e){t=this._styleMap[t];this.styles[t.line]=e},_deleteLineStyle:function(t){t=this._styleMap[t];delete this.styles[t.line]},_wrapText:function(t,e){for(var i=e.split(this._reNewline),o=[],n=0;n<i.length;n++)o=o.concat(this._wrapLine(t,i[n],n));return o},_measureText:function(t,e,i,o){var n=0;o=o||0;for(var r=0,s=e.length;r<s;r++)n+=this._getWidthOfChar(t,e[r],i,r+o);return n},_wrapLine:function(t,e,i){for(var o,n,r=0,s=[],a="",h=e.split(" "),l=0,c=0,p=0,u=!0,d=this._getWidthOfCharSpacing(),f=0;f<h.length;f++)o=h[f],n=this._measureText(t,o,i,l),l+=o.length,(r+=c+n-d)>=this.width&&!u?(s.push(a),r=n,u=!(a="")):r+=d,u||(a+=" "),a+=o,c=this._measureText(t," ",i,l),l++,u=!1,p<n&&(p=n);return f&&s.push(a),p>this.dynamicMinWidth&&(this.dynamicMinWidth=p-d),s},_splitTextIntoLines:function(t){t=t||this.ctx;var e=this.textAlign,i=(t.save(),this._setTextStyles(t),this.textAlign="left",this._wrapText(t,this.text));return this.textAlign=e,t.restore(),this._textLines=i,this._styleMap=this._generateStyleMap(),i},setOnGroup:function(t,e){"scaleX"===t&&(this.set("scaleX",Math.abs(1/e)),this.set("width",this.get("width")*e/(void 0===this.__oldScaleX?1:this.__oldScaleX)),this.__oldScaleX=e)},get2DCursorLocation:function(t){void 0===t&&(t=this.selectionStart);for(var e=this._textLines.length,i=0,o=0;o<e;o++){var n=this._textLines[o].length;if(t<=i+n)return{lineIndex:o,charIndex:t-i};i+=n,"\n"!==this.text[i]&&" "!==this.text[i]||i++}return{lineIndex:e-1,charIndex:this._textLines[e-1].length}},_getCursorBoundariesOffsets:function(t,e){for(var i=0,o=0,n=this.get2DCursorLocation(),r=this._textLines[n.lineIndex].split(""),s=this._getLineLeftOffset(this._getLineWidth(this.ctx,n.lineIndex)),a=0;a<n.charIndex;a++)o+=this._getWidthOfChar(this.ctx,r[a],n.lineIndex,a);for(a=0;a<n.lineIndex;a++)i+=this._getHeightOfLine(this.ctx,a);return"cursor"===e&&(i+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,n.lineIndex)/this.lineHeight-this.getCurrentCharFontSize(n.lineIndex,n.charIndex)*(1-this._fontSizeFraction)),{top:i,left:o,lineLeft:s}},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},toObject:function(t){return this.callSuper("toObject",["minWidth"].concat(t))}}),i.Textbox.fromObject=function(t,e){t=new i.Textbox(t.text,o(t));return e&&e(t),t},i.Textbox.getTextboxControlVisibility=function(){return{tl:!1,tr:!1,br:!1,bl:!1,ml:!0,mt:!1,mr:!0,mb:!1,mtr:!0}}}("undefined"!=typeof exports?exports:this),!function(){var l=fabric.Canvas.prototype._setObjectScale,r=(fabric.Canvas.prototype._setObjectScale=function(t,e,i,o,n,r,s){var a,h=e.target;return h instanceof fabric.Textbox?(a=h.width*(t.x/e.scaleX/(h.width+h.strokeWidth)))>=h.getMinWidth()?(h.set("width",a),!0):void 0:l.call(fabric.Canvas.prototype,t,e,i,o,n,r,s)},fabric.Group.prototype._refreshControlsVisibility=function(){if(void 0!==fabric.Textbox)for(var t=this._objects.length;t--;)if(this._objects[t]instanceof fabric.Textbox)return void this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility())},fabric.util.object.clone);fabric.util.object.extend(fabric.Textbox.prototype,{_removeExtraneousStyles:function(){for(var t in this._styleMap)this._textLines[t]||delete this.styles[this._styleMap[t].line]},insertCharStyleObject:function(t,e,i){var o=this._styleMap[t];t=o.line,e=o.offset+e,fabric.IText.prototype.insertCharStyleObject.apply(this,[t,e,i])},insertNewlineStyleObject:function(t,e,i){var o=this._styleMap[t];t=o.line,e=o.offset+e,fabric.IText.prototype.insertNewlineStyleObject.apply(this,[t,e,i])},shiftLineStyles:function(t,e){var i,o=r(this.styles);for(i in t=this._styleMap[t].line,this.styles){var n=parseInt(i,10);t<n&&(this.styles[n+e]=o[n],o[n-e]||delete this.styles[n])}},_getTextOnPreviousLine:function(t){for(var e=this._textLines[t-1];this._styleMap[t-2]&&this._styleMap[t-2].line===this._styleMap[t-1].line;)e=this._textLines[t-2]+e,t--;return e},removeStyleObject:function(t,e){var e=this.get2DCursorLocation(e),i=this._styleMap[e.lineIndex],o=i.line,i=i.offset+e.charIndex;this._removeStyleObject(t,e,o,i)}})}(),!function(){var h=fabric.IText.prototype._getNewSelectionStartFromOffset;fabric.IText.prototype._getNewSelectionStartFromOffset=function(t,e,i,o,n){o=h.call(this,t,e,i,o,n);for(var r=0,s=0,a=0;a<this._textLines.length&&!(o<=(r+=this._textLines[a].length)+s);a++)"\n"!==this.text[r+s]&&" "!==this.text[r+s]||s++;return o-a+s}}(),!function(){var DOMParser,URL,HTTP,HTTPS,Canvas,Image,originaInitStatic,origSetBackstoreDimension;function request(t,o,n){var e=URL.parse(t);e.port||(e.port=0===e.protocol.indexOf("https:")?443:80);t=(0===e.protocol.indexOf("https:")?HTTPS:HTTP).request({hostname:e.hostname,port:e.port,path:e.path,method:"GET"},function(e){var i="";o&&e.setEncoding(o),e.on("end",function(){n(i)}),e.on("data",function(t){200===e.statusCode&&(i+=t)})});t.on("error",function(t){t.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+e.hostname+":"+e.port):fabric.log(t.message),n(null)}),t.end()}function requestFs(t,i){require("fs").readFile(t,function(t,e){if(t)throw fabric.log(t),t;i(e)})}"undefined"!=typeof document&&"undefined"!=typeof window||(DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image,fabric.util.loadImage=function(e,i,o){function t(t){t?(n.src=new Buffer(t,"binary"),n._src=e,i&&i.call(o,n)):(n=null,i&&i.call(o,null,!0))}var n=new Image;e&&(e instanceof Buffer||0===e.indexOf("data"))?(n.src=n._src=e,i&&i.call(o,n)):e&&0!==e.indexOf("http")?requestFs(e,t):e?request(e,"binary",t):i&&i.call(o,e)},fabric.loadSVGFromURL=function(t,e,i){0!==(t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim()).indexOf("http")?requestFs(t,function(t){fabric.loadSVGFromString(t.toString(),e,i)}):request(t,"",function(t){fabric.loadSVGFromString(t,e,i)})},fabric.loadSVGFromString=function(t,i,e){t=(new DOMParser).parseFromString(t);fabric.parseSVGDocument(t.documentElement,function(t,e){i&&i(t,e)},e)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.createCanvasForNode=function(t,e,i,o){o=o||i;var n=fabric.document.createElement("canvas"),r=new Canvas(t||600,e||600,o),t=new Canvas(t||600,e||600,o);n.style={},n.width=r.width,n.height=r.height,(i=i||{}).nodeCanvas=r,i.nodeCacheCanvas=t;e=new(fabric.Canvas||fabric.StaticCanvas)(n,i);return e.nodeCanvas=r,e.nodeCacheCanvas=t,e.contextContainer=r.getContext("2d"),e.contextCache=t.getContext("2d"),e.Font=Canvas.Font,e},originaInitStatic=fabric.StaticCanvas.prototype._initStatic,fabric.StaticCanvas.prototype._initStatic=function(t,e){t=t||fabric.document.createElement("canvas"),this.nodeCanvas=new Canvas(t.width,t.height),this.nodeCacheCanvas=new Canvas(t.width,t.height),originaInitStatic.call(this,t,e),this.contextContainer=this.nodeCanvas.getContext("2d"),this.contextCache=this.nodeCacheCanvas.getContext("2d"),this.Font=Canvas.Font},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(t){return this.nodeCanvas.createJPEGStream(t)},fabric.StaticCanvas.prototype._initRetinaScaling=function(){if(this._isRetinaScaling())return this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.nodeCanvas.width=this.width*fabric.devicePixelRatio,this.nodeCanvas.height=this.height*fabric.devicePixelRatio,this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio),this},fabric.Canvas&&(fabric.Canvas.prototype._initRetinaScaling=fabric.StaticCanvas.prototype._initRetinaScaling),origSetBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension,fabric.StaticCanvas.prototype._setBackstoreDimension=function(t,e){return origSetBackstoreDimension.call(this,t,e),this.nodeCanvas[t]=e,this},fabric.Canvas&&(fabric.Canvas.prototype._setBackstoreDimension=fabric.StaticCanvas.prototype._setBackstoreDimension))}(),DrawerJs={plugins:{},util:{},utilPlugins:{},brushes:{},texts:{"Add Drawer":"Add Drawer","Insert Drawer":"Insert Drawer",Insert:"Insert","Free drawing mode":"Free drawing mode",SimpleWhiteEraser:"SimpleWhiteEraser",Eraser:"Eraser","Delete this canvas":"Delete this canvas","Are you sure want to delete this canvas?":"Are you sure want to delete this canvas?","Size (px)":"Size (px)",Position:"Position",Inline:"Inline",Left:"Left",Center:"Center",Right:"Right",Floating:"Floating","Canvas properties":"Canvas properties",Background:"Background",transparent:"transparent",Cancel:"Cancel",Save:"Save","Enter fullscreen mode":"Enter fullscreen mode","Exit fullscreen mode":"Exit fullscreen mode","Bring forward":"Bring forward","Send backwards":"Send backwards","Bring to front":"Bring to front","Send to back":"Send to back",Duplicate:"Duplicate",Remove:"Remove","Size:":"Size:","Fill:":"Fill:",Transparent:"Transparent","Border:":"Border:",None:"None","Draw an arrow":"Draw an arrow","Draw a two-sided arrow":"Draw a two-sided arrow","Lines and arrows":"Lines and arrows","Draw a circle":"Draw a circle","Draw a line":"Draw a line","Draw a rectangle":"Draw a rectangle","Draw a triangle":"Draw a triangle","Draw a Polygon":"Draw a Polygon","Stop drawing a polygon":"Stop drawing a polygon (esc)","Click to start a new line":"Click to start a new line","Draw a text":"Draw a text","Click to place a text":"Click to place a text","Font:":"Font:","Move canvas":"Move canvas","Click to start drawing a ":"Click to start drawing a "}},!function(t,r){"use strict";fabric.util.getPointer,fabric.util.degreesToRadians;var n=fabric.util.radiansToDegrees,s=Math.atan2;Math.abs;t.Canvas=fabric.util.createClass(fabric.Canvas,{initialize:function(t,e){e=e||{},this.preserveObjectStacking=!0,this.callSuper("initialize",t,e)},disableSelection:function(){var t=null,e=this.getObjects();this.deactivateAll();for(var i=0;i<e.length;i++)void 0===(t=e[i]).__evented&&(t.__evented=t.get("evented"),t.set("evented",!1)),void 0===t.__selectable&&(t.__selectable=t.get("selectable"),t.set("selectable",!1))},restoreSelection:function(){for(var t=null,e=this.getObjects(),i=0;i<e.length;i++)void 0!==(t=e[i]).__evented&&(t.set("evented",t.__evented),delete t.__evented),void 0!==t.__selectable&&(t.set("selectable",t.__selectable),delete t.__selectable)},_renderObjects:function(t,e){var i,o,n;for(r.getTemporaryCanvas(this).getContext("2d").clearRect(0,0,this.width,this.height),this.eraserPaths=[],i=0,o=e.length;i<o;++i)(n=e[i])instanceof fabric.EraserPath||n.render(t)},_applyEraserPath:function(t,e){t.visible=!0,t.globalCompositeOperation="destination-out",t.render(e),t.visible=!1},_findNewLowerIndex:function(t,e,i){if(i){for(var o=e,n=e-1;0<=n;--n)if(!(this._objects[n]instanceof fabric.EraserPath))if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){o=n;break}}else o=e-1;return o},_findNewUpperIndex:function(t,e,i){if(i){for(var o=e,n=e+1;n<this._objects.length;++n)if(!(this._objects[n]instanceof fabric.EraserPath))if(t.intersectsWithObject(this._objects[n])||t.isContainedWithinObject(this._objects[n])||this._objects[n].isContainedWithinObject(t)){o=n;break}}else o=e+1;return o},_rotateObject:function(t,e){var i,o=this._currentTransform;if(!o.target.get("lockRotation"))return i=s(o.ey-o.top,o.ex-o.left),e=s(e-o.top,t-o.left),t=n(e-i+o.theta),o.target.set("angle",(t=t<0?360+t:t)%360),!0}})}(DrawerJs,DrawerJs.util),!function(l,c){"use strict";var n,r,t,e,s,a=null;function h(t){var e={originalEvent:t=t||window.event,target:t.target||t.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,deltaY:0,deltaZ:0,preventDefault:function(){t.preventDefault?t.preventDefault():t.returnValue=!1}};return"mousewheel"==s?(e.deltaY=-.025*t.wheelDelta,t.wheelDeltaX&&(e.deltaX=-.025*t.wheelDeltaX)):e.deltaY=t.deltaY||t.detail,callback(e)}function o(t,e,i,o){e=r+e,i="wheel"==s?i:h,t[n](e,i,o||!1)}c.setDrawerFolderUrl=function(t){a=t.replace(/\/*$/g,"")+"/"},c.getDrawerFolderUrl=function(){if(a)return a;for(var t=document.getElementsByTagName("script"),e=/dist\/(drawer.+\.js)+$/,i=0;i<t.length;i++){var o=t.item(i);if(o.src){var n=o.src.match(e);if(n)return o.src.replace(n[1],"")}}return""},c.unbindClick=function(t,e){e+="drawerBindClick";l(t).off("click."+e),l(t).off("touchstart."+e),l(t).off("touchend."+e)},c.bindClick=function(o,t,n){var r=t+"drawerBindClick";l(o).on("click."+r,function(t){var e=null;if(this.__lastClickTime){if(500<Date.now()-this.__lastClickTime){try{e=n.apply(this,[t])}catch(t){var i="Catched error - click."+r;console.groupCollapsed(i),console.log("%c[Event name]","color: green","click."+r),console.log("%c[Element]","color: green",o),console.error(t),console.groupEnd(i)}if(!1===e)return t.stopPropagation(),t.preventDefault(),!1}}else{try{e=n.apply(this,[t])}catch(t){i="Catched error - click."+r;console.groupCollapsed(i),console.log("%c[Event name]","color: green","click."+r),console.log("%c[Element]","color: green",o),console.error(t),console.groupEnd(i)}if(!1===e)return t.stopPropagation(),t.preventDefault(),!1}}),l(o).on("touchstart."+r,function(t){this.__drawerTouchStartEvent=t,l(o).off("click."+r)}),l(o).on("touchend."+r,function(t){var e;if(this.__drawerTouchStartEvent){if(Math.abs(this.__drawerTouchStartEvent.timeStamp-t.timeStamp)<300){this.__lastClickTime=Date.now();try{e=n.apply(this,[t])}catch(t){var i="Catched error - touchend."+r;console.groupCollapsed(i),console.log("%c[Event name]","color: green","touchend."+r),console.log("%c[Element]","color: green",this),console.error(t),console.groupEnd(i)}if(!1===e)return t.stopPropagation(),t.preventDefault(),!1}delete this.__drawerTouchStartEvent}})},c.bindDoubleTap=function(t,a,h){l(t).on("touchend."+a,function(t){var e=this;if(e.__touchEndTime){var i,o=Date.now()-e.__touchEndTime,n=c.getEventPosition(t),r=Math.abs(e.__touchEndX-n.left),s=Math.abs(e.__touchEndY-n.top);if(o<500&&r<20&&s<20){delete e.__touchEndTime,delete e.__touchEndX,delete e.__touchEndY;try{i=h.apply(e,[t])}catch(t){o="Catched error - touchend(doubleTap)."+a;console.groupCollapsed(o),console.log("%c[Event name]","color: green","touchend(doubleTap)."+a),console.log("%c[Element]","color: green",e),console.error(t),console.groupEnd(o)}if(!1===i)return t.stopPropagation(),t.preventDefault(),!1}else delete e.__touchEndTime,delete e.__touchEndX,delete e.__touchEndY}else e.__touchEndTime=Date.now(),n=c.getEventPosition(t),e.__touchEndX=n.left,e.__touchEndY=n.top,c.setTimeout(function(){delete e.__touchEndTime,delete e.__touchEndX,delete e.__touchEndY},500)})},c.bindLongPress=function(t,e,n){var r=e+"drawerBindLongPress";l(t).on("touchstart."+r,function(t){function i(){delete o.__touchStartTime,delete o.__touchStartX,delete o.__touchStartY,l(o).off("touchmove."+r),l(o).off("touchend."+r)}var o=this,e=(o.__touchStartTime=Date.now(),c.getEventPosition(t));o.__touchStartX=e.left,o.__touchStartY=e.top,o.__longPressCheckTimeout&&clearTimeout(o.__longPressCheckTimeout);return l(o).on("touchmove."+r,function(t){var e,t=c.getEventPosition(t);o.__touchStartTime&&(e=Math.abs(o.__touchStartX-t.left),t=Math.abs(o.__touchStartY-t.top),10<e||10<t)&&i()}),l(o).on("touchend."+r,function(t){i()}),o.__longPressCheckTimeout=setTimeout(function(){if(o.__touchStartTime){i();try{n.apply(o,[t])}catch(t){var e="Catched error - touchstart(bindLongPress)."+r;console.groupCollapsed(e),console.log("%c[Event name]","color: green","touchstart(bindLongPress)."+r),console.log("%c[Element]","color: green",o),console.error(t),console.groupEnd(e)}}},1e3),!0})},c.unbindLongPress=function(t,e){e+="drawerBindLongPress";l(t).off("touchstart."+e),l(t).off("touchmove."+e),l(t).off("touchend."+e)},c.mouseDown=function(t){return"mousedown."+t+this.id+" touchstart."+t+this.id},c.mouseMove=function(t){return"mousemove."+t+this.id+" touchmove."+t+this.id},c.mouseUp=function(t){return"mouseup."+t+this.id+" touchend."+t+this.id},c.getTransitionDuration=function(t,e){var t=window.getComputedStyle(t),i=t.webkitTransitionDuration,t=t.webkitTransitionDelay,i=-1<i.indexOf("ms")?parseFloat(i):1e3*parseFloat(i),t=-1<t.indexOf("ms")?parseFloat(t):1e3*parseFloat(t);return e?i+t:i},c.getEventPosition=function(t,e){function r(t,e){var i,o,n;return t&&(i=(n=-1<t.type.indexOf("touch"))&&t.touches&&t.touches.length,o=c.eventCoordsAreValid(t),n=n&&i&&!o?t:!e&&r(t.originalEvent,!0)),n}var i,o,n,s,a={};return a=t&&(e=e||0,s=(i=r(t))&&c.eventCoordsAreValid(i.touches[e]),o=c.eventCoordsAreValid(t),n=t&&t.originalEvent&&c.eventCoordsAreValid(t.originalEvent),s=s&&i.touches[e]||o&&t||n&&t.originalEvent)?{left:s.pageX,top:s.pageY}:a},c.eventCoordsAreValid=function(t){var e,i;return t&&(i=0!==t.pageX&&0!==t.pageY,t=(e="number"==typeof t.pageX&&"number"==typeof t.pageY)&&isFinite(t.pageX)&&isFinite(t.pageY),i=i&&e&&t),i},c.isShape=function(t){return(!t.type||"line"!=t.type&&"arrow"!=t.type)&&!t.path},c.__temporaryCanvas=null,c.__latestValidCanvasWidth=null,c.__latestValidCanvasHeight=null,c.getTemporaryCanvas=function(t){c.__temporaryCanvas||(c.__temporaryCanvas=document.createElement("canvas"));var e=t.width,t=t.height,e=e||c.__latestValidCanvasWidth||1,t=t||c.__latestValidCanvasHeight||1;return c.__temporaryCanvas.setAttribute("width",e),c.__temporaryCanvas.setAttribute("height",t),c.__latestValidCanvasWidth=e,c.__latestValidCanvasHeight=t,c.__temporaryCanvas},c.LastCoordsQueue=function(){this.coordsQueue=[],this.length=10,this.pushCoords=function(t,e){this.coordsQueue.length>this.length&&(this.coordsQueue=this.coordsQueue.slice(this.coordsQueue.length-this.length)),this.coordsQueue.push({x:t,y:e})},this.getInterpolatedValues=function(){if(0===this.coordsQueue.length)return[];if(1===this.coordsQueue.length)return[{x:this.coordsQueue[0].x,y:this.coordsQueue[0].y}];for(var t=[],e=this.coordsQueue[this.coordsQueue.length-2].x,i=this.coordsQueue[this.coordsQueue.length-2].y,o=this.coordsQueue[this.coordsQueue.length-1].x-e,n=this.coordsQueue[this.coordsQueue.length-1].y-i,r=Math.abs(o),s=Math.abs(n),a=s<r?r:s,h=0;h<a;h++)t.push({x:e+o/a*h,y:i+n/a*h});return t}},c.addCSSRule=function(t,e,i,o){t&&("insertRule"in t?t.insertRule(e+"{"+i+"}",o):"addRule"in t&&t.addRule(e,i,o))},c.addStyleToStyleSheet=function(t,e,i,o,n){var r=i&&i instanceof jQuery&&i.length,s="string"==typeof i&&l(i).length&&l(i),a=i instanceof Node&&l(i).length&&l(i),r=r||s||a;r?c.addCSSRule(r[0].sheet,t,e):o?(s=document.head||document.getElementsByTagName("head")[0],(a=document.createElement("style")).type="text/css",a.id=i,s.appendChild(a),c.addCSSRule(a.sheet,t,e)):n&&c.addStyle(t+"{"+e+"}")},c.addStyle=function(t){var e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i)},c.isString=function(t){return"string"==typeof t||t instanceof String},c.getScrollTopFromElement=function(t){for(var e=t,i={left:0,top:0},o=!0;o;){var o=e&&e.length&&!e.is("body"),n=e.scrollTop(),r=e.scrollLeft();i.top+=n,i.left+=r,e=e.parent()}return i.top+=l(document).scrollTop(),i.left+=l(document).scrollLeft(),i},c.debounce=function(o,n,r){var s;return n=n||0,function(){var t=this,e=arguments,i=r&&!s;clearTimeout(s),s=c.setTimeout(function(){s=null,r||o.apply(t,e)},n),i&&o.apply(t,e)}},c.loadImage=function(e,t,i,o){i=i||{};var n=t||new Image;return n.style.opacity=0,new Promise(function(t){n.src===e?t(n,i):(n.removeAttribute("crossOrigin"),!o&&e.match(/^https?:\/\/|^\/\//)&&n.setAttribute("crossOrigin","anonymous"),n.onload=function(){c.setTimeout(function(){t(n,i)},1)},n.src=e)})},c.checkBrowser=function(t){var e=navigator.userAgent.toLowerCase(),e=/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0<=e.indexOf("trident")&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"safari"==t?void 0!==e[3]&&"safari"==e[3]:"version"==t?e[2]:"webkit"==t?"chrome"==e[1]||"opr"==e[1]||"webkit"==e[1]:"rv"==e[1]?"msie"==t:"opr"==e[1]?"webkit"==t:t==e[1]},c.getScrollOffset=function(t){var e={},i=!0,o=t,n=0,r=0;if(t&&t.length)for(;i;)i=(o=o.parent())&&o.length&&!o.is("body"),n+=o.scrollLeft(),r+=o.scrollTop();return e.left=n,e.top=r,e},c.setTimeout=function(t,e,i){var o=new Error("Parent stack").stack;return window.setTimeout(function(){try{t.apply(window,arguments)}catch(t){var e="Catched error - setTimeout";console.groupCollapsed(e),console.log("%c[Parent stack]","color: green",o),console.log("%c[Error stack]","color: green",t.stack),console.error(t),console.groupEnd(e)}},e,i)},r="",window.addEventListener?n="addEventListener":(n="attachEvent",r="on"),t="onwheel"in document.createElement("div")&&"wheel",e=void 0!==document.onmousewheel&&"mousewheel",s=t||e||"DOMMouseScroll",c.addWheelListener=function(t,e,i){o(t,s,e,i),"DOMMouseScroll"==s&&o(t,"MozMousePixelScroll",e,i)},c.requestAnimationFrame=window.requestAnimationFrame.bind(window)||window.mozRequestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame.bind(window)||window.msRequestAnimationFrame.bind(window)||function(t){t()},c.cancelAnimationFrame=window.cancelAnimationFrame.bind(window)||window.mozCancelAnimationFrame.bind(window)||function(){}}(jQuery,DrawerJs.util),!function(){function t(t){if(!t)throw new Error("DrawerApi(): no drawer is provided!");this.drawer=t}t.prototype.drawer=null,t.prototype.checkIsActive=function(){if(this.drawer.mode!=this.drawer.MODE_ACTIVE)throw new Error("Drawer is not active!")},t.prototype.startEditing=function(){this.drawer._startEditing()},t.prototype.stopEditing=function(){this.drawer._stopEditing()},t.prototype.getCanvasAsJSON=function(){return this.drawer.api.checkIsActive(),this.drawer.getSerializedCanvas()},t.prototype.saveCanvas=function(){this.drawer.api.checkIsActive(),this.drawer.syncCanvasData()},t.prototype.loadCanvasFromData=function(t){this.drawer.loadCanvas(t)},t.prototype.getCanvasAsImage=function(){return this.drawer.getImageData()},t.prototype.saveCanvasImage=function(){this.drawer.api.checkIsActive(),this.drawer.syncImageData()},t.prototype.getSize=function(){return this.drawer.getSize()},t.prototype.setSize=function(t,e){this.drawer.setSize(t,e)},t.prototype.setActiveColor=function(t){this.drawer.setActiveColor(t)},t.prototype.createText=function(t,e,i,o){this.drawer._pluginsInstances.Text.addShape(t,e,i,o)},t.prototype.updateOptions=function(t){this.drawer.updateOptions(t)},t.prototype.setOptions=function(t){this.drawer.setOptions(t)},t.prototype.loadPlugin=function(t){this.drawer.loadPlugin(t)},t.prototype.unloadPlugin=function(t){this.drawer.unloadPlugin(t)},DrawerJs.DrawerApi=t}(DrawerJs),!function(t){t.prototype._checkObject=function(t){if(!t)throw new Error("[Drawer API]  no object provided!");if(!(t instanceof fabric.Object))throw new Error("[Drawer API]  object type is not 'fabric.Object!'")},t.prototype.getSelectedObject=function(){return this.drawer.fCanvas.getActiveObject()},t.prototype.bringObjectForward=function(t){return this._checkObject(t),this.drawer.fCanvas.bringForward(t,!0),this.drawer.syncCanvasData(),t},t.prototype.sendObjectBackwards=function(t){return this._checkObject(t),this.drawer.fCanvas.sendBackwards(t,!0),this.drawer.syncCanvasData(),t},t.prototype.bringObjectToFront=function(t){return this._checkObject(t),this.drawer.fCanvas.bringToFront(t,!0),this.drawer.syncCanvasData(),t},t.prototype.sendObjectToBack=function(t){return this._checkObject(t),this.drawer.fCanvas.sendToBack(t),this.drawer.syncCanvasData(),t},t.prototype.removeObject=function(t){this._checkObject(t),t.remove(),this.drawer.fCanvas.renderAll()},t.prototype.duplicateObject=function(e,i){this._checkObject(e);function t(t){if(t)return t.set("left",e.get("left")+20),t.set("top",e.get("top")+20),o.drawer.fCanvas.add(t),o.drawer.fCanvas.renderAll(),i&&i(t),t;throw new Error("[Drawer API] duplicateObject() : Clone failed! Clone source: "+e.toString())}var o=this;if(!e.async)return t(e.clone());e.clone(t)}}(DrawerJs.DrawerApi),!function(r,s,a,h){"use strict";function t(t,e,i,o){var n=this;if(this.mode=this.MODE_INACTIVE,this.redactorInstance=t,this.id=Math.random().toString().replace("0.",""),this.width=i||0,this.height=o||0,this._eventEmitter=r({}),this.api=new s.DrawerApi(this),this.setOptions(e),this.$imageElement=null,this.$canvasEditContainer=null,this.aligmentCss={},this.toolbars=new DrawerToolbarManager(this),n.options.detectTouch){if("Function"!==n.options.detectTouch.constructor.name)throw new Error("detectTouch should be a function which will be called when Drawer needs to determine whether it is working on touch device");n.touchDevice=n.options.detectTouch(n)}else n.touchDevice=/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent),r("body").on("touchstart.DrawerTouchCheck",function(){n.touchDevice=!0,r("body").off("touchstart.DrawerTouchCheck"),n.log("touch","Found touch screen")});if(n.$canvasDataContainer=null,n.options.contentConfig.canvasDataContainer&&(n.$canvasDataContainer=r(n.options.contentConfig.canvasDataContainer),n.$canvasDataContainer.length<1))throw n.$canvasDataContainer=null,new Error("contentConfig.canvasDataContainer provided but not found in DOM: "+n.options.contentConfig.canvasDataContainer);if(n.$imagesContainer=null,n.options.contentConfig.imagesContainer&&(n.$imagesContainer=r(n.options.contentConfig.imagesContainer),n.$imagesContainer.length<1))throw n.$imagesContainer=null,new Error("contentConfig.imagesContainer provided but not found in DOM: "+n.options.contentConfig.imagesContainer);return t=".editable-canvas-not-edited {background: url("+this.options.defaultImageUrl+") no-repeat !important;background-size: contain !important;}",h.addStyle(t),this}t.prototype.api={},t.prototype.MODE_PREPARING="mode:preparing",t.prototype.MODE_ACTIVE="mode:active",t.prototype.MODE_INACTIVE="mode:inactive",t.prototype.setOptions=function(t){this.options=r.extend(!0,this.defaultOptions||{},t||{}),this.onOptionsUpdated(!0)},t.prototype.getPluginConfig=function(t){var e={},i=t&&"string"==typeof t&&t.length,o=i&&this.options.pluginsConfig[t],i=i&&this.options.pluginsConfig.Text&&this.options.pluginsConfig.Text[t];return o&&(e=r.extend(!0,e,o)),e=i?r.extend(!0,e,i):e},t.prototype.updateOptions=function(t){this.options=r.extend(!0,this.options,t=t||{});var e=!1;t.plugins&&(this.options.plugins=t.plugins,e=!0),this.onOptionsUpdated(e)},t.prototype.onOptionsUpdated=function(t){this.options.basePath&&h.setDrawerFolderUrl(this.options.basePath),this.options.canvasProperties.rotationCursor="url("+h.getDrawerFolderUrl()+"assets/cursor-fa-rotate-right.cur), default",this.activeColor||(this.activeColor=this.options.activeColor||this.defaultOptions.activeColor),void 0===this.activeOpacity&&(this.activeOpacity=this.options.activeOpacity||this.defaultOptions.activeOpacity),t&&(this.loadPlugins(),this.toolbars)&&this.toolbars.resetAllToolbars()},t.prototype.unloadPlugins=function(){for(var t in this._pluginsInstances)this.unloadPlugin(t)},t.prototype.unloadPlugin=function(t){var e;this._pluginsInstances.hasOwnProperty(t)&&((e=this._pluginsInstances[t]).removeTool&&e.removeTool(!0),delete this._pluginsInstances[t])},t.prototype.loadPlugin=function(e){if(e&&a[e]){var t=this._pluginsInstances[e],i=this.options.corePlugins&&-1!==this.options.corePlugins.indexOf(e);if(t)i||this.error("Drawer: Load plugin error - "+e+". Plugin should not be specified multiple times.");else try{var o={},n=(this.options.pluginsConfig[e]&&(o=this.options.pluginsConfig[e]),new a[e](this,o));this._pluginsInstances[e]=n}catch(t){this.error("Drawer: Load plugin error - "+e+"."),this.error(t)}}else this.error("Drawer: Load plugin error - "+e+". No such plugin.")},t.prototype.loadPlugins=function(){if(this._pluginsInstances?this.unloadPlugins():this._pluginsInstances={},this.options.corePlugins)for(var t=0;t<this.options.corePlugins.length;t++)this.loadPlugin(this.options.corePlugins[t]);if(this.options.plugins)for(var e=0;e<this.options.plugins.length;e++)this.loadPlugin(this.options.plugins[e])},t.prototype.log=function(t,e){this.options.debug&&console.log("%c["+t+"]","color: green",e)},t.prototype.error=function(t){this.options.debug&&console.error(t)},t.prototype.clickEvent=function(t){return"click."+t+" touchend."+t},t.prototype.getHtml=function(){var t=r("<img>").css({display:"inline-block",width:this.width||this.options.defaultWidth,height:this.height||this.options.defaultHeight,background:this.options.backgroundCss}).addClass("editable-canvas-image").addClass("editable-canvas-not-edited").attr("id","canvas_image_"+this.id).attr("data-redactor-drawer-enabled",!0).attr("src","");return this.options.borderCss&&t.css("border",this.options.borderCss),r(t)[0].outerHTML},t.prototype.updateAligmentCss=function(){this.aligmentCss=this.getAligmentCssFor(this.$imageElement)},t.prototype.getAligmentCssFor=function(t){var e=window.getComputedStyle(t[0]),e={display:e.display,float:e.float,"margin-left":e.marginLeft,"margin-right":e.marginRight,position:e.position,left:e.left,top:e.top};return t.attr("data-margin-left")&&(e["margin-left"]=t.attr("data-margin-left")),t.attr("data-margin-right")&&(e["margin-right"]=t.attr("data-margin-right")),e},t.prototype.setAligmentCssFor=function(t,e){"none"==t.css("display")&&delete e.display,t.css(e),e["margin-left"]&&"auto"==e["margin-left"]&&(t.css("margin-left","auto"),t.attr("data-margin-left","auto")),e["margin-right"]&&"auto"==e["margin-right"]&&(t.css("margin-right","auto"),t.attr("data-margin-right","auto"))},t.prototype.onInsert=function(){var e=this,t=(r(document).off(this.clickEvent("DrawerStop"+this.id)),!this.$imageElement);this.$imageElement=r(document.getElementById("canvas_image_"+this.id)),this.$imageElement.parent().css({position:"relative"}),t&&(this.options.align?this.aligmentCss=this._generateAlignCss(this.options.align):this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.width=this.$imageElement.outerWidth(),this.height=this.$imageElement.outerHeight(),this.$imageElement.removeClass("edit-mode")),this.$imageElement.attr("src").length<1&&!this.$imageElement.hasClass("editable-canvas-not-edited")&&(this.$imageElement.attr("src",this.getImageData()),this.$imageElement.removeClass("editable-canvas-not-edited")),this.setAligmentCssFor(this.$imageElement,this.aligmentCss),this.options.editOnClick?(this.$imageElement.off(),h.bindClick(this.$imageElement,"Drawer",function(t){e._startEditing()})):(this.$imageElement.off(e.clickEvent("Drawer")),this.$imageElement.on(e.clickEvent("Drawer"),function(){e.drawCanvasControls()})),h.bindClick(r(document),"Drawer",this._globalClickHandler.bind(this)),this.on(this.EVENT_OPTIONS_CHANGED,this.onOptionsChange.bind(this)),this.on(this.EVENT_CANVAS_READY,this.onOptionsChange.bind(this))},t.prototype._globalClickHandler=function(t){var e=r(t.target).parents("#redactor-drawer-box");return 0<e.length?e.attr("data-canvas-id")==this.id:t.target.id!="canvas_image_"+this.id&&!("redactor-image-editter"==t.target.id&&r(t.target).attr("data-canvas-id")==this.id||0<r(t.target).parents("#redactor-modal").length)&&void(!this.$canvasEditContainer||!this.options.exitOnOutsideClick||this.resizingNow||this.croppingNow||this.movingNow||this.fullscreenMode||this.drawingInProgress||this.isBrushDrawing||this._stopEditing())},t.prototype.drawCanvasControls=function(){var t=this,e=r("#redactor-image-editter");e.attr("data-canvas-id",this.id),e.text("Edit in Drawer"),e.css("margin-left","-"+e.innerWidth()/2+"px"),e.off("click"),e.on("click",function(){t._startEditing()})},t.prototype._startEditing=function(){this.log("canvasEditMode","startEditing()");var t,e,i=this;this.mode!=this.MODE_INACTIVE?this.log("Drawer.startEditing(): already in active mode"):(this.mode=this.MODE_PREPARING,i.redactorInstance&&i.redactorInstance.$editor.attr("contenteditable","false"),i._previousFocusedElement=document.activeElement,r(document.activeElement).blur(),this.width=this.$imageElement.outerWidth(),this.height=this.$imageElement.outerHeight(),this.$imageElement.addClass("edit-mode"),this.$imageElement.removeClass("editable-canvas-not-edited"),t=r('<canvas width="'+this.width+'" height="'+this.height+'" />'),this.$canvasEditContainer=r("<span></span>"),this.$canvasEditContainer.attr({id:"redactor-drawer-box",class:"drawer-instance-container","data-canvas-id":this.id,tabindex:"0"}),this.options.borderCss&&this.$canvasEditContainer.css("border",this.options.borderCssEditMode),this.touchDevice&&this.$canvasEditContainer.addClass("touch"),this.$canvasEditContainer.css({position:"absolute"}),this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.$canvasEditContainer.append(t),this.$imageElement.parent().append(this.$canvasEditContainer),this.adjustEditContainer(),r(window).on("resize.drawer"+this.id,function(){i.adjustEditContainer(!1,!0)}),this.redactorInstance&&this.redactorInstance.image.hideResize(),e=this.getCanvasData(),this.fCanvas=new s.Canvas(t.get(0)),this.fCanvas.selection=!1,this.options&&this.options.canvasProperties&&r.each(this.options.canvasProperties,function(t,e){i.fCanvas[t]=e}),this.$canvasEditContainer.css("background",this.$imageElement.css("background")),this.loadCanvas(e))},t.prototype._stopEditing=function(){this.log("canvasEditMode","_stopEditing()"),this.mode==this.MODE_INACTIVE?this.log("canvasEditMode","_stopEditing(): already stopped, mode is INACTIVE"):(this.redactorInstance&&this.redactorInstance.$editor.attr("contenteditable","true"),this.trigger(this.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.fCanvas&&this.fCanvas.deactivateAll(),this.$imageElement.attr("src",this.getImageData()),this.$imageElement.removeClass("edit-mode"),this.$imageElement.removeClass("editable-canvas-not-edited"),this.syncCanvasData(),this.$imageElement.show(),this.$canvasEditContainer&&(this.$canvasEditContainer.remove(),this.$canvasEditContainer=null),r(window).off("resize.drawer"+this.id),this.trigger(this.EVENT_EDIT_STOP),this.mode=this.MODE_INACTIVE)},t.prototype.setActiveColor=function(t){var e=this.fCanvas.getActiveObject(),i=this.activeDrawingTool,o=this._pluginsInstances.Color,o=o&&o.colorControl;this.activeColor=t,this.options.activeColor=t,!e&&o&&o.setColor(t),i&&(i.brush=null,i._activateTool()),this.trigger(this.EVENT_CANVAS_MODIFIED)},t.prototype.setColor=function(t,e){var i;t&&(this.activeColor=t),void 0!==e&&(this.activeOpacity=e),this.fCanvas&&(t=this.fCanvas.getActiveObject(),this.setOpacity(this.activeOpacity,!0),t&&(e="line"===t.type||"arrow"===t.type,i=t.path,e||i?t.set("stroke",this.activeColor):t.set("fill",this.activeColor),this.fCanvas.renderAll()),this.fCanvas.freeDrawingBrush.color=this.activeColor,this.fCanvas.freeDrawingBrush.fill=this.activeColor,this.trigger(this.EVENT_CANVAS_MODIFIED))},t.prototype.setOpacity=function(t,e){t=void 0!==t?t:this.activeOpacity,this.activeOpacity=t;var i=this.fCanvas.getActiveObject();i&&i.set("opacity",t),this.fCanvas.freeDrawingBrush.opacity=t,e||(this.fCanvas.renderAll(),this.trigger(this.EVENT_CANVAS_MODIFIED))},t.prototype.setBrushSize=function(t){this.fCanvas&&(this.fCanvas.freeDrawingBrush.width=t),this.trigger(this.EVENT_BRUSH_SIZE_CHANGED)},t.prototype.getBrushSize=function(){var t=0;return t=this.fCanvas?this.fCanvas.freeDrawingBrush.width:t},t.prototype.setBrush=function(t){this.fCanvas.freeDrawingBrush=t,this.trigger(this.EVENT_BRUSH_CHANGED)},t.prototype.getBrush=function(){return this.fCanvas?this.fCanvas.freeDrawingBrush:null},t.prototype.getSize=function(){var t={},e=this.$canvasEditContainer,i=e&&e.get(0).getBoundingClientRect(),e=e&&h.getScrollOffset(e);return t.top=i?i.top:null,t.left=i?i.left:null,t.scrollTop=e?e.top:null,t.scrollLeft=e?e.left:null,t.width=this.width,t.height=this.height,t},t.prototype.setSize=function(t,e){this.width=t,this.height=e,this.fCanvas&&(this.fCanvas.setWidth(this.width),this.fCanvas.setHeight(this.height)),this.$imageElement.css("width",this.width),this.$imageElement.css("height",this.height),this.$canvasEditContainer&&(this.$canvasEditContainer.css("width",this.width),this.$canvasEditContainer.css("height",this.height)),this.adjustEditContainer(!1,!0)},t.prototype._generateAlignCss=function(t){var e={};switch(t){case"floating":e.position="absolute",e.display="block",e.float="none",e.left="0px",e.top="0px";break;case"center":e.float="none",e["margin-left"]="auto",e["margin-right"]="auto",e.display="block",e.position="static";break;case"left":case"right":e.display="block",e.float=t,e.position="static";break;default:e.float="none",e.display="inline-block",e.position="static"}return e},t.prototype.setAlign=function(t){t=this._generateAlignCss(t);this.setAligmentCssFor(this.$imageElement,t),this.aligmentCss=this.getAligmentCssFor(this.$imageElement),this.adjustEditContainer(),this.trigger(this.EVENT_CANVAS_MODIFIED)},t.prototype.getAlign=function(){var t="inline";return"absolute"==this.aligmentCss.position?t="floating":"left"==this.aligmentCss.float?t="left":"right"==this.aligmentCss.float?t="right":"block"==this.aligmentCss.display&&"auto"==this.aligmentCss["margin-left"]&&(t="center"),t},t.prototype.adjustEditContainer=function(t,e){if(!this.$canvasEditContainer)return!1;var i=this,o=this.$canvasEditContainer.hasClass("animated");this.$imageElement.offset();t||this.$canvasEditContainer.removeClass("animated"),this.$canvasEditContainer.css({top:0,left:0}),t||(e?i.$canvasEditContainer.toggleClass("animated",!!o):h.setTimeout(function(){i.$canvasEditContainer&&i.$canvasEditContainer.length&&i.$canvasEditContainer.toggleClass("animated",!!o)},0))},t.prototype.destroy=function(){this.trigger(this.EVENT_DESTROY),this._stopEditing(),this.$imageElement.remove(),this.syncCanvasData(!0),this.syncImageData(!0)},t.prototype.activateDefaultPlugin=function(){var t,e;this.options.defaultActivePlugin&&(t=this.options.defaultActivePlugin.name,"always"==(e=this.options.defaultActivePlugin.mode)||"lastUsed"==e||"onNew"==e&&0===this.fCanvas.getObjects().length)&&(this.log("defaultActivePlugin",e+"/"+t),this.lastUsedPluginName&&"lastUsed"==e&&(t=this.lastUsedPluginName),(e=this._pluginsInstances[t])?this.trigger(this.EVENT_DO_ACTIVATE_TOOL,[e]):this.log("WARNING","options['defaultActivePlugin']['name'] is '"+t+"', but no such plugin found."))},t.prototype.onCanvasModified=function(t){var e=this;if(void 0===t&&this.options.contentConfig.saveAfterInactiveSec)return void 0!==this.__activityTimer&&(e.log("saveAfterInactiveSec","Cleaning previous timeout"),clearTimeout(this.__activityTimer)),e.log("saveAfterInactiveSec","Setting up a timeout"),this.__activityTimer=h.setTimeout(function(){e.log("saveAfterInactiveSec","Timeout happened, triggering onCanvasModified"),e.onCanvasModified(!0)},1e3*this.options.contentConfig.saveAfterInactiveSec),!1;this.redactorInstance||this.beforeSync(),this.syncCanvasData(),this.syncImageData(),this.trigger(this.EVENT_CANVAS_MODIFIED),this.redactorInstance||this.afterSync()},t.prototype._updateObjectsControls=function(t){var e=this.options.objectControls;if(e=this.touchDevice&&this.options.objectControlsTouch?this.options.objectControlsTouch:e)for(var i in e)e.hasOwnProperty(i)&&t.set(i,e[i])},t.prototype.getPluginInstance=function(t){if(this._pluginsInstances[t])return this._pluginsInstances[t];throw new Error("Plugin not exists: "+t)},t.prototype.onOptionsChange=function(){this.options.transparentBackground?(this.$imageElement.css("background","transparent"),this.$canvasEditContainer.css("background","transparent")):(this.$imageElement.css("background","white"),this.$canvasEditContainer.css("background","white"))},t.prototype.t=function(t){return this.options.texts[t]||t},t.prototype.showError=function(t){alert(t)},t.prototype.left=function(){return 0|this.$canvasEditContainer.css("left").replace("px","")},t.prototype.top=function(){return 0|this.$canvasEditContainer.css("top").replace("px","")},t.prototype.setTemporaryStyles=function(t){var e,i=!!(t=t||!1)&&r.extend(!0,{},this.fCanvas._temporaryStyles||{},t||{});for(e in t)void 0===t[e]&&delete i[e];i?(this.fCanvas._temporaryStyles=i,this.fCanvas.copiedTextStyle={0:i},fabric.copiedTextStyle={0:i}):(this.fCanvas._temporaryStyles=i,this.fCanvas.copiedTextStyle=i,fabric.copiedTextStyle=i)},t.prototype.getRelativeEventPosition=function(t,e){var i={},t=h.getEventPosition(t),o=h.getScrollOffset(this.$canvasEditContainer),n=this.$canvasEditContainer.get(0).getBoundingClientRect();return i.top=t.top-n.top-o.top,i.left=t.left-n.left-o.left,i.scaledTop=i.top,i.scaledLeft=i.left,i},s.Drawer=t}(jQuery,DrawerJs,DrawerJs.plugins,DrawerJs.util,DrawerJs.texts),!function(t,e){t.prototype.defaultOptions={captionText:"Drawer",defaultWidth:"100%",defaultHeight:"500px",enableImageCrop:!0,editOnClick:!0,exitOnOutsideClick:!0,activeColor:"#E80F07",activeOpacity:1,toolbarSize:35,toolbarSizeTouch:45,toolbars:{popupButtonAlwaysVisible:!0,drawingTools:{position:"top"},toolOptions:{position:"bottom"},settings:{position:"right"}},tooltipCss:{background:"black",color:"white"},canvasProperties:{selectionColor:"rgba(255, 255, 255, 0.3)",selectionDashArray:[3,8],selectionLineWidth:1,selectionBorderColor:"#5f5f5f"},objectControls:{borderColor:"rgba(102,153,255,0.75)",borderOpacityWhenMoving:.4,cornerColor:"rgba(102,153,255,0.5)",cornerSize:12,hasBorders:!0},objectControlsTouch:{borderColor:"rgba(102,153,255,0.75)",borderOpacityWhenMoving:.4,cornerColor:"rgba(102,153,255,0.5)",cornerSize:20,hasBorders:!0},contentConfig:{saveAfterInactiveSec:null,saveInHtml:!0,canvasDataContainer:null,imagesContainer:null,loadCanvasData:null,saveCanvasData:null,loadImageData:null,saveImageData:null},backgroundCss:"white",borderCss:"1px dashed rgb(195, 194, 194)",borderCssEditMode:"1px dashed rgb(195, 194, 194)",defaultImageUrl:"images/drawer.jpg",plugins:[],pluginsConfig:{},corePlugins:["Zoom"],texts:e,basePath:null,debug:!1}}(DrawerJs.Drawer,(DrawerJs.util,DrawerJs.texts)),!function(t){t.prototype.EVENT_EDIT_START="editStart",t.prototype.EVENT_EDIT_STOP="editStop",t.prototype.EVENT_LOADED_FROM_JSON="loadedFromJson",t.prototype.EVENT_CANVAS_READY="ready",t.prototype.EVENT_CANVAS_START_RESIZE="canvas:resize:start",t.prototype.EVENT_BEFORE_RENDER="before:render",t.prototype.EVENT_AFTER_RENDER="after:render",t.prototype.EVENT_CANVAS_RESIZING="canvas:resize:resizing",t.prototype.EVENT_CANVAS_STOP_RESIZE="canvas:resize:stop",t.prototype.EVENT_BRUSH_SIZE_CHANGED="brushSizeChanged",t.prototype.EVENT_BRUSH_CHANGED="brushChanged",t.prototype.EVENT_DO_ACTIVATE_TOOL="activateTool",t.prototype.EVENT_DO_DEACTIVATE_TOOL="deactivateTool",t.prototype.EVENT_DO_DEACTIVATE_ALL_TOOLS="deactivateAllTools",t.prototype.EVENT_OPTIONS_CHANGED="options.changed",t.prototype.EVENT_DESTROY="destroy",t.prototype.EVENT_TOOL_ACTIVATED="toolActivated",t.prototype.EVENT_TOOL_DEACTIVATED="toolDeactivated",t.prototype.EVENT_TOOLS_TOOLBAR_CREATED="toolsToolbarCreated",t.prototype.BEFORE_CREATE_TOOLBARS="beforeCreateToolbars",t.prototype.AFTER_CREATE_TOOLBARS="afterCreateToolbars",t.prototype.EVENT_OPTIONS_TOOLBAR_CREATED="optionsToolbarCreated",t.prototype.EVENT_CONFIG_TOOLBAR_CREATED="configToolbarCreated",t.prototype.EVENT_IMAGECROP_TOOLBAR_CREATED="imageCropToolbarCreated",t.prototype.EVENT_FLOATING_TOOLBAR_CREATED="floatingToolbarCreated",t.prototype.EVENT_MINIMIZED_TOOLBAR_CREATED="minimizedToolbarCreated",t.prototype.EVENT_TOOLBAR_DESTROYED="toolbarDestroyed",t.prototype.EVENT_TOOLBAR_CHANGE_STATE="toolbarChangeState",t.prototype.EVENT_TOOLBAR_CLEAR_STATE="toolbarClearState",t.prototype.EVENT_TOOLBAR_STATE_HIDDEN_OFF="toolbarShow",t.prototype.EVENT_TOOLBAR_STATE_HIDDEN_ON="toolbarHide",t.prototype.EVENT_TOOLBAR_STATE_OVERLAY_ON="toolbarOverlayShow",t.prototype.EVENT_TOOLBAR_STATE_OVERLAY_OFF="toolbarOverlayHide",t.prototype.EVENT_TOOLBAR_STATE_DISABLED_ON="toolbarDisableOn",t.prototype.EVENT_TOOLBAR_STATE_DISABLED_OFF="toolbarDisableOff",t.prototype.EVENT_RESTORE_DEFAULT_ZOOM="restoreDefaultZoom",t.prototype.EVENT_CONTEXTMENU="contextmenu",t.prototype.EVENT_KEYDOWN="keydown",t.prototype.EVENT_BEFORE_SHAPE_ADD="beforeShapeAdd",t.prototype.EVENT_AFTER_SHAPE_ADD="afterShapeAdd",t.prototype.EVENT_ZOOM_SET="EVENT_ZOOM_SET",t.prototype.EVENT_ZOOM_UNSET="EVENT_ZOOM_UNSET",t.prototype.EVENT_ZOOM_UPPER_SET="EVENT_ZOOM_UPPER_SET",t.prototype.EVENT_ZOOM_UPPER_UNSET="EVENT_ZOOM_UPPER_UNSET",t.prototype.EVENT_ZOOM_UPPER_RESTORE="EVENT_ZOOM_UPPER_RESTORE",t.prototype.EVENT_ZOOM_RESTORE="EVENT_ZOOM_RESTORE",t.prototype.EVENT_ZOOM_CHANGE="zoomChange",t.prototype.EVENT_CANVAS_MODIFIED="canvasModified",t.prototype.EVENT_OBJECT_ADDED="objectAdded",t.prototype.EVENT_OBJECT_SELECTED="objectSelected",t.prototype.EVENT_OBJECT_MOVING="objectMoving",t.prototype.EVENT_SELECTION_CLEARED="selectionCleared",t.prototype.EVENT_TEXT_SELECTION_CHANGED="textSelectionChanged",t.prototype.EVENT_TEXT_EDITING_ENTERED="textEditingEntered",t.prototype.EVENT_TEXT_EDITING_EXITED="textEditingExited",t.prototype.EVENT_TEXT_STYLES_CHANGED="textStylesChanged",t.prototype.EVENT_TEXT_GET_STYLES="textGetStyles",t.prototype.EVENT_OVERCANVAS_POPUP_SHOW="overcanvasPopupShow",t.prototype.EVENT_OVERCANVAS_POPUP_HIDE="overcanvasPopupHide",t.prototype.EVENT_OVERCANVAS_BUTTON_SHOW="overcanvasButtonShow",t.prototype.EVENT_OVERCANVAS_BUTTON_HIDE="overcanvasButtonHide",t.prototype.EVENT_IMAGE_CROP="initImageCrop",t.prototype.EVENT_RESIZER_HIDE="resizerHide",t.prototype.EVENT_RESIZER_SHOW="resizerShow",t.prototype.EVENT_CREATE_TOOLTIP="createTooltip",t.prototype.EVENT_HIDE_TOOLTIPS="hideTooltips",t.prototype.EVENT_DESTROY_TOOLTIPS="destroyTooltips",t.prototype.off=function(t,e){return this._eventEmitter.off(t,e)},t.prototype.on=function(t,e){return this._eventEmitter.on(t,e)},t.prototype.trigger=function(e,i){var t,o,n=!this.insideEvent;try{this.insideEvent=!0,t=this._eventEmitter.trigger(e,i)}catch(t){this.options.debug&&(o="Catched error - "+e,console.groupCollapsed(o),this.log("Event name",e),this.log("Arguments",i),this.error(t),console.groupEnd(o))}return n&&(this.insideEvent=!1),t}}(DrawerJs.Drawer),!function(t,e){t.prototype.getCanvasData=function(){var t,e=null;return this.fCanvas?e=this.fCanvas.toJSON():this.options.contentConfig.loadCanvasData?e=this.options.contentConfig.loadCanvasData(this.id):this.$canvasDataContainer?(t=this.$canvasDataContainer.text())&&(e=JSON.parse(t)[this.id]):(t=this.$imageElement.attr("data-canvas-serialized"))&&(e=JSON.parse(t)),e},t.prototype.getImageData=function(){var t;return this.fCanvas?this.imageData=this.fCanvas.toDataURL():this.options.contentConfig.loadImageData?(this.imageData=this.options.contentConfig.loadImageData(this.id),'"'==this.imageData[0]&&'"'==this.imageData[this.imageData.length-1]&&(this.imageData=this.imageData.substr(1,this.imageData.length-2))):this.$imagesContainer&&(t=this.$imagesContainer.text())&&(t=JSON.parse(t),this.imageData=t[this.id]),this.imageData},t.prototype.loadCanvas=function(t){var i=this;t?this.fCanvas.loadFromJSON(t,function(){var t,e=i.fCanvas.getObjects();for(t in e)i._updateObjectsControls(e[t]);i.mode=i.MODE_ACTIVE,i.trigger(i.EVENT_LOADED_FROM_JSON),i.fCanvas.renderAll(),i.onCanvasLoaded()}):(i.mode=this.MODE_ACTIVE,i.onCanvasLoaded())},t.prototype.onCanvasLoaded=function(){var o=this;this.fCanvas.on("object:added",function(t){o._updateObjectsControls(t.target),o.trigger(o.EVENT_OBJECT_ADDED,t),o.onCanvasModified()}),this.fCanvas.on("object:moving",function(t){o.trigger(o.EVENT_OBJECT_MOVING,t)}),this.fCanvas.on("object:modified",function(){o.onCanvasModified()}),this.fCanvas.on("before:render",function(t){o.trigger(o.EVENT_BEFORE_RENDER,t)}),this.fCanvas.on("after:render",function(t){o.trigger(o.EVENT_AFTER_RENDER,t)}),this.fCanvas.on("canvas:zoom:lower:set",function(t){o.trigger(o.EVENT_ZOOM_SET,t)}),this.fCanvas.on("canvas:zoom:lower:restore",function(t){o.trigger(o.EVENT_ZOOM_RESTORE,t)}),this.fCanvas.on("canvas:zoom:upper:set",function(t){o.trigger(o.EVENT_ZOOM_UPPER_SET,t)}),this.fCanvas.on("canvas:zoom:upper:restore",function(t){o.trigger(o.EVENT_ZOOM_UPPER_RESTORE,t)}),this.fCanvas.on("pencil:move:before",function(t){o.trigger(o.EVENT_ZOOM_UPPER_SET,t)}),this.fCanvas.on("pencil:move:after",function(t){o.trigger(o.EVENT_ZOOM_UPPER_RESTORE,t)}),this.fCanvas.on("object:removed",function(){o.onCanvasModified()}),this.fCanvas.on("object:selected",function(t){o.trigger(o.EVENT_OBJECT_SELECTED,t)}),this.fCanvas.on("selection:cleared",function(t){o.trigger(o.EVENT_SELECTION_CLEARED,t)}),this.fCanvas.on("text:selection:changed",function(t){o.trigger(o.EVENT_TEXT_SELECTION_CHANGED,t)}),this.fCanvas.on("text:editing:entered",function(t){o.trigger(o.EVENT_TEXT_EDITING_ENTERED,t)}),this.fCanvas.on("text:editing:exited",function(t){o.trigger(o.EVENT_TEXT_EDITING_EXITED,t)}),this.setColor(),this.toolbars.createAllToolbars(),$(this.fCanvas.upperCanvasEl).attr("data-id",1),this.setSize(this.width,this.height),this.$canvasEditContainer.on("contextmenu",function(t){return o.trigger(o.EVENT_CONTEXTMENU,[t]),!1}),e.bindLongPress(this.$canvasEditContainer,"canvasEdit",function(t){o.trigger(o.EVENT_CONTEXTMENU,[t])}),this.trigger(this.EVENT_EDIT_START),this.$canvasEditContainer.on("keydown",function(t){o.trigger(o.EVENT_KEYDOWN,t);var e=8==t.which,i=46==t.which;if(e||i)return o.fCanvas.renderOnAddRemove=!1,(e=o.fCanvas.getActiveObject())&&(e.remove(),t.preventDefault(),t.stopPropagation()),(i=o.fCanvas.getActiveGroup())&&(i.getObjects().map(function(t){t.remove()}),o.fCanvas.discardActiveGroup(),t.preventDefault(),t.stopPropagation()),o.fCanvas.renderAll(),!(o.fCanvas.renderOnAddRemove=!0)}),this.trigger(this.EVENT_CANVAS_READY)},t.prototype.getSerializedCanvas=function(){var t=this.fCanvas.toJSON();return JSON.stringify(t)},t.prototype.beforeSync=function(){this.options.contentConfig&&!this.options.contentConfig.saveInHtml&&this.$imageElement.attr("src",""),this.fCanvas&&(this.beforeSyncActiveObject=this.fCanvas.getActiveObject(),this.beforeSyncActiveGroup=this.fCanvas.getActiveGroup(),this.fCanvas.deactivateAll())},t.prototype.afterSync=function(){this.beforeSyncActiveObject&&(this.fCanvas.setActiveObject(this.beforeSyncActiveObject),delete this.beforeSyncActiveObject),this.beforeSyncActiveGroup&&(this.fCanvas.setActiveGroup(this.beforeSyncActiveGroup),delete this.beforeSyncActiveGroup),this.options.contentConfig&&!this.options.contentConfig.saveInHtml&&this.$imageElement.attr("src",this.getImageData())},t.prototype.syncCanvasData=function(t){var e,i,o;this.fCanvas&&(e=this.getSerializedCanvas(),this.$canvasDataContainer&&(o={},0<(i=this.$canvasDataContainer.text()).length&&(o=JSON.parse(i)),t?delete o[this.id]:this.fCanvas&&(o[this.id]=e),this.$canvasDataContainer.text(JSON.stringify(o,null,2)),this.log("sync","sync with data container done.")),this.options.contentConfig.saveCanvasData&&this.options.contentConfig.saveCanvasData(this.id,e),this.options.contentConfig.saveInHtml)&&this.$imageElement.attr("data-canvas-serialized",e)},t.prototype.syncImageData=function(t){var e,i,o=this.getImageData();this.$imagesContainer&&(i={},0<(e=this.$imagesContainer.text()).length&&(i=JSON.parse(e)),t?delete i[this.id]:i[this.id]=o,this.$imagesContainer.text(JSON.stringify(i,null,2)),this.log("sync","sync with images container done.")),this.options.contentConfig.saveImageData&&this.options.contentConfig.saveImageData(this.id,o)}}(DrawerJs.Drawer,DrawerJs.util),!function(t){"use strict";var a=t.fabric||(t.fabric={}),h=a.util.object.extend;a.ErasableMixin=function(t){this.eraserPaths=[],t&&(this.eraserPaths=this._createEraserPaths(t.eraserPaths))},a.ErasableMixin.prototype.initialize=function(t){this.eraserPaths=[],t&&(this.eraserPaths=a.ErasableMixin.prototype._createEraserPaths.call(this,t.eraserPaths))},a.ErasableMixin.prototype._createEraserPaths=function(t){var e=[];return t&&t.map(function(t){a.EraserPath.fromObject(t,function(t){e.push(t)})}),e},a.ErasableMixin.prototype.render=function(t,e){var i=DrawerJs.util.getTemporaryCanvas(this.canvas),o=i.getContext("2d"),n=this.canvas.width,r=this.canvas.height;o.clearRect(0,0,n,r),e(o);for(var s=0;s<this.eraserPaths.length;s++)this.eraserPaths[s].globalCompositeOperation="destination-out",this.eraserPaths[s].render(o);t.drawImage(i,0,0)},a.ErasableMixin.prototype.addEraserPath=function(t,r){var s=this;t.clone(function(t){t.set("stroke","blue"),t.selectable=!1,t.evented=!1;var e=s.getCenterPoint(),i=t.getCenterPoint(),o=(t.polygonOffsetX=i.x-e.x,t.polygonOffsetY=i.y-e.y,s.angle);t.set({angle:o});for(var n=0;n<t.path.length;n++)a.ErasableMixin.prototype._rotatePathPoints(t.path[n],e,-o);a.ErasableMixin.prototype._updatePathPosition.call(s,t),s.eraserPaths.push(t),r&&r(this)})},a.ErasableMixin.prototype._updateEPathsOnSet=function(t,e){if(this.eraserPaths){this.getCenterPoint();for(var i=0;i<this.eraserPaths.length;i++){var o,n,r=this.eraserPaths[i];r instanceof a.EraserPath&&(o=r.scaleX,n=r.scaleY,"scaleX"==t&&(o*=e/this.scaleX,r.set("scaleX",o)),"scaleY"==t&&(n*=e/this.scaleY,r.set("scaleY",n)),"angle"==t&&r.set("angle",this.angle),a.ErasableMixin.prototype._updatePathPosition.call(this,r))}}},a.ErasableMixin.prototype._updatePathPosition=function(t){var e=this.getCenterPoint(),i=t.scaleX,o=t.scaleY,i=e.x+t.polygonOffsetX*i,o=e.y+t.polygonOffsetY*o,i=a.util.rotatePoint(new a.Point(i,o),e,a.util.degreesToRadians(t.angle));t.set("left",i.x),t.set("top",i.y)},a.ErasableMixin.prototype._rotatePathPoints=function(t,e,i){for(var o,n=a.util.degreesToRadians(i),r=t.length,s=0;s<r;s++)"number"==typeof t[s]&&(o=new a.Point(t[s],t[s+1]),o=a.util.rotatePoint(o,e,n),t[s]=o.x,t[s+1]=o.y,s++);return t},a.ErasableMixin.prototype.toObject=function(){return{eraserPaths:this.eraserPaths.map(function(t){return t.toObject()})}},a.ErasableMixin.prototype.fromObject=function(t){return this.eraserPaths=a.ErasableMixin.prototype._createEraserPaths(t.eraserPaths),this},a.makeObjectErasable=function(t){var o=new a.ErasableMixin,e=(t.prototype.isErasable=!0,t.prototype.initialize),i=(t.prototype.initialize=function(){e.apply(this,arguments),o.initialize.apply(this,arguments)},t.prototype.addEraserPath=function(t){o.addEraserPath.call(this,t)},t.prototype.render),n=(t.prototype.render=function(t){o.render.call(this,t,i.bind(this))},t.prototype._set),r=(t.prototype._set=function(t,e){o._updateEPathsOnSet.call(this,t,e),n.call(this,t,e)},t.fromObject),s=(t.fromObject=function(e,i){var t;if(!this.async)return t=r.call(this,e),o.fromObject.call(t,e);r.call(this,e,function(t){t=o.fromObject.call(t,e);i&&i(t)})},t.prototype.toObject);t.prototype.toObject=function(){var t=s.call(this);return h(t,o.toObject.call(this)),t}}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={});e.util.object.extend;e.ErasableObject=e.util.createClass(e.Object,{type:"erasableObject",initialize:function(t){this.callSuper("initialize",t=t||{})}}),e.ErasableObject.fromObject=function(t){return new e.ErasableObject(t)},e.makeObjectErasable(e.ErasableObject)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,s=e.util.array.min,a=e.util.array.max;e.util.toFixed;e.SegmentablePolygon=e.util.createClass(e.ErasableObject,{type:"segmentablePolygon",points:null,minX:0,minY:0,objectOptionsList:["color","border","opacity"],initialize:function(t,e){void 0===(this.points=t)&&console.error("Points should be array."),this.callSuper("initialize",e=e||{}),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX)},_calcDimensions:function(){for(var t=null,e=null,i=null,o=null,n=0;n<this.points.length;n++){var r=s(this.points[n],"x"),r=((null===t||r<t)&&(t=r),s(this.points[n],"y")),r=((null===e||r<e)&&(e=r),a(this.points[n],"x")),r=((null===i||i<r)&&(i=r),a(this.points[n],"y"));(null===o||o<r)&&(o=r)}this.width=i-t||1,this.height=o-e||1,this.minX=t,this.minY=e},_fixPoints:function(){this._calcDimensions(),this.minX==this.width/2*-1&&this.minY==this.height/2*-1||this.points.forEach(function(t){t.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},this)},_applyPointOffset:function(){this.points.forEach(function(t){t.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},this)},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat(),type:this.type})},render:function(t,e){2==this.points[0].length&&(this.oldStroke=this.stroke,this.oldStrokeDashArray=this.strokeDashArray,this.oldStrokeWidth=this.strokeWidth,this.stroke=this.fill,this.strokeWidth=3,this.strokeDashArray=[]),this.callSuper("render",t,e),2==this.points[0].length&&(this.stroke=this.oldStroke,this.strokeDashArray=this.oldStrokeDashArray,this.strokeWidth=this.oldStrokeWidth)},_render:function(t){this.commonRender(t),this._renderFill(t),(this.stroke||this.strokeDashArray)&&(t.closePath(),this._renderStroke(t))},commonRender:function(t){t.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);var e,i=this.points[0];1==i.length&&t.arc(i[0].x,i[0].y,2,0,2*Math.PI,!1),t.moveTo(i[0].x,i[0].y);for(var o=0,n=i.length;o<n;o++)e=i[o],t.lineTo(e.x,e.y);if(t.closePath(),1<this.points.length)for(var r=1;r<this.points.length;r++){var s=this.points[r];t.moveTo(s[0].x,s[0].y);for(var a=0;a<s.length;a++)t.lineTo(s[a].x,s[a].y)}},complexity:function(){for(var t=0,e=0;e<this.points.length;e++)t+=this.points[e].length;return t}}),e.SegmentablePolygon.fromObject=function(t){return new e.SegmentablePolygon(t.points,t,!0)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.PText=e.util.createClass(e.IText,{type:"PText",_defaultOptions:{editIconMode:!0},objectOptionsList:["color","border","opacity","TextLineHeight","TextAlign"],initialize:function(t,e){this.callSuper("initialize",t,e),this.options=$.extend(!0,this._defaultOptions||{},e||{});t=DrawerJs.util.getDrawerFolderUrl()+"assets/pencil-square-o.32.png";this.options.editIconMode&&(this.startEditControl=new ObjectFloatingControl(this,t,this._iconClickHandler.bind(this),this.options))},onInput:function(t){var e,i,o,n,r;this.isEditing&&!this.inCompositionMode&&(e=this.selectionStart||0,i=this.selectionEnd||0,n=(o=this.text.length)<(r=this.hiddenTextarea.value.length)?(n="left"===this._selectionDirection?i:e,this.hiddenTextarea.value.slice(n,n+(r-o))):this.hiddenTextarea.value.slice(e,e+(r-o+i-e)),r=this.selectionStart===this.selectionEnd&&this.canvas.copiedTextStyle,this.insertChars(n,r),t.stopPropagation())},renderCursorOrSelection:function(t){this.canvas.fire("canvas:zoom:upper:set"),this.callSuper("renderCursorOrSelection",t),this.canvas.fire("canvas:zoom:upper:restore")},initMouseupHandler:function(){this.on("mouseup",function(t){this.options.editIconMode?this.onMouseUpHandler(t):this.onMouseUpSuperHandler(t)})},onMouseUpHandler:function(t){this.__isMousedown=!1,!this.editable||this._isObjectMoved&&this._isObjectMoved(t.e)||(this.selected=!0)},onMouseUpSuperHandler:function(t){this.__isMousedown=!1,!this.editable||this._isObjectMoved&&this._isObjectMoved(t.e)||(this.__lastSelected&&!this.__corner&&(this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()),this.selected=!0)},_iconClickHandler:function(t){this.canvas.setActiveObject(this),this.enterEditing(t.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()},getObjStyles:function(t){return{fontSize:(t=t||this).fontSize,fill:t.fill,textBackgroundColor:t.textBackgroundColor,textDecoration:t.textDecoration,fontFamily:t.fontFamily,fontWeight:t.fontWeight,fontStyle:t.fontStyle,lineHeight:t.lineHeight,stroke:t.stroke,strokeWidth:t.strokeWidth}},render:function(t){this.callSuper("render",t)},toObject:function(t){return i(this.callSuper("toObject",t))}}),e.PText.fromObject=function(t){return new e.PText(t.text,t)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={});e.util.object.extend;e.ErasableText=e.util.createClass(e.PText,{type:"ErasableText",isErasable:!0,initialize:function(t,e){this.callSuper("initialize",t,e)}}),e.ErasableText.fromObject=function(t){return new e.ErasableText(t.text,t)},e.makeObjectErasable(e.ErasableText)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var i=t.fabric||(t.fabric={});i.util.object.extend;i.Arrow=i.util.createClass(i.Line,{type:"arrow",objectCaching:!1,objectOptionsList:["border","opacity","lineWidth","strokeWidth"],initialize:function(t,e){this.callSuper("initialize",t,e),e&&this.set("oneSided",e.oneSided)},_render:function(t,e){this.width<20&&this.height<20||this.scaleX<.3&&this.scaleY<.3?this.set("padding",20):this.set("padding",10),this.canvas.calcOffset(),this.callSuper("_render",t,e);var e=this.callSuper("calcLinePoints"),i=this._calcArrowAngle(e.x1,e.y1,e.x2,e.y2);this.oneSided||this._drawArrow(t,{x:e.x1,y:e.y1},i+90),this._drawArrow(t,{x:e.x2,y:e.y2},i-90)},_drawArrow:function(t,e,i){var o=.5,n=(1<this.get("strokeWidth")&&(o*=this.get("strokeWidth")/2),{x:e.x,y:e.y+10*o}),r={x:e.x-10*o,y:e.y-20*o},s={x:e.x,y:e.y-10*o},o={x:e.x+10*o,y:e.y-20*o};t.save(),t.translate(e.x,e.y),t.rotate(i*Math.PI/180),t.translate(-1*e.x,-1*e.y),t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(r.x,r.y),t.lineTo(s.x,s.y),t.lineTo(o.x,o.y),t.fillStyle=this.stroke,t.fill(),t.restore()},_calcArrowAngle:function(t,e,i,o){i-=t,t=o-e;return 180*(0==i?0==t?0:0<t?Math.PI/2:3*Math.PI/2:0==t?0<i?0:Math.PI:i<0?Math.atan(t/i)+Math.PI:t<0?Math.atan(t/i)+2*Math.PI:Math.atan(t/i))/Math.PI},toObject:function(t){return(t=t||[]).push("oneSided","padding"),i.util.object.extend(this.callSuper("toObject",t),this.calcLinePoints())}}),i.Arrow.fromObject=function(t){var e=[t.x1,t.y1,t.x2,t.y2];return new i.Arrow(e,t)}}("undefined"!=typeof exports?exports:this),this.DrawerJs||(this.DrawerJs={}),this.DrawerJs.clipping={},!function(){"use strict";DrawerJs.clipping.runClippingOperation=function(t){var e=t.firstShape,i=t.secondShape,o=c(e.width,e.currentWidth,e.height,e.currentHeight,e.center,e.angleInRadians,e.points),n=h(i.center,i.points),r=a(t.cmd,o,l(n));if(i.centersQueue)for(var s=0;s<i.centersQueue.length;s++)n=h(i.centersQueue[s],i.points),r=a(t.cmd,r,l(n));o=null;return o=0<(r=ClipperLib.JS.Lighten(r,.1)).length?p(e.currentWidth,e.width,e.currentHeight,e.height,e.center,-1*e.angleInRadians,r):o};var a=function(t,e,i){var o=new ClipperLib.Paths,n=new ClipperLib.Clipper;return n.AddPaths(e,ClipperLib.PolyType.ptSubject,!0),n.AddPaths(i,ClipperLib.PolyType.ptClip,!0),n.Execute(t,o),o},h=function(t,e){for(var i=[],o=0;o<e.length;o++){for(var n=[],r=0;r<e[o].length;r++)n.push({x:t.x+e[o][r].x,y:t.y+e[o][r].y});i.push(n)}return i},l=function(t){for(var e=[],i=0;i<t.length;i++){for(var o=[],n=0;n<t[i].length;n++)o.push({X:t[i][n].x,Y:t[i][n].y});e.push(o)}return e},c=function(t,e,i,o,n,r,s){for(var a=[],h=Math.sin(r),l=Math.cos(r),c=0;c<s.length;c++){for(var p=[],u=0;u<s[c].length;u++){var d=s[c][u].x,f=s[c][u].y,d=n.x+100*d/t*e/100,f=n.y+100*f/i*o/100,g=(d-=n.x)*l-(f-=n.y)*h,v=d*h+f*l;d=g+=n.x,f=v+=n.y,p.push({X:d,Y:f})}a.push(p)}return a},p=function(t,e,i,o,n,r,s){for(var a=[],h=Math.sin(r),l=Math.cos(r),c=0;c<s.length;c++){for(var p=[],u=0;u<s[c].length;u++){var d=s[c][u].X,f=s[c][u].Y,g=(d-=n.x)*l-(f-=n.y)*h,v=d*h+f*l,d=g+=n.x,f=v+=n.y;d-=n.x,f-=n.y,p.push({x:d=100*d/t*e/100,y:f=100*f/i*o/100})}a.push(p)}return a}}(),!function(t){"use strict";var i=t.fabric||(t.fabric={});i.ErasableArrow=i.util.createClass(i.Arrow,{type:"ErasableArrow",originX:"center",originY:"center",initialize:function(t,e){this.callSuper("initialize",t,e=e||{})},toObject:function(t){return this.callSuper("toObject",t)},_render:function(t){this.callSuper("_render",t)}}),i.ErasableArrow.fromObject=function(t){var e=[t.x1,t.y1,t.x2,t.y2];return new i.ErasableArrow(e,t)},i.makeObjectErasable(i.ErasableArrow)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var o=t.fabric||(t.fabric={}),e=o.util.object.extend;o.ErasableImage=o.util.createClass(o.Image,{type:"ErasableImage",async:!0,objectOptionsList:["opacity","border"],initialize:function(t,e){this.width=(e=e||{}).width||10,this.height=e.height||10,this.callSuper("initialize",t,e)},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){this.callSuper("_set",t,e)},toObject:function(t){return e(this.callSuper("toObject",t),{width:this.width,height:this.height})}}),o.ErasableImage.fromObject=function(e,i){o.util.loadImage(e.src,function(t){t=new o.ErasableImage(t,e);i&&i(t)})},o.ErasableImage.async=!0,o.makeObjectErasable(o.ErasableImage)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var i=t.fabric||(t.fabric={});i.ErasableLine=i.util.createClass(i.Line,{type:"ErasableLine",originX:"center",originY:"center",objectOptionsList:["border","opacity","lineWidth","strokeWidth"],initialize:function(t,e){this.callSuper("initialize",t,e=e||{})},toObject:function(t){return this.callSuper("toObject",t)},_render:function(t){this.callSuper("_render",t)}}),i.ErasableLine.fromObject=function(t){var e=[t.x1,t.y1,t.x2,t.y2];return new i.ErasableLine(e,t)},i.makeObjectErasable(i.ErasableLine)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={});e.util.object.extend;e.ErasablePath=e.util.createClass(e.Path,{type:"ErasablePath",objectCaching:!1,evented:!1,selectable:!1,initialize:function(t,e){this.callSuper("initialize",t,e=e||{})},_render:function(t){this.callSuper("_render",t)},toObject:function(t){return this.callSuper("toObject",t)}}),e.ErasablePath.fromObject=function(t){return new e.ErasablePath(t.path,t)},e.ErasablePath.async=!1,e.makeObjectErasable(e.ErasablePath)}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={});e.ErasablePencilBrush=e.util.createClass(e.PencilBrush,{type:"ErasablePencilBrush",objectOptionsList:["color","opacity","brush"],onMouseMove:function(t){this._captureDrawingPath(t),this.canvas.clearContext(this.canvas.contextTop),this._render(),this.canvas.renderAll()},_render:function(){this.canvas.fire("pencil:move:before"),this.callSuper("_render"),this.canvas.fire("pencil:move:after")},initialize:function(t,e){this.options=e=e||{},this.callSuper("initialize",t)},createPath:function(t){t=new e.ErasablePath(t,{fill:null,stroke:this.color,opacity:this.opacity,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t}})}("undefined"!=typeof exports?exports:this),!function(t,n){"use strict";function e(t,e,i,o){if(!(t&&t instanceof r.Object))throw new Error("[ObjectFloatingControl()]  invalid param : obj");if(this.obj=t,!e||!n.isString(e))throw new Error("[ObjectFloatingControl()]  invalid param : iconPath");if(this.iconPath=e,!(i&&i instanceof Function))throw new Error("[ObjectFloatingControl()]  invalid param : callback");this.callback=i,this.options=$.extend(!0,{},this._defaultOptions||{},o||{}),this.enabled=this.options.enabled,r.Image.fromURL(e,this._onIconReady.bind(this)),this.obj.on("added",this._onAdded.bind(this)),this.obj.on("removed",this._onRemoved.bind(this))}var r=t.fabric||(t.fabric={});r.util.object.extend;e.prototype.SMALL_ICON="small",e.prototype.MEDIUM_ICON="medium",e.prototype.LARGE_ICON="large",e.prototype.LEFT_TOP="left-top",e.prototype.LEFT_BOTTOM="left-bottom",e.prototype.RIGHT_TOP="right-top",e.prototype.RIGHT_BOTTOM="right-bottom",e.prototype._defaultOptions={defaulIconSize:32,symbolicIconSizes:{small:16,medium:32,large:48},enabled:!0},e.prototype.remove=function(){this._onRemoved()},e.prototype.enable=function(){this.enabled=!0},e.prototype.disable=function(){this.enabled=!1},e.prototype._onAdded=function(t){this.canvas=this.obj.canvas,this._iconClickHandlerBinded=this._iconClickHandler.bind(this),this.canvas.on("mouse:up",this._iconClickHandlerBinded),this.canvas.on("touchend",this._iconClickHandlerBinded),this._bindedAfterRender=this._onAfterRender.bind(this),this.canvas.on("after:render",this._bindedAfterRender)},e.prototype._onRemoved=function(t){this.canvas.off("mouse:up",this._iconClickHandlerBinded),this.canvas.off("touchend",this._iconClickHandlerBinded),this.canvas.off("after:render",this._bindedAfterRender)},e.prototype._onIconReady=function(t){var e=this.options.iconSize||this.options.defaulIconSize,i=this.options.editIconSize,i=("string"==typeof i&&this.options.symbolicIconSizes[i]||i||this.options.defaulIconSize)/e;this.icon=t,this.iconSize=e,this.iconScale=i,this.icon.offsetFromLeft=.66*this.options.defaulIconSize,this.icon.offsetFromTop=.66*-this.iconSize,this.icon.set({scaleX:i,scaleY:i,originX:"center",originY:"center",opacity:1})},e.prototype._iconClickHandler=function(t){var e,i,o,n;this.enabled&&this.canvas&&this.icon&&((e=this.canvas.getPointer(t.e))?(o=e.x,n=e.y):void 0===t.e.offsetX?(e=drawer.left(),i=drawer.top(),o=t.e.pageX-e,n=t.e.pageY-i,console.log("x : ",t.e.pageX,"-",e,"=",o),console.log("y : ",t.e.pageY,"-",i,"=",n)):(o=t.e.offsetX,n=t.e.offsetY),this._coordInsideIcon(o,n))&&this.callback(t,this)},e.prototype._coordInsideIcon=function(t,e){var i=this.icon.width*this.icon.scaleX/2,o=this._calcIconCoords(),t=t>o.x-i&&t<o.x+i,e=e>o.y-i&&e<o.y+i;return t&&e},e.prototype._onAfterRender=function(t){this.canvas.fire("canvas:zoom:lower:set"),this._drawIcon(),this.canvas.fire("canvas:zoom:lower:restore")},e.prototype._drawIcon=function(){var t;this.enabled&&this.icon&&this.obj.active&&(t=this._calcIconCoords(),this.icon.left=t.x,this.icon.top=t.y,this.icon.render(this.canvas.getContext()))},e.prototype._calcIconCoords=function(){var t=this.obj.getPointByOrigin("left","top"),e=this.icon.offsetFromLeft*this.obj.scaleX,i=this.icon.offsetFromTop,o=r.util.degreesToRadians(this.obj.angle),n=e*Math.cos(o)-i*Math.sin(o),e=e*Math.sin(o)+i*Math.cos(o);return{x:t.x+n,y:t.y+e}},t.ObjectFloatingControl=e}("undefined"!=typeof exports?exports:this,DrawerJs.util),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,s=e.util.array.min,a=e.util.array.max,r=e.util.toFixed;e.SegmentableLine=e.util.createClass(e.Object,{type:"SegmentableLine",objectOptionsList:["border","opacity","lineWidth","strokeWidth"],points:null,minX:0,minY:0,initialize:function(t,e){e=e||{},this.points=t,this.callSuper("initialize",e),this._calcDimensions(),"top"in e||(this.top=this.minY),"left"in e||(this.left=this.minX)},_calcDimensions:function(){this.points;for(var t=null,e=null,i=null,o=null,n=0;n<this.points.length;n++){var r=s(this.points[n],"x"),r=((null===t||r<t)&&(t=r),s(this.points[n],"y")),r=((null===e||r<e)&&(e=r),a(this.points[n],"x")),r=((null===i||i<r)&&(i=r),a(this.points[n],"y"));(null===o||o<r)&&(o=r)}this.width=i-t||1,this.height=o-e||1,this.minX=t,this.minY=e},_applyPointOffset:function(){this.points.forEach(function(t){t.forEach(function(t){t.x-=this.minX+this.width/2,t.y-=this.minY+this.height/2},this)},this)},toObject:function(t){return i(this.callSuper("toObject",t),{points:this.points.concat(),type:this.type})},toSVG:function(t){for(var e=[],i=this._createBaseSVGMarkup(),o=0,n=this.points.length;o<n;o++)e.push(r(this.points[o].x,2),",",r(this.points[o].y,2)," ");return i.push("<",this.type," ",'points="',e.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),t?t(i.join("")):i.join("")},_render:function(t){this.commonRender(t),this._renderFill(t),(this.stroke||this.strokeDashArray)&&this._renderStroke(t)},commonRender:function(t){t.beginPath(),this._applyPointOffset&&(this.group&&"path-group"===this.group.type||this._applyPointOffset(),this._applyPointOffset=null);var e,i=this.points[0];t.moveTo(i[0].x,i[0].y);for(var o=0,n=i.length;o<n;o++)e=i[o],t.lineTo(e.x,e.y);if(1<this.points.length)for(var r=1;r<this.points.length;r++){var s=this.points[r];t.moveTo(s[0].x,s[0].y);for(var a=0;a<s.length;a++)t.lineTo(s[a].x,s[a].y)}},complexity:function(){return this.points.length}}),e.SegmentableLine.fromObject=function(t){return new e.SegmentableLine(t.points,t,!0)}}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var l=t.fabric||(t.fabric={}),e=l.util.object.extend;l.util.array.min,l.util.array.max,l.util.toFixed;l.PCircle=l.util.createClass(l.SegmentablePolygon,{radius:0,type:"PCircle",initialize:function(t){this.radius=(t=t||{}).radius||0;var e=this.makeCircle(this.radius);this.width=2*this.radius,this.height=2*this.radius,this.callSuper("initialize",e,t)},makeCircle:function(t){for(var e=[],i=0;i<360;i++){var o=i*Math.PI/180,n=0+t*Math.cos(o),o=0+t*Math.sin(o);e.push({x:n,y:o})}return[e]},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){"radius"===t&&(this.points=this.makeCircle(e),this.width=2*e,this.height=2*e,this.callSuper("_set","points",this.points)),this.callSuper("_set",t,e)},isPointInside:function(t,e){var i=this.getCenterPoint();return Math.sqrt((t-i.x)*(t-i.x)+(e-i.y)*(e-i.y))<this.radius},getPerimeterPoints:function(t,e,i){var o=0,n=360;return"number"==typeof t&&"number"==typeof e&&!i&&(t||e)&&(n=0!==t&&0!==e?90:180,e<0?o=0<t?270:180:t<0&&(o=90)),this.getSectorPoints(o,n)},getSectorPoints:function(t,e){for(var i=[],o=Math.round(15*Math.random()/2),n=t+e+15-o,r=t-o;r<=n;r+=15){var s={},a=l.util.degreesToRadians(r%360),h=this.radius*Math.cos(a),a=this.radius*Math.sin(a);s.x=this.left+Math.round(h),s.y=this.top+Math.round(a),i.push(s)}return i},toObject:function(t){return e(this.callSuper("toObject",t),{radius:this.radius})}}),l.PCircle.fromObject=function(t){return new l.PCircle(t,!0)},l.PCircle.async=!1}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.util.array.min,e.util.array.max,e.util.toFixed;e.PRect=e.util.createClass(e.SegmentablePolygon,{type:"PRect",initialize:function(t){this.width=(t=t||{}).width||10,this.height=t.height||10;var e=this.makeRect(this.width,this.height);this.callSuper("initialize",e,t)},makeRect:function(t,e){t/=2,e/=2;return[[{x:-1*t,y:-1*e},{x:t,y:-1*e},{x:t,y:e},{x:-1*t,y:e}]]},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){var i=!1;"width"===t&&(this.width=e,i=!0),"height"===t&&(this.height=e,i=!0),i&&(this.points=this.makeRect(this.width,this.height),this.callSuper("_set","points",this.points)),this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{width:this.width,height:this.height})}}),e.PRect.fromObject=function(t){return new e.PRect(t,!0)},e.PRect.async=!1}("undefined"!=typeof exports?exports:this),!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend;e.util.array.min,e.util.array.max,e.util.toFixed;e.PTriangle=e.util.createClass(e.SegmentablePolygon,{type:"PTriangle",initialize:function(t){this.width=(t=t||{}).width||10,this.height=t.height||10;var e=this.makeTriangle(this.width,this.height);this.callSuper("initialize",e,t)},makeTriangle:function(t,e){t/=2,e/=2;return[[{x:-1*t,y:e},{x:0,y:-1*e},{x:t,y:e}]]},_render:function(t){this.callSuper("_render",t)},_set:function(t,e){var i=!1;"width"===t&&(this.width=e,i=!0),"height"===t&&(this.height=e,i=!0),i&&(this.points=this.makeTriangle(this.width,this.height),this.callSuper("_set","points",this.points)),this.callSuper("_set",t,e)},toObject:function(t){return i(this.callSuper("toObject",t),{width:this.width,height:this.height})}}),e.PTriangle.fromObject=function(t){return new e.PTriangle(t,!0)},e.PTriangle.async=!1}("undefined"!=typeof exports?exports:this),function(){}),DrawerToolbar=function(t,e){if(!t)throw new Error("DrawerToolbar c-tor : drawerInstance is not set!");this.drawerInstance=t,this.buttonsGroups={},this._setupOptions(e),this._setupElement(),this._attachEventHandlers(),this._attachDrawerEventHandlers(),this._initCompactType()},DrawerToolbarManager=(DrawerToolbar.prototype.MULTILINE="multiline",DrawerToolbar.prototype.SCROLLABLE="scrollable",DrawerToolbar.prototype.POPUP="popup",DrawerToolbar.prototype.POSITION_TYPE_OUTSIDE="outside",DrawerToolbar.prototype.POSITION_TYPE_INSIDE="inside",DrawerToolbar.prototype.position="top",DrawerToolbar.prototype.buttonsGroups={},DrawerToolbar.prototype.buttons=[],DrawerToolbar.prototype._defaultOptions={compactType:DrawerToolbar.prototype.MULTILINE,positionType:DrawerToolbar.prototype.POSITION_TYPE_OUTSIDE,buttonWidth:32,buttonHeight:35},DrawerToolbar.prototype._defaultButtonConfig={additionalClass:"",iconClass:"",tooltipText:"",buttonOrder:10,isSubMenu:!1,group:{name:"",tooltip:""},clickHandler:emptyFunc},DrawerToolbar.prototype._setupOptions=function(t){this.options=$.extend(!0,{},this._defaultOptions||{},t||{})},DrawerToolbar.prototype._setupElement=function(){var t=this._generateTemplate(),t=$(t);this.$toolbar=t,this.$toolbarContentHolder=this.$toolbar.find(".toolbar-content-wrapper")},DrawerToolbar.prototype._generateTemplate=function(){return'<ul class="'+("editable-canvas-toolbar "+(this.options.toolbarClass||"")+(this.options.hidden?" hidden ":""))+'" contenteditable="false"><ul class="toolbar-content-wrapper"></ul></ul>'},DrawerToolbar.prototype._attachEventHandlers=function(){},DrawerToolbar.prototype._attachDrawerEventHandlers=function(){var t=this;this.drawerInstance.on(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL,function(){t.hideActiveSubmenu()})},DrawerToolbar.prototype._initCompactType=function(){switch(!0){case this.options.compactType===DrawerToolbar.prototype.SCROLLABLE:this._initCompactType_scrollable();break;case this.options.compactType===DrawerToolbar.prototype.MULTILINE:this._initCompactType_multiline();break;case this.options.compactType===DrawerToolbar.prototype.POPUP:this._initCompactType_popup();break;default:this._initCompactType_multiline()}},DrawerToolbar.prototype._initCompactType_scrollable=function(){this.isScrollable=!0,this.scrollModeActive=!1,this.currentScrollOffset=0,this.$toolbar.addClass("toolbar-scrollable"),this._addScrollButtons(),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_START_RESIZE,this._onCanvasResizeStart.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_RESIZING,this._onCanvasResizing.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE,this._onCanvasResizeFinish.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_START,this.checkScroll.bind(this)),this.$toolbar.on("mousedown.toolbar touchstart.toolbar",this.onTouchStart.bind(this))},DrawerToolbar.prototype._initCompactType_multiline=function(){this.$toolbar.addClass("toolbar-multiline")},DrawerToolbar.prototype._initCompactType_popup=function(){this._initCompactType_multiline()},DrawerToolbar.prototype.remove=function(){this.$toolbar.remove(),this.buttonsGroups={},this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_DESTROYED,[this])},DrawerToolbar.prototype.addControl=function(t,e){e=void 0!==e?e:this._defaultButtonConfig.buttonOrder;var e=this._getOrderString(e),i=t.attr("style");t.attr("style",(i||"")+";"+e),this.$toolbarContentHolder.append(t)},DrawerToolbar.prototype.addButton=function(t){t=this._validateButtonConfig(t);t=this.createButton(t);return this.buttons.push(t),this.$toolbarContentHolder.append(t),this.checkScroll(),t},DrawerToolbar.prototype.addButtonToGroup=function(t){t=this._validateButtonConfig(t);var e=this.buttonsGroups[t.group.name],t=(!(e&&e.length)&&(this._createAndAppendGroup(t.group,t.iconClass,t.buttonOrder),e=this.buttonsGroups[t.group.name]),t.isSubMenu=!0,this.createButton(t));return e.$submenuWrapper.buttons.push(t),e.find(".group-items-container").append(t),t},DrawerToolbar.prototype._validateButtonConfig=function(t){t=t||{};var e=$.extend(!0,{},this._defaultButtonConfig),t=$.extend(!0,{},e,t);return t.buttonOrder=("number"==typeof t.buttonOrder?t:e).buttonOrder,t.isSubMenu=(void 0!==t.isSubMenu?t:e).isSubMenu,t.clickHandler=("function"==typeof t.clickHandler?t:e).clickHandler,t},DrawerToolbar.prototype._getOrderString=function(t){return"-webkit-order:"+t+";-ms-flex-order:"+t+";order:"+t+";"},DrawerToolbar.prototype.createButton=function(t){var e=this._getOrderString(t.buttonOrder),i=t.isSubMenu?" submenu-child ":" ",e='<li class="'+("toolbar-button "+t.additionalClass+i)+'"data-tooltip-class="'+t.additionalClass+'"'+('style="'+e+'"')+'><a href="#" class="toolbar-button-icon '+i+'"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+t.iconClass+" "+i+'"></i></a></li>',i=$(e),e={additionalClass:t.additionalClass,text:t.tooltipText,position:"bottom"},e=(i.tooltip=this.drawerInstance.trigger(this.drawerInstance.EVENT_CREATE_TOOLTIP,[i.find("a"),e]),i.find("a"));return e.on("click",function(t){t.preventDefault(),t.stopPropagation()}),DrawerJs.util.bindClick(e,"editable-canvas-toolbar-button",t.clickHandler),i},DrawerToolbar.prototype.removeButton=function(t){t?(DrawerJs.util.unbindClick(t.find("a"),"editable-canvas-toolbar-button"),t.remove()):console.warn("DrawerToolbar.removeButton() : no $button is provided!")},DrawerToolbar.prototype._createAndAppendGroup=function(t,e,i){i=this._getOrderString(i),i=$('<li class="toolbar-button btn-group group-'+t.name+'"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="width,height"'+('style="'+i+'"')+'><a href="#" class="toolbar-button-icon"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa '+e+'"></i></a><div class="submenu-wrapper"><ul class="group-items-container submenu-child toolbar-dropdown-block"></ul></div></li>'),i.$submenuWrapper=i.find(".submenu-wrapper"),i.$submenuWrapper.buttons=[],this.$toolbarContentHolder.append(i),(this.buttonsGroups[t.name]=i).find("a").on("click",function(t){t.preventDefault()}),i.on("click",this.onGroupButtonClick.bind(this,i)),e={additionalClass:t.name,text:t.tooltip,position:"bottom"};this.drawerInstance.trigger(this.drawerInstance.EVENT_CREATE_TOOLTIP,[i.children("a"),e])},DrawerToolbar.prototype.setActiveButton=function(t){this.$toolbar.find(".toolbar-button."+t).find(".toolbar-button-icon").addClass("active")},DrawerToolbar.prototype.clearActiveButton=function(){this.$toolbar.find(".toolbar-button .toolbar-button-icon.active").removeClass("active")},DrawerToolbar.prototype.onGroupButtonClick=function(t,e){this.activeSubmenu=t.$submenuWrapper.clone(!0);var t=$(e.currentTarget),i=(this.isHorizontal()?(e=parseInt(this.$toolbar.css("padding-left")),e=t.position().left-this.currentScrollOffset+e,this.activeSubmenu.css("left",e+"px")):(e=parseInt(this.$toolbar.css("padding-top")),t=t.position().top-this.currentScrollOffset+e,this.activeSubmenu.css("top",t+"px")),this.$toolbar.parent().append(this.activeSubmenu),0);switch(this.position){case"custom":case"top":i=this.$toolbar[0].offsetTop+this.$toolbar.height(),this.activeSubmenu.css("top",i+"px");break;case"left":i=this.$toolbar[0].offsetLeft+this.$toolbar.width(),this.activeSubmenu.css("left",i+"px");break;case"right":i=this.$toolbar[0].offsetLeft-this.$toolbar.width(),this.activeSubmenu.css("left",i+"px");break;case"bottom":i=this.$toolbar[0].offsetTop-this.activeSubmenu.height(),this.activeSubmenu.css("top",i+"px")}$("body").on("mousedown.submenu",this.onSubmenuMouseDown.bind(this))},DrawerToolbar.prototype.onSubmenuMouseDown=function(t){!this.activeSubmenu||t.target==this.activeSubmenu||$(t.target).hasClass("submenu-child")||this.hideActiveSubmenu()},DrawerToolbar.prototype.hideActiveSubmenu=function(){this.activeSubmenu&&(this.drawerInstance.trigger(this.drawerInstance.EVENT_HIDE_TOOLTIPS),this.activeSubmenu.remove(),this.activeSubmenu=null,$("body").off("mousedown.submenu"))},DrawerToolbar.prototype._setGroupButtonActive=function(t,e){t=this.buttonsGroups[t],e=this.$toolbar.find("."+e),t.attr("class",e.attr("class")),t.addClass("btn-group"),t=t.children("a");t.addClass("active"),t.html(e.children("a").html())},DrawerToolbar.prototype._addScrollButtons=function(){function t(t){return'<li class="toolbar-button '+t+'"><a href="#" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height,font-size:($v / 2.5)" tabindex="-1"><i class="fa"></i></a></li>'}this.$scrollToBeginBtn=$(t("scroll-to-begin-btn")),this.$scrollToEndBtn=$(t("scroll-to-end-btn"));var e=this.$scrollToBeginBtn.find("a"),i=this.$scrollToEndBtn.find("a");e.on("click",function(t){t.preventDefault()}),i.on("click",function(t){t.preventDefault()}),DrawerJs.util.bindClick(e,"scroll-to-begin-btn",this.onScrollToBegin.bind(this)),DrawerJs.util.bindClick(i,"scroll-to-end-btn",this.onScrollToEnd.bind(this)),this.$toolbar.append(this.$scrollToBeginBtn),this.$toolbar.append(this.$scrollToEndBtn)},DrawerToolbar.prototype.onTouchStart=function(t){var e;this.scrollModeActive&&(this.mouseDown=!0,e="touchstart"==t.type?t.originalEvent.touches[0]:t,e=this.isHorizontal()?e.pageX:e.pageY,this.touchStartCoord=e+this.currentScrollOffset,console.log("TOUCH START",this.touchStartCoord,t),$("body").on("mouseup.toolbar touchend.toolbar",this.onTouchEnd.bind(this)),this.$toolbar.on("mousemove.toolbar touchmove.toolbar",this.onTouchMove.bind(this)))},DrawerToolbar.prototype.onTouchEnd=function(t){console.log("TOUCH END",t),this.mouseDown=!1,$("body").off("mousemove.toolbar touchmove.toolbar"),$("body").off("mouseup.toolbar touchend.toolbar")},DrawerToolbar.prototype.onTouchMove=function(t){var e,i;!this.mouseDown||(i=t.target,e=(i=$(i)).is("input"),i=i.is(".color-indicator"),e)||i||(t.preventDefault(),e="touchmove"===t.type?t.originalEvent.touches[0]:t,i=this.isHorizontal()?e.pageX:e.pageY,t=this.touchStartCoord-i,console.log("TOUCH MOVE",i,t),this.scrollTo(t))},DrawerToolbar.prototype._onCanvasResizeStart=function(){this.checkScroll()},DrawerToolbar.prototype._onCanvasResizing=function(){this.checkScroll()},DrawerToolbar.prototype._onCanvasResizeFinish=function(){this.checkScroll()},DrawerToolbar.prototype.checkScroll=function(){var t=this.$toolbarContentHolder.get(0),t=this.isHorizontal()?t.scrollWidth:t.scrollHeight;(this.isHorizontal()?this.$toolbar.width():this.$toolbar.height())<t?(this.scrollModeActive=!0,this.$toolbar.addClass("show-scroll")):(this.scrollModeActive=!1,this.$toolbar.removeClass("show-scroll"),this.scrollTo(0))},DrawerToolbar.prototype._getCurrOffsetProps=function(){var r,s={},a=this.isHorizontal(),h=this.currentScrollOffset,t=this.$toolbar.find(".toolbar-content-wrapper"),l=t.get(0).getBoundingClientRect();return t.children().each(function(t,e){var i=$(e),e=e.getBoundingClientRect(),o=a?e.left-l.left:e.top-l.top,n=Math.abs(o-h);i.is(":visible")&&(void 0===r||n<r)&&(r=n,s.relativeOffset=o-h,s.$element=i,s.sizes=e)}),s},DrawerToolbar.prototype._getOffsetStep_Custom=function(t){for(var e,i,o=0,n=this.isHorizontal(),r=(n?this.$toolbar.width():this.$toolbar.height())-2*(n?this.options.buttonWidth:this.options.buttonHeight),s=this._getCurrOffsetProps(),a=s.$element,h=!0,o=s.relativeOffset,l=a.get(0).getBoundingClientRect(),c=a;h;)(i=t?c.prev():c.next()).length&&Math.abs(o)<r?i.is(":visible")&&(e=i.get(0).getBoundingClientRect(),0<(e=n?e.left-l.left:e.top-l.top)?e+=3:e-=3,o+=e,h=!1):h=!1,c=i;return o},DrawerToolbar.prototype._getOffsetStep_Buttons=function(){var t=this.isHorizontal()?this.$toolbar.width():this.$toolbar.height(),e=this.isHorizontal()?this.options.buttonWidth:this.options.buttonHeight,t=Math.ceil(t/e);return Math.max(t-1,1)*e},DrawerToolbar.prototype.onScrollToBegin=function(){var t=this.customScrollMode?this._getOffsetStep_Custom(!0):-this._getOffsetStep_Buttons();this.scrollToolbarBy(t)},DrawerToolbar.prototype.onScrollToEnd=function(){var t=this.customScrollMode?this._getOffsetStep_Custom():this._getOffsetStep_Buttons();this.scrollToolbarBy(t)},DrawerToolbar.prototype.scrollToolbarBy=function(t){var t=this.currentScrollOffset+parseInt(t),e=this.$toolbar.get(0),i=this.isHorizontal(),e=(i?this.$toolbar.width():this.$toolbar.height(),i?e.scrollWidth:e.scrollHeight),i=i?this.options.buttonWidth:this.options.buttonHeight,t=Math.min(t,e-i);t=Math.max(t,0),this.scrollTo(t)},DrawerToolbar.prototype.toggleToolbarVisibility=function(t,e){var i=!this.$toolbar.hasClass("hidden");(e?this.visibilityState:i)?this.showToolbar(t):this.hideToolbar(t)},DrawerToolbar.prototype.hideToolbar=function(t){t&&(this.visibilityState=!this.$toolbar.hasClass("hidden")),this.invisible=!0,this.$toolbar.addClass("hidden")},DrawerToolbar.prototype.showToolbar=function(t){t&&(this.visibilityState=!this.$toolbar.hasClass("hidden")),this.invisible=!1,this.$toolbar.removeClass("hidden")},DrawerToolbar.prototype.scrollTo=function(t){this.currentScrollOffset=parseInt(t),this.isHorizontal()?this.$toolbarContentHolder.css("left","-"+this.currentScrollOffset+"px"):this.$toolbarContentHolder.css("top","-"+this.currentScrollOffset+"px")},DrawerToolbar.prototype.getToolbarOrientation=function(){return this.$toolbar.hasClass("toolbar-vertical")?"vertical":"horizontal"},DrawerToolbar.prototype.isHorizontal=function(){return"horizontal"===this.getToolbarOrientation()},DrawerToolbar.prototype.height=function(){return this.$toolbar.height()},DrawerToolbar.prototype.width=function(){return this.$toolbar.width()},function(t){if(!(this.drawerInstance=t))throw new Error("DrawerToolbarManager : drawer must be provided!");this.toolbars={},this.toolbarPlaceholders={},this.TooltipManager=new DrawerJs.utilPlugins.TooltipManager(this.drawerInstance)}),ToolbarPlaceholder=(DrawerToolbarManager.prototype.addToolbar=function(t,e){var i=(e=e||{}).position==ToolbarPlaceholder.prototype.CUSTOM_POSITION,o=i?e.customAnchorSelector:e.position,n=o===ToolbarPlaceholder.prototype.POPUP_POSITION||o===ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION?ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM:e.positionType||ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE,r=this.toolbarPlaceholders[n]&&this.toolbarPlaceholders[n][o],s=this.toolbarPlaceholders[o],r=r||s;r?r.addToolbar(t):i||(s=n+" "+o+" "+e.customAnchorSelector+"'",this.drawerInstance.error("DrawerToolbarManager.addToolbar() : no placeholder exists with name '"+s))},DrawerToolbarManager.prototype.createAllToolbars=function(){var t=this,e=(this.drawerInstance.trigger(this.drawerInstance.BEFORE_CREATE_TOOLBARS,[this]),this._createHelperElements(),this._createToolbarsPlaceholders(),this.drawerInstance.options.toolbars),i=this.drawerInstance.$canvasEditContainer.hasClass("fullscreen"),o=e.overCanvas,e=(i=i?(i={positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE},n=$.extend(!0,{},e.toolOptions,e.toolOptions.fullscreenMode||{},i),r=$.extend(!0,{},e.drawingTools,e.drawingTools.fullscreenMode||{},i),$.extend(!0,{},e.settings,e.settings.fullscreenMode||{},i)):(n=e.toolOptions,r=e.drawingTools,e.settings),this.toolOptionsToolbar=new ToolOptionsToolbar(this.drawerInstance,n),{position:n.position,positionType:n.positionType,customAnchorSelector:n.customAnchorSelector}),n=(n.compactType===DrawerToolbar.prototype.POPUP&&(e.position=ToolbarPlaceholder.prototype.POPUP_POSITION,e.positionType=ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM),this.addToolbar(this.toolOptionsToolbar,e),this.drawingToolsToolbar=new DrawingToolsToolbar(this.drawerInstance,r),{position:r.position,positionType:r.positionType,customAnchorSelector:r.customAnchorSelector}),e=(this.addToolbar(this.drawingToolsToolbar,n),this.settingsToolbar=new SettingsToolbar(this.drawerInstance,i),{position:i.position,positionType:i.positionType,customAnchorSelector:i.customAnchorSelector}),r=(this.addToolbar(this.settingsToolbar,e),this.overCanvasToolbar=new OverCanvasToolbar(this.drawerInstance,o),{position:ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION,positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM}),n=(this.addToolbar(this.overCanvasToolbar,r),this.cropImageToolbar=new CropImageToolbar(this.drawerInstance,o),{position:ToolbarPlaceholder.prototype.TOP_POSITION,positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE}),i=(this.addToolbar(this.cropImageToolbar,n),this.minimizedToolbar=new MinimizedToolbar(this.drawerInstance),{position:ToolbarPlaceholder.prototype.TOP_POSITION,positionType:ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE});this.addToolbar(this.minimizedToolbar,i),this.setToolbarButtonsSize(),this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_STOP,function(){t.destroyAllToolbars()}),this.drawerInstance.trigger(this.drawerInstance.AFTER_CREATE_TOOLBARS,[this])},DrawerToolbarManager.prototype._createToolbarsPlaceholders=function(){this.toolbarPlaceholders.outside={},this.toolbarPlaceholders.inside={},this.toolbarPlaceholders.custom={},this.toolbarPlaceholders.outside.top=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.TOP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.left=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.LEFT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.right=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.RIGHT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.outside.bottom=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.BOTTOM_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE),this.toolbarPlaceholders.inside.top=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.TOP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.left=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.LEFT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.right=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.RIGHT_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.inside.bottom=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.BOTTOM_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE),this.toolbarPlaceholders.custom.canvas=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM),this.toolbarPlaceholders.custom.popup=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.POPUP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM),this.toolbarPlaceholders.custom.minimized=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.TOP_POSITION,ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE);for(var t=["drawingTools","toolOptions","settings"],e=0;e<t.length;e++){var i=this.drawerInstance.options.toolbars[t[e]];i&&i.position==ToolbarPlaceholder.prototype.CUSTOM_POSITION&&i.customAnchorSelector&&(i=i.customAnchorSelector,this.toolbarPlaceholders[i]=new ToolbarPlaceholder(this.drawerInstance,ToolbarPlaceholder.prototype.CUSTOM_POSITION,null,i))}},DrawerToolbarManager.prototype._removeHelperElements=function(){this.drawerInstance.$toolbarsWrapper&&this.drawerInstance.$toolbarsWrapper.length&&this.drawerInstance.$toolbarsWrapper.remove();var t=this.drawerInstance.$canvasEditContainer.find(".toolbars-wrapper");t&&t.length&&t.remove(),this.drawerInstance.$toolbarsWrapper=void 0},DrawerToolbarManager.prototype._createHelperElements=function(){this._removeHelperElements();var t=$('<div class="toolbars-wrapper"></div>');this.drawerInstance.$canvasEditContainer.append(t),this.drawerInstance.$toolbarsWrapper=t},DrawerToolbarManager.prototype.destroyAllToolbars=function(){this.settingsToolbar.remove(),this.drawingToolsToolbar.remove(),this.toolOptionsToolbar.remove()},DrawerToolbarManager.prototype.resetAllToolbars=function(){this.destroyAllToolbars(),this.createAllToolbars()},DrawerToolbarManager.prototype._adjustElementsSize=function(t,e){for(var i=$("[data-editable-canvas-sizeable="+t+"]"),o=0;o<i.length;o++){var n=i[o],r=$(n).attr("data-editable-canvas-cssrules");if(r)for(var s=r.split(","),a=0;a<s.length;a++){var h=s[a],l=e,c=("-"==h[0]&&(h=h.substr(1),l="-"+e),h.match(/:\((.+)\)/));c&&(h=h.replace(c[0],""),c=(c=c[1]).replace("$v",l),l=new Function("return "+c)()),$(n).css(h,l+"px")}}},DrawerToolbarManager.prototype.setToolbarButtonsSize=function(t){t?this.touchDevice?this.drawerInstance.options.toolbarSizeTouch=t:this.drawerInstance.options.toolbarSize=t:t=this.touchDevice?this.drawerInstance.options.toolbarSizeTouch:this.drawerInstance.options.toolbarSize,this._adjustElementsSize("toolbar-button",t)},function(t,e,i,o){if(!(this.drawerInstance=t))throw new Error("ToolbarPlaceholder: drawerInstance is not provided!");this._setupOptions(e,i,o),this._setupElement(),this._attachEventHandlers(),this._attachDrawerEventHandlers()}),CropImageToolbar=(ToolbarPlaceholder.prototype.TOP_POSITION="top",ToolbarPlaceholder.prototype.BOTTOM_POSITION="bottom",ToolbarPlaceholder.prototype.LEFT_POSITION="left",ToolbarPlaceholder.prototype.RIGHT_POSITION="right",ToolbarPlaceholder.prototype.OVER_CANVAS_POSITION="canvas",ToolbarPlaceholder.prototype.POPUP_POSITION="popup",ToolbarPlaceholder.prototype.POSITION_TYPE_OUTSIDE="outside",ToolbarPlaceholder.prototype.POSITION_TYPE_INSIDE="inside",ToolbarPlaceholder.prototype.POSITION_TYPE_CUSTOM="custom",ToolbarPlaceholder.prototype.CUSTOM_POSITION="custom",ToolbarPlaceholder.prototype.HORIZONTAL_ORIENTATION="horizontal",ToolbarPlaceholder.prototype.VERTICAL_ORIENTATION="vertical",ToolbarPlaceholder.prototype.STATE_HIDDEN="hidden",ToolbarPlaceholder.prototype.STATE_OVERLAY="overlay",ToolbarPlaceholder.prototype.STATE_DISABLED="disabled",ToolbarPlaceholder.prototype._html_default='<ul class="noselect toolbar-placeholder" contenteditable=false><li class="toolbar-placeholder-overlay"></li></ul>',ToolbarPlaceholder.prototype._html_popup='<div class="noselect toolbar-placeholder hidden" contenteditable=false><div class="close-btn"><span class="fa fa-close"></span></div><div class="overlay"></div></div>',ToolbarPlaceholder.prototype._setupOptions=function(t,e,i){var o;t===this.POPUP_POSITION&&(o=(o=this.drawerInstance.$popupWrapper)&&o.find(".popup-content"))&&o.length&&(t=this.CUSTOM_POSITION,this.$customAnchor=o),this.position=t,this.positionType=e,this.customAnchorSelector=i},ToolbarPlaceholder.prototype._attachEventHandlers=function(){},ToolbarPlaceholder.prototype._attachDrawerEventHandlers=function(){var n=this;this.drawerInstance.on(this.drawerInstance.EVENT_EDIT_STOP,function(){n.$element.remove()});this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_CHANGE_STATE,function(t,e){e=$.extend(!0,{},e||{});n.changeState(e)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_CLEAR_STATE,function(t,e){var e=e&&e.excludeElements,i=n.$element.find(e).length,e=n.$element.closest(e).length,o=n.position===n.POSITION_TYPE_CUSTOM;i||e||o||(n.turnOffOverlay(),n.turnOffDisabled(),n._showPlaceholder())}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_HIDDEN_OFF,function(t,e){e=$.extend(!0,{},e||{});e.state="hidden",e.turnOn=!1,n.changeState(e)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_HIDDEN_ON,function(t,e){e=$.extend(!0,{},e||{});e.state="hidden",e.turnOn=!0,n.changeState(e)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_OVERLAY_ON,function(t,e){e=$.extend(!0,{},e||{});e.state="overlay",e.turnOn=!0,n.changeState(e)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_OVERLAY_OFF,function(t,e){e=$.extend(!0,{},e||{});e.state="overlay",e.turnOn=!1,n.changeState(e)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_DISABLED_ON,function(t,e){e=$.extend(!0,{},e||{});e.state="disabled",e.turnOn=!0,n.changeState(e)}),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_STATE_DISABLED_OFF,function(t,e){e=$.extend(!0,{},e||{});e.state="disabled",e.turnOn=!1,n.changeState(e)})},ToolbarPlaceholder.prototype._setPosition=function(t,e,i){if(t=t||this.position,e=e||this.positionType,i=i||this.customAnchorSelector,(this.position=t)==this.CUSTOM_POSITION){this.customAnchorSelector=i;var o=$(window.document).find(this.$customAnchor),n=$(window.document).find(i),o=o.length?o:!!n.length&&n;o?(this.orientation=this.HORIZONTAL_ORIENTATION,this.$customAnchor=o,this.$customAnchor.append(this.$element)):(this.drawerInstance.error("ToolbarPlaceholder : no anchor element found for custom toolbar by selector '"+i+"'"),this.position=this.TOP_POSITION)}else{switch(t){case this.TOP_POSITION:this.$element.addClass("toolbar-placeholder-top"),this.orientation=this.HORIZONTAL_ORIENTATION;break;case this.BOTTOM_POSITION:this.$element.addClass("toolbar-placeholder-bottom"),this.orientation=this.HORIZONTAL_ORIENTATION;break;case this.LEFT_POSITION:this.$element.addClass("toolbar-placeholder-left"),this.orientation=this.VERTICAL_ORIENTATION;break;case this.RIGHT_POSITION:this.$element.addClass("toolbar-placeholder-right"),this.orientation=this.VERTICAL_ORIENTATION;break;case this.OVER_CANVAS_POSITION:this.$element.addClass("toolbar-placeholder-overcanvas"),this.orientation=this.HORIZONTAL_ORIENTATION;break;default:this.position=this.TOP_POSITION,this.$element.addClass("toolbar-placeholder-top"),this.orientation=this.HORIZONTAL_ORIENTATION}e&&e===this.POSITION_TYPE_INSIDE&&this.$element.addClass("toolbar-placeholder-inside"),this.$element.attr("data-position",t),this.drawerInstance.$toolbarsWrapper.append(this.$element)}},ToolbarPlaceholder.prototype._setupElement=function(){var t=this._getHtmlOfElement();this.$element=$(t),this.$overlay=this.$element.find(".toolbar-placeholder-overlay"),this._setPosition()},ToolbarPlaceholder.prototype._getHtmlOfElement=function(){var t=this._html_default;return t=this.position===this.POPUP_POSITION?this._html_popup:t},ToolbarPlaceholder.prototype.changeState=function(t){var r=this,e=function(t){var i,o,n;return(t&&t.length?t:$()).each(function(t,e){e=$(e);n||(i=r.$element.find(e).length,o=r.$element.closest(e).length,n=i||o)}),n}(t&&t.excludeElements.length?t.excludeElements:$()),i=r.position===r.POSITION_TYPE_CUSTOM;if(!(e||i))switch(t.state){case this.STATE_OVERLAY:this.toggleOverlay(t.turnOn);break;case this.STATE_HIDDEN:t.turnOn?this._hidePlaceholder():this._showPlaceholder();break;case this.STATE_DISABLED:t.turnOn?this.turnOnDisabled():this.turnOffDisabled()}},ToolbarPlaceholder.prototype._hidePlaceholder=function(){this.$element.addClass("hidden")},ToolbarPlaceholder.prototype._showPlaceholder=function(){this.$element.removeClass("hidden")},ToolbarPlaceholder.prototype.toggleOverlay=function(t){t?this.turnOnOverlay():this.turnOffOverlay()},ToolbarPlaceholder.prototype.turnOnDisabled=function(){this.$element.addClass("placeholder-disabled")},ToolbarPlaceholder.prototype.turnOffDisabled=function(){this.$element.removeClass("placeholder-disabled")},ToolbarPlaceholder.prototype.turnOnOverlay=function(){this.$element.addClass("placeholder-overlayed")},ToolbarPlaceholder.prototype.turnOffOverlay=function(){this.$element.removeClass("placeholder-overlayed")},ToolbarPlaceholder.prototype.addToolbar=function(t){var e=t.$toolbar;this.$element.append(e),t.position=this.position,e.removeClass("toolbar-horizontal").removeClass("toolbar-vertical"),this.orientation==this.HORIZONTAL_ORIENTATION?e.addClass("toolbar-horizontal"):e.addClass("toolbar-vertical")},function(t,e){(e=e||{}).toolbarClass="tool-cropimage hidden",DrawerToolbar.call(this,t,e),this._createDefaultButtons(),t.trigger(t.EVENT_IMAGECROP_TOOLBAR_CREATED,[this])}),DrawingToolsToolbar=(CropImageToolbar.prototype=Object.create(DrawerToolbar.prototype),CropImageToolbar.prototype.constructor=DrawerToolbar,CropImageToolbar.prototype._createDefaultButtons=function(){},function(t,e){e.toolbarClass="drawing-tools-toolbar",this.eventNameSpace=".toolbar-drawingTools",DrawerToolbar.call(this,t,e),this._setDrawerHandlers(),t.trigger(t.EVENT_TOOLS_TOOLBAR_CREATED,[this])}),MinimizedToolbar=(DrawingToolsToolbar.prototype=Object.create(DrawerToolbar.prototype),DrawingToolsToolbar.prototype.constructor=DrawerToolbar,DrawingToolsToolbar.prototype._setDrawerHandlers=function(){var i=this.drawerInstance,t=this.eventNameSpace;i.off(i.EVENT_DO_ACTIVATE_TOOL+t),i.on(i.EVENT_DO_ACTIVATE_TOOL+t,function(t,e){i.lastUsedPluginName=e.name}),i.off(i.EVENT_DO_DEACTIVATE_TOOL+t),i.on(i.EVENT_DO_DEACTIVATE_TOOL+t,function(t,e){i.lastUsedPluginName==e.name&&(i.lastUsedPluginName=null)}),i.off(i.AFTER_CREATE_TOOLBARS+t),i.on(i.AFTER_CREATE_TOOLBARS+t,function(){i.activateDefaultPlugin()})},function(t,e){(e=e||{}).toolbarClass="tool-minimized-toolbar",DrawerToolbar.call(this,t,e),t.trigger(t.EVENT_MINIMIZED_TOOLBAR_CREATED,[this])}),OverCanvasToolbar=(MinimizedToolbar.prototype=Object.create(DrawerToolbar.prototype),MinimizedToolbar.prototype.constructor=DrawerToolbar,function(t,e){(e=e||{}).toolbarClass="tool-overcanvas-toolbar",DrawerToolbar.call(this,t,e),t.trigger(t.EVENT_FLOATING_TOOLBAR_CREATED,[this])}),SettingsToolbar=(OverCanvasToolbar.prototype=Object.create(DrawerToolbar.prototype),OverCanvasToolbar.prototype.constructor=DrawerToolbar,function(t,e){(e=e||{}).toolbarClass="tool-settings-toolbar",DrawerToolbar.call(this,t,e),this._createDefaultButtons(),t.trigger(t.EVENT_CONFIG_TOOLBAR_CREATED,[this])}),ToolOptionsToolbar=(SettingsToolbar.prototype=Object.create(DrawerToolbar.prototype),SettingsToolbar.prototype.constructor=DrawerToolbar,SettingsToolbar.prototype._createDefaultButtons=function(){},function(t,e){e.toolbarClass="tool-options-toolbar",DrawerToolbar.call(this,t,e),t.trigger(t.EVENT_OPTIONS_TOOLBAR_CREATED,[this])});ToolOptionsToolbar.prototype=Object.create(DrawerToolbar.prototype),ToolOptionsToolbar.prototype.constructor=DrawerToolbar,ToolOptionsToolbar.prototype.customScrollMode=!0,!function(h,l,t){"use strict";function r(t,e){return this.$element=h(t),this._setupOptions(e),this._setupCombobox(),this._attachEventHandlers(),this._attachDrawerEventHandlers(),{instance:this,updateSelectedValues:this.updateSelectedValues.bind(this),hideDropdown:this.hideDropdown.bind(this),showDropdown:this.hideDropdown.bind(this)}}var o=".ToolbarComboBox";r.prototype._defaultOptions={wrapper:"toolbar-combobox-wrapper",editable:!1,addNewOptions:!1,buttonMode:!1,items:[]},r.prototype._setupOptions=function(t){var e=this._collectOptionsFromElement();return this.options=h.extend(!0,{},this._defaultOptions||{},e||{},t||{}),this._initialOptions=h.extend(!0,{},t),this._initialOptionsFromElement=h.extend(!0,{},e),this.options},r.prototype._setupCombobox=function(){var t=this._generateTemplate(),t=h(t);t.insertAfter(this.$element),this.$element.addClass("hidden"),this.$combobox=t,this.$options=this.$combobox.find("ul"),this.$dropdown=this.$combobox.find(".dropdown-box"),this.$input=this.$combobox.find("input"),this.$closestToolbarItem=this.$element.closest(".toolbar-item-wrapper")},r.prototype._generateTemplate=function(){var n=this,r="";return this.options.items.forEach(function(t){var e="object"==typeof t,i=e?t.value:t,o=e&&t.text||i,e=e&&t.style||"",t=n._generateNewOptionItem(o,i,!1,!0,e);r+=t}),this.wrapperClasses=this.options.wrapper+(this.options.buttonMode?" button-mode ":"")+(this.options.editable?" edit-mode ":""),'<div class="'+this.wrapperClasses+' collapsed" tabindex="-1"><div class="selected"><span></span><a class="ui-button"><i class="fa fa-angle-down"></i></a></div><div class="dropdown-box">'+(this.options.editable?'<div class="inputbox"><input type="text"/></div>':"")+'<ul class="option-list">'+r+"</ul></div></div>"},r.prototype._generateNewOptionItem=function(t,e,i,o,n){n=h('<li style="'+(n=n||"")+'"data-val="'+e+'"class="option-item"><div class="option-item-text">'+(t=t||"")+"</div></li>");return i&&(this.$combobox.find(".selected").attr("data-val",e).find("span").text(t),n.addClass("selected")),o?n.get(0).outerHTML:n},r.prototype._setupDropDownSize=function(){this.$combobox.width()&&(this.sizesUpdated=!0)},r.prototype._attachDrawerEventHandlers=function(){var s=this,a=this.$element.closest(".toolbar-item-wrapper");a&&a.length&&(l.bindClick(h("body"),"_optionTool_toggleDropdown",function(t){var t=h(t.target),e=t.closest(".toolbar-item-wrapper"),t=t.is("canvas");a.get(0)===e.get(0)||t||(a.find(".toolbar-dropdown-block").addClass("collapsed"),s.hideDropdown())}),l.bindClick(a.find(".toolbar-item-icon"),"_optionTool_toggleDDropdown",function(t){var e,i,o,n,r=a.find(".toolbar-dropdown-block").hasClass("collapsed");r&&(n=(e=(e=s.options&&s.options.drawer&&s.options.drawer.toolbars&&s.options.drawer.toolbars.toolOptionsToolbar)&&e.options)&&"popup"!==e.position,i=e&&"outside"===e.positionType,e=e&&"scrollable"===e.compactType,n=n&&i&&e)&&(i=s.$combobox.clone(!0),a.closest(".toolbar-placeholder").append(i),i.addClass("combobox-cloned"),s.$clonedCombobox=i,e=l.getScrollOffset(s.options.drawer.$canvasEditContainer),i=l.getScrollOffset(s.$element.parent()),o=s.options.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),o=s.$element.parent().get(0).getBoundingClientRect().left-o.left-(i.left-e.left)-s.$clonedCombobox.width()/2,s.$clonedCombobox.css({left:o})),n||a.find(".toolbar-dropdown-block").toggleClass("collapsed",!r)}))},r.prototype._attachEventHandlers=function(){var i,e,r=this;this.options.editable&&((i=this.$input).off("focus"+o).on("focus"+o,function(t){r.$combobox.addClass("focus"),e=!0}),i.off("blur"+o).on("blur"+o,function(t){e=!1,r.$combobox.trigger("blur")}),i.off("keypress"+o).on("keypress"+o,function(t){var e;"13"==t.keyCode&&(t=i.val(),i.val(""),e=h("<option>").val(t).text(t).attr("data-is-input",1),r.$element.append(e),r.options.addNewOptions&&(e=r._generateNewOptionItem(t,t,!0),r.$options.append(e)),r.changeActiveOption(t))})),this.$element.off("valueChanged"+o).on("valueChanged"+o,function(t,e){var i,o=r.$element.val(),n=e?e.value:void 0;e&&(i=e.classString),r.updateSelectedValues(e?n:o,i)}),this.$element.off("change"+o).on("change"+o,function(t){var e,i;r.addNewOptions||(i=(e=r.$element).attr("prev-value"),-1===r.options.valuesArr.indexOf(i)&&e.find('option[data-val="'+i+'"]').remove())}),this.$combobox.off("mouseleave"+o).on("mouseleave"+o,function(t){r.$element.closest(".toolbar-item-wrapper").find(".toolbar-dropdown-block").addClass("collapsed"),r.hideDropdown()}),this.$combobox.off("click"+o+"_optionSelect").on("click"+o+"_optionSelect",".option-item",this._onOptionSelect.bind(this)),this.$combobox.off("click"+o+"_toggleDropdown").on("click"+o+"_toggleDropdown",".selected",function(){r.toggleDropdown()}),this.$combobox.off("blur"+o).on("blur"+o,function(t){t.preventDefault(),setTimeout(function(){e||r.hideDropdown()},100),r.$combobox.removeClass("focus")})},r.prototype._collectOptionsFromElement=function(){var o={},t=this.$element.attr("data-editable")&&"true"===this.$element.attr("data-editable");return o.items=[],o.valuesArr=[],this.$element.find("option").each(function(t,e){var e=h(e),i=e.val(),e={value:i,text:e.text(),style:e.attr("style")||""};o.valuesArr.push(i),o.items.push(e)}),o.editable=t,o},r.prototype._onOptionSelect=function(t){var e=h(t.currentTarget),i=e.hasClass("selected")?"":e.attr("data-val"),e=e.text();this.hideDropdown(),this.changeActiveOption(i,e),t.stopPropagation(),t.preventDefault()},r.prototype.changeActiveOption=function(t,e){var i=this.$element.val();this.$element.attr("prev-value",i),this.$element.val(t),this.updateSelectedValues(t),this.$element.trigger("toolbarOptionChange")},r.prototype.updateSelectedValues=function(t,e,i){t=t||"";var o=this.$combobox.find(".option-item"),n=o.filter('[data-val="'+t+'"]'),r=n&&n.length?n.text():t,s=this.$combobox.hasClass("collapsed")?" collapsed":"",e=this.wrapperClasses+" "+(e||"")+s;this.$combobox.attr("class",e),this.$combobox.find(".selected span").text(r),o.removeClass("selected"),n?(n.addClass("selected"),this.$input.val("")):this.$input.val(t)},r.prototype.showDropdown=function(){this.dropdownIsVisible=!0,this.sizesUpdated||this._setupDropDownSize(),this.$combobox.find(".ui-button .fa").addClass("fa-angle-down").removeClass("fa-angle-up"),this.$combobox.removeClass("collapsed")},r.prototype.hideDropdown=function(){this.dropdownIsVisible=!1,this.$combobox.addClass("collapsed"),this.$combobox.find(".ui-button .fa").removeClass("fa-angle-down").addClass("fa-angle-up"),this.$clonedCombobox&&this.$clonedCombobox.remove()},r.prototype.toggleDropdown=function(t){t=void 0!==t?t:!this.dropdownIsVisible;(this.dropdownIsVisible=t)?this.showDropdown():this.hideDropdown()},h.fn.ToolbarComboBox=function(o){var n=[];return h(this).each(function(t,e){var i=new r(e,o);h(e).data("comboBox",i),n.push(i)}),n},h.fn.getComboBox=function(){var i=[];return h(this).each(function(t,e){e=h(e).data("comboBox");e&&i.push(e)}),1<i.length?i:i[0]},t.ToolbarComboBox=r}((window,jQuery),DrawerJs.util,DrawerJs.utilPlugins),!function(l,t){"use strict";function r(t,e){return this.$element=l(t),this._setupOptions(e),this._processOptions(),this._setupTooltip(),this._attachEventHandlers(),{instance:this,$trigger:this.$element,adjustPosition:this.adjustPosition.bind(this),destroy:this.destroy.bind(this),hideTooltip:this.hideTooltip.bind(this),showTooltip:this.showTooltip.bind(this)}}r.prototype._defaultOptions={defaultClass:"editable-canvas-tooltip",defaultPositionX:"center",defaultPositionY:"bottom",additionalClass:"",text:"",position:"",style:"",styleObj:{},$tooltipWrapper:"",tooltipWrapperSelector:void 0},r.prototype.enabled=!0,r.prototype._defaultWrapper="body",r.prototype._eventsNamespace=".drawerTooltip",r.prototype._firstShow=!0,r.prototype._setupOptions=function(t){var e=this._collectOptionsFromElement();return this.options=l.extend(!0,{},this._defaultOptions||{},e||{},t||{}),this._initialOptions=l.extend(!0,{},t),this._initialOptionsFromElement=l.extend(!0,{},e),this.options},r.prototype._checkElement=function(t){var e,i;return"string"==typeof t&&(i=l(t)),e=(i=t instanceof l?t:i)&&i.length?i.eq(0):e},r.prototype._processOptions=function(){var t=this._checkElement(this.options.$tooltipWrapper),e=this._checkElement(this.options.tooltipWrapperSelector),i=this._checkElement(this._defaultWrapper);this.$tooltipWrapper=t||e||i},r.prototype._setupTooltip=function(){var t=this._generateTemplate(),t=l(t);this.options.styleObj&&t.css(this.options.styleObj),this.$element.addClass("tooltip-trigger"),this.$element.data("DrawerTooltip",this),this.$tooltipWrapper.append(t),this.$tooltip=t},r.prototype._generateTemplate=function(){var t=this.options.text||"";return'<span class="'+(this.options.defaultClass+" "+this.options.additionalClass)+'"style="'+(this.options.style||"")+'">'+t+"</span>"},r.prototype._attachEventHandlers=function(){var n=this,r=this.$element;this._detachEventHandlers(),r.on("mouseenter"+this._eventsNamespace,function(t){var t=l(t.currentTarget),e=l("body"),i=e.hasClass("drawer-moving"),e=e.hasClass("drawer-resizing"),o=r.hasClass("disabled");i||e||o||n.showTooltip(t)}),r.on("mouseout"+this._eventsNamespace,function(){n.hideTooltip()})},r.prototype._detachEventHandlers=function(){this.$element.off("mouseenter"+this._eventsNamespace),this.$element.off("mouseout"+this._eventsNamespace)},r.prototype._parsePositionString=function(t){var e={},i=-1!==(t=t||this.options.position||"").indexOf("right")||-1!==t.indexOf("left"),o=i&&(-1!==t.indexOf("right")?"right":"left"),n=-1!==t.indexOf("top")||-1!==t.indexOf("bottom"),t=n&&(-1!==t.indexOf("top")?"top":"bottom"),o=o||(n?"center":this.options.defaultPositionX),t=t||(i?"center":this.options.defaultPositionY);return e.positionX=o,e.positionY=t,e},r.prototype._resetTooltip=function(t){},r.prototype.adjustPosition=function(t,e){if(this.enabled){e=e||this.$element;var t=this._parsePositionString(t),i=this.$tooltip,o=0,n=0,r=e.get(0).getBoundingClientRect(),s=i.get(0).getBoundingClientRect(),a=l(document).scrollLeft(),h=l(document).scrollTop();switch(t.positionX){case"right":n=a+r.left+r.width+8;break;case"left":n=a+r.left-s.width-8;break;default:n=a+r.left+(r.width-s.width)/2}switch(t.positionY){case"top":o=h+r.top-s.height-8;break;case"bottom":o=h+r.top+r.height+8;break;default:o=h+r.top+(r.height-s.height)/2}i.attr("positionX",t.positionX),i.attr("positionY",t.positionY),i.css({top:o+"px",left:n+"px"})}},r.prototype._collectOptionsFromElement=function(t){var e={items:[]},i=(t=t||this.$element).text(),o=t.attr("tooltip-text"),n=t.attr("tooltip-style")||"",t=t.attr("tooltip-position")||"";return e.text=o||i,e.style=n,e.position=t,e},r.prototype.destroy=function(){this._detachEventHandlers(),this.$tooltip.remove(),this.$element.data("DrawerTooltip",void 0),this.$element.removeClass("tooltip-trigger"),this.enabled=!1},r.prototype.showTooltip=function(t){this.enabled&&(this.$element.trigger("showTooltip"),this._firstShow=!1,this.$tooltip.is(":visible")||this.$tooltip.addClass("tooltip-transparent"),this.adjustPosition(void 0,t),this.$tooltip.removeClass("tooltip-transparent"),this.$tooltip.addClass("active"),this.isVisible=!0)},r.prototype.hideTooltip=function(){this.enabled&&this.isVisible&&(this.$tooltip.removeClass("active"),this.isVisible=!1)},l.fn.DrawerTooltip=function(o){var n=[];return l(this).each(function(t,e){var i=new r(e,o);l(e).data("DrawerTooltip",i),n.push(i)}),n},l.fn.getDrawerTooltip=function(){var i=[];return l(this).each(function(t,e){e=l(e).data("DrawerTooltip");e&&i.push(e)}),1<i.length?i:i[0]},t.Tooltip=r}((window,jQuery),(DrawerJs.util,DrawerJs.utilPlugins)),!function(s,a){"use strict";function t(t,e){return this.drawerInstance=t,this._setupOptions(e),this._processOptions(),this._createHelperElements(),this._attachDrawerEventHandlers(),this._attachEventHandlers(),{instance:this,createTooltip:this.createTooltip.bind(this)}}t.prototype._defaultOptions={tooltipCss:{}},t.prototype._tooltipInstances=[],t.prototype._setupOptions=function(t){var e={styleObj:this.drawerInstance.options.tooltipCss};return this.options=s.extend(!0,{},this._defaultOptions||{},e,t||{}),this._initialOptions=s.extend(!0,{},t),this.options},t.prototype._processOptions=function(){},t.prototype.createTooltip=function(t,e){t=t||[];var i,o=this,n=[],r=s.extend(!0,{},this.options,e||{});return t.each(function(t,e){i=new a.Tooltip(e,r),o._tooltipInstances.push(i),n.push(i)}),n},t.prototype.removeAllTooltips=function(){this._tooltipInstances.forEach(function(t){t.destroy()}),this._tooltipInstances=[]},t.prototype.hideAllTooltips=function(){this._tooltipInstances.forEach(function(t){t.hideTooltip()})},t.prototype._removeHelperElements=function(){this.drawerInstance.$tooltipContainer&&this.drawerInstance.$tooltipContainer.length&&this.drawerInstance.$tooltipContainer.remove()},t.prototype._createHelperElements=function(){this._removeHelperElements();var t=this.drawerInstance.id,t=s('<div class="tooltip-container" data-drawer-instance="'+t+'"></div>');s("body").append(t),this.options.$tooltipWrapper=t,this.drawerInstance.$tooltipContainer=t},t.prototype._attachDrawerEventHandlers=function(){var o=this;this.drawerInstance.on(this.drawerInstance.EVENT_CREATE_TOOLTIP,function(t,e,i){return o.createTooltip(e,i)}),this.drawerInstance.on(this.drawerInstance.EVENT_HIDE_TOOLTIPS,function(){o.hideAllTooltips()}),this.drawerInstance.on(this.drawerInstance.EVENT_DESTROY_TOOLTIPS,function(){o.removeAllTooltips()}),this.drawerInstance.on("destroy",function(){o.removeAllTooltips()})},t.prototype._attachEventHandlers=function(){s("body").off("showTooltip").on("showTooltip",".tooltip-trigger",function(t){var e,t=s(t.currentTarget),i=t.data("DrawerTooltip");if(i._firstShow){switch(t.closest(".toolbar-placeholder").attr("data-position")){case ToolbarPlaceholder.prototype.TOP_POSITION:e=ToolbarPlaceholder.prototype.BOTTOM_POSITION;break;case ToolbarPlaceholder.prototype.BOTTOM_POSITION:e=ToolbarPlaceholder.prototype.TOP_POSITION;break;case ToolbarPlaceholder.prototype.LEFT_POSITION:e=ToolbarPlaceholder.prototype.RIGHT_POSITION;break;case ToolbarPlaceholder.prototype.RIGHT_POSITION:e=ToolbarPlaceholder.prototype.LEFT_POSITION}e&&(i.options.position=e)}})},a.TooltipManager=t}((window,jQuery),(DrawerJs.util,DrawerJs.utilPlugins)),!function(n,t){"use strict";function e(t,e){if(!t)throw new Error("BaseTool CTOR : drawerInstance is not set!");this._setupOptions(e),this.drawerInstance=t,this.drawer=t,this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),this.drawerInstance.on(this.drawerInstance.EVENT_TOOLS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)}e.prototype.name="",e.prototype.type=null,e.prototype.active=!1,e.prototype.btnClass="btn",e.prototype.faClass="",e.prototype.tooltip="",e.prototype.toolbar=null,e.prototype.$toolButton=null,e.prototype.drawerInstance=null,e.prototype._onDeactivateAllTools=function(){var t;this.active&&(t=".tool-"+this.name,this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+t,[this]))},e.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},e.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.createButton(e),this._setHandlers(),this.onToolbarCreated&&this.onToolbarCreated(t,e)},e.prototype.onToolbarDestroyed=function(t,e){this.toolbar==e&&this.removeTool()},e.prototype.removeTool=function(t){this.$toolButton&&this.toolbar.removeButton(this.$toolButton),t&&(this._unsetHandlers(),this.drawerInstance.off(this.drawerInstance.EVENT_TOOLS_TOOLBAR_CREATED,this._bindedOnToolbarCreated))},e.prototype._setHandlers=function(){var t=".tool-"+this.name;this.drawerInstance.on(this.drawerInstance.EVENT_TOOLBAR_DESTROYED+t,this.onToolbarDestroyed.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS+t,this._onDeactivateAllTools.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+t,this._onDeactivateTool.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this))},e.prototype._unsetHandlers=function(){var t=".tool-"+this.name;this.drawerInstance.off(this.drawerInstance.EVENT_TOOLBAR_DESTROYED+t),this.drawerInstance.off(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS+t),this.drawerInstance.off(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL+t),this.drawerInstance.off(this.drawerInstance.EVENT_DO_ACTIVATE_TOOL+t)},e.prototype._onDeactivateTool=function(t,e){if(!e||!e.name)throw new Error("BaseTool.onDeactivateTool() : no tool name is provided!");this.active&&e.name==this.name&&this._deactivateTool()},e.prototype._onActivateTool=function(t,e){if(!e||!e.name)throw new Error("BaseTool._onActivateTool() : no tool name is provided!");e.name!==this.name||this.active||(this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_ALL_TOOLS,{beforeActivateTool:!0}),this._activateTool())},e.prototype.createButton=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:this.btnClass,iconClass:this.faClass,tooltipText:this.tooltip,clickHandler:this.onButtonClick.bind(this)};this.group?(e.group=this.group,this.$toolButton=t.addButtonToGroup(e)):this.$toolButton=t.addButton(e)},e.prototype.onButtonClick=function(){var t=this.active?this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL:this.drawerInstance.EVENT_DO_ACTIVATE_TOOL;this.drawerInstance.trigger(t,[this])},e.prototype._activateTool=function(){this.drawerInstance.log("TOOL","["+this.name+"] .activateTool() [BaseTool]"),this.drawerInstance.fCanvas.discardActiveObject(),this.drawerInstance.fCanvas.renderAll(),this.active=!0,(this.drawerInstance.activeDrawingTool=this).highlightButton(),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_ACTIVATED,[this])},e.prototype._deactivateTool=function(){this.drawerInstance.log("TOOL","["+this.name+"] : deactivateTool [BaseTool]"),this.active=!1,this.drawerInstance.activeDrawingTool===this&&(this.drawerInstance.activeDrawingTool=null),this.highlightButtonOff(),this.drawerInstance.fCanvas.renderAll(),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_DEACTIVATED,[this])},e.prototype.highlightButton=function(){this.group?this.toolbar._setGroupButtonActive(this.group.name,this.btnClass):this.toolbar.setActiveButton(this.btnClass)},e.prototype.highlightButtonOff=function(){this.toolbar.clearActiveButton()},t.BaseTool=e}(jQuery,DrawerJs.plugins),!function(e,t,i,o){"use strict";function n(t){i.call(this,t),this.type="brush",this.brushConstructor=fabric.ErasablePencilBrush}var r=o.mouseUp("BaseBrushTimer"),s=o.mouseDown("BaseBrushTimer");((n.prototype=Object.create(i.prototype)).constructor=n).prototype.doNotZoomOnActivate=!0,n.prototype.createButton=function(t){var e=this,i={buttonOrder:this.options.buttonOrder,additionalClass:this.btnClass,iconClass:this.faClass,tooltipText:this.tooltip,clickHandler:function(){var t=e.active?e.drawerInstance.EVENT_DO_DEACTIVATE_TOOL:e.drawerInstance.EVENT_DO_ACTIVATE_TOOL;e.drawerInstance.trigger(t,[e])}};this.$toolButton=t.addButton(i)},n.prototype._activateTool=function(){i.prototype._activateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : activateTool [BaseBrush]");var t=this,e=t.drawerInstance.fCanvas;e.freeDrawingCursor="url(/redactor.plugin.drawer/dist/cursor-fa-eraser.cur), default",e.isDrawingMode=!0,t.brush||(t.createBrush?t.brush=t.createBrush():t.brush=new fabric.ErasablePencilBrush(t.drawerInstance.fCanvas)),t.previousBrush=t.drawerInstance.getBrush(),t.drawerInstance.setBrush(t.brush),t.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_ACTIVATED,[this]),this.afterActivateTool(),this._attachTimerEvents()},n.prototype._attachTimerEvents=function(){var t=this.drawerInstance.fCanvas.upperCanvasEl,t=e(t);this._removeTimerEvents(),t.on(s,this._onMouseDownTimer.bind(this)),e(window.document).on(r,this._onMouseUpTimer.bind(this))},n.prototype._onMouseDownTimer=function(){this.drawerInstance.isBrushDrawing=!0},n.prototype._onMouseUpTimer=function(){var t=this;o.setTimeout(function(){t.drawerInstance.isBrushDrawing=!1},0)},n.prototype._removeTimerEvents=function(){var t=this.drawerInstance.fCanvas.upperCanvasEl;e(t).off(s),e(window.document).off(r)},n.prototype._deactivateTool=function(){i.prototype._deactivateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : deactivateTool [BaseBrush]"),this.drawerInstance.fCanvas.isDrawingMode=!1,e(this.drawerInstance.fCanvas.upperCanvasEl).off("mousedown.BaseBrush touchstart.BaseBrush"),e(this.drawerInstance.fCanvas.upperCanvasEl).off("mouseup.BaseBrush touchend.BaseBrush"),this._removeTimerEvents(),this.drawerInstance.setBrush(this.previousBrush),this.brush=null,this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOL_DEACTIVATED,[this]),this.afterDeactivateTool()},n.prototype.afterActivateTool=function(){throw new Error(this.name+" should implement afterActivateTool() method.")},n.prototype.afterDeactivateTool=function(){throw new Error(this.name+" should implement afterDeactivateTool() method.")},t.BaseBrush=n}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseTool,DrawerJs.util),!function(n,t,e,o){"use strict";function i(t){if(!t)throw new Error("BaseShape CTOR : drawerInstance is not set!");e.call(this,t),this.drawer=t,this.type="shape",this.objectBaseType="shape",this.toolOptionsList=["color","border","opacity"],this.drawingInProgress=!1,this.onlyOneItem=!0,this.MOUSEMOVE=this.getEventId(["mousemove","touchmove"]),this.MOUSEDOWN=this.getEventId(["mousedown","touchstart"]),this.MOUSEUP=this.getEventId(["mouseup","touchend"])}((i.prototype=Object.create(e.prototype)).constructor=i).prototype.minShapeSize=4,i.prototype.minShapeSizeForTouch=15,i.CENTERING_MODE={NORMAL:"normal",FROM_CENTER:"from_center"},i.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},i.prototype.getEventId=function(t){var e=this;if((t=t instanceof String?[t]:t)instanceof Array)return t.map(function(t){return t+".drawerTool"+e.btnClass}).join(" ")},i.prototype._activateTool=function(){var t;this.active||(e.prototype._activateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : _activateTool() [BaseShape]"),this.drawerInstance.touchDevice||this.showHelpTooltip(),(t=this.drawerInstance.fCanvas).disableSelection(),t.renderAll(),t.defaultCursor="crosshair",this.setUpHandlers?this.setUpHandlers():this._setUpHandlers())},i.prototype._setUpHandlers=function(){var i=this,e=this.drawerInstance.fCanvas;n(e.upperCanvasEl).on(i.MOUSEDOWN,function(t){if(i.drawerInstance.log("baseShape","mousedown"),n(e.upperCanvasEl).off(i.MOUSEDOWN),i.drawerInstance.touchDevice||i.removeHelpTooltip(),e.getActiveObject())return!0;if(i.drawingInProgress)return i.finishItemDraw(),!0;i.drawingInProgress=!0,i.drawerInstance.drawingInProgress=!0;t=i.drawer.fCanvas.getPointer(t,!0);if(!i.createShape)throw new Error("createShape method does not exist",i);i.shape=i.createShape(t.x,t.y),i.drawerInstance.trigger(i.drawerInstance.EVENT_ZOOM_SET),e.add(i.shape),i.drawerInstance.trigger(i.drawerInstance.EVENT_ZOOM_RESTORE),n(document).on(i.MOUSEMOVE,function(t){t=i.drawer.fCanvas.getPointer(t);if(!i.updateShape)throw new Error("updateShape method does not exist",i);i.updateShape(i.shape,t.x,t.y),e.renderAll()}),n(document).on(i.MOUSEUP,function(){i.drawerInstance.log("baseShape","mouseup");var t=i.drawer.touchDevice?i.minShapeSizeForTouch:i.minShapeSize,e=i.shape.width<t,t=!i.checkOnlyWidth&&i.shape.height<t;(i.checkOnlyWidthOrHeight?e&&t:e||t)?(i.shape.remove(),i.shape=null,i._deactivateTool(),i._activateTool()):(i.finishItemDraw(),i.onlyOneItem&&i.drawerInstance.trigger(i.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,i))})})},i.prototype.finishItemDraw=function(){var t,e=this,i=e.drawerInstance.fCanvas;i.defaultCursor="default",this.drawerInstance.touchDevice||e.removeHelpTooltip(),i.deactivateAll(),i.calcOffset(),e.drawingInProgress=!1,o.setTimeout(function(){e.drawerInstance.drawingInProgress=!1}),n(document).off(e.MOUSEMOVE),n(document).off(e.MOUSEUP),this.finishShape&&this.finishShape(this.shape),e.shape&&(e.shape.width<0&&(e.shape.set("width",-1*e.shape.width),e.shape.set("left",e.shape.left-e.shape.width),e.shape.set("flipX",!0)),e.shape.height<0&&(e.shape.set("height",-1*e.shape.height),e.shape.set("top",e.shape.top-e.shape.height),e.shape.set("flipY",!0)),t=e.shape.clone(),e.shape.remove(),e.shape=null,i.deactivateAll(),i.add(t),i.restoreSelection(),i.renderAll(),i.calcOffset(),i.renderAll())},i.prototype._deactivateTool=function(){this.active&&(e.prototype._deactivateTool.call(this),this.drawerInstance.log("TOOL",this.name+" : _deactivateTool() [BaseShape]"),this.finishItemDraw(),n(this.drawerInstance.fCanvas.upperCanvasEl).off(this.MOUSEDOWN),this.drawerInstance.fCanvas.restoreSelection())},i.prototype.showHelpTooltip=function(){var e=this,t=e.drawerInstance.fCanvas,i="",i=this.helpTooltipText||e.drawerInstance.t("Click to start drawing a ")+'<i class="fa '+e.faClass+'"></i>';e.cursorTooltip=n('<div class="drawer-tool-mouse-tooltip '+this.btnClass+'">'+i+"</div>"),n("body").append(e.cursorTooltip),n(t.upperCanvasEl).on("mousemove.drawer-tool-mouse-toolip",function(t){e.cursorTooltip.css("left",t.pageX),e.cursorTooltip.css("top",t.pageY)}),n(t.upperCanvasEl).on("mouseleave",function(){e.cursorTooltip.css("opacity",0)}),n(t.upperCanvasEl).on("mouseenter",function(){e.cursorTooltip.css("opacity",1)})},i.prototype.removeHelpTooltip=function(){this.cursorTooltip&&(n("body").off("mousemove.drawer-tool-mouse-toolip"),this.cursorTooltip.fadeOut(),this.cursorTooltip.remove())},t.BaseShape=i}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseTool,DrawerJs.util),!function(t,n){"use strict";function r(t){var e,i=!1;return t&&(e=void 0!==t.naturalWidth&&0!==t.naturalWidth,t=void 0!==t.naturalHeight&&0!==t.naturalHeight,i=e&&t),i}function s(t){n.addStyleToStyleSheet(".editable-canvas-not-edited","background: url("+t+") !important;background-repeat: no-repeat !important;background-position: center !important;background-size: contain !important;","#canvasInactiveImage",!0)}t.prototype.setInactiveDrawerImage=function(t){var e,i,o;t&&(e="string"==typeof t&&t.length,i=t instanceof Image,o=e?t:t.src,e||i)&&(i&&t.complete&&r(t)?s(o):n.loadImage(o,null,null,!0).then(function(t){r(t)&&s(t.src)}))}}((jQuery,DrawerJs.DrawerApi),DrawerJs.util),!function(e,o,t,s){function i(t,e){o.call(this,t);var i=this;this.drawer=t,this.name="BackgroundImage",this.btnClass="btn-image",this.faClass="fa-image",this.tooltip=t.t("Insert a background image"),this._setupOptions(e),-1!=["stretch","center","bottom-left","bottom-right","top-right"].indexOf(this.options.imagePosition)&&(this.options.dynamicRepositionImage?(t=(t=0<this.options.dynamicRepositionImageThrottle?parseInt(this.options.dynamicRepositionImageThrottle):0)?this._throttle(this._repositionImage.bind(this),t):this._repositionImage.bind(this),this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_RESIZING,t)):this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE,this._repositionImage.bind(this))),this.options.fixedBackgroundUrl&&this.drawerInstance.on(this.drawerInstance.EVENT_CANVAS_READY,function(){i.loadImageFromUrl(i.options.fixedBackgroundUrl,e,!0)})}((i.prototype=Object.create(o.prototype)).constructor=i).prototype._defaultOptions={cropIsActive:!0,maxImageSizeKb:5120,imagePosition:"stretch",dynamicRepositionImage:!0,dynamicRepositionImageThrottle:100,acceptedMIMETypes:["image/jpeg","image/png","image/gif"]},i.prototype._activateTool=function(){var t=this;this.drawerInstance.log("TOOL","BackgroundImageTool._activateTool()"),o.prototype._activateTool.call(this),this._showDialog(),s.setTimeout(function(){t.drawerInstance.trigger(t.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,[t])},300)},i.prototype._showDialog=function(){var t=this.options.acceptedMIMETypes.join(",");($el=e('<input type="file" accept="'+t+'">')).on("change",this._processFileInput.bind(this)),$el.click()},i.prototype._processFileInput=function(t){var t=t.target.files;t.length<1?this.drawerInstance.showError(this.drawerInstance.t("No file selected.")):(t=t[0],this._checkFile(t)&&(this.options.cropIsActive&&this.drawer._pluginsInstances.ImageCrop?this.readFile(t,this._triggerImageCrop.bind(this)):this.readFile(t,this.loadImageFromUrl.bind(this))))},i.prototype._triggerImageCrop=function(t,e){t={url:t,callback:this.loadImageFromUrl.bind(this)};this.drawerInstance.trigger(this.drawerInstance.EVENT_IMAGE_CROP,t)},i.prototype.readFile=function(e,i){var o=this,n=new FileReader;n.onload=function(t){o.drawerInstance.log("IMAGE LOADED:",e.name),i(n.result)},n.readAsDataURL(e)},i.prototype._checkFile=function(t){return t.type.indexOf("image")<0?(this.drawerInstance.showError(this.drawerInstance.t("Incorrect file type.")),!1):!(0<this.options.maxImageSizeKb&&t.size>1024*this.options.maxImageSizeKb&&(t=(t=this.drawerInstance.t("File is to big!. Maximum file size is "))+this.options.maxImageSizeKb+" KB",this.drawerInstance.showError(t),1))},i.prototype.loadImageFromUrl=function(t,e,i){var o=this,n=new Image;n.onload=function(){o.makeImageBackground(n,e)},i&&(n.onerror=function(){var t=o.drawerInstance.t("Image failed to create!");o.drawerInstance.showError(t)}),n.src=t},i.prototype.makeImageBackground=function(t,e){var i=this.drawerInstance.fCanvas,t=new fabric.Image(t),e=(e=e||this.options,this._calcPositioningOptions(t,e.imagePosition));i.setBackgroundImage(t,function(){i.renderAll()},e)},i.prototype._calcPositioningOptions=function(t,e){var i=this.drawerInstance.fCanvas,o={};switch(e){case"stretch":o.left=0,o.top=0,o.width=i.width,o.height=i.height;break;case"center":o.originX="center",o.originY="center",o.left=i.getCenter().left,o.top=i.getCenter().top;break;case"top-left":o.left=0,o.top=0;break;case"top-right":o.left=i.width-t.width,o.top=0;break;case"bottom-left":o.left=0,o.top=i.height-t.height;break;case"bottom-right":o.left=i.width-t.width,o.top=i.height-t.height;break;case"default":o.left=0,o.top=0,o.width=i.width,o.height=i.height}return o},i.prototype._repositionImage=function(){var t=this.drawerInstance.fCanvas;if(t.backgroundImage){var e=t.backgroundImage,i={};switch(this.options.imagePosition){case"stretch":i.width=t.width,i.height=t.height;break;case"center":i.originX="center",i.originY="center",i.left=t.getCenter().left,i.top=t.getCenter().top;break;case"top-right":i.left=t.width-e.width,i.top=0;break;case"bottom-right":i.left=t.width-e.width,i.top=t.height-e.height;break;default:return}e.set(i),e.setCoords(),t.renderAll()}},i.prototype.createButton=function(t){this.options.fixedBackgroundUrl||o.prototype.createButton.call(this,t)},i.prototype._throttle=function(t,e){var i,o,n=!1;function r(){n?(i=arguments,o=this):(t.apply(this,arguments),n=!0,s.setTimeout(function(){n=!1,i&&(r.apply(o,i),i=o=null)},e))}return r},t.BackgroundImage=i}(jQuery,DrawerJs.plugins.BaseTool,DrawerJs.plugins,DrawerJs.util),!function(t){t.prototype.setBackgroundImageFromUrl=function(t,e,i){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("BackgroundImage").loadImageFromUrl(t,e)},t.prototype.setBackgroundImage=function(t,e){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("BackgroundImage").makeImageBackground(t,e)}}(DrawerJs.DrawerApi),!function(n,t){"use strict";function e(t,e){if(!t)throw new Error("BaseToolOptions CTOR : drawer is not set!");this.drawer=t,this._setupOptions(e),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(t.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(t.EVENT_TOOLBAR_DESTROYED,this._onToolbarDestroyed.bind(this)),t.on(t.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateTool.bind(this)),t.on(t.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),t.on(t.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),t.on(t.EVENT_TOOL_DEACTIVATED,this._onDeactivateTool.bind(this)),t.on(t.EVENT_TOOL_ACTIVATED,this._onActivateTool.bind(this)),t.on(t.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),t.on(t.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),t.on(t.EVENT_TEXT_EDITING_ENTERED,this._onTextEditingEntered.bind(this)),t.on(t.EVENT_TEXT_EDITING_EXITED,this._onTextEditingExited.bind(this))}e.prototype.active=!1,e.prototype.drawer=null,e.prototype.toolbar=null,e.prototype.name="",e.prototype.type=null,e.prototype.optionName="",e.prototype.btnClass="btn",e.prototype.faClass="",e.prototype.showOnEditMode=!1,e.prototype.hideOnEditMode=!0,e.prototype.data={},e.prototype._setupOptions=function(t,e,i){t=t||{};var e=this._collectDefaultOptions(e),o=n.extend(!0,{},this._defaultOptions||{},e||{},t),o=this._onOptionsSetup(this._defaultOptions,t,e,o)||o;return i||(this.options=o),o},e.prototype._onOptionsSetup=function(t,e,i,o){return o},e.prototype._collectDefaultOptions=function(t){t=t||this.name||this.optionName;var e=this.drawerInstance||this.drawer;return e&&e.getPluginConfig(t)},e.prototype._onToolbarCreated=function(t,e){var i;this.toolbar=e,this.createControls&&this.createControls(e),this.useCombobox&&this.$toolControl&&(e={drawer:this.drawer,editable:!this.onlyPredefined,buttonMode:this.buttonMode},(i=this.$toolControl.find("select")).ToolbarComboBox(e),this.comboBox=i.getComboBox())},e.prototype._onToolbarDestroyed=function(t,e){this.toolbar==e&&this.removeTool()},e.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},e.prototype._onTextEditingEntered=function(t,e){var i=(e=e&&e.target)&&e.isEditing;!this.hideOnEditMode&&(this.showOnEditMode||i)?this.showControls(!0,e):this.hideControls()},e.prototype._onTextEditingExited=function(t,e){e=e&&e.target&&e.target.isEditing;this.hideOnEditMode&&!e?this.showControls():this.hideControls()},e.prototype._onDeactivateTool=function(t,e){this.active=!1,this.options&&this.options.alwaysVisible?this.showControls():this.hideControls()},e.prototype._onActivateTool=function(t,e){this.updateOnTool(e)},e.prototype.updateOnTool=function(t){var e=t.toolOptionsList&&-1!==t.toolOptionsList.indexOf(this.optionName),i=!this.showOnEditMode||t.isEditing;e&&i?(this.active=!0,this.showControls(),this.onActivateTool&&this.onActivateTool(t)):(this.active=!1,this.hideControls(t.forceOptionsHide))},e.prototype._onObjectSelected=function(t,e){var e=e.target,i=e.objectOptionsList&&-1!==e.objectOptionsList.indexOf(this.optionName),o=!this.showOnEditMode||e.isEditing;i&&o?(this.showControls(),this.updateControlsFromObject(e)):this.hideControls()},e.prototype.onSelectionCleared=function(){},e.prototype._onSelectionCleared=function(){this.drawer.activeDrawingTool?this.updateOnTool(this.drawer.activeDrawingTool):this.hideControls(),this.onSelectionCleared()},e.prototype.collectDataFromObject=function(t){return{}},e.prototype.updateControls=function(t){},e.prototype.updateControlsFromObject=function(t){this.collectDataFromObject(t),this.updateControls(this.data)},e.prototype.showControls=function(t,e){},e.prototype.hideControls=function(t){},t.BaseToolOptions=e}(jQuery,DrawerJs.plugins),!function(d,t,e){"use strict";function i(t){e.call(this,t),this.drawer=t,this._setEventHandlers(),this._setGlobalClickHandler()}(i.prototype=Object.create(e.prototype)).constructor=e,i.prototype.buttonIconClass="",i.prototype.showOnEditMode=!0,i.prototype.hideOnEditMode=!1,i.prototype.focusTextOnChange=!1,i.prototype.onlyPredefined=!1,i.prototype.stylesToObject=!1,i.prototype.useCombobox=!0,i.prototype.buttonMode=!0,i.prototype.predefined={},i.prototype.valueType={},i.prototype.minValue=void 0,i.prototype.maxValue=void 0,i.prototype._setEventHandlers=function(){this.drawer.on(this.drawer.EVENT_TEXT_STYLES_CHANGED,this._onStylesChanged.bind(this)),this.drawer.on(this.drawer.EVENT_TEXT_GET_STYLES,this._onGetStyles.bind(this)),this._onObjectAdded&&this.drawer.on(this.drawer.EVENT_OBJECT_ADDED,this._onObjectAdded.bind(this))},i.prototype._onStylesChanged=function(t,e,i,o){this.updateControls(e,i,o)},i.prototype._onGetStyles=function(t,e,i){(i=i||{}).defaultValues=d.extend(!0,{},i.defaultValues||{},this.options.defaultValues||{})},i.prototype.updateControls=function(h,l,c){h=h||this._lastData||{},l=l||{},c=c||[];var p=this,u=this.$toolControl;u&&u.find(".controls-value-item").each(function(t,e){var e=d(e),i=e.is("input, select, textarea"),o=e.data("name"),n=p._defaultOptions.defaultValues[o],r=l[o],s=-1!==c.indexOf(o),a=void 0===h[o],n=void 0!==h[o]?h[o]:r||n,i=(s&&(n=""),i&&e.val(n),p._updateClasses(a,a&&n===r,s),u.toggleClass("option-value-invalid",!!a),u.toggleClass("option-value-multiple",!!s),u.toggleClass("option-value-inherited",!(!a||n!==r)),(a&&n===r?" option-value-inherited ":"")+(a?" option-value-invalid ":"")+(s?" option-value-multiple ":""));e.data("comboBox")?e.data("comboBox").updateSelectedValues(n,i):e.trigger("valueChanged",[{value:n,valueName:o,inherited:a||n===r,multipleValues:s,classString:i}]),p.updateSingleControl(o,n)})},i.prototype._updateClasses=function(t,e,i){this.$toolControl.toggleClass("option-value-invalid",!!t),this.$toolControl.toggleClass("option-value-multiple",!!e),this.$toolControl.toggleClass("option-value-inherited",!!i)},i.prototype.updateSingleControl=function(t,e){},i.prototype.setStyles=function(t){t=t||this._lastData||this.getStylesFromControls();var e=this.drawer.fCanvas.getActiveObject();if(e){if(e.selectionEnd===e.selectionStart)this.drawer.setTemporaryStyles(t);else if(this.drawer.setTemporaryStyles(),this.stylesToObject)for(var i in t)e[i]=t[i];else e.setSelectionStyles(t);this._lastData=t,this.focusTextOnChange&&(this.comboBox&&this.comboBox.hideDropdown(),e.hiddenTextarea)&&e.hiddenTextarea.focus(),e.canvas.renderAll()}},i.prototype.normalizeValue=function(t,e,i){i=i?void 0:this.options.defaultSize,i=!this.validateValue(t,e)?i:t;return this.minValue&&void 0!==this.minValue[e]&&(i=i<this.minValue[e]?this.minValue[e]:i),i=this.maxValue&&void 0!==this.maxValue[e]?i>this.maxValue[e]?this.maxValue[e]:i:i},i.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},i.prototype.generateControlHtml=function(){var t="";return t=this.controlTemplate?"function"==typeof this.controlTemplate?this.controlTemplate():this.controlTemplate:t},i.prototype.createControls=function(t,e){this.changeCallback=e;var i=this.generateControlHtml();return this.$toolControl=d(i),t.addControl(this.$toolControl,this.options.buttonOrder),this.setupControl(t,this.$toolControl,e),this._attachEvents(),this.$toolControl},i.prototype.setupControl=function(t,e,i){},i.prototype._collectDefaultOptions=function(t){var e=this.drawer.getPluginConfig("Text");return{predefined:d.extend(!0,{},e.predefined||{}),defaultValues:d.extend(!0,{},e.defaultValues||{})}},i.prototype._onOptionsSetup=function(t,e,i,o){var n,r,s,a;for(n in e=e||{},t=t||{},i=i||{},o.predefined)r=t.predefined&&t.predefined[n],s=i.predefined&&i.predefined[n],a=e.predefined&&e.predefined[n],o.predefined[n]=void 0!==a&&!1!==a?a:void 0!==s&&!1!==s?s:void 0!==r&&!1!==r?r:[];return o},i.prototype.onInputChange=function(t){t=this.getStylesFromChangeEvent(t);t||this.getStylesFromControls(),this.setStyles(t),this._updateClasses()},i.prototype.getStylesFromChangeEvent=function(t){},i.prototype.getStylesFromControls=function(){var n=this,r={},t=this.$toolControl;return t&&t.find("input, select, textarea").each(function(t,e){var e=d(e),i=e.data("name"),e=e.val(),o=n.normalizeValue(e,i);void 0!==i&&void 0!==e&&(r[i]=o)}),this._lastData=r},i.prototype.validateValue=function(t,e,i){var o=this.onlyPredefined&&this.predefined&&this.predefined[e],n=o&&-1!==this.predefined[e].indexOf(t);switch(this.valueType[e]){case"number":a="number"==typeof(t=parseFloat(t))&&isFinite(t);break;case"string":a="string"==typeof t;break;case"color":var r="string"==typeof t,s=t instanceof fabric.Color,a=i?s:r;break;default:a=void 0!==t}return a=o?a&&n:a},i.prototype.hideControls=function(){this.$toolControl&&this.$toolControl.addClass("hidden")},i.prototype.showControls=function(t,e){t&&(t=(e=e||this.drawer.fCanvas.getActiveObject()).getSelectionStyles(),e=e.getObjStyles(),this.updateControls(t,e)),this.$toolControl&&this.$toolControl.removeClass("hidden")},i.prototype.remove=function(){this.$toolControl&&this.$toolControl.remove()},i.prototype._setGlobalClickHandler=function(){var e=this;d("html").off("click.textOptionTool").on("click.textOptionTool",function(t){e.hideControls()})},t.BaseTextOptionTool=i}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),!function(i,t,o){function e(t,e){i.call(this,t),this.name="SimpleWhiteEraser",this.btnClass="btn-simple-eraser",this.faClass="fa-eraser",this.tooltip=t.t("SimpleWhiteEraser"),this._defaultOptions={brushSize:3,cursorUrl:"eraser"},this._setupOptions(e),"eraser"==this.options.cursorUrl&&(t=o.getDrawerFolderUrl())&&(this.options.cursorUrl="url("+t+"assets/cursor-fa-eraser.cur), default"),this.previousColor=null,this.previousBrushSize=null,this.savedBrushSize=this.options.brushSize}((e.prototype=Object.create(i.prototype)).constructor=e).prototype.afterActivateTool=function(){this.previousColor=this.drawerInstance.fCanvas.freeDrawingBrush.color,this.drawerInstance.fCanvas.freeDrawingBrush.color="#fff",this.drawerInstance.fCanvas.freeDrawingBrush.fill="#fff",this.drawerInstance.fCanvas.freeDrawingBrush.opacity=this.drawerInstance.activeOpacity,this._previousCursor=this.drawerInstance.fCanvas.freeDrawingCursor,this.drawerInstance.fCanvas.freeDrawingCursor=this.options.cursorUrl,this.previousBrushSize=this.drawerInstance.freeDrawingBrushSize,this.drawerInstance.setFreeDrawingBrushSize(this.savedBrushSize)},e.prototype.afterDeactivateTool=function(){this.drawerInstance.fCanvas.freeDrawingCursor=this._previousCursor,this.drawerInstance.fCanvas.freeDrawingBrush.color=this.previousColor,this.drawerInstance.fCanvas.freeDrawingBrush.fill=this.previousColor,this.savedBrushSize=this.drawerInstance.freeDrawingBrushSize,this.drawerInstance.setFreeDrawingBrushSize(this.previousBrushSize)},t.SimpleWhiteEraser=e}((jQuery,DrawerJs.plugins.BaseBrush),DrawerJs.plugins,DrawerJs.util),!function(i,e,o,t,n){"use strict";function r(t,e){o.call(this,t),this.name="Eraser",this.btnClass="btn-eraser",this.faClass="fa-eraser",this.tooltip=t.t("Eraser"),this.separatePathOnShapes=!0,this._defaultOptions={cursorUrl:"none",brushSize:3,useCoordsQueue:!1},this._setupOptions(e),this.toolOptionsList=["brushSize"],this.forceOptionsHide=!0,this.previousColor=null,this.previousBrushSize=null,this.savedBrushSize=this.options.brushSize,this.erasingNow=!1,this.brush=null}var s=n.mouseUp("Eraser"),a=n.mouseDown("Eraser"),h=n.mouseMove("Eraser"),l="mouseenter.EraserCursor",c="mouseleave.EraserCursor";((r.prototype=Object.create(o.prototype)).constructor=r).prototype.afterActivateTool=function(){var t=this.drawerInstance,e=t.fCanvas;this._previousCursor=t.fCanvas.freeDrawingCursor,t.fCanvas.freeDrawingCursor=this.options.cursorUrl,this.brush=this._createBrush(),t.setBrush(this.brush),t.on(t.EVENT_BRUSH_SIZE_CHANGED,this._updateCursorShapeSize.bind(this)),i(e.upperCanvasEl).on(h,this._onMouseMove.bind(this)),i(e.upperCanvasEl).on(a,this._onMouseDown.bind(this)),i(e.upperCanvasEl).on(s,this._onMouseUp.bind(this)),this._createEraserCursorShape(),i(e.upperCanvasEl).on(l,this._showEraserCursorShape.bind(this)),i(e.upperCanvasEl).on(c,this._hideEraserCursorShape.bind(this)),e.on("path:created",this._onEraserPathCreated.bind(this))},r.prototype.afterDeactivateTool=function(){var t=this.drawerInstance.fCanvas;this.erasingNow=!1,t.off("path:created"),t.freeDrawingCursor=this._previousCursor,this._removeEraserCursorShape(),i(t.upperCanvasEl).off(h),i(t.upperCanvasEl).off(s),i(t.upperCanvasEl).off(a),i(t.upperCanvasEl).off(l),i(t.upperCanvasEl).off(c)},r.prototype._createBrush=function(){var t=new e.EraserBrush(this.drawerInstance.fCanvas);return t.color="#fff",t.opacity=this.drawerInstance.activeOpacity,t.width=this.options.brushSize,t},r.prototype._createEraserCursorShape=function(){var t=this.drawerInstance.getBrushSize()/2;this.eraserCursorShape=new fabric.PCircle({radius:t}),this.drawerInstance.fCanvas.add(this.eraserCursorShape),this.eraserCursorShape.isEraserBrush=!0,this.eraserCursorShape.set("fill","transparent"),this.eraserCursorShape.set("stroke","black"),this.eraserCursorShape.set("strokeWidth",1),this.eraserCursorShape.set("originX","center"),this.eraserCursorShape.set("originY","center"),this._updateCursorShapeSize()},r.prototype._removeEraserCursorShape=function(){this.eraserCursorShape&&(this.eraserCursorShape.remove(),delete this.eraserCursorShape)},r.prototype._showEraserCursorShape=function(){this.eraserCursorShape.set("visible",!0),this.drawerInstance.fCanvas.renderAll()},r.prototype._hideEraserCursorShape=function(){this.eraserCursorShape.set("visible",!1),this.drawerInstance.fCanvas.renderAll()},r.prototype._updateCursorShapeSize=function(){var t,e;this.eraserCursorShape&&(t=this.drawerInstance.getBrushSize()/2,e=2*Math.PI*t/20,this.eraserCursorShape.set("radius",t),this.eraserCursorShape.set("strokeDashArray",[e,e]))},r.prototype._onEraserPathCreated=function(t){var e=this.drawerInstance.fCanvas;t.path.set("eraserPath",!0),t.path.set("visible",!0);for(var i=0;i<this.affectedShapes.length;i++){var o=this.affectedShapes[i];delete o.eraserAffected,o.addEraserPath(t.path)}e.renderAll()},r.prototype._affectShapesUnderCoords=function(t,e){var i=this.drawerInstance.fCanvas.getObjects();this.eraserCursorShape._lastCenterPosition={x:t,y:e};for(var o=0;o<i.length;o++){var n=i[o];!n.isErasable||n.eraserAffected||n.isEraserBrush||this._checkObjectIntersection(n,t,e)&&(n.eraserAffected=!0,this.affectedShapes.push(n))}},r.prototype._checkObjectIntersection=function(i,t,e){var o,n,r=this.eraserCursorShape;return r.intersectsWithObject(i)&&!(n=!i.canvas.isTargetTransparent(i,t,e))&&(t=r._lastCenterPosition?t-r._lastCenterPosition.x:void 0,e=r._lastCenterPosition?e-r._lastCenterPosition.y:void 0,r.getPerimeterPoints(t,e).forEach(function(t,e){o=o||!i.canvas.isTargetTransparent(i,t.x,t.y)})),n||o},r.prototype._onMouseDown=function(t){var e=3===t.which,t=2===t.which;e||t||(this.affectedShapes=[],this.erasingNow=!0)},r.prototype._onMouseUp=function(){this.erasingNow=!1,this.drawerInstance.fCanvas.renderAll()},r.prototype._onMouseMove=function(t){var t=this.drawer.fCanvas.getPointer(t),e=t.x,i=t.y;this.eraserCursorShape&&(this.eraserCursorShape.set("left",t.x),this.eraserCursorShape.set("top",t.y),this.eraserCursorShape.setCoords(),this.drawerInstance.fCanvas.renderAll()),this.erasingNow&&this.separatePathOnShapes&&this._affectShapesUnderCoords(e,i)},t.Eraser=r}(jQuery,DrawerJs.brushes,DrawerJs.plugins.BaseBrush,DrawerJs.plugins,DrawerJs.util),DrawerJs.brushes.EraserBrush=fabric.util.createClass(fabric.PencilBrush,{initialize:function(t){this.callSuper("initialize",t)},_render:function(){this.canvas.fire("pencil:move:before"),this.callSuper("_render"),this.canvas.fire("pencil:move:after")},createPath:function(t){t=new fabric.EraserPath(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t}}),!function(){"use strict";fabric.EraserPath=fabric.util.createClass(fabric.Path,{type:"EraserPath",objectCaching:!1,evented:!1,selectable:!1,initialize:function(t,e){this.polygonOffsetX=(e=e||{}).polygonOffsetX||null,this.polygonOffsetY=e.polygonOffsetY||null,this.callSuper("initialize",t,e)},toString:function(){return"#<fabric.EraserPath ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(t){t=fabric.util.object.extend(this.callSuper("toObject",t),{path:this.path.map(function(t){return t.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),this.polygonOffsetX&&this.polygonOffsetY&&(t.polygonOffsetX=this.polygonOffsetX,t.polygonOffsetY=this.polygonOffsetY),t}}),fabric.EraserPath.fromObject=function(i,o){"string"==typeof i.path?fabric.loadSVGFromURL(i.path,function(t){var t=t[0],e=i.path;delete i.path,fabric.util.object.extend(t,i),t.setSourcePath(e),o(t)}):o(new fabric.EraserPath(i.path,i))},fabric.EraserPath.async=!0}(),!function(i,t,o){"use strict";function e(t,e){i.call(this,t),this.name="Pencil",this.toolOptionsList=["color","opacity","brushSize"],this.btnClass="btn-pencil",this.faClass="fa-pencil",this.tooltip=t.t("Free drawing mode"),this._defaultOptions={cursorUrl:"pencil",brushSize:2},this._setupOptions(e),"pencil"==this.options.cursorUrl&&(t=o.getDrawerFolderUrl())&&(this.options.cursorUrl="url("+t+"assets/cursor-fa-pencil.cur), default")}((e.prototype=Object.create(i.prototype)).constructor=e).prototype.createBrush=function(){var t=new fabric.ErasablePencilBrush(this.drawerInstance.fCanvas);return t.color=this.drawerInstance.activeColor,t.opacity=this.drawerInstance.activeOpacity,t.width=this.options.brushSize,t},e.prototype.afterActivateTool=function(){var t=this.drawerInstance.fCanvas;this._previousCursor=t.freeDrawingCursor,t.freeDrawingCursor=this.options.cursorUrl},e.prototype.afterDeactivateTool=function(){this.drawerInstance.fCanvas.freeDrawingCursor=this._previousCursor},t.Pencil=e}((jQuery,DrawerJs.plugins.BaseBrush),DrawerJs.plugins,DrawerJs.util),!function(a,t){"use strict";function e(n,t){var r=this;n.redactorInstance?(this.drawerInstance=n,this.drawer=n,this.name="DrawerPluginCanvasProperties",this.LOGTAG=r.name,this._setupOptions(t),r.drawerInstance.on(r.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,function(t,e){var i=r.drawerInstance.redactorInstance,o='<section id="redactor-drawer-properties"><label class="drawer-properties-size-label">'+n.t("Size (px)")+'</label><input class="drawer-properties-width" type="number" value="'+n.width+'" /><span class="size-separator">x</span><input class="drawer-properties-height" type="number" value="'+n.height+'"/><label class="drawer-properties-align-label">'+n.t("Position")+'</label><select class="drawer-properties-align"><option value="inline">'+n.t("Inline")+'</option><option value="left">'+n.t("Left")+'</option><option value="center">'+n.t("Center")+'</option><option value="right">'+n.t("Right")+'</option><option value="floating">'+n.t("Floating")+'</option></select><span class="group-transparency"><label class="drawer-properties-background">'+n.t("Background")+'</label><input type="checkbox" id="background-transparency" class="background-transparency"/><label for="background-transparency" class="background-transparency">'+n.t("transparent")+"</label></span></section>",i=(i.modal.addTemplate("drawer-properties",o),{buttonOrder:9,additionalClass:"btn-canvas-properties",iconClass:"fa-cog",tooltipText:n.t("Canvas properties"),clickHandler:function(){return r.openPopup(),!1}});e.addButton(i)})):console.error("'CanvasProperties' plugin can work only in redactor mode!")}e.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=a.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},e.prototype.openPopup=function(){var e=this,t=e.drawerInstance.redactorInstance,i=e.drawerInstance,o=(e.drawerInstance.$imageElement,t.modal.load("drawer-properties",i.t("Canvas properties"),260),t.modal.createCancelButton(),a(".redactor-modal-close-btn").html(i.t("Cancel")),t.modal.createActionButton(i.t("Save"))),n=a("#redactor-drawer-properties"),r=i.getAlign(),r=(n.find("select").val(r),n.find(".drawer-properties-width").val(i.width),n.find(".drawer-properties-height").val(i.height),e.currentAlign=r,e.currentHeight=i.height,e.currentWidth=i.width,e.$backgroundTransparencyInput=n.find("input.background-transparency"),e.$backgroundTransparencyInput.attr("checked",i.options.transparentBackground),n.find(".background-transparency").click(function(){var t=e.$backgroundTransparencyInput.attr("checked");e.$backgroundTransparencyInput.attr("checked",!t)}),o.on("click",function(){e.saveProperties()}),n.find(".drawer-properties-align"));function s(){"floating"==n.find(".drawer-properties-align").val()?n.find(".group-transparency").show():n.find(".group-transparency").hide()}s(),r.change(function(){s()}),t.modal.show(),a(document.body).css("overflow",t.modal.bodyOveflow)},e.prototype.saveProperties=function(){var t=this.drawerInstance.redactorInstance,e=this.drawerInstance,i=this.drawerInstance.getPluginInstance("Fullscreen"),o=a("#redactor-drawer-properties"),n=o.find("input.drawer-properties-width").val(),r=o.find("input.drawer-properties-height").val(),o=o.find("select.drawer-properties-align option:selected").val(),n=(this.currentWidth==n&&this.currentHeight==r||(i&&i.isInFullscreenMode()&&i.exitFullscreen(),e.setSize(n,r)),e.options.align=o,this.currentAlign!=o&&(i&&i.isInFullscreenMode()&&i.exitFullscreen(),e.setAlign(o)),this.$backgroundTransparencyInput.attr("checked"));e.options.transparentBackground=!!n,t.modal.close(),e.onCanvasModified(),e.trigger(e.EVENT_OPTIONS_CHANGED)},t.CanvasProperties=e}(jQuery,DrawerJs.plugins),!function(n,t){"use strict";function e(t,e){this.drawer=t,this.name="CloseButton",this._setupOptions(e),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(t.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(t.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated)}e.prototype._defaultOptions={buttonOrder:1},e.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},e.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.createControls&&this.createControls(e)},e.prototype.createControls=function(t){this._createAndAddButton(t)},e.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},e.prototype._createAndAddButton=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-delete-canvas",iconClass:"fa-times",tooltipText:this.drawer.t("Delete this canvas"),clickHandler:this._onCloseButtonClick.bind(this)};t.addButton(e)},e.prototype._onCloseButtonClick=function(){var t=this.drawer.t("Are you sure want to delete this canvas?");confirm(t)&&this.drawer.destroy()},t.CloseButton=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(r,t,s){"use strict";function e(t,e){var i=this;i.drawer=t,i.LOGTAG=i.name,i._setupOptions(e),i.previousWidth=null,i.previousHeight=null,i.previousOffset=null,i.$enterButton=null,i.$exitButton=null,i.onlyForEditing=!1,this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(t.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),i.drawer.on(i.drawer.EVENT_EDIT_START,function(){i.drawer.$imageElement.attr("data-before-fullscreen")?(i.$enterButton.hide(),i.$exitButton.show()):(i.$enterButton.show(),i.$exitButton.hide())}),i.drawer.on(i.drawer.EVENT_EDIT_STOP,function(){i.onlyForEditing&&i.exitFullscreen()}),r(window).on("resize",function(){i.isInFullscreenMode()&&i.adjustFullscreenSize()})}e.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=r.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},e.prototype._onToolbarCreated=function(t,e){this.toolbar=e;var i={buttonOrder:this.options.buttonOrder,additionalClass:"btn-fullscreen",iconClass:"fa-expand",tooltipText:this.drawer.t("Enter fullscreen mode"),clickHandler:this.enterFullscreen.bind(this)},o={buttonOrder:this.options.buttonOrder,additionalClass:"btn-fullscreen",iconClass:"fa-compress",tooltipText:this.drawer.t("Exit fullscreen mode"),clickHandler:this.exitFullscreen.bind(this)};this.$enterButton=e.addButton(i),this.$exitButton=e.addButton(o),this.$exitButton.hide()},e.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},e.prototype.isInFullscreenMode=function(){return void 0!==this.drawer.$imageElement.attr("data-before-fullscreen")},e.prototype.adjustFullscreenSize=function(){var t=this.drawer.redactorInstance,e=this.drawer.$imageElement,i=this.drawer.options.toolbarSize,o=t.$box.width()-i,n=t.$box.height()-i,t=t.$box.offset();this.drawer.$canvasEditContainer.css({left:t.left+"px",top:t.top+i+"px",width:o+"px",height:n+"px"}),this.drawer.fCanvas.setWidth(o),this.drawer.fCanvas.setHeight(n),this.onlyForEditing||e.css({position:"absolute",left:"0px",top:"0px",width:o+"px",height:n+"px"})},e.prototype.enterFullscreen=function(){var t=this,e=t.drawer.redactorInstance,i=t.drawer.$imageElement;t.drawer.options.toolbarSize;t.$enterButton.hide(),t.$exitButton.show(),i.attr("data-before-fullscreen",JSON.stringify({imageCss:{position:i.css("position"),display:i.css("display"),left:i.css("float"),top:i.css("top"),"margin-left":i.css("margin-left"),"margin-right":i.css("margin-right"),width:i.css("width"),height:i.css("height")},canvasCss:{width:t.drawer.width,height:t.drawer.height,offset:t.drawer.$canvasEditContainer.offset()}})),this.onlyForEditing||i.css("position","absolute"),t.adjustFullscreenSize(),this.onlyForEditing&&(i=s.getTransitionDuration(t.drawer.$canvasEditContainer[0]),s.setTimeout(function(){e.$box.css("opacity","0")},i)),t.drawer.toolbars.toolOptionsToolbar.removeClass("toolbar-bottomLeft").detach(),t.drawer.appendToolbar(t.drawer.toolbars.toolOptionsToolbar,"topRight"),t.drawer.toolbars.setToolbarButtonsSize(),t.drawer.onCanvasModified()},e.prototype.exitFullscreen=function(){var t,e,i=this,o=i.drawer.$imageElement,n=(r(".editable-canvas-tooltip").removeClass("active"),i.$enterButton.show(),i.$exitButton.hide(),o.attr("data-before-fullscreen")),n=JSON.parse(n);o.attr("data-before-fullscreen",null),this.onlyForEditing?i.drawer.redactorInstance.$box.css("opacity","1"):o.css(n.imageCss),i.drawer.$canvasEditContainer&&(o=s.getTransitionDuration(i.drawer.$canvasEditContainer[0]),t=n.canvasCss.width,e=n.canvasCss.height,i.drawer.$canvasEditContainer.css({left:n.canvasCss.offset.left+"px",top:n.canvasCss.offset.top+"px",width:t+"px",height:e+"px"}),i.drawer.$canvasEditContainer.find(".canvas-container").css({width:t+"px",height:e+"px"}),s.setTimeout(function(){i.drawer.fCanvas.setWidth(t),i.drawer.fCanvas.setHeight(e)},o),i.drawer.width=t,i.drawer.height=e,i.drawer.adjustEditContainer(!0,!0)),i.drawer.toolbars.toolOptionsToolbar.removeClass("toolbar-topRight").detach(),i.drawer.appendToolbar(i.drawer.toolbars.toolOptionsToolbar,"bottomLeft"),i.drawer.toolbars.setToolbarButtonsSize(),i.drawer.onCanvasModified()},t.Fullscreen=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(a,t,n,e){"use strict";function i(t,e){this.name="FullscreenModeButton",this.drawer=t,this.drawer.touchDevice,this._setupOptions(e),this._attachEvents(),this._setupFullscreenHandlers(),this.drawer.on(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._onConfigToolbarCreated.bind(this))}var o=n.checkBrowser("mozilla"),r=n.checkBrowser("safari"),s=n.checkBrowser("webkit");i.prototype._attachEvents=function(){var i=this,t="onfullscreenchange.FullscreenModeButton webkitfullscreenchange.FullscreenModeButton fullscreenchange.FullscreenModeButton mozfullscreenchange.FullscreenModeButton MSFullscreenChange.FullscreenModeButton ";a(document).off(t).on(t,function(){i.globalFullscreenMode=!i.globalFullscreenMode,i.reactOnResize=!0,n.setTimeout(function(){i.reactOnResize=!1},2e3),i.globalFullscreenMode?i.setFullscreenStateOn(!0):i.setFullscreenStateOff(!0)}),window.removeEventListener("resize",i._onWindowResize.bind(i)),window.addEventListener("resize",i._onWindowResize.bind(i)),a(document).off("keypress.FullscreenModeButton").on("keypress.FullscreenModeButton",function(t){var e=i.globalFullscreenMode&&i.fullscreenMode,t=27==t.keyCode;e&&t&&i.fullscreenOff(!0)})},i.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=a.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},i.prototype._onWindowResize=function(){var t=this,e=(!o||t.reactOnResize||t.globalFullscreenMode||t._saveCurrentSizes(),t.reactOnResize&&(t.globalFullscreenMode?t._refreshFullscreenSize(!1):t._restoreNormalSizes()),!t.fullscreenMode&&t.reactOnResize&&o&&!t.globalFullscreenMode),i=t.fullscreenMode&&!t.globalFullscreenMode&&s;(e||i)&&t.setFullscreenStateOff(),t.reactOnResize=!1},i.prototype._saveCurrentSizes=function(t,e){t&&e||(t=this.drawer.$canvasEditContainer.outerWidth(),e=this.drawer.$canvasEditContainer.outerHeight()),this.savedWidth=t,this.savedHeight=e},i.prototype._refreshFullscreenSize=function(t){var e=a(window),i=e.width(),e=e.height(),o=this.drawer.width,n=this.drawer.height,r=this.drawer.$canvasEditContainer,s=r.hasClass("animated");t&&this._saveCurrentSizes(o,n),r.removeClass("animated"),this.drawer.setSize(i,e),this.drawer.trigger(this.drawer.EVENT_RESTORE_DEFAULT_ZOOM),r.toggleClass("animated",!!s)},i.prototype._restoreNormalSizes=function(){var t=this,e=this.drawer.$canvasEditContainer,i=e.hasClass("animated");e.removeClass("animated"),e.css("position",this.savedPosition),console.info(this.savedWidth,this.savedHeight),this.drawer.setSize(this.savedWidth,this.savedHeight),n.setTimeout(function(){t.drawer.adjustEditContainer(),t.drawer.trigger(t.drawer.EVENT_RESTORE_DEFAULT_ZOOM),n.setTimeout(function(){e.toggleClass("animated",!!i)},0)},0)},i.prototype._setupFullscreenHandlers=function(){var t,e=document.documentElement,i=e.requestFullScreen&&function(){e.requestFullScreen()},o=e.msRequestFullscreen&&function(){e.msRequestFullscreen()},n=e.mozRequestFullScreen&&function(){e.mozRequestFullScreen()},r=e.webkitRequestFullScreen&&function(){e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)};this.fullscreenRequest=i||o||n||r||this.setFullscreenStateOn.bind(this),t=document.cancelFullScreen||document.msExitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||this.setFullscreenStateOff.bind(this),this.fullscreenCancel=function(){t.call(document)}},i.prototype._onConfigToolbarCreated=function(t,e){this.fullscreenEl=this.drawer.$canvasEditContainer.get(0),this._createAndAddButton(e)},i.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},i.prototype._createAndAddButton=function(t){var e={buttonOrder:10,additionalClass:"btn-fullscreen-canvas",iconClass:"fa-window-restore",tooltipText:this.drawer.t("Toggle fullscreen mode"),clickHandler:this._onFullscreenModeButtonClick.bind(this)},t=t.addButton(e);this.$fullscreenModeButton=t},i.prototype._toggleFullScreen=function(t){var e=document.fullScreenElement&&null!==document.fullScreenElement,i=!document.mozFullScreen&&!document.webkitIsFullScreen;!1===t||!t&&(e||i)?this.fullscreenRequest():this.fullscreenCancel()},i.prototype._onFullscreenModeButtonClick=function(){this.fullscreenMode?this.fullscreenOff():this.fullscreenOn()},i.prototype.setFullscreenStateOff=function(){var t,e,i,o=this.drawer.$canvasEditContainer||this.drawer.$canvasEditContainer.length;this.changeStateInProgress=!0,o&&(this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.trigger(this.drawer.EVENT_DESTROY_TOOLTIPS),e=(t=this).drawer.$canvasEditContainer,i=e.hasClass("animated"),this.fullscreenMode=!1,this.drawer.fullscreenMode=!1,e.addClass("fullscreen-in-progress"),e.removeClass("animated"),e.removeClass("fullscreen"),this.drawer.$imageElement.show(),this._restoreNormalSizes(),n.setTimeout(function(){t.drawer.toolbars.resetAllToolbars(),t.$fullscreenModeButton&&t.$fullscreenModeButton.removeClass("active"),r&&t._restoreNormalSizes(),e.toggleClass("animated",!!i),e.removeClass("fullscreen-in-progress"),t.changeStateInProgress=!1},0))},i.prototype.setFullscreenStateOn=function(){var t,e,i;this.changeStateInProgress=!0,(this.drawer.$canvasEditContainer||this.drawer.$canvasEditContainer.length)&&(this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.trigger(this.drawer.EVENT_DESTROY_TOOLTIPS),e=(t=this).drawer.$canvasEditContainer,i=e.hasClass("animated"),this.fullscreenMode=!0,this.drawer.fullscreenMode=!0,this.savedPosition=e.css("position"),e.addClass("fullscreen-in-progress"),e.removeClass("animated"),e.addClass("fullscreen"),this.drawer.$imageElement.hide(),t._refreshFullscreenSize(!o),n.setTimeout(function(){t.drawer.toolbars.resetAllToolbars(),t.drawer.toolbars.settingsToolbar.$toolbar.parent().addClass("fullscreenOverOther"),t.$fullscreenModeButton&&t.$fullscreenModeButton.addClass("active"),e.toggleClass("animated",!!i),e.removeClass("fullscreen-in-progress"),t.changeStateInProgress=!1},50))},i.prototype.fullscreenOn=function(){this._toggleFullScreen(!1)},i.prototype.fullscreenOff=function(){this._toggleFullScreen(!0)},e.prototype.fullscreenOn=function(){this.drawer.getPluginInstance("FullscreenModeButton").fullscreenOn()},e.prototype.fullscreenOff=function(){this.drawer.getPluginInstance("FullscreenModeButton").fullscreenOff()},t.FullscreenModeButton=i}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.DrawerApi),!function(n,e){"use strict";function t(t,e){this.name="ImageCrop",this.drawer=t,this._setupOptions(e),this.drawer.on(this.drawer.BEFORE_CREATE_TOOLBARS,this._init.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGECROP_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGE_CROP,this._onImageCropTrigger.bind(this))}t.prototype._defaultOptions={toolbarState:"hidden"},t.prototype._defaultCropOptions={},t.prototype._init=function(){var t;this.enabled=this.drawer.options.enableImageCrop&&e.ImageCropPlugin,this.enabled&&(t=this._setupCropOptions(),this._removeElements(),this._createElements(),this.cropper=new e.ImageCropPlugin(this.drawer,this.$cropperContainer,t))},t.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},t.prototype._onToolbarCreated=function(t,e){this.cropContainerSizesUpdated=!1,this.$toolbar=e.$toolbar,this._resizeCropWrapper(),this._createToolbarButtons(e)},t.prototype._createToolbarButtons=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-another-crop",iconClass:"fa-scissors",tooltipText:this.drawer.t("Crop image"),clickHandler:this._onAnotherCropButtonClick.bind(this)},i={buttonOrder:this.options.buttonOrder,additionalClass:"btn-apply-crop",iconClass:"fa-check",tooltipText:this.drawer.t("Apply current image"),clickHandler:this._onApplyCropButtonClick.bind(this)},o={buttonOrder:this.options.buttonOrder,additionalClass:"btn-undo-crop",iconClass:"fa-undo",tooltipText:this.drawer.t("Undo crop"),clickHandler:this._onUndoCropButtonClick.bind(this)},n=(this.options.buttonOrder,this.drawer.t("Use origin image"),this._onUseOriginButtonClick.bind(this),{buttonOrder:this.options.buttonOrder,additionalClass:"btn-cancel-crop",iconClass:"fa-ban",tooltipText:this.drawer.t("Cancel"),clickHandler:this._onCancelCropButtonClick.bind(this)}),e=t.addButton(e),i=t.addButton(i),o=t.addButton(o),t=t.addButton(n);this.$anotherCropButton=e,this.$applyButton=i,this.$undoCropButton=o,this.$useOriginButton=void 0,this.$cancelButton=t},t.prototype._onAnotherCropButtonClick=function(){this.cropper.applyCrop(!0),this.$undoCropButton.removeClass("disabled")},t.prototype._onApplyCropButtonClick=function(){this.cropper.applyCrop()},t.prototype._onUndoCropButtonClick=function(){var t=this.cropper;t.prevImages&&t.prevImages.length&&(t.undoCrop(!0),t.prevImages.length||this.$undoCropButton.addClass("disabled"))},t.prototype._onUseOriginButtonClick=function(){var t=this.cropper;t.success(t.originalImage)},t.prototype._onCancelCropButtonClick=function(){this.cropper.success()},t.prototype._resizeCropWrapper=function(){var t=this.drawer.toolbars.cropImageToolbar,t=t&&t.$toolbar&&t.$toolbar.height(),e=this.cropper&&this.cropper.$element;e&&e.css("top",t||0),t&&0<t&&(this.cropContainerSizesUpdated=!0)},t.prototype._getCropCallback=function(e){var i=this;return function(t){e&&"function"==typeof e&&e(t),i.hideCropper(),i.hideCropToolbar(),i.cropper.reset()}},t.prototype._onImageCropTrigger=function(t,e){var i;this.enabled&&(i=e&&e.url,e.newImage=!0,i)&&(i=this._getCropCallback(e.callback),this.showCropToolbar(),this.showCropper(),this.cropper._bind(e,i))},t.prototype._setupCropOptions=function(t){var e={};n.extend(!0,e,this._defaultCropOptions,t||{}),this.cropOptions=e},t.prototype._createElements=function(){var t=n('<div class="image-crop-wrapper hidden"></div>'),e=this.drawer.$canvasEditContainer;e.append(t),this.drawer.$cropperContainer=t,this.$cropperContainer=t},t.prototype._removeElements=function(){this.$cropperContainer&&(this.$cropperContainer.remove(),delete this.$cropperContainer),this.drawer.$cropperContainer&&delete this.drawer.$cropperContainer,this.cropper&&(this.cropper._destroy(),delete this.cropper)},t.prototype.showCropToolbar=function(){this.$undoCropButton.addClass("disabled"),this.drawer.trigger(this.drawer.EVENT_RESIZER_HIDE),this.drawer.trigger(this.drawer.EVENT_TOOLBAR_CHANGE_STATE,[{excludeElements:this.$toolbar,state:this.options.toolbarState,turnOn:!0}]),this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,[!0]),this.drawer.toolbars.cropImageToolbar.showToolbar(),this.cropContainerSizesUpdated||this._resizeCropWrapper()},t.prototype.hideCropToolbar=function(){this.drawer.toolbars.cropImageToolbar.hideToolbar(),this.drawer.trigger(this.drawer.EVENT_RESIZER_SHOW),this.drawer.trigger(this.drawer.EVENT_TOOLBAR_CLEAR_STATE),this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW)},t.prototype.showCropper=function(){this.$cropperContainer&&this.$cropperContainer.length&&this.$cropperContainer.removeClass("hidden")},t.prototype.hideCropper=function(){this.$cropperContainer&&this.$cropperContainer.length&&this.$cropperContainer.addClass("hidden")},e.ImageCrop=t}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(f,t,g){"use strict";function o(){}var e=g.mouseDown("drawerJsCrop"),v=g.mouseUp("drawerJsCrop"),b=g.mouseMove("drawerJsCrop"),n=["Webkit","Moz","ms"],r=document.createElement("div").style;function i(t){if(t in r)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=n.length;i--;)if((t=n[i]+e)in r)return t}i("transform");function s(t,e,i){return this.name="ImageCropPlugin",this.drawer=t,this.$element=e,this._resetData(),this.options=f.extend(!0,{},this._defaultOptions,i||{}),this._init(),this}var a=i("transformOrigin"),h=(i("userSelect"),s.prototype._defaultOptions={boundary:{},enableExif:!1,minSize:10,enableOrientation:!1,update:o,controlsCss:{},controlsTouchCss:{}},s.prototype.globals={translate:"translate3d"},s.prototype._bind=function(t,e){var i=e&&"function"==typeof e;return this.data="string"==typeof t?{url:t}:f.extend(!0,{},t||{}),this._resetData(),this.successCallback=i?e:this.successCallback||o,this.data&&this.data.newImage&&(this.originalImage=this.data.url,this.prevImages=[]),this.currentImage=this.data.url,this.elements.$fullsizePreview.attr("src",this.data.url),g.loadImage(this.data.url,this.elements.$img.get(0),this.data).then(this.startCropping.bind(this))},s.prototype._getCanvas=function(t){var e=t.points,i=parseInt(e[0],10),o=parseInt(e[1],10),n=parseInt(e[2],10),e=parseInt(e[3],10),r=n-i,s=e-o,a=document.createElement("canvas"),h=a.getContext("2d"),l=r,c=s,p=0,u=0,d=l,f=c,g=t.outputWidth&&t.outputHeight,v=1;return!v&&g&&(d=t.outputWidth,f=t.outputHeight,v=d/l),a.width=d,a.height=f,t.backgroundColor&&(h.fillStyle=t.backgroundColor,h.fillRect(0,0,l,c)),i<0&&(p=Math.abs(i),i=0),o<0&&(u=Math.abs(o),o=0),n>this.originalWidth&&(l=r=this.originalWidth-i),e>this.originalHeight&&(c=s=this.originalHeight-o),1!==v&&(p*=v,u*=v,l*=v,c*=v),h.drawImage(this.elements.$fullsizePreview.get(0),i,o,r,s,p,u,l,c),a},s.prototype._getHtmlResult=function(t){var e=t.points,i=f('<div class="croppie-result">'),o=f("<img>"),n=e[2]-e[0],r=e[3]-e[1];return i.append(o),o.css({left:-1*e[0]+"px",top:-1*e[1]+"px"}),img.src=t.url,i.css({width:n+"px",height:r+"px"}),i},s.prototype._getBase64Result=function(t){return this._getCanvas(t).toDataURL(t.format,t.quality)},s.prototype._getBlobResult=function(i){var o=this;return new Promise(function(e,t){o._getCanvas(i).toBlob(function(t){e(t)},i.format,i.quality)})},s.prototype._get=function(){var t=this.elements.$img.get(0),e=this.elements.$viewport.get(0),t=t.getBoundingClientRect(),e=e.getBoundingClientRect(),i=e.left-t.left,t=e.top-t.top,o=i+e.width,e=t+e.height,n=parseInt(100*this._currentZoom)/100||1,i=Math.max(0,i/n),t=Math.max(0,t/n),o=Math.max(0,o/n),e=Math.max(0,e/n);return{points:[parseFloat(i).toFixed(4),parseFloat(t).toFixed(4),parseFloat(o).toFixed(4),parseFloat(e).toFixed(4)],zoom:n}},{type:"canvas",format:"png",quality:1}),l=["jpeg","webp","png"];s.prototype._result=function(t){var i=this,o=this._get(),e=f.extend(!0,{},h,t||{}),n="string"==typeof t?t:e.type||"base64",t=e.format,r=e.quality,e=e.backgroundColor;this.elements.$viewport.get(0).getBoundingClientRect();return-1<l.indexOf(t)&&(o.format="image/"+t,o.quality=r),o.url=this.data.url,o.backgroundColor=e,new Promise(function(t,e){switch(n.toLowerCase()){case"rawcanvas":t(i._getCanvas(o));break;case"canvas":case"base64":t(i._getBase64Result(o));break;case"blob":i._getBlobResult(o).then(t);break;default:t(i._getHtmlResult(o))}})},s.prototype.getExifOrientation=function(t,e){window.EXIF||e(0),EXIF.getData(t,function(){var t=EXIF.getTag(this,"Orientation");e(t)})},s.prototype.drawCanvas=function(t,e,i){var o=e.width,n=e.height,r=t.getContext("2d");switch(t.width=e.width,t.height=e.height,r.save(),i){case 2:r.translate(o,0),r.scale(-1,1);break;case 3:r.translate(o,n),r.rotate(180*Math.PI/180);break;case 4:r.translate(0,n),r.scale(1,-1);break;case 5:t.width=n,t.height=o,r.rotate(90*Math.PI/180),r.scale(1,-1);break;case 6:t.width=n,t.height=o,r.rotate(90*Math.PI/180),r.translate(0,-n);break;case 7:t.width=n,t.height=o,r.rotate(-90*Math.PI/180),r.translate(-o,n),r.scale(1,-1);break;case 8:t.width=n,t.height=o,r.translate(0,o),r.rotate(-90*Math.PI/180)}r.drawImage(e,0,0,o,n),r.restore()},s.prototype._transferImageToCanvas=function(e){e=this.options.enableOrientation&&e;var i=this.elements.$canvas.get(0),o=this.elements.$img.get(0),t=i.get(0).getContext("2d"),n=this.options.enableExif&&window.EXIF;t.clearRect(0,0,i.width,i.height),i.width=o.width,i.height=o.height,n?this.getExifOrientation(o,function(t){this.drawCanvas(i,o,parseInt(t,10)),e&&this.drawCanvas(i,o,e)}):e&&this.drawCanvas(i,o,e)},s.prototype._onCropSuccess=function(t){this.success(t)},s.prototype.success=function(t){this.successCallback&&this.successCallback(t)},s.prototype._resetData=function(){this.weight=0,this.originalWidth=null,this.originalHeight=null,this.actualWidth=null,this.actualHeight=null,this.croppedWidth=null,this.croppedHeight=null,this.croppedLeft=null,this.croppedTop=null},s.prototype._destroy=function(){},s.prototype._updateViewportSizes=function(){var t=this.elements.$img.get(0).getBoundingClientRect(),e=this.elements.$img.parent().get(0).getBoundingClientRect(),i=t&&e&&t.left-e.left,e=t&&e&&t.top-e.top,o=t&&t.width||this.originalWidth,t=t&&t.height||this.originalHeight;this.actualWidth=o,this.actualHeight=t,this.offsetLeft=i,this.offsetTop=e,this._currentZoom=parseInt(this.actualWidth/this.originalWidth*100)/100},s.prototype._refreshViewportPosition=function(t){this._updateViewportSizes();var e={width:this.croppedWidth||this.actualWidth,height:this.croppedHeight||this.actualHeight,"max-width":this.actualWidth,"max-height":this.actualHeight,left:this.croppedLeft||this.offsetLeft||0,top:this.croppedTop||this.offsetTop||0};t?this.elements.$viewport.attr("style",t):this.elements.$viewport.css(e)},s.prototype.undoCrop=function(){var t=this.prevImages.pop();t&&this._bind(t)},s.prototype._setupCropElements=function(){var t=g.getDrawerFolderUrl()+"assets/",t='style="background: url('+t+'border.gif);"',t='<div class="imager-crop-container"><div class="crop-corner crop-top-left"></div><div class="crop-corner crop-top-right"></div><div class="crop-corner crop-bottom-right"></div><div class="crop-corner crop-bottom-left"></div><div class="crop-border crop-border-top" '+t+'></div><div class="crop-border crop-border-right" '+t+'></div><div class="crop-border crop-border-bottom" '+t+'></div><div class="crop-border crop-border-left" '+t+"></div></div>";this.elements=this.elements||{},this.elements.$viewport=f(t),this.elements.$img=f('<img class="cr-image">'),this.elements.$fullsizePreview=f('<img class="cr-image-fullsize">'),this.elements.$overlay=f('<div class="cr-overlay">'),this.elements.$preview=this.elements.$img,this.$element.append(this.elements.$fullsizePreview),this.$element.append(this.elements.$preview),this.$element.append(this.elements.$overlay),this.$element.append(this.elements.$viewport)},s.prototype._init=function(){this._setupCropElements()},s.prototype._save=function(){this.prevImages.push({viewportStyleAttr:this.elements.$viewport.attr("style"),points:this._get(),url:this.currentImage})},s.prototype.applyCrop=function(e){var i=this;i._result().then(function(t){e?(i._save(),i._bind(t)):i._onCropSuccess(t)})},s.prototype.startCropping=function(t){var d=this,i=(t.style.opacity=1,d.enableRendering=!1,d.renderCropped=!1,f("body")),t=(d.originalWidth=t.naturalWidth,d.originalHeight=t.naturalHeight,d.makePreview(),d._refreshViewportPosition(d.data&&d.data.viewportStyleAttr),d.viewportStyleAttr=!1,d.elements.$viewport.find(".crop-corner"));d.drawer.touchDevice?t.css(d.options.controlsTouchCss):t.css(d.options.controlsCss),t.on(e,function(t){var o=this.getBoundingClientRect().width/2,n=(d.drawer.croppingNow=!0,g.getEventPosition(t)),t=d.elements.$viewport.get(0).getBoundingClientRect(),e=d.elements.$viewport.parent().get(0).getBoundingClientRect(),r=t.left-e.left,s=t.top-e.top,a=t.width,h=t.height,l=f(this).hasClass("crop-top-left"),c=f(this).hasClass("crop-top-right"),p=f(this).hasClass("crop-bottom-left"),u=f(this).hasClass("crop-bottom-right");i.on(b,function(t){var e=g.getEventPosition(t),i=e.left-n.left,e=e.top-n.top;return l&&(d.croppedLeft=r+i,d.croppedTop=s+e,d.croppedWidth=a-i,d.croppedHeight=h-e),c&&(d.croppedLeft=r,d.croppedTop=s+e,d.croppedWidth=a- -1*i,d.croppedHeight=h-e),u&&(d.croppedLeft=r,d.croppedTop=s,d.croppedWidth=a- -1*i,d.croppedHeight=h+e),p&&(d.croppedLeft=r+i,d.croppedTop=s,d.croppedWidth=a-i,d.croppedHeight=h+e),d.croppedLeft<d.offsetLeft&&(d.croppedLeft=d.offsetLeft),d.croppedLeft+o>d.offsetLeft+d.actualWidth&&(d.croppedLeft=d.offsetLeft+d.actualWidth-d.options.minSize,d.croppedWidth=d.options.minSize),d.croppedTop<d.offsetTop&&(d.croppedTop=d.offsetTop),d.croppedTop+o>d.offsetTop+d.actualHeight&&(d.croppedTop=d.offsetTop+d.actualHeight-d.options.minSize,d.croppedHeight=d.options.minSize),d.croppedLeft+d.croppedWidth>d.actualWidth+d.offsetLeft&&(d.croppedWidth=d.actualWidth-d.croppedLeft+d.offsetLeft),d.croppedTop+d.croppedHeight>d.actualHeight+d.offsetTop&&(d.croppedHeight=d.actualHeight-d.croppedTop+d.offsetTop),d.elements.$viewport.css({left:d.croppedLeft,top:d.croppedTop,width:d.croppedWidth,height:d.croppedHeight}),t.preventDefault(),t.stopPropagation(),!1}),i.on(v,function(){g.setTimeout(function(){d.drawer.croppingNow=!1},50),i.off(b),i.off(v)})})},s.prototype.makePreview=function(t,e){this.$preview=f('<div class="imager-crop-preview-container"><canvas class="imager-crop-preview"></canvas></div>').css("position","absolute").css("top","50px").css({width:t,height:e,position:"absolute",right:"50px",top:"50px"}),this.previewCanvas=this.$preview.find("canvas.imager-crop-preview")[0],this.previewCanvas.__previewCanvas=!0,this.previewCanvas.width=1.5*t,this.previewCanvas.height=1.5*e,f(this.previewCanvas).css({height:"400px"}),this.$element.append(this.$preview)},s.prototype.reset=function(){this.croppedLeft=null,this.croppedTop=null,this.croppedWidth=null,this.croppedHeight=null,this.sizeBeforeCrop=null};t.ImageCropPlugin=s}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(n,t,i,e){"use strict";function o(t,e){this.name="MinimizeButton",this.drawer=t,this._setupOptions(e),t.on(t.EVENT_CONFIG_TOOLBAR_CREATED,this._onConfigToolbarCreated.bind(this)),t.on(t.EVENT_MINIMIZED_TOOLBAR_CREATED,this._onMinimizedToolbarCreated.bind(this))}o.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},o.prototype._onConfigToolbarCreated=function(t,e){this._createAndAddButton_minimize(e)},o.prototype._onMinimizedToolbarCreated=function(t,e){var i=this.drawer.options.captionText,i=n('<li class="canvas-caption">'+i+"</li>");e.$toolbar.find(".toolbar-content-wrapper").prepend(i),this._createAndAddButton_restore(e)},o.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},o.prototype.minimizeCanvas=function(){var t=this.drawer.$canvasEditContainer,e=t.hasClass("animated");t.removeClass("animated"),t.addClass("minimized"),i.setTimeout(function(){t.toggleClass("animated",!!e)},0)},o.prototype.restoreCanvas=function(){var t=this.drawer.$canvasEditContainer,e=t.hasClass("animated");t.removeClass("animated"),t.removeClass("minimized"),i.setTimeout(function(){t.toggleClass("animated",!!e)},0)},o.prototype._createAndAddButton_restore=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-restore-canvas",iconClass:"fa-expand",tooltipText:this.drawer.t("Restore canvas"),clickHandler:this._onRestoreSizeButtonClick.bind(this)},t=t.addButton(e);this.$restoreButton=t},o.prototype._createAndAddButton_minimize=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-minimize-canvas",iconClass:"fa-compress",tooltipText:this.drawer.t("Minimize canvas"),clickHandler:this._onMinimizeButtonClick.bind(this)},t=t.addButton(e);this.$minimizeButton=t},o.prototype._onMinimizeButtonClick=function(){this.minimizeCanvas()},o.prototype._onRestoreSizeButtonClick=function(){this.restoreCanvas()},e.prototype.minimizeCanvas=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("MinimizeButton").minimizeCanvas()},e.prototype.restoreCanvas=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("MinimizeButton").restoreCanvas()},t.MinimizeButton=o}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.DrawerApi),!function(n,t,o){"use strict";function e(t,e){this.drawer=t,this._setupOptions(e),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(t.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(t.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.options.align&&"floating"!==t.options.align&&console.warn("MovableFloatingMode plugin: options.align is set and it is not 'floating', so canvas will not move. Please use MovableFloatingMode plugin with 'floating' align"),t.options.align||(t.options.align="floating"),this.drawer.on(this.drawer.EVENT_CANVAS_READY,this.onOptionsChanged.bind(this)),this.drawer.on(this.drawer.EVENT_OPTIONS_CHANGED,this.onOptionsChanged.bind(this))}var i=o.mouseDown("MovableFloatingMode"),r=o.mouseMove("MovableFloatingMode"),s=o.mouseUp("MovableFloatingMode");e.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},e.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.createControls(e)},e.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&(this.drawer.off(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),this.drawer.off(this.drawer.EVENT_MINIMIZED_TOOLBAR_CREATED,this._bindedOnToolbarCreated))},e.prototype.createControls=function(t){this.makeMoveButton(t)},e.prototype.makeMoveButton=function(t){var e={buttonOrder:this.options.buttonOrder,additionalClass:"btn-move",iconClass:"fa-arrows",tooltipText:this.drawer.t("Move canvas")},t=t.addButton(e);this.$moveButton=t,this.$moveButton.on(i,this.buttonOnMouseDown.bind(this))},e.prototype.buttonOnMouseDown=function(t){-1<t.type.indexOf("touch")&&(t=t.originalEvent),n(".tooltip-btn-move").css("display","none"),this.startLeft=0|this.drawer.$imageElement.css("left").replace("px",""),this.startTop=0|this.drawer.$imageElement.css("top").replace("px",""),this.mouseStartLeft=t.pageX,this.mouseStartTop=t.pageY;var t=n("body"),e=n(window.document);return t.addClass("drawer-moving"),e.on(r,this.buttonOnMouseMove.bind(this)),e.on(s,this.buttonOnMouseUp.bind(this)),!1},e.prototype.buttonOnMouseMove=function(t){var e=this,i=o.getEventPosition(t);return o.requestAnimationFrame(function(){e.moveDrawer(i.left,i.top)}),t.preventDefault(),t.stopPropagation(),!1},e.prototype.buttonOnMouseUp=function(t){n(".tooltip-btn-move").css("display","block");var e=n("body"),i=n(window.document);return e.removeClass("drawer-moving"),i.off(r),i.off(s),!1},e.prototype.moveDrawer=function(t,e){var t=t-this.mouseStartLeft,e=e-this.mouseStartTop,t=this.startLeft+t,e=this.startTop+e,i=this.drawer;i.$imageElement.css({left:t<0?0:t,top:e<0?0:e}),i.updateAligmentCss(),i.adjustEditContainer(!1,!0)},e.prototype.onOptionsChanged=function(){var t;try{t=this.drawer.getPluginInstance("Fullscreen")}catch(t){}t&&t.isInFullscreenMode()||"floating"!=this.drawer.options.align?this.hideMoveButton():this.showMoveButton()},e.prototype.showMoveButton=function(){this.$moveButton?this.$moveButton.show():console.warn("MovableFloatingMode.removeMoveButton() : no button 'Move' present")},e.prototype.hideMoveButton=function(){this.$moveButton?this.$moveButton.hide():console.warn("MovableFloatingMode.removeMoveButton() : no button 'Move' present")},t.MovableFloatingMode=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(n,t,r){"use strict";function e(t,e){this.drawer=t,this._setupOptions(e),t.on(t.EVENT_OPTIONS_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),t.on(t.EVENT_FLOATING_TOOLBAR_CREATED,this._init.bind(this))}var s=r.mouseUp("OpenPopupButton"),a=r.mouseDown("OpenPopupButton"),h=r.mouseMove("OpenPopupButton");e.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},e.prototype._init=function(t,e){this.needToInitButton&&(this.createControls(e),this.drawer.off(this.drawer.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),this.drawer.on(this.drawer.EVENT_OBJECT_SELECTED,this._onObjectSelected.bind(this)),this.drawer.off(this.drawer.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),this.drawer.on(this.drawer.EVENT_SELECTION_CLEARED,this._onSelectionCleared.bind(this)),this.drawer.off(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.off(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._onDeactivateTool.bind(this)),this.drawer.off(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateAllTools.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS,this._onDeactivateAllTools.bind(this)),this.drawer.off(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideButton.bind(this)),this.drawer.off(this.drawer.EVENT_CANVAS_STOP_RESIZE,this.refreshPosition.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_STOP_RESIZE,this.refreshPosition.bind(this)),this.drawer.off(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_OVERCANVAS_BUTTON_HIDE,this.hideButton.bind(this)),this.drawer.off(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW,this.showButton.bind(this)),this.drawer.on(this.drawer.EVENT_OVERCANVAS_BUTTON_SHOW,this.showButton.bind(this)),this.drawer.off(this.drawer.EVENT_IMAGE_CROP,this.hideButton.bind(this)),this.drawer.on(this.drawer.EVENT_IMAGE_CROP,this.hideButton.bind(this)))},e.prototype._onToolbarCreated=function(t,e){var i=(this.toolbar=e).options.compactType===e.POPUP,e=e.options.hidden;this.needToInitButton=i&&!e},e.prototype._onObjectSelected=function(t){this.showButton()},e.prototype._onActivateTool=function(t){this.showButton()},e.prototype._onDeactivateTool=function(t){this.hideButton()},e.prototype._onDeactivateAllTools=function(t,e){e&&e.beforeActivateTool||this.hideButton()},e.prototype._onSelectionCleared=function(t,e){this.drawer.activeDrawingTool||this.hideButton()},e.prototype.createControls=function(t){this._createAndAddButton(t),this._setInitialPosition(),this.showButton()},e.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},e.prototype._setInitialPosition=function(){var i=0,o=0,t=this.drawer.toolbars.toolbarPlaceholders.inside,e=t&&t.top&&t.top.$element,t=t&&t.left&&t.left.$element;e&&e.length&&e.find("ul.editable-canvas-toolbar:visible").each(function(t,e){e=n(e);o+=e.height()}),t&&t.length&&t.find("ul.editable-canvas-toolbar:visible").each(function(t,e){e=n(e);i+=e.width()}),this.positionInitialized=!0,this.moveButton(i,o)},e.prototype.moveButton=function(t,e){this.positionLimit||this.refreshPositionLimits(),t=t>this.positionLimit.left?this.positionLimit.left:t,e=e>this.positionLimit.top?this.positionLimit.top:e,this.latestState={left:(t=t<0?0:t)||0,top:(e=e<0?0:e)||0},this.$button[0].style.left=t+"px",this.$button[0].style.top=e+"px"},e.prototype.refreshPosition=function(){var t=this.latestState&&this.latestState.left||0,e=this.latestState&&this.latestState.top||0;this.showButton(),this.refreshPositionLimits(),this.moveButton(t,e)},e.prototype._createAndAddButton=function(t){var e=n("body"),i={buttonOrder:this.options.buttonOrder,additionalClass:"btn-popup-canvas hidden",iconClass:"fa-cogs",tooltipText:this.drawer.t("Open options tools")},t=t.addButton(i),i=(this.$button=t,this.latestState&&this.latestState.left||0),o=this.latestState&&this.latestState.top||0;this.moveButton(i,o),e.off(h).on(h,this._onMouseMove.bind(this)),t.off(a).on(a,this._onMouseDown.bind(this)),e.off(s).on(s,this._onMouseUp.bind(this))},e.prototype._onMouseDown=function(t){var e=this;this.moveNow=!0,this.triggerClick=!0,this.clickPosition=r.getEventPosition(t),this.refreshSizes(),this.refreshPositionLimits(),r.setTimeout(function(){e.triggerClick=!1},200)},e.prototype._onMouseUp=function(t){this.moveNow=!1,this.dragNow=!1,this.clickPosition={};t=t.target===this.$button.get(0)||this.$button.find(t.target).length;this.$button.removeClass("dragging"),t&&this.triggerClick&&this.drawer.trigger(this.drawer.EVENT_OVERCANVAS_POPUP_SHOW,[this.$button])},e.prototype._onMouseMove=function(t){var e,i,o,n;!this.moveNow||(e=r.getEventPosition(t),n=this.clickPosition&&this.clickPosition.left===e.left,e=this.clickPosition&&this.clickPosition.top===e.top,n&&e)||(this.dragNow||(this.$button.addClass("dragging"),this.dragNow=!0),this.latestSizes=this.latestSizes||this.refreshSizes(),n=r.getEventPosition(t),i=(e=this.latestSizes).canvas,o=n.left-i.left-e.button.width/2-e.scroll.left,n=n.top-i.top-e.button.height/2-e.scroll.top,this.triggerClick=!1,this.moveButton(o,n),t.preventDefault(),t.stopPropagation())},e.prototype.refreshSizes=function(){var t={},e=this.drawer.fCanvas.upperCanvasEl.getBoundingClientRect(),i=this.$button[0].getBoundingClientRect();return t.canvas=e,t.button=i,t.scroll=r.getScrollTopFromElement(this.$button),this.latestSizes=t},e.prototype.refreshPositionLimits=function(){var t=this.$button.get(0).getBoundingClientRect();this.positionLimit={left:this.drawer.width-t.width-2,top:this.drawer.height-t.height-2}},e.prototype.showButton=function(){this.$button.removeClass("hidden")},e.prototype.hideButton=function(t,e){var i=this.drawer.options.toolbars.popupButtonAlwaysVisible;!e&&i||this.$button.addClass("hidden")},t.OpenPopupButton=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(o,t,n){function e(t){this.drawerInstance=t,this.LOGTAG=this.name,this._attachDrawerEvents()}e.prototype.drawerInstance=null,e.prototype.namespace="OvercanvasPopup",e.prototype.name="DrawerPluginOvercanvasPopup",e.prototype.popupClass="popup-wrapper",e.prototype.defaultPosition="bottom",e.prototype.positions=["bottom","left","right","top"],e.prototype.toolbarBehavior="overlay",e.prototype._attachDrawerEvents=function(){this.drawerInstance.on(this.drawerInstance.BEFORE_CREATE_TOOLBARS,this._onBeforeCreateToolbars.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_OVERCANVAS_POPUP_SHOW,this.showPopup.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE,this.hidePopup.bind(this))},e.prototype._onBeforeCreateToolbars=function(){this._createHelperElements(),this._attachHelperEvents()},e.prototype._attachHelperEvents=function(){var t=this.$popup.find(".popup-close-btn"),e=this.$popup.find(".popup-overlay"),i=o("body");n.bindClick(t,this.namespace,this._triggerPopupHide.bind(this)),n.bindClick(e,this.namespace,this._triggerPopupHide.bind(this)),n.bindClick(i,this.namespace,this._onBodyClick.bind(this))},e.prototype._triggerPopupHide=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE)},e.prototype._triggerPopupShow=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_SHOW)},e.prototype._onBodyClick=function(t){var e;this.popupIsVisible&&(e=this.$button&&this.$button.length&&(t.target===this.$button.get(0)||this.$button.find(t.target).length),t=t.target===this.$popup.get(0)||this.$popup.find(t.target).length,e||t||this.drawerInstance.trigger(this.drawerInstance.EVENT_OVERCANVAS_POPUP_HIDE))},e.prototype._createHelperElements=function(){this._removeHelperElements();var t='<div class="'+this.popupClass+' hidden"><div class="popup-content-wrapper"><div class="popup-arrow"></div><div class="popup-content"></div></div><div class="popup-overlay"></div><div class="popup-close-btn"><div class="fa fa-close"></div></div></div>',t=o(t);this.drawerInstance.$canvasEditContainer.append(t),this.drawerInstance.$popupWrapper=t,this.$popup=t,this.$arrow=t.find(".popup-arrow"),this.$popupContentWrapper=t.find(".popup-content-wrapper")},e.prototype._removeHelperElements=function(){this.drawerInstance.$popupWrapper&&this.drawerInstance.$popupWrapper.length&&this.drawerInstance.$popupWrapper.remove();var t=this.drawerInstance.$canvasEditContainer.find("."+this.popupClass);t&&t.length&&t.remove(),this.drawerInstance.$popupWrapper=void 0,this.$popup=void 0},e.prototype._getAvailableSpace=function(t){var e,i,o,n,r;return t&&t.length&&(e=this.drawerInstance.$canvasEditContainer.get(0).getBoundingClientRect(),t=t.get(0).getBoundingClientRect(),i=this.$popupContentWrapper.get(0).getBoundingClientRect(),o=t.left-e.left,n=t.top-e.top,(r={}).top=n,r.left=o,r.right=e.width-o-t.width,r.bottom=e.height-n-t.height,r.centerX=o+t.width/2,r.centerY=n+t.height/2,r.popup={arrowSize:10,top:i.height,bottom:i.height,left:i.width,right:i.width},r.popupSizes=i,r.canvasSizes=e,r.triggerSizes=t),this.sizes=r},e.prototype._movePopup=function(t){var e,i,o,n,r=this.sizes,s={},a=r.popupSizes.width/2,h=r.popupSizes.height/2;switch(t){case"left":i=r.left-r.popupSizes.width-r.popup.arrowSize,o=r.centerY-r.popupSizes.height/2;break;case"right":i=r.canvasSizes.width-r.right+r.popup.arrowSize,o=r.centerY-r.popupSizes.height/2;break;case"top":e=!0,i=r.centerX-r.popupSizes.width/2,o=r.top-r.popupSizes.height-r.popup.arrowSize;break;case"bottom":e=!0,i=r.centerX-r.popupSizes.width/2,o=r.canvasSizes.height-r.bottom+r.popup.arrowSize}e?(s.top=o,0<(n=i+r.popupSizes.width-r.canvasSizes.width)?(a+=n,s.right=0):(i<0&&(a+=i,i=0),s.left=i)):(s.left=i,0<(n=o+r.popupSizes.height-r.canvasSizes.height)?(h+=n,s.bottom=0):(o<0&&(h+=o,o=0),s.top=o)),this.$popupContentWrapper.attr("data-position",t),this.$popupContentWrapper.removeAttr("style"),this.$popupContentWrapper.css(s),this._moveArrow(a,h)},e.prototype._moveArrow=function(t,e){this.$arrow.css({left:t,top:e})},e.prototype._adjustPosition=function(t){var o,n=this._getAvailableSpace(t);this.positions.forEach(function(t,e){var i=n[t]&&n.popup[t];!o&&i&&(i=n.popup[t]+n.popup.arrowSize,i=0<n[t]-i,o=i&&t)}),o&&this._movePopup(o)},e.prototype.showPopup=function(t,e){this.popupIsVisible=!0,this.$popup.removeClass("hidden"),this._adjustPosition(e),this.$popupContentWrapper.removeClass("popup-transparent"),this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_CHANGE_STATE,[{excludeElements:o().add(this.$popup).add(e),turnOn:!0,state:this.toolbarBehavior}])},e.prototype.hidePopup=function(){this.drawerInstance.trigger(this.drawerInstance.EVENT_TOOLBAR_CLEAR_STATE),this.popupIsVisible=!1,this.$popup.addClass("hidden"),this.$popupContentWrapper.addClass("popup-transparent")},t.OvercanvasPopup=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(n,t,r){function e(t){this.drawerInstance=t,this.name="DrawerPluginResize",this.LOGTAG=this.name,this.MOUSEDOWN=r.mouseDown("drawerPluginResize"),this.MOUSEUP=r.mouseUp("drawerPluginResize"),this.MOUSEMOVE=r.mouseMove("drawerPluginResize"),this._bindedOnToolbarCreated=this._onToolbarCreated.bind(this),t.on(this.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated),t.on(this.drawerInstance.EVENT_RESIZER_HIDE,this.resizerHide.bind(this)),t.on(this.drawerInstance.EVENT_RESIZER_SHOW,this.resizerShow.bind(this))}e.prototype._onToolbarCreated=function(){this.createControls()},e.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawerInstance.off(this.drawerInstance.EVENT_CONFIG_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},e.prototype.createControls=function(){this.deleteControls(),this.appendResizeControl()},e.prototype.deleteControls=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.remove()},e.prototype.appendResizeControl=function(){var o=this,t=n(window.document),i=(n("body"),t),t=o.drawerInstance.$canvasEditContainer;this.$canvasResizer=n('<span class="redactor-drawer-resizer"><span class="resizer-box"></span></span>'),this.drawerInstance.touchDevice&&this.$canvasResizer.find(".resizer-box").addClass("touch"),t.append(this.$canvasResizer),this.$canvasResizer.find(".resizer-box").on(this.MOUSEDOWN,function(t){var t=r.getEventPosition(t),e=(o.drawerInstance.log(o.LOGTAG,"resize start"),o.resizeOriginalWidth=o.drawerInstance.width,o.resizeOriginalHeight=o.drawerInstance.height,o.resizeStartX=t.left,o.resizeStartY=t.top,n("body"));e.addClass("drawer-resizing"),o.drawerInstance.trigger(o.drawerInstance.EVENT_CANVAS_START_RESIZE),o.drawerInstance.resizingNow=!0,i.on(o.MOUSEMOVE,function(t){t.stopPropagation(),t.preventDefault();var t=r.getEventPosition(t),e=o.resizeStartX-t.left,i=o.resizeStartY-t.top;return r.requestAnimationFrame(function(){o.drawerInstance.setSize(o.resizeOriginalWidth-e,o.resizeOriginalHeight-i),o.drawerInstance.trigger(o.drawerInstance.EVENT_CANVAS_RESIZING)}),!1}),i.on(o.MOUSEUP,function(t){e.removeClass("drawer-resizing"),i.off(o.MOUSEMOVE),i.off(o.MOUSEUP),o.drawerInstance.log(o.LOGTAG,"resize finished by mouseup"),o.resizeFinished()})})},e.prototype.resizerHide=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.addClass("hidden")},e.prototype.resizerShow=function(){this.$canvasResizer&&this.$canvasResizer.length&&this.$canvasResizer.removeClass("hidden")},e.prototype.resizeFinished=function(){this.drawerInstance.onCanvasModified(),this.drawerInstance.resizingNow=!1,console.log("[resize]","EVENT_CANVAS_STOP_RESIZE"),this.drawerInstance.trigger(this.drawerInstance.EVENT_CANVAS_STOP_RESIZE)},t.Resize=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(t){t.prototype.contextMenuShow=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("ShapeContextMenu").showContextMenu()},t.prototype.contextMenuHide=function(){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("ShapeContextMenu").hideContextMenu()},t.prototype.contextMenuSetPosition=function(t,e,i){this.drawer.api.checkIsActive();var o=this.drawer.getPluginInstance("ShapeContextMenu");i&&(t=(i=o._calcCoordsToFitViewport(t,e)).left,e=i.top),o.setMenuPosition(t,e)}}(DrawerJs.DrawerApi),!function(s,t,a){function e(t,e){this.drawerInstance=t,this.options=s.extend(!0,{},this._defaultOptions||{},e||{}),this.left=this.top=0,this._bindedOnContextMenu=this._onContextMenu.bind(this),this._bindedSetHandlers=this._setHandlers.bind(this),t.on(t.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedSetHandlers),t.on(t.EVENT_EDIT_STOP,this._onEditStop.bind(this)),t.on(t.EVENT_OBJECT_MOVING,this._onObjectMoved.bind(this))}var i=a.mouseDown("ShapeContextMenu");e.prototype.eventsNamespace="shapeContextMenu",e.prototype._defaultOptions={position:{touch:"shapeRightBottom",mouse:"cursor"}},e.prototype._setHandlers=function(){var t;this.options.customMenuRenderer?this.drawerInstance.on(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace,this.options.customMenuRenderer):(this.drawerInstance.on(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace,this._bindedOnContextMenu),t=this,a.bindClick(s("body"),"shapeContextMenu",function(){t.hideContextMenu()})),this.drawerInstance.$canvasEditContainer.off(i).on(i,this._onMouseDown.bind(this))},e.prototype._unsetHandlers=function(t){this.options.customMenuRenderer?this.drawerInstance.off(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace):(a.unbindClick(s("body"),"shapeContextMenu"),this.drawerInstance.off(this.drawerInstance.EVENT_CONTEXTMENU+"."+this.eventsNamespace),t&&this.drawerInstance.off(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedSetHandlers))},e.prototype.removeTool=function(t){this._unsetHandlers(t)},e.prototype._onObjectMoved=function(){this.objectWasMoved=!0},e.prototype._onEditStop=function(){this._unsetHandlers()},e.prototype._onMouseDown=function(){this.objectWasMoved=!1},e.prototype._onContextMenu=function(t,e){var i=this.drawerInstance.drawingInProgress,o=this.drawerInstance.isBrushDrawing,n=this.objectWasMoved;i||o||n||(-1<e.type.indexOf("touch")&&(e=e.originalEvent),this.handleContextMenuEvent(e))},e.prototype.handleContextMenuEvent=function(t){var e=s(t.target).hasClass("upper-canvas")&&this.drawerInstance.fCanvas.findTarget(t),i=e&&e.isMoving,o=e&&e.__corner;!e||i||o||(this.drawerInstance.fCanvas.setActiveObject(e),this.showContextMenu(e,t))},e.prototype.showContextMenu=function(t,e){var i=this,o=(i.hideContextMenu(),i.eventsNamespace),n=(i.$contextMenu=s('<ul class="editable-canvas-shape-context-menu"></ul>'),s("<li><a>"+i.drawerInstance.t("Bring forward")+"</a></li>")),n=(a.bindClick(n.find("a"),o,this._bringObjectForward.bind(this,t)),i.$contextMenu.append(n),s("<li><a>"+i.drawerInstance.t("Send backwards")+"</a></li>")),n=(a.bindClick(n.find("a"),o,this._sendObjectBackwards.bind(this,t)),i.$contextMenu.append(n),s("<li><a>"+i.drawerInstance.t("Bring to front")+"</a></li>")),n=(a.bindClick(n.find("a"),o,this._bringObjectToFront.bind(this,t)),i.$contextMenu.append(n),s("<li><a>"+i.drawerInstance.t("Send to back")+"</a></li>")),n=(a.bindClick(n.find("a"),o,this._sendObjectToBack.bind(this,t)),i.$contextMenu.append(n),s("<li><a>"+i.drawerInstance.t("Duplicate")+"</a></li>")),n=(a.bindClick(n.find("a"),o,this._duplicateObject.bind(this,t)),i.$contextMenu.append(n),s("<li><a>"+i.drawerInstance.t("Remove")+"</a></li>")),r=(a.bindClick(n.find("a"),o,this._removeObject.bind(this,t)),i.$contextMenu.append(n),20),r=i.drawerInstance.touchDevice?i.drawerInstance.options.toolbarSizeTouch:i.drawerInstance.options.toolbarSize;r/=3,i.$contextMenu.find("li > a").each(function(t,e){s(e).css({"padding-top":r+"px","padding-bottom":r+"px"})}),i.drawerInstance.$canvasEditContainer.append(i.$contextMenu),this._positionMenu(t,a.getEventPosition(e))},e.prototype.hideContextMenu=function(){this.$contextMenu&&this.$contextMenu.remove()},e.prototype.setMenuPosition=function(t,e){this.left=Number(t),this.top=Number(e),this.$contextMenu.css("left",t+"px"),this.$contextMenu.css("top",e+"px")},e.prototype.getMenuPosition=function(){return{left:this.left,top:this.top}},e.prototype._positionMenu=function(t,e){var i=s(this.drawerInstance.fCanvas.upperCanvasEl).offset(),o=0,n=0,r=this.drawerInstance.touchDevice?"touch":"mouse",r=this.options.position[r],t=("shapeRightBottom"==r?(o=t.left+t.width,n=t.top+t.height):"cursor"==r&&(o=e.left-i.left+10,n=e.top-i.top+10),{}),o=(t=this.options.customFitViewportMethod?this.options.customFitViewportMethod(o,n):this._calcCoordsToFitViewport(o,n)).left,n=t.top;this.setMenuPosition(o,n)},e.prototype._calcCoordsToFitViewport=function(t,e){t=Number(t),e=Number(e);var i=this.$contextMenu.height(),o=this.drawerInstance.fCanvas.height,o=(o<e+i&&(e=o-i-10),this.$contextMenu.width()),i=this.drawerInstance.fCanvas.width;return{left:t=i<t+o?i-o-10:t,top:e}},e.prototype._bringObjectForward=function(t){return this.drawerInstance.api.bringObjectForward(t),this.hideContextMenu(),!1},e.prototype._sendObjectBackwards=function(t){return this.drawerInstance.api.sendObjectBackwards(t),this.hideContextMenu(),!1},e.prototype._bringObjectToFront=function(t){return this.drawerInstance.api.bringObjectToFront(t),this.hideContextMenu(),!1},e.prototype._sendObjectToBack=function(t){return this.drawerInstance.api.sendObjectToBack(t),this.hideContextMenu(),!1},e.prototype._removeObject=function(t){return this.drawerInstance.api.removeObject(t),this.hideContextMenu(),!1},e.prototype._duplicateObject=function(t){return this.drawerInstance.api.duplicateObject(t),this.hideContextMenu(),!1},t.ShapeContextMenu=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(n,t,r){"use strict";function e(t,e){this.drawer=t,this._setupOptions(e),this.drawer.on(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._onToolbarCreated.bind(this))}var s=r.mouseUp("ToggleVisibilityButton"),a=r.mouseDown("ToggleVisibilityButton"),h=r.mouseMove("ToggleVisibilityButton");e.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=n.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},e.prototype._onOverCanvasMode=function(){this.showNextItem(),this.positionInitialized||this._setInitialPosition()},e.prototype._onToolbarCreated=function(t,e){this.toolbar=e,this.checkConfigForButton()&&(this.createControls(e),this._onOverCanvasMode())},e.prototype._checkToolbarForButton=function(t){var e,i=!1;return t&&(e=t.options.toggleVisibilityButton,t="popup"===t.options.compactType,i=e&&!t),i},e.prototype.checkConfigForButton=function(){var t=this.drawer.toolbars.drawingToolsToolbar,e=this.drawer.toolbars.toolOptionsToolbar,i=this.drawer.toolbars.settingsToolbar,o=this._checkToolbarForButton(t),n=this._checkToolbarForButton(e),r=this._checkToolbarForButton(i),s=o||n||r,a=[];return o&&a.push(t),n&&a.push(e),r&&a.push(i),this.toolbarsForToggle=a,s},e.prototype.createControls=function(t){this._createAndAddButton(t),this.showButton()},e.prototype.removeTool=function(t){this.deleteControls&&this.deleteControls(),t&&this.drawer.off(this.drawer.EVENT_FLOATING_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},e.prototype.moveButton=function(t,e){this.positionLimit||this.refreshPositionLimits(),t=t>this.positionLimit.left?this.positionLimit.left:t,e=e>this.positionLimit.top?this.positionLimit.top:e,this.latestState={left:(t=t<0?0:t)||0,top:(e=e<0?0:e)||0},this.$button.css({left:t+"px",top:e+"px"})},e.prototype._setInitialPosition=function(){var t=0,e=0,i=this.drawer.toolbars.toolbarPlaceholders.inside,o=i&&i.top&&i.top.$element,i=i&&i.left&&i.left.$element;o&&o.length&&(e+=o.height()),i&&i.length&&(t+=i.width()),this.positionInitialized=!0,this.moveButton(t,e)},e.prototype._createAndAddButton=function(t){var e=n("body"),i={buttonOrder:this.options.buttonOrder,additionalClass:"btn-toggle-canvas hidden",iconClass:"fa-eye",tooltipText:this.drawer.t("Toggle toolbar vision")},t=t.addButton(i),i=(this.$button=t,this.latestState&&this.latestState.left||0),o=this.latestState&&this.latestState.top||0;this.moveButton(i,o),e.off(h).on(h,this._onMouseMove.bind(this)),t.off(a).on(a,this._onMouseDown.bind(this)),e.off(s).on(s,this._onMouseUp.bind(this))},e.prototype._onMouseDown=function(t){var e=this;this.moveNow=!0,this.triggerClick=!0,this.refreshSizes(),this.refreshPositionLimits(),r.setTimeout(function(){e.triggerClick=!1},200)},e.prototype._onMouseUp=function(t){var e=this,t=t.target===this.$button.get(0)||this.$button.find(t.target).length;this.moveNow=!1,this.dragNow=!1,this.$button.removeClass("dragging"),t&&this.triggerClick&&!this.touchRightNow&&(this.triggerClick=!1,this.touchRightNow=!0,r.setTimeout(function(){e.touchRightNow=!1},400),this.showNextItem())},e.prototype._onMouseMove=function(t){var e,i,o,n;this.moveNow&&(this.dragNow||(this.$button.addClass("dragging"),this.dragNow=!0),this.latestSizes||this.refreshSizes(),n=r.getEventPosition(t),i=(e=this.latestSizes).canvas,o=n.left-i.left-e.button.width/2-e.scroll.left,n=n.top-i.top-e.button.height/2-e.scroll.top,this.triggerClick=!1,this.moveButton(o,n),t.preventDefault(),t.stopPropagation())},e.prototype.refreshSizes=function(){var t={},e=this.drawer.fCanvas.upperCanvasEl.getBoundingClientRect(),i=this.$button[0].getBoundingClientRect();return t.canvas=e,t.button=i,t.scroll=r.getScrollTopFromElement(this.$button),this.latestSizes=t},e.prototype.refreshPositionLimits=function(){var t=this.$button.get(0).getBoundingClientRect();this.positionLimit={left:this.drawer.width-t.width-2,top:this.drawer.height-t.height-2}},e.prototype.showButton=function(){this.$button.removeClass("hidden")},e.prototype.hideButton=function(){this.$button.addClass("hidden")},e.prototype.showNextItem=function(){var i,o,n=this,t=this.toolbarsForToggle[0];this.toolbarsForToggle.forEach(function(t,e){t.invisible||(i=!0,o=n.toolbarsForToggle[e+1]),t.hideToolbar()}),i?o&&o.showToolbar():t.showToolbar()},t.ToggleVisibilityButton=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(t,r,e,i,u){"use strict";function o(t,e){this.drawer=t,this._setupOptions(e),this._init()}var s=t.fabric||(t.fabric={}),n=u.mouseDown("Zoom"),a=u.mouseMove("Zoom"),h=u.mouseUp("Zoom"),l=u.checkBrowser("webkit")?"-webkit-":"";o.prototype._defaultOptions={enabled:!0,enableWhenNoActiveTool:!0,enableButton:!0,showZoomTooltip:!0,enableMove:!0,useWheelEvents:!0,moveCanvasOnWheel:!0,moveCanvasOnWheelStep:0,zoomStep:1.05,defaultZoom:1,maxZoom:32,minZoom:1,buttonOrder:11},o.prototype._init=function(){this.viewport=new e.ZoomViewport(this.drawer),this.enabled=this.options.enabled,this.zoomIsOn=!0,this.currentZoom=1,this._updateProto(),this.enabled&&(this._attachDrawerEvents(),this._updateDrawerValues())},o.prototype._setupOptions=function(t,e,i){e=e||this.name;var o=this.drawerInstance||this.drawer,o=o&&o.getPluginConfig(e),e=r.extend(!0,{},this._defaultOptions||{},o||{},t||{});return i||(this.options=e),e},o.prototype._updateProto=function(){this.drawer.on(this.drawer.EVENT_CANVAS_READY,this._updateCanvasProto.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_READY,this._updateObjectProto.bind(this))},o.prototype._attachDrawerEvents=function(){this.drawer.on(this.drawer.EVENT_CONFIG_TOOLBAR_CREATED,this._onToolbarCreated.bind(this)),this.drawer.on(this.drawer.EVENT_RESTORE_DEFAULT_ZOOM,this.restoreDefaultZoom.bind(this)),this.drawer.on(this.drawer.EVENT_DO_ACTIVATE_TOOL,this._onActivateTool.bind(this)),this.drawer.on(this.drawer.EVENT_DO_DEACTIVATE_TOOL,this._ctxUpperRestore.bind(this)),this.drawer.on(this.drawer.EVENT_BEFORE_RENDER,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_AFTER_RENDER,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_SET,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UNSET,this._ctxUnset.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_RESTORE,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_SET,this._ctxUpperSet.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_UNSET,this._ctxUpperUnset.bind(this)),this.drawer.on(this.drawer.EVENT_ZOOM_UPPER_RESTORE,this._ctxUpperRestore.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this._ctxSet.bind(this)),this.drawer.on(this.drawer.EVENT_CANVAS_STOP_RESIZE,this._ctxRestore.bind(this)),this.drawer.on(this.drawer.EVENT_SELECTION_CLEARED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_OBJECT_SELECTED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_TOOL_ACTIVATED,this._refreshButton.bind(this)),this.drawer.on(this.drawer.EVENT_TOOL_DEACTIVATED,this._refreshButton.bind(this))},o.prototype._refreshButton=function(t){this._refreshMoveButtonState()},o.prototype._ctxUpperSet=function(t){var e=this.drawer.fCanvas.contextTop;e.save(),e.scale(this.viewport.zoom,this.viewport.zoom),e.translate(this.viewport.position.x,this.viewport.position.y)},o.prototype._ctxUpperUnset=function(t){var e=this.drawer.fCanvas.contextTop;e.save(),e.scale(1/this.viewport.zoom,1/this.viewport.zoom),e.translate(-this.viewport.position.x,-this.viewport.position.y)},o.prototype._ctxUpperRestore=function(t){this.drawer.fCanvas.contextTop.restore()},o.prototype._ctxSet=function(t){var e=this.drawer.fCanvas.contextContainer;e.save(),e.scale(this.viewport.zoom,this.viewport.zoom),e.translate(this.viewport.position.x,this.viewport.position.y)},o.prototype._ctxUnset=function(t){var e=this.drawer.fCanvas.contextContainer;e.save(),e.scale(1/this.viewport.zoom,1/this.viewport.zoom),e.translate(-this.viewport.position.x,-this.viewport.position.y)},o.prototype._ctxRestore=function(t){this.drawer.fCanvas.contextContainer.restore()},o.prototype._onActivateTool=function(t,e){e.doNotZoomOnActivate||this._ctxUpperSet()},o.prototype._onDeactivateTool=function(t,e){e.doNotZoomOnActivate||this._ctxUpperRestore()},o.prototype._onToolbarCreated=function(t,e){this.toolbar=e;this.createControls(e),this._createHelperElements(),this._attachEvents()},o.prototype._removeHelperElements=function(){this.$zoomTooltip&&this.$zoomTooltip.length&&(this.$zoomTooltip.remove(),delete this.$zoomTooltip)},o.prototype._createHelperElements=function(){this._removeHelperElements();var t=r('<div class="zoom-tooltip transparent-tooltip"></div>'),e=this.drawer.$canvasEditContainer;this.$zoomTooltip=t,e.append(t)},o.prototype._attachEvents=function(){var i,o=this;this.options.showZoomTooltip&&(i=u.debounce(function(){o.$zoomTooltip.addClass("transparent-tooltip")},1e3),this.drawer.on(this.drawer.EVENT_ZOOM_CHANGE,function(t,e){e=parseInt(100*e.zoom,10)+"%";o.$zoomTooltip.text(e),o.$zoomTooltip.removeClass("transparent-tooltip"),i()})),this.options.enableButton&&this.drawer.on(this.drawer.EVENT_ZOOM_CHANGE,function(t,e){(1===e.prevValues.zoom&&1!==e.zoom||1===e.zoom&&1!==e.prevValues.zoom)&&o._refreshMoveButtonState()})},o.prototype.createControls=function(t){this._createAndAddButton(t),this._attachWheelEvents(),this._attachMoveEvents(),this._attachTouchEvents()},o.prototype._createAndAddButton=function(t){var e,i={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-in",iconClass:"fa-search-plus",tooltipText:this.drawer.t("Zoom in"),clickHandler:this._onZoomIn.bind(this)},o={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-out",iconClass:"fa-search-minus",tooltipText:this.drawer.t("Zoom out"),clickHandler:this._onZoomOut.bind(this)},n={buttonOrder:this.options.buttonOrder,additionalClass:"btn-zoom-move",iconClass:"fa-search",tooltipText:this.drawer.t("Move canvas"),clickHandler:this._onMoveButtonClick.bind(this)},i=t.addButton(i),o=t.addButton(o);this.options.enableMove&&this.options.enableButton&&(e=t.addButton(n)),this.toolbar=t,this.$zoomInButton=i,this.$zoomOutButton=o,this.$moveCanvasButton=e},o.prototype._onMoveButtonClick=function(t){this.$moveCanvasButton.hasClass("disabled")||(this.moveButtonIsActive=!this.moveButtonIsActive,this._refreshMoveButtonState(!0))},o.prototype._getZoomPopertiesFromEvent=function(t,e,i){var o,n={},i=this.currentZoom*(i?this.options.zoomStep:1/this.options.zoomStep);return t=e?(t=(e=this.drawer.getRelativeEventPosition(t,!0)).left/i-this.viewport.position.x,e=e.top/i-this.viewport.position.y,t=t-this.zoomCenterX,e=e-this.zoomCenterY,o=this.zoomCenterX+t*this.options.moveCanvasOnWheelStep,this.zoomCenterY+e*this.options.moveCanvasOnWheelStep):(o=this.zoomCenterX,this.zoomCenterY),n.zoom=i,n.zoomCenterX=o,n.zoomCenterY=t,n},o.prototype._onZoomIn=function(t,e){this.zoomIsOn&&(t=this._getZoomPopertiesFromEvent(t,e,!0),this.setZoom(t.zoom,t.zoomCenterX,t.zoomCenterY,!0))},o.prototype._onZoomOut=function(t,e){this.zoomIsOn&&(t=this._getZoomPopertiesFromEvent(t,e,!1),this.setZoom(t.zoom,t.zoomCenterX,t.zoomCenterY,!0))},o.prototype._attachWheelEvents=function(){var t;this.options.useWheelEvents&&(this.wheelEventsAttached=!0,t=this.drawer.$canvasEditContainer.find(".canvas-container").get(0),u.addWheelListener(t,this._onWheelEvent.bind(this),!0))},o.prototype._attachMoveEvents=function(){var t;this.options.enableMove&&(t=r(window.document),this.drawer.$canvasEditContainer.find(".canvas-container").off(n).on(n,this._moveOnMouseDown.bind(this)),t.off(a).on(a,this._moveOnMouseMove.bind(this)),t.off(h).on(h,this._moveOnMouseUp.bind(this)))},o.prototype._moveOnMouseDown=function(t){var e=this.drawer.fCanvas.getActiveObject(),i=this.drawer.activeDrawingTool,o=this.moveButtonIsActive,o=this.options.enableButton&&o,n=this.options.enableWhenNoActiveTool&&(!this.options.enableButton||o);if(!(1===this.currentZoom||e||i)&&(o||n))return e=this.drawer.getRelativeEventPosition(t),this.drawer.movingNow=!0,this.isMoving=!0,this.moveStartPoint=e,this.moveLastPoint=e,i=r("body"),this.drawer.fCanvas.defaultCursor=l+"grabbing",this.drawer.fCanvas.setCursor(l+"grabbing"),i.addClass("drawer-dragging drawer-zoom-moving"),t.preventDefault(),t.stopPropagation(),!1},o.prototype._refreshMoveButtonState=function(t){this.savedDefaultCursor=this.savedDefaultCursor||this.drawer.fCanvas.defaultCursor,this.options.enableButton?1===this.currentZoom?(this.$moveCanvasButton.addClass("disabled"),this.drawer.fCanvas.defaultCursor=this.savedDefaultCursor,this.drawer.fCanvas.setCursor(this.savedDefaultCursor)):(t||(t=this._checkMovePermission(!t),this.moveButtonIsActive=t),this.$moveCanvasButton.removeClass("disabled"),this.moveButtonIsActive?(this._prepareDrawerForZoom(),this.drawer.fCanvas.defaultCursor=l+"grab",this.drawer.fCanvas.setCursor(l+"grab"),r("body").addClass("drawer-zoom-move-available"),this.toolbar.setActiveButton("btn-zoom-move")):(this.drawer.fCanvas.defaultCursor=this.savedDefaultCursor,this.drawer.fCanvas.setCursor(this.savedDefaultCursor),r("body").removeClass("drawer-zoom-move-available"),this.toolbar.clearActiveButton())):(this.drawer.fCanvas.defaultCursor=l+"grab",this.drawer.fCanvas.setCursor(l+"grab"),r("body").addClass("drawer-zoom-move-available"))},o.prototype._prepareDrawerForZoom=function(){this.drawer.trigger(this.drawer.EVENT_DO_DEACTIVATE_ALL_TOOLS),this.drawer.fCanvas._clearSelection(),this.drawer.fCanvas.renderAll()},o.prototype._checkMovePermission=function(t){var e=this.drawer.fCanvas.getActiveObject(),i=this.drawer.activeDrawingTool,t=t&&this.moveButtonIsActive;return!e&&!i&&(this.options.enableWhenNoActiveTool||t)},o.prototype._moveOnMouseMove=function(t){var e,i,o,n,r,s;if(this.isMoving&&1!==this.currentZoom)return i=(e=this).drawer.getRelativeEventPosition(t),o=(n=this.moveLastPoint).left-i.left,n=n.top-i.top,r=this.zoomCenterX+o,s=this.zoomCenterY+n,this.moveLastPoint=i,u.requestAnimationFrame(function(){e.setZoom(e.currentZoom,r,s,!0)}),t.preventDefault(),t.stopPropagation(),!1},o.prototype._moveOnMouseUp=function(t){var e,i;if(this.isMoving)return e=r("body"),i=this,u.setTimeout(function(){i.drawer.movingNow=!1},0),this.isMoving=!1,this.drawer.fCanvas.defaultCursor=l+"grab",this.drawer.fCanvas.setCursor(l+"grab"),e.removeClass("drawer-dragging drawer-zoom-moving"),t.preventDefault(),t.stopPropagation(),!1},o.prototype._attachTouchEvents=function(){var i,h,l=this,c=this.drawer.$canvasEditContainer;function p(t,e){return Math.sqrt(Math.pow(t.left-e.left,2)+Math.pow(t.top-e.top,2))}c.off("touchstart.drawerZoom").on("touchstart.drawerZoom",function(t){var e=t.touches||t.originalEvent.touches;l.zoomIsOn&&e&&1<e.length&&(e=getEventPosition(t,0),t=getEventPosition(t,1),e.left&&e.top||(e=getEventPosition(window.event,0),t=getEventPosition(window.event,1)),i=p(e,t),h=i,l._prepareDrawerForZoom())}),c.off("touchmove.drawerZoom").on("touchmove.drawerZoom",function(t){var e,i,o,n,r,s,a=t.touches||t.originalEvent.touches;l.zoomIsOn&&a&&1<a.length&&(a=u.getEventPosition(t,0),r=u.getEventPosition(t,1),a.left&&a.top||(a=u.getEventPosition(window.event,0),r=u.getEventPosition(window.event,1)),e=p(a,r),i=h<e,i=l.currentZoom*(i?l.options.zoomStep:1/l.options.zoomStep),o=u.getScrollOffset(c),n=c.get(0).getBoundingClientRect(),s=a.left-(a.left-r.left)/2,a=a.top-(a.top-r.top)/2,r=s-n.left-o.left,s=a-n.top-o.top,l.setZoom(i,r,s,!0),h=e,t.stopPropagation(),t.preventDefault())})},o.prototype._onWheelEvent=function(t){var e;this.zoomIsOn&&(e=t.deltaY||t.detail||t.wheelDelta,this._prepareDrawerForZoom(),0<e?this._onZoomOut(t,!0):this._onZoomIn(t,!0),t.stopPropagation(),t.preventDefault())},o.prototype._updateDrawerValues=function(t){t=t||{};var e=this.drawer.width,i=this.drawer.height,o=this.viewport.getZoomCenter(),o=(this.zoomCenterX=void 0!==this.zoomCenterX?this.zoomCenterX:o.x,this.zoomCenterY=void 0!==this.zoomCenterY?this.zoomCenterY:o.y,(void 0!==t.zoomCenterX?t:this).zoomCenterX),n=(void 0!==t.zoomCenterY?t:this).zoomCenterY,t=t.zoom;"number"==typeof t&&isFinite(t)||"number"==typeof(t=this.currentZoom)&&isFinite(t)||(t=this.options.defaultZoom),(o=e<o?e:o)<0&&(o=0),(n=i<n?e:n)<0&&(n=0),"number"==typeof this.options.minZoom&&(t=Math.max(t,this.options.minZoom)),"number"==typeof this.options.maxZoom&&(t=Math.min(t,this.options.maxZoom)),this.drawer.currentZoom=this.currentZoom=t,this.drawer.zoomCenterX=this.zoomCenterX=o,this.drawer.zoomCenterY=this.zoomCenterY=n},o.prototype.setZoom=function(t,e,i,o){var n="number"==typeof t&&isFinite(t),o=void 0!==o?o:!this.options.moveCanvasOnWheel;n?(n={zoom:this.currentZoom,zoomCenterX:this.zoomCenterX,zoomCenterY:this.zoomCenterY},this._updateDrawerValues({zoom:t,zoomCenterX:e,zoomCenterY:i}),(t=this.viewport.setViewport(this.currentZoom,this.zoomCenterX,this.zoomCenterY,o)).prevValues=n,this._updateDrawerValues(t),this.drawer.trigger(this.drawer.EVENT_ZOOM_CHANGE,[t])):console.info("invalid zoom value")},o.prototype._updateObjectProto=function(){var i=this,o=(s.Object.prototype._drawControl,s.Object.prototype.drawControls,s.Object.prototype.getPointByOrigin),n=s.Object.prototype._setCornerCoords;s.Object.prototype._setCornerCoords=function(){var t,e=i.viewport,e=e?e.zoom:1;return this.cornerSize=this.cornerSize/e,t=n.apply(this,arguments),this.cornerSize=this.cornerSize*e,t},s.Object.prototype.getPointByOrigin=function(){var t,e=i.viewport,e=e?e.zoom:1;return this.cornerSize=this.cornerSize/e,t=o.apply(this,arguments),this.cornerSize=this.cornerSize*e,t}},o.prototype._updateCanvasProto=function(){var a=this,t=this.drawer.fCanvas,h=t.getPointer,e=t._drawSelection;t.getPointer=function(t,e,i){var o=h.apply(this,arguments),n=(isFinite(o.x)&&isFinite(o.y)||(s=a.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),n=u.getEventPosition(window.event),r=u.getScrollOffset(a.drawer.$canvasEditContainer),o={x:n.left-r.left-s.left,y:n.top-r.top-s.top}),a.viewport.position.x),r=a.viewport.position.y,s=parseInt(o.x/a.viewport.zoom-n,10),n=parseInt(o.y/a.viewport.zoom-r,10);return o.oldX=o.x,o.oldY=o.y,o.newX=s,o.newY=n,o.x=s,o.y=n,o},t._drawSelection=function(){var t=this.contextTop;return t.save(),t.scale(this.viewport.zoom,this.viewport.zoom),t.translate(this.viewport.position.x,this.viewport.position.y),e.apply(this,arguments),t.restore(),t}},o.prototype.restoreDefaultZoom=function(){var t=this.options.defaultZoom,e=this.viewport.getZoomCenter();this.setZoom(t,e.x,e.y,!0),this.viewport.setToCenterOfCanvas(1),t=this.viewport.getData(),this._updateDrawerValues(t)},i.prototype.setZoom=function(t,e,i){var o=this.drawer.getPluginInstance("Zoom");o&&o.setZoom(t,e,i,!0)},i.prototype.restoreDefaultZoom=function(){var t=this.drawer.getPluginInstance("Zoom");t&&t.restoreDefaultZoom()},e.Zoom=o}(this,jQuery,DrawerJs.plugins,DrawerJs.DrawerApi,DrawerJs.util),!function(t,e){"use strict";function i(t,e){return this.drawer=t,this.i=0,this.position=new o.Point(0,0),this.zoom=1,this}var o=t.fabric||(t.fabric={});i.prototype.setViewport=function(t,e,i,o){return this._adjustPosition(t,e,i,o),this._render(),this.getData()},i.prototype.getData=function(){var t={},e=this.getZoomCenter();return t.zoom=this.zoom,t.position={x:this.position.x,y:this.position.y},t.zoomCenterX=e.x,t.zoomCenterY=e.y,t},i.prototype.getZoomCenter=function(){var t={},e=this.drawer.width,i=this.drawer.height,e=e/this.zoom,i=i/this.zoom,e=e/2-this.position.x,i=i/2-this.position.y;return t.x=e,t.y=i,t},i.prototype._validatePosition=function(t,e,i){var o=this.drawer.width,n=this.drawer.height,o=o-o/t,n=n-n/t;return{x:e=0<(e=(e=e||0)<-o?-o:e)?0:e,y:i=0<(i=(i=i||0)<-n?-n:i)?0:i}},i.prototype.setToCenterOfCanvas=function(t){t=t||this.zoom;var e=this.drawer.width/2,i=this.drawer.height/2;this._adjustPosition(t,e,i,!0),this._render()},i.prototype._render=function(){this.drawer.fCanvas.renderAll()},i.prototype.setPosition=function(t,e,i){t=t||this.zoom;e=this._validatePosition(t,e,i);this.position.x=e.x,this.position.y=e.y,this.zoom=t},i.prototype._adjustPosition=function(t,e,i,o){this.position.x=this.position.x||0,this.position.y=this.position.y||0;var n,r=this.drawer.width,s=this.drawer.height,a=t/this.zoom,h=r/this.zoom,l=s/this.zoom,c=r/t,p=s/t;return i=o?(n=c/2-e,p/2-i):void 0!==e&&void 0!==i?(o=(e-r/2)/this.zoom,e=(i-r/2)/this.zoom,n=this.position.x-o-(h-c)/2,this.position.y-e-(l-p)/2):(n=r/2-a*(r/2-this.position.x),s/2-a*(s/2-this.position.y)),this.setPosition(t,n,i),this.position},e.ZoomViewport=i}(this,(jQuery,DrawerJs.plugins)),!function(i,t,e){"use strict";function o(t){e.call(this,t),this.name="BrushSize",this.optionName="brushSize",this.$sizeControl=null,t.on(t.EVENT_BRUSH_SIZE_CHANGED,this.updateValue.bind(this)),t.on(t.EVENT_BRUSH_CHANGED,this.updateValue.bind(this))}(o.prototype=Object.create(e.prototype)).constructor=e,o.prototype.createControls=function(t){this.createSizeControl(t)},o.prototype.removeTool=function(t){this.$sizeControl.remove(),t&&this.drawer.off(this.drawer.EVENT_OPTIONS_TOOLBAR_CREATED,this._bindedOnToolbarCreated)},o.prototype.createSizeControl=function(t){var e=this;e.$sizeControl=i('<li style="display:none" class="editable-canvas-brushsize toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label">'+this.drawer.t("Size:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-brushsize-indicator">0px</span></div><input class="editable-canvas-brushsize-input" type="range" name="drawer-size" min="1"value="0" /></li>'),t.addControl(e.$sizeControl,this.options.buttonOrder),i(e.$sizeControl).on("change",function(){var t=i(e.$sizeControl).find("input").val();i(e.$sizeControl).find(".editable-canvas-brushsize-indicator").text(t+"px"),e.drawer.setBrushSize(t)})},o.prototype.showControls=function(){this.updateValue(),this.$sizeControl.show()},o.prototype.hideControls=function(){this.$sizeControl.hide()},o.prototype.updateValue=function(){var t=this.drawer.getBrushSize();this.$sizeControl.find("input").val(t),this.$sizeControl.find(".editable-canvas-brushsize-indicator").text(t+"px")},t.BrushSize=o}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions),!function(i,o){"use strict";function t(t,e){o.call(this,t),this._setupOptions(e),this.colorControl=new i.ColorpickerControl(this.drawer,this.options),this.opacityControl=new i.OpacityControl(this.drawer,this.options),this.transparentSaveColor=null}(t.prototype=Object.create(o.prototype)).constructor=o,t.prototype.optionName="color",t.prototype._defaultOptions={showOpacityControl:!1,alwaysVisible:!0,colorText:"Fill:"},t.prototype.createControls=function(t){this.colorControl.createControl(t,this._onColorSelected.bind(this)),this.opacityControl.createControl(t,this._onOpacityControlChanged.bind(this))},t.prototype._onColorSelected=function(t){"rgba(0, 0, 0, 0)"==t&&this.saveColor(),this.drawer.setColor(t)},t.prototype._onOpacityControlChanged=function(t){var e=this.drawer.activeColor,e=this._hexToRgba(e,t);this.drawer.setColor(e)},t.prototype.updateControlsFromObject=function(t){var e=null;t.path?(e=t.get("stroke"),this.colorControl.disableTransparent(),this.restoreColor()):(e=t.get("fill"),this.colorControl.enableTransparent()),e&&(this.updateControlsWithColor(e),this.drawer.activeColor=e)},t.prototype.updateControlsWithColor=function(t){this.colorControl.setColor(t);t=new fabric.Color(t)._source[3];this.opacityControl.setOpacity(t)},t.prototype.onActivateTool=function(t){t instanceof i.Line||t instanceof i.ArrowOneSide||t instanceof i.ArrowTwoSide||t instanceof i.Pencil?(this.colorControl.disableTransparent(),this.restoreColor()):this.colorControl.enableTransparent()},t.prototype.saveColor=function(){this.transparentSaveColor||(this.transparentSaveColor=this.drawer.activeColor)},t.prototype.restoreColor=function(){this.transparentSaveColor&&(this._onColorSelected(this.transparentSaveColor),this.colorControl.setColor(this.transparentSaveColor),this.transparentSaveColor=null)},t.prototype.showControls=function(t){t=void 0!==t?t:!this.options.showOpacityControl,this.colorControl.showControls(),t?this.opacityControl.hideControls():this.opacityControl.showControls()},t.prototype.hideControls=function(t){var e=this.drawer.options.toolbars.popupButtonAlwaysVisible||this.options.alwaysVisible;!t&&e||(this.colorControl.hideControls(),this.opacityControl.hideControls())},t.prototype._hexToRgba=function(t,e){t=new fabric.Color(t);return t._source[3]=e,t.toRgba()},i.Color=t}((jQuery,DrawerJs.plugins),DrawerJs.plugins.BaseToolOptions,DrawerJs.util),!function(o,t,n){"use strict";function e(t,e){this.drawer=t,this.options=o.extend(!0,{},this._defaultOptions||{},(e=e||{})||{}),this.hideOnEditMode=!0,this.assetsUrl=n.getDrawerFolderUrl()+"assets/",this.shouldDisplayTransparent=!1,this.colors=this.options.colors,this.colorsInRow=this.options.colorsInRow}e.prototype._defaultOptions={colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],colorsInRow:11,minSwatchSize:10,buttonOrder:6},e.prototype.TRANSPARENT="rgba(0, 0, 0, 0)",e.prototype.defaultPosition="bottom",e.prototype.positions=["bottom","top","left","right"],e.prototype.remove=function(){this.$colorButton&&this.$colorButton.remove()},e.prototype.hideControls=function(){this.$colorButton&&this.$colorButton.addClass("hidden")},e.prototype.showControls=function(){this.$colorButton&&this.$colorButton.removeClass("hidden")},e.prototype.getColor=function(){return this.currentColor},e.prototype.setColor=function(t){t instanceof fabric.Color?this.currentColor=t:this.currentColor=new fabric.Color(t);var e=t;""!==t&&t!=this.TRANSPARENT&&"transparent"!=t||(e="url("+this.assetsUrl+"transparent.png)",this.currentColor=this.TRANSPARENT),this.$colorButton.$colorIndicator.css("background",e)},e.prototype.disableTransparent=function(){this.shouldDisplayTransparent=!1,this.$colorButton&&this.$colorButton.find(".transparent").hide()},e.prototype.enableTransparent=function(){this.shouldDisplayTransparent=!0,this.$colorButton&&this.$colorButton.find(".transparent").show()},e.prototype.onColorSelected=function(t){this.hideColorDropdown(),this.setColor(t),this.colorChangeHandler&&this.colorChangeHandler(t)},e.prototype._setGlobalClickHandler=function(){var e=this;o("html").click(function(t){return e.colorDropdownVisible&&t.target!=e.$colorButton.$colorIndicator.get(0)&&e.hideColorDropdown(),!0})},e.prototype.createControl=function(t,e){return this.$colorButton=o(this._getControlHtml()),this._collectDataFromToolbar(t),this.$colorButton.$colorIndicator=this.$colorButton.find(".color-indicator"),this.$colorButton.$colorDropdown=this.$colorButton.find(".color-dropdown"),this.$colorButton.$colorIndicator.css("background-color",this.drawer.activeColor),this.colorDropdownVisible=!1,this.$colorButton.$colorIndicator.click(this._onButtonClick.bind(this)),this.colorChangeHandler=e,this._buildPicker(this.$colorButton.$colorDropdown),this._setGlobalClickHandler(),t.addControl(this.$colorButton,this.options.buttonOrder),this.$colorButton},e.prototype._onButtonClick=function(t){t=o(t.currentTarget);this.$lastTrigger=t,this.toggleColorDropdown(t)},e.prototype._collectDataFromToolbar=function(t){var e;t&&(e=t.options.position,this.isVertical="left"===e||"right"===e,this.$toolbar=t.$toolbar,this.toolbar=t)},e.prototype._buildPicker=function(t){for(var e=0;e<this.colors.length;e++){var i=this.colors[e],i=this._createSwatch(i);t.append(i)}var o=this._createTransparentSwatch();t.append(o)},e.prototype._updateControlsSize=function(){var t=this._calcSwatchSize(),t=(this.$colorButton.$colorDropdown.css("fontSize",t+"px"),t*this.colorsInRow);this.$colorButton.$colorDropdown.css("width",t+"px")},e.prototype._calcSwatchSize=function(){var t=(t=this.drawer.touchDevice?this.drawer.options.toolbarSize:this.drawer.options.toolbarSizeTouch)||this.options.minSwatchSize,e=Math.floor(.95*this.drawer.width/this.colorsInRow),i=this.drawer.height+this.drawer.toolbars.toolOptionsToolbar.height(),i=Math.floor(i/(this.colors.length/this.colorsInRow)),e=Math.min(e,i);return t=e<t?Math.max(e,this.options.minSwatchSize):t},e.prototype._getAvailableSpace=function(t){var e,i,o,n,r,s,a;return t&&t.length&&(e=this.drawer.$canvasEditContainer,o=this.$colorButton.$colorDropdown.closest(".popup-content-wrapper"),i=this.$colorButton.$colorDropdown.closest(".toolbar-content-wrapper"),e=e.get(0).getBoundingClientRect(),t=t.get(0).getBoundingClientRect(),i=i.get(0).getBoundingClientRect(),o=o.get(0).getBoundingClientRect(),n=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),r=t.left-e.left,s=t.top-e.top,(a={}).top=s,a.left=r,a.right=e.width-r-t.width,a.bottom=e.height-s-t.height,a.centerX=r+t.width/2,a.centerY=s+t.height/2,a.palette={arrowSize:0,top:n.height,bottom:n.height,left:n.width,right:n.width},a.popupSizes=o,a.toolbarSizes=i,a.paletteSizes=n,a.canvasSizes=e,a.triggerSizes=t),this.sizes=a},e.prototype._resetPalette=function(){this.$colorButton.$colorDropdown.removeClass("palette-with-scroll"),this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.removeAttr("data-position")},e.prototype._setFullSize=function(){var t=this.sizes,e=t.toolbarSizes.left-t.canvasSizes.left,i=t.toolbarSizes.top-t.canvasSizes.top,o={};o.top=-i,o.left=-e,o.width=t.canvasSizes.width,o.height=t.canvasSizes.height,this.$colorButton.$colorDropdown.css(o)},e.prototype._adjustPosition=function(t){this._resetPalette();var o,n=this._getAvailableSpace(t);this.positions.forEach(function(t,e){var i=n[t]&&n.palette[t];!o&&i&&(i=n.palette[t]+n.palette.arrowSize,i=0<n[t]-i,o=i&&t)}),o?this._movePalette(o):this._setFullSize()},e.prototype._cropSizeOfPalette=function(){var t,e=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),i=this.sizes.canvasSizes,o={},n=i.height-(e.height+e.top-i.top),r=e.top-i.top,s=i.width-(e.width+e.left-i.left),i=e.left-i.left,n=Math.min(n,r),r=Math.min(s,i);n<0&&(t=!0,o.height=e.height+n),r<0&&(t=!0,o.width=e.width+r),t&&this.$colorButton.$colorDropdown.addClass("palette-with-scroll"),this.$colorButton.$colorDropdown.css(o)},e.prototype._movePalette=function(t){var e,i,o,n,r,s,a=this.sizes,h=this.sizes.toolbarSizes.left-this.sizes.canvasSizes.left,l=this.sizes.toolbarSizes.top-this.sizes.canvasSizes.top,c={};a.paletteSizes.width,a.paletteSizes.height;switch(t){case"left":i=a.left-a.paletteSizes.width-a.palette.arrowSize,o=a.centerY-a.paletteSizes.height/2,c.right=a.toolbarSizes.width-(a.left-h);break;case"right":i=a.canvasSizes.width-a.right+a.palette.arrowSize,o=a.centerY-a.paletteSizes.height/2,c.left=a.left-h+a.triggerSizes.width;break;case"top":e=!0,i=a.centerX-a.paletteSizes.width/2,o=a.top-a.paletteSizes.height-a.palette.arrowSize,c.bottom=a.toolbarSizes.height-(a.top-l);break;case"bottom":e=!0,i=a.centerX-a.paletteSizes.width/2,o=a.canvasSizes.height-a.bottom+a.palette.arrowSize,c.top=a.top-l+a.triggerSizes.height}e?(n=i+a.paletteSizes.width-a.canvasSizes.width,r=0<a.canvasSizes.width-a.paletteSizes.width,0<n&&0<i&&!r?c.right=0-h:(i<0&&(i=0),s=!0,c.width=a.canvasSizes.width,c.left=i-h)):(n=o+a.paletteSizes.height-a.canvasSizes.height,r=0<a.canvasSizes.height-a.paletteSizes.height,0<n&&0<o&&!r?c.bottom=0-l:(s=!0,o<0&&(o=0),c.height=a.canvasSizes.width,c.top=o-l)),s&&this.$colorButton.$colorDropdown.addClass("palette-with-scroll"),this.$colorButton.$colorDropdown.attr("data-position",t),this.$colorButton.$colorDropdown.css(c),this._cropSizeOfPalette()},e.prototype._adjustControlsPosition=function(){var t,e,i=this.drawer.width<375,o=this.drawer.height<375,o=this.isVertical?o:i,i=this.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),n=this.$colorButton.get(0).getBoundingClientRect();this.$colorButton.$colorDropdown.removeAttr("style"),e=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),this.isVertical?o?this.$colorButton.$colorDropdown.css("top",0):(t=n.top-i.top+n.height/2-e.height/2,this.$colorButton.$colorDropdown.css("top",t)):o?this.$colorButton.$colorDropdown.css("left",0):(t=n.left-i.left+n.width/2-e.width/2,this.$colorButton.$colorDropdown.css("left",t)),o||(e=this.$colorButton.$colorDropdown.get(0).getBoundingClientRect(),this.isVertical?(o=10<375-e.height,n=e.top>i.top,t=e.top+e.height<i.top+i.height&&!o,n||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css("top",0)),t||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css({bottom:0,top:"auto"}))):(o=10<375-e.width,n=e.left>i.left,t=e.left+e.width<i.left+i.width&&!o,n||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css("left",0)),t||(this.$colorButton.$colorDropdown.removeAttr("style"),this.$colorButton.$colorDropdown.css({right:0,left:"auto"}))))},e.prototype._getControlHtml=function(){var t=this.options.colorText||"";return'<li class="colorpicker-control" data-editable-canvas-sizeable="toolbar-button" ><span class="toolbar-label" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="line-height">'+this.drawer.t(t)+' </span><span class="color-indicator" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="width"></span><span class="color-dropdown control-hidden hidden" data-editable-canvas-sizeable="toolbar-button"></span></li>'},e.prototype._createSwatch=function(t,e){var i=o('<a href="#"></a>');return i.attr("rel",t).addClass("color-swatch").css({"background-color":t}),e&&i.addClass(e),n.bindClick(i,"colorpicker",this._swatchClickHandler.bind(this)),i},e.prototype._swatchClickHandler=function(t){t.preventDefault(),t.stopPropagation();t=o(t.target).attr("rel");return this.onColorSelected(t),!1},e.prototype._createTransparentSwatch=function(){var t=this._createSwatch(this.TRANSPARENT,"transparent");return t.text(this.drawer.t("Transparent")),this.shouldDisplayTransparent||t.hide(),t},e.prototype.showColorDropdown=function(t){this.colorDropdownVisible=!0,this._updateControlsSize();var e=this.$toolbar.closest(".popup-content-wrapper").length;this.$colorButton.$colorDropdown.removeClass("hidden"),e?this._adjustPosition(t):this._adjustControlsPosition(),this.$colorButton.$colorDropdown.removeClass("control-hidden"),"scrollable"===this.toolbar.options.compactType&&(this.$cloneControl=o('<div class="colorpicker-control"></div>'),this.$cloneDropdown=this.$colorButton.$colorDropdown.clone(!0),this.$cloneControl.append(this.$cloneDropdown),this.$toolbar.closest(".toolbar-placeholder").append(this.$cloneControl))},e.prototype.hideColorDropdown=function(){this.colorDropdownVisible=!1,this.$colorButton.$colorDropdown.addClass("hidden"),this.$colorButton.$colorDropdown.addClass("control-hidden"),this.$cloneControl&&this.$cloneControl.remove()},e.prototype.toggleColorDropdown=function(t){this.colorDropdownVisible?this.hideColorDropdown():this.showColorDropdown(t)},t.ColorpickerControl=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(i,t){"use strict";function e(t,e){this.drawer=t,this.options=i.extend(!0,{},this._defaultOptions||{},e||{}),this._opacity=this.options.defaultOpacity,this.drawer.on(this.drawer.AFTER_CREATE_TOOLBARS,this._moveControlToEnd.bind(this))}e.prototype._defaultOptions={defaultOpacity:1},e.prototype.remove=function(){this.$opacityControl&&this.$opacityControl.remove()},e.prototype._moveControlToEnd=function(){"popup"===this.toolbar.options.compactType&&this.$opacityControl.parent().append(this.$opacityControl)},e.prototype.hideControls=function(){this.$opacityControl&&this.$opacityControl.addClass("hidden")},e.prototype.showControls=function(){this.$opacityControl&&this.$opacityControl.removeClass("hidden")},e.prototype.getOpacity=function(){return this._opacity},e.prototype.setOpacity=function(t){this._opacity=t,this.$opacityControl.find("input").val(100*t),this.$opacityControl.find(".editable-canvas-opacity-indicator").text(100*t+"%")},e.prototype.onOpacityChange=function(){var t=i(this.$opacityControl).find("input"),t=parseInt(t.val(),10),t="number"==typeof t&&isFinite(t)?t:this.options.defaultOpacity,e=parseInt(t,10)+"%";this._opacity=t/100,this.$opacityIndicator.text(e),this.opacityChangeCallback&&this.opacityChangeCallback(this._opacity)},e.prototype.createControl=function(t,e){return this.toolbar=t,this.opacityChangeCallback=e,this.$opacityControl=i('<li class="editable-canvas-opacity toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-opacity-label">'+this.drawer.t("Fill opacity:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-opacity-indicator">100%</span></div><input class="editable-canvas-opacity-input" type="range" name="drawer-size" min="0" max="100"value="100" /></li>'),this.$opacityIndicator=this.$opacityControl.find(".editable-canvas-opacity-indicator"),t.addControl(this.$opacityControl,this.options.buttonOrder),i(this.$opacityControl).on("change",this.onOpacityChange.bind(this)),this.$opacityControl},e.prototype.showControls=function(){this.$opacityControl.show()},e.prototype.hideControls=function(){this.$opacityControl.hide()},t.OpacityControl=e}(jQuery,DrawerJs.plugins,DrawerJs.util),!function(o,t){function e(t){var i=this;this.drawerInstance=t,this.name="BrushSize",t.on(t.EVENT_OPTIONS_TOOLBAR_CREATED,function(t,e){i.createColorControl(e)})}e.prototype.createColorControl=function(t){var e=this,i=o('<li class="editable-canvas-plugin-color"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height"><span class="toolbar-label"data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height,line-height">Color: </span><input class="editable-canvas-colorpicker" type="color" value="'+this.drawerInstance.activeColor+'" data-editable-canvas-sizeable="toolbar-button" data-editable-canvas-cssrules="height,width"/></li>');t.addControl(i,this.options.buttonOrder);i.find("input").change(function(t){t&&(t=t.target.value,e.drawerInstance.setColor(t))})},t.ColorpickerHtml5=e}(jQuery,DrawerJs.plugins),!function(i,t,o){"use strict";function e(t,e){o.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(o.prototype)).constructor=o,e.prototype.name="LineWidth",e.prototype.optionName="lineWidth",e.prototype.useCombobox=!1,e.prototype.preventHightlight=!1,e.prototype.buttonMode=!1,e.prototype.buttonIconClass="fa-arrows-h",e.prototype._defaultOptions={digitsAfterDecimalPoint:0},e.prototype.onSelectionCleared=function(t){this.data=!1},e.prototype.createControls=function(t){this.createControl(t),this._attachEvents()},e.prototype._generateHtml=function(){return'<li class="'+("toolbar-item-wrapper toolbar-item-range editable-canvas-line-width hidden"+((this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")))+'"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-line-width-label">'+this.drawer.t("Line width:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-line-width-indicator"></span></div><input class="editable-canvas-line-width-input controls-value-item" name="drawer-line-width"data-name="lineWidth"type="range"min="1"max="1000"></li>'},e.prototype.createControl=function(t){var e=this._generateHtml();return this.$toolControl=i(e),this.$valueIndicator=this.$toolControl.find(".editable-canvas-line-width-indicator"),t.addControl(this.$toolControl,this.options.buttonOrder),this.$toolControl},e.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},e.prototype.validateValue=function(t){var e;return"number"==typeof(t=parseInt(t,10))&&isFinite(t)&&t&&(e=Math.pow(10,this.options.digitsAfterDecimalPoint),e=parseInt(t*e,10)/e),e},e.prototype.setLineWidth=function(t){var e=this.drawer.fCanvas,i=e.getActiveObject();i&&(this.data||this.collectDataFromObject(i),t=parseInt(t/this.data.initialWidth*100,10)/100,i.x1=this.data.x1*t*i.scaleX,i.x2=this.data.x2*t*i.scaleX,i.y1=this.data.y1*t*i.scaleY,i.y2=this.data.y2*t*i.scaleY,i.set("x1",i.x1),i.set("x2",i.x2),i.set("y1",i.y1),i.set("y2",i.y2),i.set("top",this.data.top),i.set("left",this.data.left),e.renderAll())},e.prototype.onInputChange=function(){var t=i(this.$toolControl).find("input").val(),t=this.validateValue(t);this.$valueIndicator.text(t+"px"),this.setLineWidth(t)},e.prototype.collectDataFromObject=function(t){function e(t,e){return t=Math.pow(t,2)+Math.pow(e,2),e=Math.sqrt(t),parseInt(e*o)/o}var i={},o=Math.pow(10,this.options.digitsAfterDecimalPoint),n=t.x2-t.x1,r=t.y2-t.y1,s=n*t.scaleX,a=r*t.scaleY,h=n,l=r,r=Math.atan(r/n),n=Math.abs(fabric.util.radiansToDegrees(r));return i.lineWidth=e(s,a),i.initialWidth=e(h,l),i.angleRad=r,i.angleDeg=n,i.top=t.top,i.left=t.left,i.x1=t.x1,i.x2=t.x2,i.y1=t.y1,i.y2=t.y2,this.data=i},e.prototype.updateControls=function(t){t=(t=t||this.data).lineWidth,t=this.validateValue(t);this.$toolControl.find("input").val(t),this.$valueIndicator.text(t+"px")},e.prototype.showControls=function(){this.$toolControl.removeClass("hidden")},e.prototype.hideControls=function(t){this.$toolControl.addClass("hidden")},t.LineWidth=e}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),!function(i,t,o){"use strict";function e(t,e){o.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(o.prototype)).constructor=o,e.prototype.optionName="opacity",e.prototype._defaultOptions={defaultValue:1,alwaysVisible:!0},e.prototype.createControls=function(t){this.createControl(t,this.setOpacity.bind(this))},e.prototype.createControl=function(t,e){return this.toolbar=t,this.opacityChangeCallback=e,this.$opacityControl=i('<li class="editable-canvas-opacity-option toolbar-item-range"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-opacity-option-label">'+this.drawer.t("Opacity :")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-opacity-option-indicator">100%</span></div><input class="editable-canvas-opacity-option-input" type="range" name="drawer-size" min="0" max="100"value="100" /></li>'),this.$opacityIndicator=this.$opacityControl.find(".editable-canvas-opacity-option-indicator"),t.addControl(this.$opacityControl,this.options.buttonOrder),this.$opacityControl.on("change",this._onOpacityChange.bind(this)),this.$opacityControl},e.prototype.setOpacity=function(t){var e=this.drawer.fCanvas,i=e.getActiveObject();this.drawer.setOpacity(t),i&&(i.setOpacity(t),e.renderAll())},e.prototype._onOpacityChange=function(){var t=i(this.$opacityControl).find("input"),t=parseInt(t.val(),10),t="number"==typeof t&&isFinite(t)?t:this.options.defaultOpacity,e=parseInt(t,10)+"%";this._opacity=t/100,this.$opacityIndicator.text(e),this.opacityChangeCallback&&this.opacityChangeCallback(this._opacity)},e.prototype.collectDataFromObject=function(t){var e={};return e.opacity=t.get("opacity"),this.data=e},e.prototype.updateControls=function(t){var t=(t=t||this.data).opacity,t="number"==typeof t&&isFinite(t)?t:this.options.defaultOpacity,e=parseInt(100*t,10)+"%";this.drawer.activeOpacity=t,this.$opacityControl.find("input").val(100*t),this.$opacityControl.find(".editable-canvas-opacity-option-indicator").text(e)},e.prototype.showControls=function(){this.$opacityControl.removeClass("hidden")},e.prototype.hideControls=function(t){var e=this.drawer.options.toolbars.popupButtonAlwaysVisible||this.options.alwaysVisible;!t&&e||this.$opacityControl.addClass("hidden")},t.OpacityOption=e}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),!function(i,t,o){"use strict";function e(t,e){o.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(o.prototype)).constructor=o,e.prototype.name="StrokeWidth",e.prototype.optionName="strokeWidth",e.prototype.useCombobox=!1,e.prototype.preventHightlight=!1,e.prototype.buttonMode=!1,e.prototype.buttonIconClass="fa-arrows-h",e.prototype._defaultOptions={digitsAfterDecimalPoint:0},e.prototype.onSelectionCleared=function(t){this.data=!1},e.prototype.createControls=function(t){this.createControl(t),this._attachEvents()},e.prototype._generateHtml=function(){return'<li class="'+("toolbar-item-wrapper toolbar-item-range editable-canvas-stroke-width hidden"+((this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")))+'"><div class="toolbar-item-description"><span class="toolbar-label editable-canvas-stroke-width-label">'+this.drawer.t("Stroke width:")+' </span><span class="toolbar-label toolbar-label-indicator editable-canvas-stroke-width-indicator"></span></div><input class="editable-canvas-stroke-width-input controls-value-item" name="drawer-stroke-width"data-name="strokeWidth"type="range"min="1"max="50"></li>'},e.prototype.createControl=function(t){var e=this._generateHtml();return this.$toolControl=i(e),this.$valueIndicator=this.$toolControl.find(".editable-canvas-stroke-width-indicator"),t.addControl(this.$toolControl,this.options.buttonOrder),this.$toolControl},e.prototype._attachEvents=function(){this.$toolControl&&this.$toolControl.on("input change toolbarOptionChange",this.onInputChange.bind(this))},e.prototype.validateValue=function(t){var e;return"number"==typeof(t=parseInt(t,10))&&isFinite(t)&&t&&(e=Math.pow(10,this.options.digitsAfterDecimalPoint),e=parseInt(t*e,10)/e),e},e.prototype.setStrokeWidth=function(t){t=parseInt(t,10);var e=this.drawer.fCanvas,i=e.getActiveObject();this.drawer.lineStrokeWidth=t,i&&(this.data||this.collectDataFromObject(i),i.set("left",this.data.left),i.set("top",this.data.top),i.set("strokeWidth",parseInt(t,10)),e.renderAll())},e.prototype.onInputChange=function(){var t=i(this.$toolControl).find("input").val(),t=this.validateValue(t);this.$valueIndicator.text(t+"px"),this.setStrokeWidth(t)},e.prototype.collectDataFromObject=function(t){var e={},i=(Math.pow(10,this.options.digitsAfterDecimalPoint),t.strokeWidth);return e.strokeWidth=i,e.top=t.top,e.left=t.left,this.data=e},e.prototype.updateControls=function(t){t=(t=t||this.data).strokeWidth,t=this.validateValue(t);this.drawer.lineStrokeWidth=t,this.$toolControl.find("input").val(t),this.$valueIndicator.text(t+"px")},e.prototype.showControls=function(){this.$toolControl.removeClass("hidden")},e.prototype.hideControls=function(t){this.$toolControl.addClass("hidden")},t.StrokeWidth=e}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),!function(t,i){"use strict";function e(t,e){i.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(i.prototype)).constructor=i,e.prototype.name="TextAlign",e.prototype.optionName="TextAlign",e.prototype.useCombobox=!0,e.prototype.buttonMode=!0,e.prototype.focusTextOnChange=!0,e.prototype.preventHightlight=!0,e.prototype.showOnEditMode=!1,e.prototype.hideOnEditMode=!0,e.prototype.stylesToObject=!0,e.prototype.onlyPredefined=!0,e.prototype.buttonIconClass="fa-align-left",e.prototype.valueType={textAlign:"string"},e.prototype._defaultOptions={defaultValues:{textAlign:"left"},predefined:{textAlign:["left","center","right","justify"]},valueMap:{left:{value:"left",classString:"fa fa-align-left"},center:{value:"center",classString:"fa fa-align-center"},right:{value:"right",classString:"fa fa-align-right"},justify:{value:"justify",classString:"fa fa-align-justify"}}},e.prototype.controlTemplate=function(){var t=this.options.predefined.textAlign.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),t='<select class="editable-canvas-text-textalign-input controls-value-item" name="drawer-size"data-name="textAlign"value="'+this.options.defaultValues.textAlign+'">'+t+"</select>";return'<li class="'+("toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-textalign hidden"+((this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")))+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font size:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+t+"</div></li>"},t.TextAlign=e}((jQuery,DrawerJs.plugins),(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(i,o){"use strict";function t(t,e){o.call(this,t),this._setupOptions(e),this.colorControl=new i.ColorpickerControl(this.drawer,this.options)}(t.prototype=Object.create(o.prototype)).constructor=o,t.prototype.name="TextBackgroundColor",t.prototype.optionName="TextBackgroundColor",t.prototype.focusTextOnChange=!0,t.prototype.useCombobox=!1,t.prototype.buttonMode=!1,t.prototype._defaultOptions={colorText:"Text background:",defaultValues:{textBackgroundColor:""}},t.prototype.onlyPredefined=!0,t.prototype.valueType={textBackgroundColor:"color"},t.prototype.updateSingleControl=function(t,e){"textBackgroundColor"===t&&this.colorControl.setColor(e)},t.prototype.getStylesFromControls=function(){},t.prototype.getStylesFromChangeEvent=function(t){var e;return t&&("object"==typeof t&&(e=t.styles),"string"==typeof t)&&(e={textBackgroundColor:t}),this._lastData=e},t.prototype.setupControl=function(t,e,i){this.colorChangeHandler=i,this.$toolControl=this.colorControl.createControl(t,this.onInputChange.bind(this)),this.$toolControl.$colorIndicator=this.$toolControl.find(".color-indicator"),this.$toolControl.$colorDropdown=this.$toolControl.find(".color-dropdown"),this.$toolControl.$colorIndicator.attr("data-name","textBackgroundColor"),this.$toolControl.$colorIndicator.addClass("controls-value-item"),this.$toolControl.addClass("editable-canvas-text-option editable-canvas-text-backgroundcolor"),this.colorDropdownVisible=!1},i.TextBackgroundColor=t}((jQuery,DrawerJs.plugins),(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(i,o){"use strict";function t(t,e){o.call(this,t),this._setupOptions(e),this.colorControl=new i.ColorpickerControl(this.drawer,this.options)}(t.prototype=Object.create(o.prototype)).constructor=o,t.prototype.name="TextColor",t.prototype.optionName="TextColor",t.prototype.focusTextOnChange=!0,t.prototype.onlyPredefined=!0,t.prototype._defaultOptions={colorText:"Font color:",defaultValues:{fill:""}},t.prototype.valueType={fill:"color"},t.prototype.updateSingleControl=function(t,e){"fill"===t&&this.colorControl.setColor(e)},t.prototype.getStylesFromControls=function(){},t.prototype.getStylesFromChangeEvent=function(t){var e;return t&&("object"==typeof t&&(e=t.styles),"string"==typeof t)&&(e={fill:t}),this._lastData=e},t.prototype.setupControl=function(t,e,i){this.colorChangeHandler=i,this.$toolControl=this.colorControl.createControl(t,this.onInputChange.bind(this)),this.$toolControl.$colorIndicator=this.$toolControl.find(".color-indicator"),this.$toolControl.$colorDropdown=this.$toolControl.find(".color-dropdown"),this.$toolControl.$colorIndicator.attr("data-name","fill"),this.$toolControl.$colorIndicator.addClass("controls-value-item"),this.$toolControl.addClass("editable-canvas-text-option editable-canvas-text-color"),this.colorDropdownVisible=!1},i.TextColor=t}((jQuery,DrawerJs.plugins),(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(t,i){"use strict";function e(t,e){i.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(i.prototype)).constructor=i,e.prototype.name="TextDecoration",e.prototype.optionName="TextDecoration",e.prototype.focusTextOnChange=!0,e.prototype.onlyPredefined=!0,e.prototype.buttonIconClass="fa-strikethrough",e.prototype.valueType={textDecoration:"string"},e.prototype._defaultOptions={defaultValues:{textDecoration:""},predefined:{textDecoration:["underline","overline","line-through"]}},e.prototype.controlTemplate=function(){var t=this.options.predefined.textDecoration.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),t='<select class="editable-canvas-text-decoration-input controls-value-item" name="drawer-size"data-name="textDecoration"value="'+this.options.defaultValues.textDecoration+'">'+t+"</select>";return'<li class="'+("toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-decoration hidden"+(this.buttonMode?" toolbar-button-item ":""))+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Text Decoration:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+t+"</div></li>"},t.TextDecoration=e}((jQuery,DrawerJs.plugins),(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(n,t,r,i){"use strict";function e(t,e){i.call(this,t),this._setupOptions(e),this.activeFont=this.options.fonts[this.options.defaultFont],this.drawer.on(this.drawer.EVENT_TEXT_GET_STYLES,this._onGetStyles.bind(this))}(e.prototype=Object.create(i.prototype)).constructor=i,e.prototype.name="TextFontFamily",e.prototype.optionName="TextFontFamily",e.prototype.buttonIconClass="fa-font",e.prototype.focusTextOnChange=!0,e.prototype.onlyPredefined=!0,e.prototype.valueType={fontFamily:"string"},e.prototype._defaultOptions={defaultValues:{fontFamily:"Georgia"},fonts:{Georgia:"Georgia, serif",Palatino:"'Palatino Linotype', 'Book Antiqua', Palatino, serif","Times New Roman":"'Times New Roman', Times, serif",Arial:"Arial, Helvetica, sans-serif","Arial Black":"'Arial Black', Gadget, sans-serif","Comic Sans MS":"'Comic Sans MS', cursive, sans-serif",Impact:"Impact, Charcoal, sans-serif","Lucida Grande":"'Lucida Sans Unicode', 'Lucida Grande', sans-serif",Tahoma:"Tahoma, Geneva, sans-serif","Trebuchet MS":"'Trebuchet MS', Helvetica, sans-serif",Verdana:"Verdana, Geneva, sans-serif","Courier New":"'Courier New', Courier, monospace","Lucida Console":"'Lucida Console', Monaco, monospace"},defaultFont:"Georgia"},e.prototype.changeFont=function(t,e){this.activeFont=this.options.fonts[t],e||this.setStyles({fontFamily:this.activeFont}),this.$toolControl.find(".editable-canvas-fontfamily").css("font-family",this.activeFont),this.$toolControl.find(".editable-canvas-fontfamily").text(t||""),this.$toolControl.find(".fonts-dropdown").addClass("hidden")},e.prototype.updateSingleControl=function(t,e){"fontFamily"===t&&(t=this.getFontByCss(e),this.changeFont(t,!0))},e.prototype._collectDefaultOptions=function(t){var e=this.drawer.getPluginConfig("Text");return{fonts:n.extend(!0,{},e.fonts||{}),defaultFont:e.defaultFont}},e.prototype._onGetStyles=function(t,e,i){(i=i||{}).defaultValues=i.defaultValues||{},i.defaultValues.fontFamily=this.options.fonts[this.options.defaultFont]},e.prototype.getFontByCss=function(i){var o=null;return n.each(this.options.fonts,function(t,e){e==i&&(o=t)}),o},e.prototype.setupControl=function(t,e,i){var o=this;r.bindClick(e.find(".toolbar-label"),"fontFamily",function(){e.find(".fonts-dropdown").toggleClass("hidden")}),e.find("li a").each(function(t,e){e=n(e);r.bindClick(e,"fontFamily",function(){var t=n(this).data("fontName");o.changeFont(t)})})},e.prototype.controlTemplate=function(){var t,i="";n.each(this.options.fonts,function(t,e){i+='<option style="font-family: '+e+';"value="'+t+'"data-font-name="'+t+'">'+t+"</option>"}),t='<select class="editable-canvas-text-fontfamily-input controls-value-item" name="drawer-size"data-name="fontFamily"value="'+this.options.defaultValues.fontFamily+'">'+i+"</select>";return'<li class="'+("toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontfamily hidden"+(this.buttonMode?" toolbar-button-item ":""))+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font family:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+t+"</div></li>"},t.TextFontFamily=e}(jQuery,DrawerJs.plugins,DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool),!function(t,i){"use strict";function e(t,e){i.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(i.prototype)).constructor=i,e.prototype.name="TextFontSize",e.prototype.optionName="TextFontSize",e.prototype.buttonIconClass="fa-text-height",e.prototype.valueType={fontSize:"number"},e.prototype._defaultOptions={defaultValues:{fontSize:48},predefined:{fontSize:[6,12,14,16,20,24,32,40,48,72]}},e.prototype.controlTemplate=function(){var t=this.options.predefined.fontSize.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),t='<select class="editable-canvas-text-fontsize-input controls-value-item" name="drawer-size"data-name="fontSize"value="'+this.options.defaultValues.fontSize+'">'+t+"</select>";return'<li class="'+("toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontsize hidden"+(this.buttonMode?" toolbar-button-item ":""))+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font size:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+t+"</div></li>"},t.TextFontSize=e}((jQuery,DrawerJs.plugins),(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(t,i){"use strict";function e(t,e){i.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(i.prototype)).constructor=i,e.prototype.name="TextFontStyle",e.prototype.optionName="TextFontStyle",e.prototype.onlyPredefined=!0,e.prototype.focusTextOnChange=!0,e.prototype.buttonIconClass="fa-italic",e.prototype.valueType={fontStyle:"string"},e.prototype._defaultOptions={defaultValues:{fontStyle:""},predefined:{fontStyle:["normal","italic","oblique"]}},e.prototype.controlTemplate=function(){var t=this.options.predefined.fontStyle.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),t='<select class="editable-canvas-text-fontstyle-input controls-value-item" name="drawer-size"data-name="fontStyle"value="'+this.options.defaultValues.fontStyle+'">'+t+"</select>";return'<li class="'+("toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontstyle hidden"+(this.buttonMode?" toolbar-button-item ":""))+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font style:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+t+"</div></li>"},t.TextFontStyle=e}((jQuery,DrawerJs.plugins),(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(t,i){"use strict";function e(t,e){i.call(this,t),this._setupOptions(e)}(e.prototype=Object.create(i.prototype)).constructor=i,e.prototype.name="TextFontWeight",e.prototype.optionName="TextFontWeight",e.prototype.focusTextOnChange=!0,e.prototype.onlyPredefined=!0,e.prototype.buttonIconClass="fa-bold",e.prototype._defaultOptions={defaultValues:{fontWeight:"normal"},predefined:{fontWeight:["normal","bold","light",100,200,300,400,500,600,700,800,900]}},e.prototype.controlTemplate=function(){var t=this.options.predefined.fontWeight.map(function(t,e){return'<option value="'+t+'">'+t+"</option>"}).join(""),t='<select class="editable-canvas-text-fontweight-input controls-value-item" name="drawer-size"data-name="fontWeight"value="'+this.options.defaultValues.fontWeight+'">'+t+"</select>";return'<li class="'+("toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-fontweight hidden"+(this.buttonMode?" toolbar-button-item ":""))+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Font Weight:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+t+"</div></li>"},t.TextFontWeight=e}((jQuery,DrawerJs.plugins),(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(e,t,i){"use strict";function o(t,e){i.call(this,t),this._setupOptions(e)}var n=fabric.Text.prototype.lineHeight||1.16;(o.prototype=Object.create(i.prototype)).constructor=i,o.prototype.name="TextLineHeight",o.prototype.optionName="TextLineHeight",o.prototype.showOnEditMode=!1,o.prototype.hideOnEditMode=!0,o.prototype.stylesToObject=!0,o.prototype.preventHightlight=!0,o.prototype.buttonIconClass="fa-arrows-v",o.prototype.onlyPredefined=!0,o.prototype.valueType={lineHeight:"number"},o.prototype._defaultOptions={defaultValues:{lineHeight:n},predefined:{lineHeight:[1,1.16,1.25,1.5,1.75,2,3]}},o.prototype.collectDataFromObject=function(t){t={lineHeight:t.lineHeight};return this._lastData=this._lastData||{},e.extend(!0,this._lastData,t),t},o.prototype.controlTemplate=function(){var t=this.options.predefined.lineHeight.map(function(t,e){return'<option value="'+t+'">'+parseInt(Math.round(100*t),10)+"%</option>"}).join(""),t='<select class="editable-canvas-text-lineheight-input controls-value-item" name="drawer-size"data-name="lineHeight"value="'+this.options.defaultValues.lineHeight+'">'+t+"</select>";return'<li class="'+("toolbar-item-wrapper editable-canvas-text-option editable-canvas-text-lineheight hidden"+((this.buttonMode?" toolbar-button-item ":"")+(this.preventHightlight?" prevent-highlight ":"")))+'"><div class="toolbar-item-description"><span class="toolbar-item-label">'+this.drawer.t("Line height:")+' </span><span class="toolbar-item-valueholder"></span><span class="toolbar-item-icon fa '+this.buttonIconClass+'"></span></div><div class="toolbar-dropdown-block collapsed">'+t+"</div></li>"},t.TextLineHeight=o}(jQuery,DrawerJs.plugins,(DrawerJs.util,DrawerJs.plugins.BaseTextOptionTool)),!function(a,i,o,h){"use strict";function t(t,e){this.optionName="border",this.name="ShapeBorder",o.call(this,t),this.assetsFolder=h.getDrawerFolderUrl()+"assets/",this._setGlobalClickHandler(),this._completeDefaultOptionsPaths(),this.colorpicker=new i.ColorpickerControl(this.drawer,this.options),this.currentColor=this.options.color,this.currentBorder=this.options.borderTypes[this.options.defaultBorder],this.activeToolIsShape=!1,this.drawer.on(this.drawer.EVENT_CANVAS_START_RESIZE,this.hideStyleDropdown.bind(this)),this.drawer.on(this.drawer.EVENT_OBJECT_ADDED,this._onObjectAdded.bind(this))}(t.prototype=Object.create(o.prototype)).constructor=o,t.prototype._defaultOptions={color:"rgba(0, 0, 0, 0)",borderTypes:{None:{width:0,description:"None",color:"transparent"},"Solid thin":{width:1,preview:"border-solid-thin.png"},"Solid bold":{width:5,preview:"border-solid-bold.png"},"Dashed thin":{width:1,dashArray:[8,8],preview:"border-dashed-thin.png"},"Dashed bold":{width:5,dashArray:[8,8],preview:"border-dashed-bold.png"}},defaultBorder:"None"},t.prototype._completeDefaultOptionsPaths=function(){for(var t in this.options.borderTypes){t=this.options.borderTypes[t];t.preview&&(t.preview=this.assetsFolder+t.preview)}},t.prototype._setGlobalClickHandler=function(){var e=this;a(window.document).off("click.DrawerShapeBorder").on("click.DrawerShapeBorder",function(t){t=a(t.target).hasClass("border-type-indicator");e.isDropdownVisible&&!t&&e.hideStyleDropdown()})},t.prototype.updateControlsFromObject=function(t){this.updateColorFromObject(t),this.updateStrokeFromObject(t),this.updateControls()},t.prototype.updateColorFromObject=function(t){t=t.get("stroke");this.currentColor=t||i.ColorpickerControl.TRANSPARENT},t.prototype.updateStrokeFromObject=function(t){var e,i,o,n=t.get("strokeDashArray"),r=t.get("strokeWidth");for(e in this.options.borderTypes)this.options.borderTypes.hasOwnProperty(e)&&(i=this.options.borderTypes[e],o=JSON.stringify(i.dashArray)===JSON.stringify(n),o=!i.dashArray&&!n||o)&&i.width==r&&(this.currentBorder=i)},t.prototype._onObjectAdded=function(t,e){this.drawer.mode==this.drawer.MODE_ACTIVE&&(e=e.target,this.applyBorderStyle(e),this.drawer.fCanvas.renderAll())},t.prototype.onActivateTool=function(t){t instanceof i.Line||t instanceof i.ArrowOneSide||t instanceof i.ArrowTwoSide?(this.colorBeforeLineShape=this.currentColor,this.borderBeforeLineShape=this.currentBorder,this.currentColor=this.drawer.activeColor,this.currentBorder=this.options.borderTypes["Solid thin"],this.updateControls()):void 0!==this.colorBeforeLineShape&&(this.currentColor=this.colorBeforeLineShape,this.currentBorder=this.borderBeforeLineShape,delete this.colorBeforeLineShape,delete this.borderBeforeLineShape,this.updateControls())},t.prototype.createControls=function(t){function e(t){var e=a(t.target).attr("data-border-type");e&&(r.currentBorder=r.options.borderTypes[e],r.onColorSelected(),t.stopPropagation(),t.preventDefault())}var i,o,n,r=this,s=(this.colorButton=this.colorpicker.createControl(t,this.onColorSelected.bind(this)),this.colorpicker.setColor(this.options.color),this.colorButton.css("display","inline-block"),this.colorButton.find(".toolbar-label").text(this.drawer.t("Border:")),r.$borderTypeButton=a('<li class="editable-canvas-border-type" data-editable-canvas-sizeable="toolbar-button" ><span class="toolbar-label editable-canvas-border-type-label">'+this.drawer.t("Border type:")+' </span><span class="border-type-indicator" data-editable-canvas-sizeable="toolbar-button" ></span><span class="border-type-dropdown toolbar-dropdown-block hidden" data-editable-canvas-sizeable="toolbar-button" ></span></li>'),r.isDropdownVisible=!1,r.$borderTypeButton.$dropdown=r.$borderTypeButton.find(".border-type-dropdown"),r.$borderTypeButton.$indicator=r.$borderTypeButton.find(".border-type-indicator"),h.bindClick(r.$borderTypeButton,"border-type-dropdown",r.toggleStyleDropdown.bind(r)),a("<ul></ul>"));r.$borderTypeButton.$dropdown.append(s);for(i in this.options.borderTypes)this.options.borderTypes.hasOwnProperty(i)&&(o=this.options.borderTypes[i],n=a('<li data-border-type="'+i+'"data-editable-canvas-sizeable="toolbar-button" </li>'),o.preview&&n.css("background-image","url("+o.preview+")"),o.description&&n.text(o.description),h.bindClick(n,"border-type",e),s.append(n));t.addControl(r.$borderTypeButton,this.options.buttonOrder),r.onColorSelected(),r.hideControls()},t.prototype.onColorSelected=function(t){t&&(this.currentColor=t),this.updateControls(),this.drawer.fCanvas&&((t=this.drawer.fCanvas.getActiveObject())&&this.applyBorderStyle(t),this.drawer.fCanvas.renderAll())},t.prototype.applyBorderStyle=function(t){(h.isShape(t)||t instanceof fabric.Line)&&(this.currentBorder.color?t.set("stroke",this.currentBorder.color):t.set("stroke",this.currentColor),t.set("strokeWidth",this.currentBorder.width),this.currentBorder.dashArray?t.set("strokeDashArray",this.currentBorder.dashArray):t.set("strokeDashArray",null))},t.prototype.updateControls=function(){this.colorpicker.setColor(this.currentColor),this.hideStyleDropdown(),"None"==this.currentBorder.description?this.colorpicker.hideControls():this.colorpicker.showControls();var t=this.$borderTypeButton.find(".border-type-indicator"),e=this.currentBorder.preview?"url("+this.currentBorder.preview+")":"none";t.css("background-image",e),this.currentBorder.description?t.text(this.drawer.t(this.currentBorder.description)):t.text("")},t.prototype.showControls=function(){this.colorpicker.showControls(),this.$borderTypeButton.show()},t.prototype.hideControls=function(){this.colorpicker.hideControls(),this.$borderTypeButton.hide()},t.prototype.toggleStyleDropdown=function(){!this.isDropdownVisible?this.showStyleDropdown():this.hideStyleDropdown()},t.prototype.hideStyleDropdown=function(){this.$borderTypeButton.$dropdown.addClass("hidden"),this.isDropdownVisible=!1,this.$clonedDropdown&&this.$clonedDropdown.remove()},t.prototype.showStyleDropdown=function(){this.$borderTypeButton.$dropdown.removeClass("hidden"),this.isDropdownVisible=!0;var t,e,i=this.drawer&&this.drawer.toolbars&&this.drawer.toolbars.toolOptionsToolbar,i=i&&i.options,o=i&&"popup"!==i.position,n=i&&"outside"===i.positionType,i=i&&"scrollable"===i.compactType;o&&n&&i&&((o=this.$borderTypeButton.$dropdown).removeClass("hidden"),n=o.clone(!0),this.$borderTypeButton.$dropdown.closest(".toolbar-placeholder").append(n),n.addClass("border-type-dropdown-cloned"),this.$clonedDropdown=n,i=h.getScrollOffset(this.drawer.$canvasEditContainer),n=h.getScrollOffset(this.$borderTypeButton),t=this.drawer.$canvasEditContainer.get(0).getBoundingClientRect(),(e=this.$borderTypeButton.get(0).getBoundingClientRect()).left,e.width,t.left,n.left,i.left,this.$clonedDropdown.width(),e=e.left+e.width-t.left-(n.left-i.left)-this.$clonedDropdown.width()-12,this.$clonedDropdown.css({left:e}),o.addClass("hidden"))},i.ShapeBorder=t}(jQuery,DrawerJs.plugins,DrawerJs.plugins.BaseToolOptions,DrawerJs.util),!function(e,t){function i(t){e.call(this,t),this.name="ArrowOneSide",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-arrow-one-side",this.faClass="fa-long-arrow-right",this.tooltip=t.t("Draw an arrow"),this.group={name:"lines",tooltip:t.t("Lines and arrows")},this._setupOptions({}),$.extend(!0,this.options.lineAngleTooltip,t.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily}((i.prototype=Object.create(e.prototype)).constructor=i).prototype.checkOnlyWidthOrHeight=!0,i.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},i.prototype.createShape=function(t,e){t=new fabric.ErasableArrow([t,e,t+1,e+1],{oneSided:!0});return t.set("strokeWidth",this.drawerInstance.lineStrokeWidth||1),t.set("stroke",this.drawerInstance.activeColor),t.set("opacity",this.drawerInstance.activeOpacity),t.set("oneSided",!0),this.createAngleTooltip(t),t},i.prototype.updateShape=function(t,e,i){t.set("y2",i),t.set("x2",e),this.updateAngleTooltip(t)},i.prototype.finishShape=function(t,e){this.removeAngleTooltip()},i.prototype.createAngleTooltip=function(t){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",t.x1-10),this.angleTooltip.set("top",t.y1-10),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(t))},i.prototype.updateAngleTooltip=function(t){var e,i;this.options.lineAngleTooltip.enabled&&(e=Math.atan((t.y2-t.y1)/(t.x2-t.x1)),e=Math.abs(fabric.util.radiansToDegrees(e)),this.angleTooltip.setText(e.toFixed().toString()),e=this.options.lineAngleTooltip.fontSize,i=-this.options.lineAngleTooltip.fontSize,t.x2<t.x1&&(e=-(this.options.lineAngleTooltip.fontSize+10)),t.y2>t.y1&&(i=2),this.angleTooltip.set("left",t.x1+e),this.angleTooltip.set("top",t.y1+i),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color))},i.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},t.ArrowOneSide=i}((jQuery,DrawerJs.plugins.BaseShape),DrawerJs.plugins),!function(e,t){function i(t){e.call(this,t),this.name="ArrowTwoSide",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-arrow-two-side",this.faClass="fa-arrows-h",this.tooltip=t.t("Draw a two-sided arrow"),this.group={name:"lines",tooltip:t.t("Lines and arrows")},this._setupOptions({}),$.extend(!0,this.options.lineAngleTooltip,t.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily}((i.prototype=Object.create(e.prototype)).constructor=i).prototype.checkOnlyWidthOrHeight=!0,i.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},i.prototype.createShape=function(t,e){t=new fabric.ErasableArrow([t,e,t+1,e+1],{oneSided:!1});return t.set("strokeWidth",this.drawerInstance.lineStrokeWidth||1),t.set("stroke",this.drawerInstance.activeColor),t.set("opacity",this.drawerInstance.activeOpacity),t.set("oneSided",!1),this.createAngleTooltip(t),t},i.prototype.updateShape=function(t,e,i){t.set("y2",i),t.set("x2",e),this.updateAngleTooltip(t)},i.prototype.finishShape=function(t,e){this.removeAngleTooltip()},i.prototype.createAngleTooltip=function(t){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",t.x1-this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("top",t.y1-this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(t))},i.prototype.updateAngleTooltip=function(t){var e,i;this.options.lineAngleTooltip.enabled&&(e=Math.atan((t.y2-t.y1)/(t.x2-t.x1)),e=Math.abs(fabric.util.radiansToDegrees(e)),this.angleTooltip.setText(e.toFixed().toString()),e=this.options.lineAngleTooltip.fontSize,i=-this.options.lineAngleTooltip.fontSize,t.x2<t.x1&&(e=-(this.options.lineAngleTooltip.fontSize+10)),t.y2>t.y1&&(i=2),this.angleTooltip.set("left",t.x1+e),this.angleTooltip.set("top",t.y1+i),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color))},i.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},t.ArrowTwoSide=i}((jQuery,DrawerJs.plugins.BaseShape),DrawerJs.plugins),!function(r,t){function e(t,e){r.call(this,t),this.name="Circle",this.btnClass="btn-circle",this.faClass="fa-circle",this.tooltip=t.t("Draw a circle"),this.options=e||{},this.centeringMode=this.options.centeringMode||r.CENTERING_MODE.NORMAL}((e.prototype=Object.create(r.prototype)).constructor=e).prototype.minShapeSize=5,e.prototype.createShape=function(t,e){return this.startLeft=t,this.startTop=e,new fabric.PCircle({left:t,top:e,radius:1,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity})},e.prototype.updateShape=function(t,e,i){var e=e-this.startLeft,i=i-this.startTop,o=Math.abs(e),n=Math.abs(i),o=o<n?o:n,o=Math.abs(o);o/=2,this.centeringMode==r.CENTERING_MODE.FROM_CENTER&&(t.set("left",this.startLeft-(o*=2)),t.set("top",this.startTop-o)),this.centeringMode==r.CENTERING_MODE.NORMAL&&(e<0?t.set("left",this.startLeft-2*o):t.set("left",this.startLeft),i<0?t.set("top",this.startTop-2*o):t.set("top",this.startTop)),t.set("radius",o)},t.Circle=e}((jQuery,DrawerJs.plugins.BaseShape),DrawerJs.plugins),!function(e,i,t,o){function n(t,e){i.call(this,t),this.drawer=t,this.name="Image",this.btnClass="btn-image",this.faClass="fa-image",this.tooltip=t.t("Insert an image"),this._setupOptions(e)}((n.prototype=Object.create(i.prototype)).constructor=n).prototype._defaultOptions={maxImageSizeKb:5120,scaleDownLargeImage:!0,centerImage:!0,cropIsActive:!0,acceptedMIMETypes:["image/jpeg","image/png","image/gif"]},n.prototype._activateTool=function(){var t=this;this.drawerInstance.log("TOOL","Image._activateTool()"),i.prototype._activateTool.call(this),this._showDialog(),o.setTimeout(function(){t.drawerInstance.trigger(t.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,[t])},300)},n.prototype._showDialog=function(){var t=this.options.acceptedMIMETypes.join(",");($el=e('<input type="file" accept="'+t+'">')).on("change",this._processFileInput.bind(this)),$el.click()},n.prototype._processFileInput=function(t){var e,i,o=this,t=t.target.files;t.length<1?o.drawerInstance.showError(this.drawerInstance.t("No file was selected!")):(e=t[0],this._checkFile(e)&&((i=new FileReader).onload=function(t){o.drawerInstance.log("IMAGE LOADED:",e.name),o.options.cropIsActive&&o.drawer._pluginsInstances.ImageCrop?o._triggerImageCrop(i.result):o.loadImage(i.result)},i.readAsDataURL(e)))},n.prototype._checkFile=function(t){return t.type.indexOf("image")<0?(this.drawerInstance.showError(this.drawerInstance.t("Incorrect file type!")),!1):!(0<this.options.maxImageSizeKb&&t.size>1024*this.options.maxImageSizeKb&&(t=(t=this.drawerInstance.t("File is to big!. Maximum file size is "))+this.options.maxImageSizeKb+" KB",this.drawerInstance.showError(t),1))},n.prototype.loadImage=function(t,e){var i=this,o=new Image;o.onload=function(){i.addImage(o,e)},o.onerror=function(){var t=i.drawerInstance.t("Image failed to create!");i.drawerInstance.showError(t)},o.src=t},n.prototype._triggerImageCrop=function(t){t={url:t,callback:this.loadImage.bind(this)};this.drawerInstance.trigger(this.drawerInstance.EVENT_IMAGE_CROP,t)},n.prototype.addImage=function(t,e){var i=this.drawerInstance.fCanvas,t=new fabric.ErasableImage(t);(e=e||this.options).scaleDownLargeImage?this._fitLargeImage(t):(t.left=e.left||0,t.top=e.top||0,t.scaleX=e.scaleX||1,t.scaleY=e.scaleY||1),t.opacity=this.drawerInstance.activeOpacity,e.centerImage&&i.centerObject(t),i.add(t),i.setActiveObject(t)},n.prototype._fitLargeImage=function(t){var e=this.drawerInstance.fCanvas,i=.95*e.width,e=.95*e.height,o=1,n=1,i=(t.width>i&&(o=i/t.width),t.height>e&&(n=e/t.height),Math.min(o,n));t.set({scaleX:i,scaleY:i})},t.Image=n}(jQuery,DrawerJs.plugins.BaseTool,DrawerJs.plugins,DrawerJs.util),!function(t){t.prototype.addImageFromUrl=function(t,e){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("Image").loadImage(t,e)},t.prototype.addImage=function(t,e){this.drawer.api.checkIsActive(),this.drawer.getPluginInstance("Image").addImage(t,e)}}(DrawerJs.DrawerApi),!function(e,i,t){function o(t){i.call(this,t),this.name="Line",this.toolOptionsList=["border","opacity","lineWidth","strokeWidth"],this.btnClass="btn-line",this.faClass="fa-line",this.tooltip=t.t("Draw a line"),this.group={name:"lines",tooltip:t.t("Lines and arrows")},this._setupOptions({}),e.extend(!0,this.options.lineAngleTooltip,t.options.lineAngleTooltip||{}),this.options.lineAngleTooltip.fontFamily+=", "+this._defaultOptions.lineAngleTooltip.fontFamily}((o.prototype=Object.create(i.prototype)).constructor=o).prototype.checkOnlyWidthOrHeight=!0,o.prototype._defaultOptions={lineAngleTooltip:{enabled:!1,fontSize:11,fontFamily:"Arial, sans serif",color:"black"}},o.prototype.createShape=function(t,e){var i=new fabric.ErasableLine;return i.set("x1",t),i.set("x2",t+1),i.set("y1",e),i.set("y2",e+1),i.set("stroke",this.drawerInstance.activeColor),i.set("opacity",this.drawerInstance.activeOpacity),i.set("strokeWidth",this.drawerInstance.lineStrokeWidth||2),this.createAngleTooltip(i),i},o.prototype.updateShape=function(t,e,i){t.set("x2",e),t.set("y2",i),this.updateAngleTooltip(t)},o.prototype.finishShape=function(){this.removeAngleTooltip()},o.prototype.createAngleTooltip=function(t){this.options.lineAngleTooltip.enabled&&(this.angleTooltip=new fabric.IText("Text"),this.angleTooltip.set("fontFamily",this.options.lineAngleTooltip.fontFamily),this.angleTooltip.set("fontSize",this.options.lineAngleTooltip.fontSize),this.angleTooltip.set("left",t.x1-10),this.angleTooltip.set("top",t.y1-10),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color),this.angleTooltip.set("text",""),this.drawerInstance.fCanvas.add(this.angleTooltip),this.updateAngleTooltip(t))},o.prototype.updateAngleTooltip=function(t){var e,i;this.options.lineAngleTooltip.enabled&&(e=Math.atan((t.y2-t.y1)/(t.x2-t.x1)),e=Math.abs(fabric.util.radiansToDegrees(e)),this.angleTooltip.setText(e.toFixed().toString()),e=this.options.lineAngleTooltip.fontSize,i=-this.options.lineAngleTooltip.fontSize,t.x2<t.x1&&(e=-(this.options.lineAngleTooltip.fontSize+10)),t.y2>t.y1&&(i=2),this.angleTooltip.set("left",t.x1+e),this.angleTooltip.set("top",t.y1+i),this.angleTooltip.set("stroke",this.options.lineAngleTooltip.color),this.angleTooltip.set("fill",this.options.lineAngleTooltip.color))},o.prototype.removeAngleTooltip=function(){this.options.lineAngleTooltip.enabled&&this.angleTooltip&&(this.angleTooltip.remove(),delete this.tooltip)},t.Line=o}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins),!function(r,o,t,i){"use strict";function n(t,e){var i=this;o.call(i,t),this.name="Polygon",this.btnClass="btn-polygon",this.faClass="fa-star",this.tooltip=t.t("Draw a Polygon"),this.helpTooltipText=t.t("Click to start a new line"),this.options=e||{},this.centeringMode=this.options.centeringMode||o.CENTERING_MODE.NORMAL,t.on(t.EVENT_EDIT_STOP,function(){i.finishDraw()}),t.on(t.EVENT_DO_ACTIVATE_TOOL,function(t,e){e instanceof n||i.finishDraw()})}var s=i.mouseDown("Polygon"),a=i.mouseMove("Polygon"),h=i.mouseUp("Polygon");((n.prototype=Object.create(o.prototype)).constructor=n).prototype.setUpHandlers=function(){function e(t){i.addNewPoint(t),i.poly.__mouseEventSet||(i.setUpMoveEvent(),i.poly.__mouseEventSet=!0),i.drawerInstance.fCanvas.renderAll()}var i=this,o=(i.drawerInstance.fCanvas._oldSelectionState=i.drawerInstance.fCanvas.selection,i.drawerInstance.fCanvas.selection=!1,i.$stopButton=r('<button class="stop-polygon">'+i.drawerInstance.t("Stop drawing a polygon")+"</button>"),i.drawerInstance.$canvasEditContainer.append(i.$stopButton),i.$stopButton.click(function(){i.finishDraw()}),i.drawerInstance.on(i.drawerInstance.EVENT_KEYDOWN,function(t,e){27==e.which&&i.finishDraw()}),r(this.drawerInstance.fCanvas.upperCanvasEl));i.drawerInstance.touchDevice?(o.on(s,function(t){return e(t),t.preventDefault(),t.stopPropagation(),!1}),o.on(h,function(t){return o.off(a),i.poly.__mouseEventSet=!1,t.preventDefault(),t.stopPropagation(),!1})):o.on(s,function(t){return e(t),t.preventDefault(),t.stopPropagation(),!1})},n.prototype.addNewPoint=function(t){var e=this,t=this.drawer.fCanvas.getPointer(t),i=t.x,t=t.y,o=(e.poly||(e.startLeft=i,e.startTop=t,e.poly=new fabric.SegmentablePolygon([[{x:0,y:0}]]),e.poly.set("fill",e.drawerInstance.activeColor),e.poly.set("opacity",e.drawerInstance.activeOpacity),e.poly.set("left",i),e.poly.set("top",t),e.poly.set("evented",!1),e.poly.set("selectable",!1),e.drawerInstance.fCanvas.add(e.poly)),e.poly.get("points")),n=e.poly.getCenterPoint();i-=n.x,t-=n.y,o[0].push({x:i,y:t}),e.poly.set("points",o),e.fixPosition()},n.prototype.setUpMoveEvent=function(){var n=this;r(this.drawerInstance.fCanvas.upperCanvasEl).on(a,function(t){var e=n.poly.get("points"),t=n.drawerInstance.fCanvas.getPointer(t),i=n.poly.getCenterPoint(),o=t.x-i.x,t=t.y-i.y;2<=e[0].length&&(e[0][e[0].length-1].x=o,e[0][e[0].length-1].y=t,n.poly.set("points",e),n.fixPosition(),n.drawerInstance.fCanvas.renderAll())})},n.prototype.fixPosition=function(){var t=this,e=(t.poly._fixPoints(),t.poly.setCoords(),t.poly.get("points")),i=t.poly.getCenterPoint(),o=i.x+e[0][0].x,i=i.y+e[0][0].y,e=t.startLeft-o,o=t.startTop-i;t.poly.set("left",t.poly.get("left")+e),t.poly.set("top",t.poly.get("top")+o)},n.prototype.finishDraw=function(){var t=this,e=(t.drawerInstance.fCanvas.selection=t.drawerInstance.fCanvas._oldSelectionState,r(this.drawerInstance.fCanvas.upperCanvasEl));e.off(a),e.off(s),e.off(h),i.unbindLongPress(e,"polygon"),t.poly&&(t.drawerInstance.touchDevice||((e=this.poly.get("points"))[0].splice(e[0].length-1,1),this.poly.set("points",e)),this.fixPosition(),t.poly.set("evented",!0),t.poly.set("selectable",!0),e=this.poly.clone(),this.drawerInstance.fCanvas.add(e),this.drawerInstance.fCanvas.remove(this.poly)),this.poly=null,this.drawerInstance.fCanvas.renderAll(),t.$stopButton&&i.setTimeout(function(){t.$stopButton.remove()},1),this._deactivateTool()},t.Polygon=n}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins,DrawerJs.util),!function(r,t){function e(t,e){r.call(this,t),this.name="Rectangle",this.btnClass="btn-rectangle",this.faClass="fa-stop",this.tooltip=t.t("Draw a rectangle"),this.options=e||{},this.centeringMode=this.options.centeringMode||r.CENTERING_MODE.NORMAL}((e.prototype=Object.create(r.prototype)).constructor=e).prototype.createShape=function(t,e){return this.startLeft=t,this.startTop=e,new fabric.PRect({left:t,top:e,height:1,width:1,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity})},e.prototype.updateShape=function(t,e,i){var o=e-this.startLeft,n=i-this.startTop;this.centeringMode==r.CENTERING_MODE.FROM_CENTER&&(n*=2,t.set("left",e-(o*=2)),t.set("top",i-n)),0<o?t.set("width",o):(t.set("left",e),t.set("width",-1*o)),0<n?t.set("height",n):(t.set("top",i),t.set("height",-1*n))},t.Rectangle=e}((jQuery,DrawerJs.plugins.BaseShape),DrawerJs.plugins),!function(p,i,t){"use strict";function e(t,e){i.call(this,t),this._setupOptions(e),this.tooltip=this.drawerInstance.t("Draw a text"),this.helpTooltipText=this.drawerInstance.t("Click to place a text"),this.drawerInstance.on(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED+this.eventNs,this._onOptionsToolbarCreated.bind(this))}((e.prototype=Object.create(i.prototype)).constructor=e).prototype.name="Text",e.prototype.toolOptionsList=["color","border","opacity"],e.prototype.eventNs=".textTool",e.prototype.name="Text",e.prototype.btnClass="btn-text",e.prototype.faClass="fa-font",e.prototype._onOptionsToolbarCreated=function(t,e){this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_SELECTION_CHANGED,this._onTextSelectionChanged.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_EDITING_ENTERED,this._onTextEditingEntered.bind(this)),this.drawerInstance.on(this.drawerInstance.EVENT_TEXT_EDITING_EXITED,this._onTextEditingExited.bind(this))},e.prototype._deactivateTool=function(){this.active&&i.prototype._deactivateTool.call(this)},e.prototype.removeTool=function(t){t&&this.drawerInstance.off(this.drawerInstance.EVENT_OPTIONS_TOOLBAR_CREATED+this.eventNs),i.prototype.removeTool.call(this,t)},e.prototype._onTextEditingEntered=function(t,e){console.info("EVENT_TEXT_EDITING_ENTERED"),this._onTextSelectionChanged(t,e)},e.prototype._onTextEditingExited=function(t,e){e&&e.target&&(e.target._lastSelection=void 0,e.target._lastStyles=void 0)},e.prototype._onTextSelectionChanged=function(t,e){var r,s,a,h,e=e&&e.target||this.drawerInstance.getActiveObject(),i={start:e.selectionStart,end:e.selectionEnd},o=e._lastSelection||{},n=i.start===i.end,l=0===i.start,c=i.start===o.start&&void 0!==i.start,o=i.end===o.end&&void 0!==i.end;c&&o||(e._lastSelection=i,r=e.getObjStyles(),c=e._lastStyles||{},o=n&&!l&&e.getSelectionStyles(i.start-1),a=o||e.getSelectionStyles(),l=e._hasStyleChanged(c,o||a),s=[],n||(a=p.extend(!0,{},a),o=e.getSelectionStyles(i.start,i.end),h=p.extend(!0,{},o[0]),o.forEach(function(t,e){for(var i in r){var o=t[i]!==h[i],n=-1!==s.indexOf(i);o&&!n&&(s.push(i),a[i]=void 0)}}),l=s.length||e._hasStyleChanged(c,a)),this.drawerInstance.setTemporaryStyles(a),l&&(e._lastStyles=a,(n=this.drawerInstance).trigger(n.EVENT_TEXT_STYLES_CHANGED,[a,r,s])))},e.prototype.addShape=function(t,e,i,o){o=o||{},t=(t=parseInt(t,10))||0===t?t:0,e=parseInt(e,10);i=this.createShape(t,e=e||0===e?e:0,i,o);i.set("left",t),i.set("top",e),this.shape=i,this.finishItemDraw(),this.onlyOneItem&&this.drawerInstance.trigger(this.drawerInstance.EVENT_DO_DEACTIVATE_TOOL,this)},e.prototype.createShape=function(t,e,i,o){o=o||{},i=i||"Text",this.startLeft=t,this.startTop=e,this.text=new fabric.ErasableText(i,{editIconMode:this.options.editIconMode,editIconSize:this.options.editIconSize});var i=this.drawerInstance,n=this.options.defaultValues||{},r={};return i.trigger(i.EVENT_TEXT_GET_STYLES,[this,r]),(r=r||{}).defaultValues=r.defaultValues||{},this.text.set("fontFamily",o.fontFamily||n.fontFamily||r.defaultValues.fontFamily),this.text.set("fontSize",o.fontSize||n.fontSize||r.defaultValues.fontSize),this.text.set("lineHeight",o.lineHeight||n.lineHeight||r.defaultValues.lineHeight),this.text.set("fill",o.fill||n.fill||r.defaultValues.fill||this.drawerInstance.activeColor),this.text.set("opacity",o.opacity||n.opacity||r.defaultValues.opacity||this.drawerInstance.activeOpacity),this.text.set("left",t-this.text.width/2),this.text.set("top",e-this.text.height/2),this.text},e.prototype.updateShape=function(t,e,i){},e.prototype.isObjectText=function(t){return t instanceof fabric.IText},t.Text=e}(jQuery,DrawerJs.plugins.BaseShape,DrawerJs.plugins,DrawerJs.util),!function(r,t){function e(t,e){r.call(this,t),this.name="Triangle",this.btnClass="btn-triangle",this.faClass="fa-play",this.tooltip=t.t("Draw a triangle"),this.options=e||{},this.centeringMode=this.options.centeringMode||r.CENTERING_MODE.NORMAL}(e.prototype=Object.create(r.prototype)).constructor=e,r.prototype.minShapeSize=8,e.prototype.createShape=function(t,e){return this.startLeft=t,this.startTop=e,new fabric.PTriangle({width:1,height:1,left:t,top:e,fill:this.drawerInstance.activeColor,opacity:this.drawerInstance.activeOpacity})},e.prototype.updateShape=function(t,e,i){var o=e-this.startLeft,n=i-this.startTop;this.centeringMode===r.CENTERING_MODE.NORMAL?(0<o?t.set("width",o):t.set("width",-1*o),t.set("left",e),0<n?(t.set("angle",0),t.set("height",n),0<o?t.set("left",e-o):t.set("left",e)):(t.set("angle",180),t.set("height",-1*n),t.set("top",i+-1*n),0<o?t.set("left",e):t.set("left",e+-1*o))):this.centeringMode===r.CENTERING_MODE.FROM_CENTER&&(n*=2,t.set("left",e-(o*=2)),t.set("top",i-n),t.set("width",o),t.set("height",n))},t.Triangle=e}((jQuery,DrawerJs.plugins.BaseShape),DrawerJs.plugins);